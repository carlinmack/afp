<div id="PAL">
<div class="head">
<h1>Theory PAL</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:      PAL.thy
  Author:    Asta Halkjær From

  This work is a formalization of public announcement logic with countably many agents.
  It includes proofs of soundness and completeness for a variant of the axiom system
    PA + DIST! + NEC!.
  The completeness proof builds on the Epistemic Logic theory.
*)</span>

<span class="keyword1"><span class="command">theory</span></span> PAL <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../epistemic_logic/theories/#Epistemic_Logic">Epistemic_Logic.Epistemic_Logic</a>"</span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Syntax›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'i</span> pfm
  <span class="main">=</span> FF <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Pro' <span class="quoted">id</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Dis <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm›</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 30<span class="main">)</span>
  <span class="main">|</span> Con <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm›</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 35<span class="main">)</span>
  <span class="main">|</span> Imp <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm›</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 25<span class="main">)</span>
  <span class="main">|</span> K' <span class="tfree"><span class="quoted"><span class="tfree">'i</span></span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm›</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Ann <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm›</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm›</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">[</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">]<span class="hidden">⇩</span><sub>!</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>50<span class="main">,</span> 50<span class="main">]</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">PIff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm <span class="main">⇒</span> <span class="tfree">'i</span> pfm <span class="main">⇒</span> <span class="tfree">'i</span> pfm›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span>"</span> 25<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semantics›</span></span>

<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">psemantics</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> kripke <span class="main">⇒</span> <span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'i</span> pfm <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span> _ <span class="keyword1">⊨<span class="hidden">⇩</span><sub>!</sub></span> _"</span> <span class="main">[</span>50<span class="main">,</span> 50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">restrict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> kripke <span class="main">⇒</span> <span class="tfree">'i</span> pfm <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'i</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> kripke›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span><span class="main">)</span> <span class="main">=</span> False›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> π <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> 𝒦 <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="bound">v</span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">restrict</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">restrict</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Kripke <span class="main">(</span>π <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">w</span><span class="main">.</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> 𝒦 <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">i</span> <span class="bound">w</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free">,</span></span> <span class="bound">v</span> <span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">static</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">static</span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">=</span> True›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">static</span> <span class="main">(</span><span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">static</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">static</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free">static</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">static</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">static</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free">static</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">static</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">static</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free">static</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">static</span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">static</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">static</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> False›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">lower</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm <span class="main">⇒</span> <span class="tfree">'i</span> fm›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">lower</span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">lower</span> <span class="main">(</span><span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> Pro <span class="free"><span class="bound"><span class="entity">x</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">lower</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">lower</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">lower</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">lower</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">lower</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">lower</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">lower</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">lower</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free">lower</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">lower</span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free">lower</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">lower</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> undefined›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">lift</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> fm <span class="main">⇒</span> <span class="tfree">'i</span> pfm›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">lift</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">lift</span> <span class="main">(</span>Pro <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">lift</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">lift</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">lift</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">lift</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">lift</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">lift</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">lift</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">lift</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">lift</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">lift</span> <span class="main">(</span>K <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free">lift</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1" id="PAL-lower_semantics"><span class="command">lemma</span></span> lower_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹static <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨</span> lower <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="PAL-lift_semantics"><span class="command">lemma</span></span> lift_semantics<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> lift <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="PAL-lower_lift"><span class="command">lemma</span></span> lower_lift<span class="main">:</span> <span class="quoted"><span class="quoted">‹lower <span class="main">(</span>lift <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="PAL-lift_lower"><span class="command">lemma</span></span> lift_lower<span class="main">:</span> <span class="quoted"><span class="quoted">‹static <span class="free">p</span> <span class="main">⟹</span> lift <span class="main">(</span>lower <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Soundness of Reduction›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">reduce'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm <span class="main">⇒</span> <span class="tfree">'i</span> pfm <span class="main">⇒</span> <span class="tfree">'i</span> pfm›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> undefined›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">reduce</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm <span class="main">⇒</span> <span class="tfree">'i</span> pfm›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">reduce</span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce</span> <span class="main">(</span><span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">reduce</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">reduce</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">reduce</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">reduce</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">reduce</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">reduce</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce</span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free">reduce</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">reduce</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> reduce' <span class="main">(</span><span class="free">reduce</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">reduce</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1" id="PAL-static_reduce'"><span class="command">lemma</span></span> static_reduce'<span class="main">:</span> <span class="quoted"><span class="quoted">‹static <span class="free">p</span> <span class="main">⟹</span> static <span class="free">r</span> <span class="main">⟹</span> static <span class="main">(</span>reduce' <span class="free">r</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="PAL-static_reduce"><span class="command">lemma</span></span> static_reduce<span class="main">:</span> <span class="quoted"><span class="quoted">‹static <span class="main">(</span>reduce <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> static_reduce'<span class="main">)</span>

<span class="keyword1" id="PAL-reduce'_semantics"><span class="command">lemma</span></span> reduce'_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹static <span class="free">q</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">p</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> reduce' <span class="free">p</span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="PAL-reduce_semantics"><span class="command">lemma</span></span> reduce_semantics<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> reduce <span class="free">p</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ann <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reduce'_semantics static_reduce <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proof System›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">peval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>id <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'i</span> pfm <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'i</span> pfm <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">peval</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">=</span> False›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">peval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span><span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">peval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">peval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∨</span> <span class="free">peval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">peval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">peval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="free">peval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">peval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">peval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟶</span> <span class="free">peval</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">peval</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">peval</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ptautology</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">g</span> <span class="bound">h</span><span class="main">.</span> peval <span class="bound">g</span> <span class="bound">h</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">PA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>!</sub></span> _"</span> <span class="main">[</span>50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  PA1<span class="main">:</span> <span class="quoted"><span class="quoted">‹ptautology <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
<span class="main">|</span> PA2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> PR1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>›</span></span>
<span class="main">|</span> PR2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
<span class="main">|</span> PR3<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>›</span></span>
<span class="main">|</span> PFF<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> PPro<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> PDis<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> PCon<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> PImp<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> PK<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>!</sub></span></span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1" id="PAL-eval_peval"><span class="command">lemma</span></span> eval_peval<span class="main">:</span> <span class="quoted"><span class="quoted">‹eval <span class="free">h</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> lift<span class="main">)</span> <span class="free">p</span> <span class="main">=</span> peval <span class="free">h</span> <span class="free">g</span> <span class="main">(</span>lift <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="PAL-tautology_ptautology"><span class="command">lemma</span></span> tautology_ptautology<span class="main">:</span> <span class="quoted"><span class="quoted">‹tautology <span class="free">p</span> <span class="main">⟹</span> ptautology <span class="main">(</span>lift <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> eval_peval <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="PAL-peval_eval"><span class="command">lemma</span></span> peval_eval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹static <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹eval <span class="free">h</span> <span class="free">g</span> <span class="main">(</span>lower <span class="free">p</span><span class="main">)</span> <span class="main">=</span> peval <span class="free">h</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> lower<span class="main">)</span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="PAL-ptautology_tautology"><span class="command">lemma</span></span> ptautology_tautology<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹static <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹ptautology <span class="free">p</span> <span class="main">⟹</span> tautology <span class="main">(</span>lower <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms peval_eval <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> SystemK_PAK<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> lift <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SystemK.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> PA.intros<span class="main"><span class="main">(</span></span>1-5<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tautology_ptautology<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> static_completeness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹static <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">,</span> <span class="tfree">'i</span> fm set<span class="main">)</span> kripke<span class="main">)</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">,</span> <span class="tfree">'i</span> fm set<span class="main">)</span> kripke<span class="main">)</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">w</span> <span class="main">⊨</span> lower <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lower_semantics<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢</span> lower <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> completeness<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> lift <span class="main">(</span>lower <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> SystemK_PAK <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> lift_lower <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1" id="PAL-peval_semantics"><span class="command">lemma</span></span> peval_semantics<span class="main">:</span> <span class="quoted"><span class="quoted">‹peval <span class="main">(</span><span class="free">val</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> Kripke <span class="free">val</span> <span class="free">r</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="bound">q</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>Kripke <span class="free">val</span> <span class="free">r</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="PAL-ptautology"><span class="command">lemma</span></span> ptautology<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹ptautology <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹peval <span class="main">(</span><span class="skolem">g</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> Kripke <span class="skolem">g</span> <span class="skolem">r</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="bound">q</span><span class="main">)</span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="skolem">r</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Kripke <span class="skolem">g</span> <span class="skolem">r</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="skolem">r</span>
    <span class="keyword1"><span class="command">using</span></span> peval_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kripke.collapse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> soundness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M</span><span class="main">,</span> <span class="free">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> PA.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ptautology<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="keyword1" id="PAL-ConE"><span class="command">lemma</span></span> ConE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PA1 PR1 peval.simps<span class="main"><span class="main">(</span></span>4-5<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="PAL-Iff_Dis"><span class="command">lemma</span></span> Iff_Dis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p'</span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p'</span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PA1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms PR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PAL-Iff_Con"><span class="command">lemma</span></span> Iff_Con<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p'</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p'</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PA1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms PR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PAL-Iff_Imp"><span class="command">lemma</span></span> Iff_Imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p'</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p'</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PA1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms PR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PAL-Iff_sym"><span class="command">lemma</span></span> Iff_sym<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PA1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> PR1 ConE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PAL-Iff_Iff"><span class="command">lemma</span></span> Iff_Iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p'</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹ptautology <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p'</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> peval.simps<span class="main"><span class="main">(</span></span>4-5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> PA1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p'</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms PR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PAL-K'_A2'"><span class="command">lemma</span></span> K'_A2'<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> PA2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="skolem">P</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">Q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">R</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="skolem">Q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">P</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">R</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'i</span> pfm›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PA1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> PR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PAL-K'_map"><span class="command">lemma</span></span> K'_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> PR2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">i</span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> K'_A2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> PR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PAL-ConI"><span class="command">lemma</span></span> ConI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PA1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms PR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PAL-Iff_wk"><span class="command">lemma</span></span> Iff_wk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PA1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms PR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PAL-Iff_reduce'"><span class="command">lemma</span></span> Iff_reduce'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹static <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> reduce' <span class="free">r</span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> pfm.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> FF
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PFF<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pro' <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PPro<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dis <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> reduce' <span class="free">r</span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Iff_Dis <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> PDis Iff_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> PA1 PR1 Iff_Iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Con <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> reduce' <span class="free">r</span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Iff_Con <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> PCon Iff_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> PA1 PR1 Iff_Iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> reduce' <span class="free">r</span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Iff_Imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> PImp Iff_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> PA1 PR1 Iff_Iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>K' <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> reduce' <span class="free">r</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="main">(</span>reduce' <span class="free">r</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> K'_map ConE ConI <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> PK <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="main">(</span>reduce' <span class="free">r</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Iff_Iff Iff_sym Iff_wk<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ann <span class="skolem">r</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PAL-Iff_Ann1"><span class="command">lemma</span></span> Iff_Ann1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">r'</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹static <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r'</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> FF
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">r'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">r'</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> PA1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">r'</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main"><span class="hidden">❙</span><b>⊥</b><span class="hidden">⇩</span><sub>!</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> r PR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> PFF Iff_Iff Iff_sym<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pro' <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">r'</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">r'</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> PA1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">r'</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">Pro<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> r PR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> PPro Iff_Iff Iff_sym<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dis <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r'</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∨</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r'</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Iff_Dis<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> PDis Iff_Iff Iff_sym<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Con <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r'</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∧</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r'</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Iff_Con<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> PCon Iff_Iff Iff_sym<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r'</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Iff_Imp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> PImp Iff_Iff Iff_sym<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>K' <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r'</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> K'_map ConE ConI <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Iff_Iff Iff_Imp Iff_sym PK r<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ann <span class="skolem">s</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PAL-Iff_Ann2"><span class="command">lemma</span></span> Iff_Ann2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p'</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="free">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p'</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ConE ConI PImp PR1 PR3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="PAL-Iff_reduce"><span class="command">lemma</span></span> Iff_reduce<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> reduce <span class="free">p</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dis <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Iff_Dis<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Con <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Iff_Con<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Imp <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Iff_Imp<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>K' <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="main">(</span>reduce <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="main">(</span>reduce <span class="skolem">p</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟶</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> K' K'_map ConE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="keyword1">K<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">i</span> <span class="main">(</span>reduce <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ConI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ann <span class="skolem">r</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span>reduce <span class="skolem">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> reduce <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> reduce' <span class="main">(</span>reduce <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>reduce <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Iff_reduce' static_reduce <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="skolem">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> reduce <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span>reduce <span class="skolem">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> reduce <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ann<span class="main">(</span>1<span class="main">)</span> Iff_Ann1 static_reduce <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="skolem">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> reduce <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> reduce' <span class="main">(</span>reduce <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>reduce <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Iff_Iff Iff_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="skolem">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> reduce <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> <span class="main">[</span><span class="skolem">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ann<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> static_reduce Iff_Ann2 Iff_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="main">[</span><span class="skolem">r</span><span class="main">]<span class="hidden">⇩</span><sub>!</sub></span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> reduce' <span class="main">(</span>reduce <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>reduce <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Iff_Iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PA1<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> completeness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">,</span> <span class="tfree">'i</span> fm set<span class="main">)</span> kripke<span class="main">)</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="free">p</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="main">(</span><span class="bound">M</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">::</span> countable<span class="main">,</span> <span class="tfree">'i</span> fm set<span class="main">)</span> kripke<span class="main">)</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">M</span><span class="main">,</span> <span class="bound">w</span> <span class="main">⊨<span class="hidden">⇩</span><sub>!</sub></span> reduce <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms reduce_semantics <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹static <span class="main">(</span>reduce <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> static_reduce <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> reduce <span class="free">p</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> static_completeness <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⊢<span class="hidden">⇩</span><sub>!</sub></span> <span class="main">(</span><span class="free">p</span> <span class="main"><span class="hidden">❙</span><b>⟷</b><span class="hidden">⇩</span><sub>!</sub></span> reduce <span class="free">p</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Iff_reduce <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> ConE<span class="main">(</span>2<span class="main">)</span> PR1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>