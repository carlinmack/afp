<div id="Compiler">
<div class="head">
<h1>Theory Compiler</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Shorter Compiler Correctness Proof for Language IMP
    Author:      Pasquale Noce
                 Software Engineer at HID Global, Italy
                 pasquale dot noce dot lavoro at gmail dot com
                 pasquale dot noce at hidglobal dot com
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Compiler formalization"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Compiler
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-IMP/BExp.html">HOL-IMP.BExp</a>"</span>
    <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-IMP/Star.html">HOL-IMP.Star</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Introduction"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This paper presents a compiler correctness proof for the didactic imperative programming language
IMP, introduced in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Nipkow14"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, shorter than the proof described in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Nipkow14"<span class="antiquote"><span class="antiquote">}</span></span></span></span> and
included in the Isabelle2021 distribution <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Klein21"<span class="antiquote"><span class="antiquote">}</span></span></span></span>. Actually, the size of the presented
proof is just two thirds of the book's proof in the number of formal text lines, and as such it
promises to constitute a further enhanced reference for the formal verification of compilers meant
for larger, real-world programming languages.

Given compiler \emph{completeness}, viz. the simulation of source code execution by compiled code,
"in a deterministic language like IMP", compiler correctness "reduces to preserving termination: if
the machine program terminates, so must the source program", even though proving this "is not much
easier" (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Nipkow14"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, section 8.4). However, the presented proof does not depend on language
determinism, so that the proposed approach is applicable to non-deterministic languages as well.

As a confirmation, this paper extends IMP with an additional command <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"c<span class="hidden">⇩</span><sub>1</sub> OR c<span class="hidden">⇩</span><sub>2</sub>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, standing
for the non-deterministic choice between commands <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">c<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">c<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and proves compiler
\emph{correctness}, viz. the simulation of compiled code execution by source code, for such extended
language. Of course, the aforesaid comparison between proof sizes does not consider the lines in the
proof of lemma <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ccomp_correct</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (which proves compiler correctness for commands) pertaining to
non-deterministic choice, since this command is not included in the original language IMP. Anyway,
non-deterministic choice turns out to extend that proof just by a modest number of lines.

For further information about the formal definitions and proofs contained in this paper, see
Isabelle documentation, particularly <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Paulson21"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Nipkow21"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Krauss21"<span class="antiquote"><span class="antiquote">}</span></span></span></span>,
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Nipkow11"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Definitions"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Here below are the definitions of IMP commands, extended with non-deterministic choice, as well as
of their big-step semantics.

As in the original theory file <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Klein21"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, program counter's values are modeled using type
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">int</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> rather than <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">nat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. As a result, the same declarations and definitions used in
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Klein21"<span class="antiquote"><span class="antiquote">}</span></span></span></span> to deal with this modeling choice are adopted here as well.

\null
›</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion_enabled</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"int <span class="main">::</span> nat <span class="main">⇒</span> int"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">syntax_ambiguity_warning</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">datatype</span></span> com <span class="main">=</span>
  SKIP <span class="main">|</span>
  Assign <span class="quoted">vname</span> <span class="quoted">aexp</span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">::=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>1000<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Seq <span class="quoted">com</span> <span class="quoted">com</span>  <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span> <span class="main">[</span>60<span class="main">,</span> 61<span class="main">]</span> 60<span class="main">)</span> <span class="main">|</span>
  If <span class="quoted">bexp</span> <span class="quoted">com</span> <span class="quoted">com</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">IF</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">THEN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">ELSE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Or <span class="quoted">com</span> <span class="quoted">com</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">OR</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>60<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  While <span class="quoted">bexp</span> <span class="quoted">com</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">WHILE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">DO</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">big_step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">×</span> state <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⇒</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
Skip<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
Assign<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
Seq<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>3</sub></span></span></span>"</span></span> <span class="main">|</span>
IfTrue<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> <span class="main">|</span>
IfFalse<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> <span class="main">|</span>
Or1<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">OR</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> <span class="main">|</span>
Or2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">OR</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> <span class="main">|</span>
WhileFalse<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
WhileTrue<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">;</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>3</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> big_step.intros <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">output</span></span><span class="main">)</span>
<span class="quoted"><span class="quoted">"<span class="free">isize</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> int <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> isize <span class="main">(</span><span class="quoted">"<span class="keyword1">size</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="main">(</span>nonexhaustive<span class="main">)</span> <span class="entity">inth</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> int <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">!!</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main"><span class="free">!!</span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">!!</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Compiler-inth_append"><span class="command">lemma</span></span> inth_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="keyword1">size</span> <span class="free">xs</span> <span class="keyword1">then</span> <span class="free">xs</span> <span class="main">!!</span> <span class="free">i</span> <span class="keyword1">else</span> <span class="free">ys</span> <span class="main">!!</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="keyword1">size</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Next, the instruction set and its semantics are defined. Particularly, to allow for the compilation
of non-deterministic choice commands, the instruction set is extended with an additional instruction
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">JMPND</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> performing a non-deterministic jump -- viz. as a result of its execution, the program
counter unconditionally either jumps by the specified offset, or just moves to the next instruction.

As instruction execution can be non-deterministic, an inductively defined predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">iexec</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
rather than a simple non-recursive function as the one used in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Klein21"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, must be introduced
to define instruction semantics.

\null
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> instr <span class="main">=</span> 
  LOADI <span class="quoted">int</span> <span class="main">|</span> LOAD <span class="quoted">vname</span> <span class="main">|</span> ADD <span class="main">|</span> STORE <span class="quoted">vname</span> <span class="main">|</span>
  JMP <span class="quoted">int</span> <span class="main">|</span> JMPLESS <span class="quoted">int</span> <span class="main">|</span> JMPGE <span class="quoted">int</span> <span class="main">|</span> JMPND <span class="quoted">int</span>

<span class="keyword1"><span class="command">type_synonym</span></span> stack <span class="main">=</span> <span class="quoted"><span class="quoted">"val list"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> config <span class="main">=</span> <span class="quoted"><span class="quoted">"int <span class="main">×</span> state <span class="main">×</span> stack"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">hd2</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> hd <span class="main">(</span>tl <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">tl2</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> tl <span class="main">(</span>tl <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">iexec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"instr <span class="main">×</span> config <span class="main">⇒</span> config <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">↦</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
LoadI<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>LOADI <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pc</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pc</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
Load<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>LOAD <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pc</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pc</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
Add<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>ADD<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pc</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pc</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="main">(</span>hd2 <span class="free"><span class="bound"><span class="entity">stk</span></span></span> <span class="main">+</span> hd <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main">#</span> tl2 <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
Store<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>STORE <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pc</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pc</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> hd <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span><span class="main">,</span> tl <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
Jmp<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>JMP <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pc</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pc</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
JmpLessY<span class="main">:</span>  <span class="quoted"><span class="quoted">"hd2 <span class="free"><span class="bound"><span class="entity">stk</span></span></span> <span class="main">&lt;</span> hd <span class="free"><span class="bound"><span class="entity">stk</span></span></span> <span class="main">⟹</span>
  <span class="main">(</span>JMPLESS <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pc</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pc</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> tl2 <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
JmpLessN<span class="main">:</span>  <span class="quoted"><span class="quoted">"hd <span class="free"><span class="bound"><span class="entity">stk</span></span></span> <span class="main">≤</span> hd2 <span class="free"><span class="bound"><span class="entity">stk</span></span></span> <span class="main">⟹</span>
  <span class="main">(</span>JMPLESS <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pc</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pc</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> tl2 <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
JmpGeY<span class="main">:</span>  <span class="quoted"><span class="quoted">"hd <span class="free"><span class="bound"><span class="entity">stk</span></span></span> <span class="main">≤</span> hd2 <span class="free"><span class="bound"><span class="entity">stk</span></span></span> <span class="main">⟹</span>
  <span class="main">(</span>JMPGE <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pc</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pc</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> tl2 <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
JmpGeN<span class="main">:</span>  <span class="quoted"><span class="quoted">"hd2 <span class="free"><span class="bound"><span class="entity">stk</span></span></span> <span class="main">&lt;</span> hd <span class="free"><span class="bound"><span class="entity">stk</span></span></span> <span class="main">⟹</span>
  <span class="main">(</span>JMPGE <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pc</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pc</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> tl2 <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
JmpNdY<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>JMPND <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pc</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pc</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
JmpNdN<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>JMPND <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pc</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span> <span class="main"><span class="free">↦</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pc</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">stk</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> iexec.intros <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

<span class="keyword1"><span class="command">inductive_cases</span></span> LoadIE  <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>LOADI <span class="free">i</span><span class="main">,</span> <span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">↦</span> <span class="free">cf</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> LoadE  <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>LOAD <span class="free">x</span><span class="main">,</span> <span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">↦</span> <span class="free">cf</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> AddE  <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>ADD<span class="main">,</span> <span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">↦</span> <span class="free">cf</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> StoreE  <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>STORE <span class="free">x</span><span class="main">,</span> <span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">↦</span> <span class="free">cf</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> JmpE  <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>JMP <span class="free">i</span><span class="main">,</span> <span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">↦</span> <span class="free">cf</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> JmpLessE  <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>JMPLESS <span class="free">i</span><span class="main">,</span> <span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">↦</span> <span class="free">cf</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> JmpGeE  <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>JMPGE <span class="free">i</span><span class="main">,</span> <span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">↦</span> <span class="free">cf</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> JmpNdE  <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>JMPND <span class="free">i</span><span class="main">,</span> <span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">↦</span> <span class="free">cf</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">exec1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"instr list <span class="main">⇒</span> config <span class="main">⇒</span> config <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">⊢</span><span class="keyword3">/ </span>_<span class="keyword3">/ </span><span class="keyword1">→</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">cf'</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">!!</span> fst <span class="free"><span class="bound"><span class="entity">cf</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cf</span></span></span><span class="main">)</span> <span class="main">↦</span> <span class="free"><span class="bound"><span class="entity">cf'</span></span></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> fst <span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="main">∧</span> fst <span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="main">&lt;</span> <span class="keyword1">size</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">exec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"instr list <span class="main">⇒</span> config <span class="main">⇒</span> config <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">⊢</span><span class="keyword3">/ </span>_<span class="keyword3">/ </span><span class="keyword1">→*</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">exec</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> star <span class="main">(</span>exec1 <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Next, compilation is formalized for arithmetic and boolean expressions (functions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">acomp</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">bcomp</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>), as well as for commands (function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ccomp</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>). Particularly, as opposed to what
happens in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Klein21"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, here <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">bcomp</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> takes a single input, viz. a 3-tuple comprised of
a boolean expression, a flag, and a jump offset. In this way, all three functions accept a single
input, which enables to streamline the compiler correctness proof developed in what follows.

\null
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">acomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"aexp <span class="main">⇒</span> instr list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">acomp</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>LOADI <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">acomp</span> <span class="main">(</span>V <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>LOAD <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">acomp</span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">acomp</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">@</span> <span class="free">acomp</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">@</span> <span class="main">[</span>ADD<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bcomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bexp <span class="main">×</span> bool <span class="main">×</span> int <span class="main">⇒</span> instr list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bcomp</span> <span class="main">(</span>Bc <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">then</span> <span class="main">[</span>JMP <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">bcomp</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">bcomp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">bcomp</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">cb<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">bcomp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">;</span>
     <span class="bound">cb<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">bcomp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> False<span class="main">,</span> <span class="keyword1">size</span> <span class="bound">cb<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">in</span> <span class="bound">cb<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="bound">cb<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">bcomp</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span>
  acomp <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">@</span> acomp <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">@</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">then</span> <span class="main">[</span>JMPLESS <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[</span>JMPGE <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">ccomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> instr list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ccomp</span> SKIP <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ccomp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> acomp <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">@</span> <span class="main">[</span>STORE <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ccomp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">ccomp</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">@</span> <span class="free">ccomp</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ccomp</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ccomp</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;</span> <span class="bound">cc<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">ccomp</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">;</span> <span class="bound">cb</span> <span class="main">=</span> bcomp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> False<span class="main">,</span> <span class="keyword1">size</span> <span class="bound">cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
   <span class="keyword1">in</span> <span class="bound">cb</span> <span class="main">@</span> <span class="bound">cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> JMP <span class="main">(</span><span class="keyword1">size</span> <span class="bound">cc<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="bound">cc<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ccomp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">OR</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ccomp</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;</span> <span class="bound">cc<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">ccomp</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span>
   <span class="keyword1">in</span> JMPND <span class="main">(</span><span class="keyword1">size</span> <span class="bound">cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">#</span> <span class="bound">cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> JMP <span class="main">(</span><span class="keyword1">size</span> <span class="bound">cc<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="bound">cc<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ccomp</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">cc</span> <span class="main">=</span> <span class="free">ccomp</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span> <span class="bound">cb</span> <span class="main">=</span> bcomp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> False<span class="main">,</span> <span class="keyword1">size</span> <span class="bound">cc</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
   <span class="keyword1">in</span> <span class="bound">cb</span> <span class="main">@</span> <span class="bound">cc</span> <span class="main">@</span> <span class="main">[</span>JMP <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">size</span> <span class="bound">cb</span> <span class="main">+</span> <span class="keyword1">size</span> <span class="bound">cc</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Finally, two lemmas are proven automatically (both seem not to be included in the standard library,
though being quite basic) and registered for use by automatic proof tactics. In more detail:

  <span class="antiquoted"><span class="antiquoted">▪</span></span> The former lemma is an elimination rule similar to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] impCE<span class="antiquote"><span class="antiquote">}</span></span></span></span>, with the difference
that it retains the antecedent of the implication in the premise where the consequent is assumed to
hold. This rule permits to have both assumptions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">¬</span></span> bval <span class="free"><span class="free">b</span></span> <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"bval <span class="free"><span class="free">b</span></span> <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in the
respective cases resulting from the execution of boolean expression <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">b</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in state <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">s</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

  <span class="antiquoted"><span class="antiquoted">▪</span></span> The latter one is an introduction rule similar to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] Suc_lessI<span class="antiquote"><span class="antiquote">}</span></span></span></span>, with the difference
that its second assumption is more convenient for proving statements of the form <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free">m</span></span> <span class="main"><span class="main">&lt;</span></span> <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
arising from the compiler correctness proof developed in what follows.

\null
›</span></span>

<span class="keyword1" id="Compiler-impCE2"><span class="command">lemma</span></span> impCE2 <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">;</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">;</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compiler-Suc_lessI2"><span class="command">lemma</span></span> Suc_lessI2 <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">⟧</span> <span class="main">⟹</span> Suc <span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Compiler2">
<div class="head">
<h1>Theory Compiler2</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Shorter Compiler Correctness Proof for Language IMP
    Author:      Pasquale Noce
                 Software Engineer at HID Global, Italy
                 pasquale dot noce dot lavoro at gmail dot com
                 pasquale dot noce at hidglobal dot com
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Compiler correctness"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Compiler2
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Compiler">Compiler</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Preliminary definitions and lemmas"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Now everything is ready for the compiler correctness proof. First, two predicates are introduced,
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl_all</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, both taking as inputs a program, i.e. a list of instructions,
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">P</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and a list of program configurations <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cfs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and respectively denoted using notations
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"P ⊨ cfs"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"P ⊨ cfs□"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. In more detail:

  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"P ⊨ cfs"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> means that program <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">P</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> \emph{may} transform each configuration within
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cfs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> into the subsequent one, if any (word \emph{may} reflects the fact that programs can be
non-deterministic in this case study).
\\Thus, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> formalizes the notion of a \emph{small-step} program execution.

  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"P ⊨ cfs□"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> reinforces <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"P ⊨ cfs"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> by additionally requiring that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cfs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> be
nonempty, the initial program counter be zero (viz. execution starts from the first instruction in
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">P</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>), and the final program counter falls outside <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">P</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (viz. execution terminates).
\\Thus, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl_all</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> formalizes the notion of a \emph{complete small-step} program execution,
so that assumptions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"acomp a ⊨ cfs□"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"bcomp x ⊨ cfs□"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"ccomp c ⊨ cfs□"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
will be used in the compiler correctness proofs for arithmetic/boolean expressions and commands.

Moreover, predicates <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">apred</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">bpred</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cpred</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are defined to capture the link
between the initial and the final configuration upon the execution of an arithmetic expression, a
boolean expression, and a whole program, respectively, and abbreviation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">off</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is introduced as
a commodity to shorten the subsequent formal text.

\null
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">execl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"instr list <span class="main">⇒</span> config list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">cf'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">cfs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="main">→</span> <span class="free"><span class="bound"><span class="entity">cf'</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">cf'</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">cfs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">execl_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"instr list <span class="main">⇒</span> config list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">⊨</span><span class="keyword3">/ </span>_<span class="keyword1">□</span><span class="keyword3">)</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">cfs</span></span></span><span class="main"><span class="free">□</span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">cfs</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">cfs</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>
  fst <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cfs</span></span></span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> fst <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cfs</span></span></span> <span class="main">!</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">cfs</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">size</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">apred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"aexp <span class="main">⇒</span> config <span class="main">⇒</span> config <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">apred</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">a</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">stk</span><span class="main">)</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span><span class="main">.</span>
  <span class="bound">pc'</span> <span class="main">=</span> <span class="bound">pc</span> <span class="main">+</span> <span class="keyword1">size</span> <span class="main">(</span>acomp <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">stk'</span> <span class="main">=</span> aval <span class="bound">a</span> <span class="bound">s</span> <span class="main">#</span> <span class="bound">stk</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bpred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bexp <span class="main">×</span> bool <span class="main">×</span> int <span class="main">⇒</span> config <span class="main">⇒</span> config <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bpred</span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">stk</span><span class="main">)</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span><span class="main">.</span>
  <span class="bound">pc'</span> <span class="main">=</span> <span class="bound">pc</span> <span class="main">+</span> <span class="keyword1">size</span> <span class="main">(</span>bcomp <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">f</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> bval <span class="bound">b</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">f</span> <span class="keyword1">then</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
    <span class="bound">s'</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">stk'</span> <span class="main">=</span> <span class="bound">stk</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cpred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> config <span class="main">⇒</span> config <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">cpred</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">c</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">stk</span><span class="main">)</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span><span class="main">.</span>
  <span class="bound">pc'</span> <span class="main">=</span> <span class="bound">pc</span> <span class="main">+</span> <span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="bound">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">stk'</span> <span class="main">=</span> <span class="bound">stk</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">off</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"instr list <span class="main">⇒</span> config <span class="main">⇒</span> config"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">off</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="main">≡</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="main">-</span> <span class="keyword1">size</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">cf</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Next, some lemmas about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> [source] execl<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> execl_all<span class="antiquote"><span class="antiquote">}</span></span></span></span> are proven. In more detail,
given a program <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">P</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and a list of configurations <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cfs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> such that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">⊨</span></span> <span class="free"><span class="free">cfs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:

  <span class="antiquoted"><span class="antiquoted">▪</span></span> Lemma <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl_next</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> states that for any configuration in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cfs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> but the last one, the
subsequent configuration must result from the execution of the referenced instruction of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">P</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
in that configuration.
\\Thus, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl_next</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> permits to reproduce the execution of a single instruction.

  <span class="antiquoted"><span class="antiquoted">▪</span></span> Lemma <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl_last</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> states that a configuration in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cfs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> whose program counter falls
outside <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">P</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> must be the last one in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cfs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
\\Thus, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl_last</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> permits to infer the completion of program execution.

  <span class="antiquoted"><span class="antiquoted">▪</span></span> Lemma <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl_drop</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> states that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">⊨</span></span> drop <span class="free"><span class="free">n</span></span> <span class="free"><span class="free">cfs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for any natural number <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">n</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
and will be used to prove compiler correctness for loops by induction over the length of the list of
configurations <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cfs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Furthermore, some other lemmas enabling to prove compiler correctness automatically for constructors
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> N<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> V<span class="antiquote"><span class="antiquote">}</span></span></span></span> (arithmetic expressions), <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Bc<span class="antiquote"><span class="antiquote">}</span></span></span></span> (boolean expressions) and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SKIP<span class="antiquote"><span class="antiquote">}</span></span></span></span>
(commands) are also proven.

\null
›</span></span>

<span class="keyword1" id="Compiler2-iexec_offset_aux"><span class="command">lemma</span></span> iexec_offset_aux<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">::</span> int<span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="free">j</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="free">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">+</span> <span class="free">j</span> <span class="main">-</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="free">k</span> <span class="main">+</span> <span class="free">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Compiler2-iexec_offset"><span class="command">lemma</span></span> iexec_offset <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ins</span><span class="main">,</span> <span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">↦</span> <span class="main">(</span><span class="free">pc'</span><span class="main">,</span> <span class="free">s'</span><span class="main">,</span> <span class="free">stk'</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="free">ins</span><span class="main">,</span> <span class="free">pc</span> <span class="main">-</span> <span class="free">i</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">↦</span> <span class="main">(</span><span class="free">pc'</span> <span class="main">-</span> <span class="free">i</span><span class="main">,</span> <span class="free">s'</span><span class="main">,</span> <span class="free">stk'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> iexec.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iexec_offset_aux<span class="main">)</span>

<span class="keyword1" id="Compiler2-execl_next"><span class="command">lemma</span></span> execl_next<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">;</span> <span class="free">k</span> <span class="main">&lt;</span> length <span class="free">cfs</span><span class="main">;</span> <span class="free">k</span> <span class="main">≠</span> length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">⟧</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="free">P</span> <span class="main">!!</span> fst <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="free">k</span><span class="main">)</span><span class="main">,</span> <span class="free">cfs</span> <span class="main">!</span> <span class="free">k</span><span class="main">)</span> <span class="main">↦</span> <span class="free">cfs</span> <span class="main">!</span> Suc <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">cfs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> execl.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span>
 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons exec1_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.split<span class="main">)</span>

<span class="keyword1" id="Compiler2-execl_last"><span class="command">lemma</span></span> execl_last<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">;</span> <span class="free">k</span> <span class="main">&lt;</span> length <span class="free">cfs</span><span class="main">;</span> fst <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="free">k</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">size</span> <span class="free">P</span><span class="main">}</span><span class="main">⟧</span> <span class="main">⟹</span>
    length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">cfs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> execl.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span>
 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons exec1_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.split_asm<span class="main">)</span>

<span class="keyword1" id="Compiler2-execl_drop"><span class="command">lemma</span></span> execl_drop<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊨</span> <span class="free">cfs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⊨</span> drop <span class="free">n</span> <span class="free">cfs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">cfs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> execl.induct<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> drop_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.split<span class="main">)</span>

<span class="keyword1" id="Compiler2-execl_all_N"><span class="command">lemma</span></span> execl_all_N <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[</span>LOADI <span class="free">i</span><span class="main">]</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span> <span class="main">⟹</span> apred <span class="main">(</span>N <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def apred_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">frule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> execl_next<span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> execl_last<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="Compiler2-execl_all_V"><span class="command">lemma</span></span> execl_all_V <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[</span>LOAD <span class="free">x</span><span class="main">]</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span> <span class="main">⟹</span> apred <span class="main">(</span>V <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def apred_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">frule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> execl_next<span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> execl_last<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="Compiler2-execl_all_Bc"><span class="command">lemma</span></span> execl_all_Bc <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">if</span> <span class="free">v</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">[</span>JMP <span class="free">i</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[]</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span><span class="main">;</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">i</span><span class="main">⟧</span> <span class="main">⟹</span>
    bpred <span class="main">(</span>Bc <span class="free">v</span><span class="main">,</span> <span class="free">f</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def bpred_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">frule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> execl_next<span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> execl_last<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> execl.cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">[]</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="free"><span class="free"><span class="free">cfs</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exec1_def<span class="main">)</span>

<span class="keyword1" id="Compiler2-execl_all_SKIP"><span class="command">lemma</span></span> execl_all_SKIP <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span> <span class="main">⟹</span> cpred SKIP <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> execl.cases <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">[]</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="free"><span class="free"><span class="free">cfs</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def exec1_def cpred_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Next, lemma <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl_all_sub</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is proven. It states that, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">P'</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">P''</span></span> <span class="main"><span class="main">⊨</span></span> <span class="free"><span class="free">cfs</span></span><span class="main"><span class="main">□</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
configuration <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cf</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> within <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cfs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> refers to the start of program <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"P' x"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and the
initial and the final configuration in every complete execution of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"P' x"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> satisfy predicate
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"Q x"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then there exists a configuration <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cf'</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cfs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> such that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cf</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cf'</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> satisfy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"Q x"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
\\Thus, this lemma permits to reproduce the execution of a subprogram, particularly:

  <span class="antiquoted"><span class="antiquoted">▪</span></span> a compiled arithmetic expression <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">a</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Q</span></span> <span class="main"><span class="main">=</span></span> apred"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,

  <span class="antiquoted"><span class="antiquoted">▪</span></span> a compiled boolean expression <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">b</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Q</span></span> <span class="main"><span class="main">=</span></span> bpred"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">f</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">i</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
(given a flag <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">f</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and a jump offset <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">i</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>), and

  <span class="antiquoted"><span class="antiquoted">▪</span></span> a compiled command <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">c</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Q</span></span> <span class="main"><span class="main">=</span></span> cpred"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">c</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Furthermore, lemma <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl_all_sub2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is derived from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">execl_all_sub</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to enable a shorter
symbolical execution of two consecutive subprograms.

\null
›</span></span>

<span class="keyword1" id="Compiler2-execl_sub_aux"><span class="command">lemma</span></span> execl_sub_aux<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">m</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">Q</span> <span class="free">P'</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">#</span> <span class="free">cfs</span><span class="main">)</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P'</span> <span class="main">⊨</span>
    map <span class="main">(</span>off <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">m</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">#</span> take <span class="bound">n</span> <span class="free">cfs</span> <span class="main">|</span> Suc <span class="bound">m</span> <span class="main">⇒</span> <span class="free">F</span> <span class="free">cfs</span> <span class="bound">m</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">+</span><span class="free">m</span><span class="main">+</span>length <span class="free">cfs'</span><span class="main">}</span><span class="main">.</span> <span class="free">Q</span> <span class="free">P'</span> <span class="main">(</span><span class="main">(</span><span class="free">cfs'</span> <span class="main">@</span> <span class="main">(</span><span class="free">pc</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">#</span> <span class="free">cfs</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="bound">k</span><span class="main">-</span><span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">P'</span> <span class="main">⊨</span> <span class="main">(</span><span class="free">pc</span> <span class="main">-</span> <span class="keyword1">size</span> <span class="free">P</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span>off <span class="free">P</span><span class="main">)</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">cfs</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="free">Q</span> <span class="free">P'</span> <span class="main">(</span><span class="var">?F</span> <span class="bound">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">_</span><span class="main">;</span> <span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="var">?A</span><span class="main">.</span> <span class="free">Q</span> <span class="free">P'</span> <span class="main">(</span><span class="var">?G</span> <span class="bound">k</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">Q</span> <span class="free">P'</span> <span class="main">(</span><span class="var">?F</span> <span class="bound">k</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subgoal_tac</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">+</span> <span class="free">m</span> <span class="main">+</span> length <span class="free">cfs'</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">∧</span> <span class="var">?F</span> <span class="bound">k</span> <span class="main">=</span> <span class="var">?G</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="free">m</span> <span class="main">+</span> length <span class="free">cfs'</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>

<span class="keyword1" id="Compiler2-execl_sub"><span class="command">lemma</span></span> execl_sub<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main">@</span> <span class="free">P'</span> <span class="main">@</span> <span class="free">P''</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">;</span> <span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span>
     <span class="keyword1">size</span> <span class="free">P</span> <span class="main">≤</span> fst <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> fst <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">size</span> <span class="free">P</span> <span class="main">&lt;</span> <span class="keyword1">size</span> <span class="free">P'</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">P'</span> <span class="main">⊨</span> map <span class="main">(</span>off <span class="free">P</span><span class="main">)</span> <span class="main">(</span>drop <span class="free">m</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">cfs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">_</span><span class="main">;</span> <span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">_</span><span class="main">.</span> <span class="var">?P</span> <span class="free">P'</span> <span class="free">cfs</span> <span class="bound">k</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P'</span> <span class="main">⊨</span> map <span class="main">_</span> <span class="main">(</span><span class="var">?F</span> <span class="free">cfs</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">cfs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> execl.induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span>
 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> take_Cons drop_Cons exec1_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.split<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">erule</span> execl_sub_aux <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> append_Cons <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">erule</span> execl_sub_aux <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> cfs' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P'</span> <span class="skolem">pc</span> <span class="skolem">s</span> <span class="skolem">stk</span> <span class="skolem">cfs</span> <span class="skolem">m</span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pc</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span> <span class="main">::</span> config"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">m</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="var">?P</span> <span class="skolem">P'</span> <span class="main">(</span><span class="var">?cf</span> <span class="main">#</span> <span class="skolem">cfs</span><span class="main">)</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="skolem">P'</span> <span class="main">⊨</span>
    map <span class="main">(</span>off <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">m</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="var">?cf</span> <span class="main">#</span> take <span class="bound">n</span> <span class="skolem">cfs</span> <span class="main">|</span> Suc <span class="bound">m</span> <span class="main">⇒</span> <span class="var">?F</span> <span class="skolem">cfs</span> <span class="bound">m</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">..&lt;</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="var">?P</span> <span class="skolem">P'</span> <span class="skolem">cfs</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="skolem">m</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="var">?P</span> <span class="skolem">P'</span> <span class="main">(</span><span class="var">?cf</span> <span class="main">#</span> <span class="skolem">cfs</span><span class="main">)</span> <span class="bound">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">⊨</span> map <span class="main">(</span>off <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="var">?F</span> <span class="skolem">cfs</span> <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compiler2-execl_all_sub"><span class="command">lemma</span></span> execl_all_sub <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">@</span> <span class="free">P'</span> <span class="free">x</span> <span class="main">@</span> <span class="free">P''</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> length <span class="free">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">size</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">cfs</span><span class="main">.</span> <span class="free">P'</span> <span class="free">x</span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="free">x</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k'</span></span> <span class="main">&lt;</span> length <span class="free">cfs</span><span class="main">.</span> <span class="free">Q</span> <span class="free">x</span> <span class="main">(</span>off <span class="free">P</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>off <span class="free">P</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="bound">k'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">size</span> <span class="free">P</span> <span class="main">≤</span> fst <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> fst <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">size</span> <span class="free">P</span> <span class="main">&lt;</span> <span class="keyword1">size</span> <span class="main">(</span><span class="free">P'</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k'</span><span class="main">.</span> <span class="bound">k'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">k</span><span class="main">..&lt;</span>length <span class="free">cfs</span><span class="main">}</span> <span class="main">∧</span> <span class="main">¬</span> <span class="var">?P</span> <span class="bound">k'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"Min <span class="var">?A</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> Min_in<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main"><span class="keyword3">,</span></span>
     <span class="operator">rule_tac</span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"length <span class="free"><span class="free"><span class="free">cfs</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>off <span class="free">P</span><span class="main">)</span> <span class="main">(</span>drop <span class="free">k</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>Min <span class="var">?A</span><span class="main">)</span><span class="main">)</span> <span class="free">cfs</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> off <span class="free">P</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cfs</span> <span class="main">!</span> <span class="main">_</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">cfs</span> <span class="main">≤</span> Suc <span class="main">(</span>Min <span class="var">?A</span><span class="main">)</span> <span class="main">⟶</span> Min <span class="var">?A</span> <span class="main">=</span> length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="var">?cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> off <span class="free">P</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> Min <span class="var">?A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nth_map<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_def execl_all_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">arith</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cfs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> fst <span class="main">(</span><span class="var">?cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="var">?cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">size</span> <span class="main">(</span><span class="free">P'</span> <span class="free">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k'</span><span class="main">.</span> <span class="bound">k'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">k'</span><span class="main">.</span> <span class="bound">k'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">k</span><span class="main">..&lt;</span>Min <span class="var">?A</span><span class="main">}</span> <span class="main">∧</span> <span class="main">¬</span> <span class="var">?P</span> <span class="bound">k'</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule</span> rev_subsetD <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?A</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span>
     <span class="operator">insert</span> E<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> Min_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P'</span> <span class="free">x</span> <span class="main">⊨</span> <span class="var">?cfs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> execl_all_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> execl_sub<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">x</span> <span class="main">(</span><span class="var">?cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="var">?cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="var">?cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Min <span class="var"><span class="var"><span class="var">?A</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compiler2-execl_all_sub2"><span class="command">lemma</span></span> execl_all_sub2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">@</span> <span class="free">P'</span> <span class="free">x'</span> <span class="main">@</span> <span class="free">P''</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⊨</span> <span class="main">_</span><span class="main">□</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> <span class="free">P</span> <span class="free">x</span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">stk</span><span class="main">)</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span><span class="main">.</span>
      <span class="bound">pc'</span> <span class="main">=</span> <span class="bound">pc</span> <span class="main">+</span> <span class="keyword1">size</span> <span class="main">(</span><span class="free">P</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">I</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">s</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">stk'</span> <span class="main">=</span> <span class="free">F</span> <span class="bound">s</span> <span class="bound">stk</span><span class="main">)</span>
        <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> <span class="main">_</span> <span class="main">⟹</span> <span class="var">?Q</span> <span class="free">x</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> <span class="free">P'</span> <span class="free">x'</span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">stk</span><span class="main">)</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span><span class="main">.</span>
      <span class="bound">pc'</span> <span class="main">=</span> <span class="bound">pc</span> <span class="main">+</span> <span class="keyword1">size</span> <span class="main">(</span><span class="free">P'</span> <span class="free">x'</span><span class="main">)</span> <span class="main">+</span> <span class="free">I'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">stk'</span> <span class="main">=</span> <span class="free">F'</span> <span class="bound">s</span> <span class="bound">stk</span><span class="main">)</span>
        <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> <span class="main">_</span> <span class="main">⟹</span> <span class="var">?Q'</span> <span class="free">x'</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="free">cfs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">stk</span><span class="main">)</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span><span class="main">.</span>
    <span class="bound">pc</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">pc'</span> <span class="main">=</span> <span class="keyword1">size</span> <span class="main">(</span><span class="free">P</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">size</span> <span class="main">(</span><span class="free">P'</span> <span class="free">x'</span><span class="main">)</span> <span class="main">+</span> <span class="free">I'</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">s</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q'</span> <span class="bound">t</span> <span class="bound">s'</span> <span class="main">∧</span>
      <span class="bound">stk'</span> <span class="main">=</span> <span class="free">F'</span> <span class="bound">t</span> <span class="main">(</span><span class="free">F</span> <span class="bound">s</span> <span class="bound">stk</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">@</span> <span class="var">?P</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> execl_all_sub <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?Q</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">insert</span> A B<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> A C D<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> execl_all_sub
 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?Q'</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Main theorem"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
It is time to prove compiler correctness. First, lemmas <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">acomp_acomp</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">bcomp_bcomp</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are
derived from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] execl_all_sub2<span class="antiquote"><span class="antiquote">}</span></span></span></span> to reproduce the execution of two consecutive compiled
arithmetic expressions (possibly generated by both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> acomp<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> bcomp<span class="antiquote"><span class="antiquote">}</span></span></span></span>) and boolean
expressions (possibly generated by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> bcomp<span class="antiquote"><span class="antiquote">}</span></span></span></span>), respectively. Subsequently, the correctness of
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> acomp<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> bcomp<span class="antiquote"><span class="antiquote">}</span></span></span></span> is proven in lemmas <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">acomp_correct</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">bcomp_correct</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1" id="Compiler2-acomp_acomp"><span class="command">lemma</span></span> acomp_acomp<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>acomp <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> acomp <span class="free">a<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">P</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> acomp <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span> apred <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> acomp <span class="free">a<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span> apred <span class="free">a<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="keyword1">case</span> <span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">stk</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">pc</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="free">cfs</span><span class="main">.</span> <span class="free">cfs</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>acomp <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> acomp <span class="free">a<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> aval <span class="free">a<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">s</span> <span class="main">#</span> aval <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">s</span> <span class="main">#</span> <span class="bound">stk</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> execl_all_sub2 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> I' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span>"</span></span></span></span>
 <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> F <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> aval <span class="free"><span class="free"><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="main"><span class="main"><span class="main">#</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span>"</span></span></span></span>
 <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> F' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> aval <span class="free"><span class="free"><span class="free">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="main"><span class="main"><span class="main">#</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apred_def<span class="main">)</span>

<span class="keyword1" id="Compiler2-bcomp_bcomp"><span class="command">lemma</span></span> bcomp_bcomp<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>bcomp <span class="main">(</span><span class="free">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">f<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">i<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">@</span> bcomp <span class="main">(</span><span class="free">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">f<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">i<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> bcomp <span class="main">(</span><span class="free">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">f<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">i<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span>
      bpred <span class="main">(</span><span class="free">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">f<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">i<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> bcomp <span class="main">(</span><span class="free">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">f<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">i<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span>
      bpred <span class="main">(</span><span class="free">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">f<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">i<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="keyword1">case</span> <span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">stk</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">pc</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>bval <span class="free">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">s</span> <span class="main">≠</span> <span class="free">f<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="free">cfs</span><span class="main">.</span> <span class="free">cfs</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>bcomp <span class="main">(</span><span class="free">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">f<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">i<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">@</span> bcomp <span class="main">(</span><span class="free">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">f<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">i<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
      <span class="main">(</span><span class="keyword1">if</span> bval <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">s</span> <span class="main">=</span> <span class="free">f<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">then</span> <span class="free">i<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">stk</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> append_Nil2
 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> execl_all_sub2 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">if</span></span></span> bval <span class="free"><span class="free"><span class="free">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="free"><span class="free"><span class="free">f<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">then</span></span></span> <span class="free"><span class="free"><span class="free">i<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">else</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span>
 <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> I' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">if</span></span></span> bval <span class="free"><span class="free"><span class="free">b<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="free"><span class="free"><span class="free">f<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">then</span></span></span> <span class="free"><span class="free"><span class="free">i<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">else</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span>"</span></span></span></span>
 <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> F <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> F' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bpred_def<span class="main">)</span>

<span class="keyword1" id="Compiler2-acomp_correct"><span class="command">lemma</span></span> acomp_correct <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"acomp <span class="free">a</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span> <span class="main">⟹</span> apred <span class="free">a</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">cfs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">frule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> acomp_acomp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">cfs</span> <span class="skolem">s</span> <span class="skolem">stk</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"acomp <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> acomp <span class="skolem">a<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="main">[</span>ADD<span class="main">]</span> <span class="main">⊨</span> <span class="skolem">cfs</span><span class="main">□</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="var">?ca<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="var">?i</span> <span class="main">⊨</span> <span class="main">_</span><span class="main">□</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="var">?ca<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="keyword1">size</span> <span class="var">?ca<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> aval <span class="skolem">a<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">s</span> <span class="main">#</span> aval <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">s</span> <span class="main">#</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> Suc <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span><span class="var">?ca<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="var">?ca<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="var">?i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> aval <span class="main">(</span>Plus <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="skolem">s</span> <span class="main">#</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_next <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?ca<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="var"><span class="var"><span class="var">?ca<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="var"><span class="var"><span class="var">?i</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">cfs</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"apred <span class="main">(</span>Plus <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_last <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?ca<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="var"><span class="var"><span class="var">?ca<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="var"><span class="var"><span class="var">?i</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">cfs</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def apred_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compiler2-bcomp_correct"><span class="command">lemma</span></span> bcomp_correct <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>bcomp <span class="free">x</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span><span class="main">;</span> <span class="main">0</span> <span class="main">≤</span> snd <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> bpred <span class="free">x</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">cfs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bcomp.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">frule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> acomp_acomp<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> bcomp_bcomp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bpred_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">f</span> <span class="skolem">i</span> <span class="skolem">cfs</span> <span class="skolem">s</span> <span class="skolem">stk</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"bcomp <span class="main">(</span><span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> False<span class="main">,</span> <span class="keyword1">size</span> <span class="main">(</span>bcomp <span class="main">(</span><span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">f</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">f</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span>
    bcomp <span class="main">(</span><span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">f</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊨</span> <span class="skolem">cfs</span><span class="main">□</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"bcomp <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="var">?n</span> <span class="main">+</span> <span class="var">?i</span><span class="main">)</span> <span class="main">@</span> <span class="var">?cb</span> <span class="main">⊨</span> <span class="main">_</span><span class="main">□</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cb</span> <span class="bound">cfs</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">cb</span> <span class="main">=</span> <span class="var">?cb</span><span class="main">;</span> bcomp <span class="main">(</span><span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> False<span class="main">,</span> <span class="var">?n</span> <span class="main">+</span> <span class="var">?i</span><span class="main">)</span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span><span class="main">⟧</span> <span class="main">⟹</span>
      bpred <span class="main">(</span><span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> False<span class="main">,</span> <span class="var">?n</span> <span class="main">+</span> <span class="var">?i</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="skolem">cfs</span><span class="main">.</span> bpred <span class="main">(</span><span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> False<span class="main">,</span> <span class="var">?n</span> <span class="main">+</span> <span class="var">?i</span><span class="main">)</span>
    <span class="main">(</span>off <span class="main">[]</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>off <span class="main">[]</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> execl_all_sub<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bval <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>bcomp <span class="main">(</span><span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> False<span class="main">,</span> <span class="var">?n</span> <span class="main">+</span> <span class="var">?i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="var">?n</span> <span class="main">+</span> <span class="var">?i</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bpred_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"bpred <span class="main">(</span>And <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">f</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>
     execl_all_def bpred_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">f</span> <span class="skolem">i</span> <span class="skolem">cfs</span> <span class="skolem">s</span> <span class="skolem">stk</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"bcomp <span class="main">(</span><span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> False<span class="main">,</span> <span class="keyword1">size</span> <span class="main">(</span>bcomp <span class="main">(</span><span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">f</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">f</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span>
    bcomp <span class="main">(</span><span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">f</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊨</span> <span class="skolem">cfs</span><span class="main">□</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cb<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="var">?cb<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="main">_</span><span class="main">□</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="var">?cb<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="keyword1">size</span> <span class="var">?cb<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> bval <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">f</span> <span class="keyword1">then</span> <span class="skolem">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"bpred <span class="main">(</span>And <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">f</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def bpred_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">f</span> <span class="skolem">i</span> <span class="skolem">cfs</span> <span class="skolem">s</span> <span class="skolem">stk</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"acomp <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> acomp <span class="skolem">a<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">f</span> <span class="keyword1">then</span> <span class="main">[</span>JMPLESS <span class="skolem">i</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[</span>JMPGE <span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main">⊨</span> <span class="skolem">cfs</span><span class="main">□</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ca<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="var">?ca<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="var">?i</span> <span class="main">⊨</span> <span class="main">_</span><span class="main">□</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="var">?ca<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="keyword1">size</span> <span class="var">?ca<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> aval <span class="skolem">a<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">s</span> <span class="main">#</span> aval <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">s</span> <span class="main">#</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> Suc <span class="skolem">k</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span><span class="var">?ca<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="var">?ca<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="var">?i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> bval <span class="main">(</span>Less <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">f</span> <span class="keyword1">then</span> <span class="skolem">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_next <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?ca<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="var"><span class="var"><span class="var">?ca<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="var"><span class="var"><span class="var">?i</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">cfs</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">cfs</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> execl_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"bpred <span class="main">(</span>Less <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">f</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bpred_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Next, lemmas <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">bcomp_ccomp</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ccomp_ccomp</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are derived to reproduce the execution of a
compiled boolean expression followed by a compiled command and of two consecutive compiled commands,
respectively (possibly generated by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ccomp<span class="antiquote"><span class="antiquote">}</span></span></span></span>). Then, compiler correctness for loops and for
all commands is proven in lemmas <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">while_correct</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ccomp_correct</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, respectively by
induction over the length of the list of configurations and by structural induction over commands.

\null
›</span></span>

<span class="keyword1" id="Compiler2-bcomp_ccomp"><span class="command">lemma</span></span> bcomp_ccomp<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>bcomp <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">f</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">@</span> ccomp <span class="free">c</span> <span class="main">@</span> <span class="free">P</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span><span class="main">;</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">i</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> ccomp <span class="free">c</span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span> cpred <span class="free">c</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="keyword1">case</span> <span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">stk</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">pc</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>bval <span class="free">b</span> <span class="bound">s</span> <span class="main">≠</span> <span class="free">f</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="free">cfs</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free">cfs</span> <span class="main">!</span> <span class="bound">k</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span> <span class="main">⇒</span>
      <span class="bound">pc'</span> <span class="main">=</span> <span class="keyword1">size</span> <span class="main">(</span>bcomp <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">f</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">@</span> ccomp <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">stk'</span> <span class="main">=</span> <span class="bound">stk</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> execl_all_sub2
 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">if</span></span></span> bval <span class="free"><span class="free"><span class="free">b</span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="free"><span class="free"><span class="free">f</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">then</span></span></span> <span class="free"><span class="free"><span class="free">i</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">else</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> I' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span>
 <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">c</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">⇒</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> F <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span>"</span></span></span></span>
 <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> F' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> bcomp_correct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">b</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="free"><span class="free"><span class="free">f</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="free"><span class="free"><span class="free">i</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bpred_def cpred_def<span class="main">)</span>

<span class="keyword1" id="Compiler2-ccomp_ccomp"><span class="command">lemma</span></span> ccomp_ccomp<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>ccomp <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> ccomp <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> ccomp <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span> cpred <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> ccomp <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span> cpred <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="keyword1">case</span> <span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">stk</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">pc</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="free">cfs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span>
    <span class="keyword1">case</span> <span class="free">cfs</span> <span class="main">!</span> <span class="bound">k</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">pc'</span> <span class="main">=</span> <span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> ccomp <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">stk'</span> <span class="main">=</span> <span class="bound">stk</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> append_Nil2 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> execl_all_sub2 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span>
 <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> I' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">⇒</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">⇒</span></span></span> <span class="bound"><span class="bound"><span class="bound">s'</span></span></span>"</span></span></span></span>
 <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> F <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> F' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">stk</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cpred_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

<span class="keyword1" id="Compiler2-while_correct"><span class="command">lemma</span></span> while_correct <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>bcomp <span class="main">(</span><span class="free">b</span><span class="main">,</span> False<span class="main">,</span> <span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">@</span> ccomp <span class="free">c</span> <span class="main">@</span>
    <span class="main">[</span>JMP <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>bcomp <span class="main">(</span><span class="free">b</span><span class="main">,</span> False<span class="main">,</span> <span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">@</span> ccomp <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> ccomp <span class="free">c</span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span> cpred <span class="free">c</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
  cpred <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="var">?cb</span> <span class="main">@</span> <span class="var">?cc</span> <span class="main">@</span> <span class="main">[</span>JMP <span class="main">(</span><span class="main">-</span> <span class="var">?n</span><span class="main">)</span><span class="main">]</span> <span class="main">⊨</span> <span class="main">_</span><span class="main">□</span><span class="main">;</span> <span class="main">⋀</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">_</span> <span class="main">⟹</span> <span class="main">_</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?Q</span> <span class="free">cfs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">cfs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> length_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule</span> bcomp_ccomp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfs</span> <span class="skolem">s</span> <span class="skolem">stk</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?cb</span> <span class="main">@</span> <span class="var">?cc</span> <span class="main">@</span> <span class="main">[</span>JMP <span class="main">(</span><span class="main">-</span> <span class="keyword1">size</span> <span class="var">?cb</span> <span class="main">-</span> <span class="keyword1">size</span> <span class="var">?cc</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">⊨</span> <span class="skolem">cfs</span><span class="main">□</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="skolem">cfs</span><span class="main">.</span> bpred <span class="main">(</span><span class="free">b</span><span class="main">,</span> False<span class="main">,</span> <span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
    <span class="main">(</span>off <span class="main">[]</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>off <span class="main">[]</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> execl_all_sub<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bval <span class="free">b</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="var">?n</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bpred_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cpred <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def cpred_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfs</span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">stk</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?cb</span> <span class="main">@</span> <span class="var">?cc</span> <span class="main">@</span> <span class="main">[</span>JMP <span class="main">(</span><span class="main">-</span> <span class="keyword1">size</span> <span class="var">?cb</span> <span class="main">-</span> <span class="keyword1">size</span> <span class="var">?cc</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">⊨</span> <span class="skolem">cfs</span><span class="main">□</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⊨</span> <span class="main">_</span><span class="main">□</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="var">?cb</span> <span class="main">+</span> <span class="keyword1">size</span> <span class="var">?cc</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> length <span class="skolem">cfs</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> Suc <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_next <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?P</span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">cfs</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span>length <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">cfs</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">cfs</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span>length <span class="var">?cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⊨</span> <span class="var">?cfs</span><span class="main">□</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> execl_drop<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">cfs'</span><span class="main">.</span> length <span class="bound">cfs'</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="main">⊨</span> <span class="bound">cfs'</span><span class="main">□</span> <span class="main">⟶</span> <span class="var">?Q</span> <span class="bound">cfs'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?cfs</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="main">⊨</span> <span class="var">?cfs</span><span class="main">□</span> <span class="main">⟶</span> <span class="var">?Q</span> <span class="var">?cfs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cpred <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">s'</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cpred <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cpred_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compiler2-ccomp_correct"><span class="command">lemma</span></span> ccomp_correct<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ccomp <span class="free">c</span> <span class="main">⊨</span> <span class="free">cfs</span><span class="main">□</span> <span class="main">⟹</span> cpred <span class="free">c</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">cfs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">cfs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> bcomp_ccomp<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">frule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> ccomp_ccomp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">cfs</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"acomp <span class="skolem">a</span> <span class="main">@</span> <span class="main">[</span>STORE <span class="skolem">x</span><span class="main">]</span> <span class="main">⊨</span> <span class="skolem">cfs</span><span class="main">□</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="skolem">cfs</span><span class="main">.</span> apred <span class="skolem">a</span> <span class="main">(</span>off <span class="main">[]</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>off <span class="main">[]</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> execl_all_sub<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">stk</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>acomp <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> aval <span class="skolem">a</span> <span class="skolem">s</span> <span class="main">#</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apred_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> Suc <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>acomp <span class="skolem">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> aval <span class="skolem">a</span> <span class="skolem">s</span><span class="main">)</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_next <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"acomp <span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="main"><span class="main"><span class="main">[</span></span></span>STORE <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">cfs</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cpred <span class="main">(</span><span class="skolem">x</span> <span class="main">::=</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_last <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"acomp <span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="main"><span class="main"><span class="main">[</span></span></span>STORE <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span>
     <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">cfs</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def cpred_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">cfs</span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">t</span> <span class="skolem">stk</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="skolem">cfs</span><span class="main">□</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">s'</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cpred <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def cpred_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">cfs</span> <span class="skolem">s</span> <span class="skolem">stk</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"bcomp <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> False<span class="main">,</span> <span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">@</span> ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span>
    JMP <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="skolem">cfs</span><span class="main">□</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"bcomp <span class="var">?x</span> <span class="main">@</span> <span class="var">?cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">_</span> <span class="main">#</span> <span class="var">?cc<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="main">_</span><span class="main">□</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bcomp <span class="var">?x</span> <span class="main">@</span> <span class="var">?cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">[</span>JMP <span class="main">(</span><span class="keyword1">size</span> <span class="var">?cc<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="skolem">cfs</span><span class="main">.</span> bpred <span class="var">?x</span> <span class="main">(</span>off <span class="main">[]</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>off <span class="main">[]</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> execl_all_sub<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="var">?P</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bpred_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> <span class="var">?cc<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span> cpred <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k'</span></span> <span class="main">&lt;</span> length <span class="skolem">cfs</span><span class="main">.</span> cpred <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>off <span class="var">?P</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>off <span class="var">?P</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="bound">k'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> execl_all_sub <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P'' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k'</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="bound">pc'</span> <span class="main">=</span> <span class="keyword1">size</span> <span class="main">(</span><span class="var">?P</span> <span class="main">@</span> <span class="var">?cc<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">stk'</span> <span class="main">=</span> <span class="skolem">stk</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cpred_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cpred <span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">ELSE</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def cpred_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">cfs</span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">stk</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"bcomp <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> False<span class="main">,</span> <span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">@</span> ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span>
    JMP <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="skolem">cfs</span><span class="main">□</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cb</span> <span class="main">@</span> <span class="var">?cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="var">?i</span> <span class="main">#</span> <span class="var">?cc<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="main">_</span><span class="main">□</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="var">?cb</span> <span class="main">+</span> <span class="keyword1">size</span> <span class="var">?cc<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">s'</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> Suc <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span><span class="var">?cb</span> <span class="main">@</span> <span class="var">?cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="var">?i</span> <span class="main">#</span> <span class="var">?cc<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">size</span> <span class="var">?P</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_next <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?P</span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">cfs</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main"><span class="keyword3">,</span></span>
     <span class="operator">drule_tac</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">s'</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cpred <span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">ELSE</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_last <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?P</span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">cfs</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def cpred_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">cfs</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"JMPND <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">#</span> ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span>
    JMP <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> ccomp <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="skolem">cfs</span><span class="main">□</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"JMPND <span class="main">(</span><span class="var">?n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">#</span> <span class="var">?cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> JMP <span class="var">?n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">#</span> <span class="var">?cc<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="main">_</span><span class="main">□</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"JMPND <span class="main">(</span><span class="var">?n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">#</span> <span class="var">?cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">[</span>JMP <span class="var">?n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> <span class="var">?cc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span> cpred <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cfs</span><span class="main">.</span> <span class="var">?cc<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊨</span> <span class="bound">cfs</span><span class="main">□</span> <span class="main">⟹</span> cpred <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="bound">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">stk</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">cfs</span> <span class="main">!</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="var">?n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="numeral">2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_next <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?P</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="var"><span class="var"><span class="var">?cc<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">cfs</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main"><span class="keyword3">,</span></span>
     <span class="operator">drule_tac</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="skolem">cfs</span><span class="main">.</span> cpred <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>off <span class="main">[</span>hd <span class="var">?P</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>off <span class="main">[</span>hd <span class="var">?P</span><span class="main">]</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> execl_all_sub<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span> <span class="main">⇒</span>
      <span class="bound">pc'</span> <span class="main">=</span> <span class="var">?n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">stk'</span> <span class="main">=</span> <span class="skolem">stk</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cpred_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="skolem">cfs</span> <span class="main">!</span> Suc <span class="skolem">k</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span> <span class="main">⇒</span>
      <span class="bound">pc'</span> <span class="main">=</span> <span class="var">?n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="var">?n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">stk'</span> <span class="main">=</span> <span class="skolem">stk</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_next <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?P</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="var"><span class="var"><span class="var">?cc<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">cfs</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main"><span class="keyword3">,</span></span>
       <span class="operator">drule_tac</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cpred <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">OR</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_last <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?P</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="var"><span class="var"><span class="var">?cc<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">cfs</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
       <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execl_all_def cpred_def split_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfs</span> <span class="main">!</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="var">?n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="numeral">2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">stk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span>length <span class="skolem">cfs</span><span class="main">.</span> cpred <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>off <span class="var">?P</span> <span class="main">(</span><span class="skolem">cfs</span><span class="main">!</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>off <span class="var">?P</span> <span class="main">(</span><span class="skolem">cfs</span><span class="main">!</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> execl_all_sub <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P'' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">cfs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="skolem">cfs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">pc'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">,</span> <span class="bound">stk'</span><span class="main">)</span> <span class="main">⇒</span>
      <span class="bound">pc'</span> <span class="main">=</span> <span class="var">?n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="var">?n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">stk'</span> <span class="main">=</span> <span class="skolem">stk</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cpred_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cpred <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">OR</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> execl_last<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> execl_all_def cpred_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cpred <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">OR</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cfs</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">cfs</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Finally, the main compiler correctness theorem, expressed using predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> exec<span class="antiquote"><span class="antiquote">}</span></span></span></span>, is proven.
First, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">⊢</span></span> <span class="free"><span class="free">cf</span></span> <span class="main"><span class="main">→*</span></span> <span class="free"><span class="free">cf'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is shown to imply the existence of a nonempty list of configurations
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cfs</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> such that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">⊨</span></span> <span class="free"><span class="free">cfs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, whose initial and final configurations match <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cf</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cf'</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, respectively. Then, the main theorem is derived as a straightforward consequence of
this lemma and of the previous lemma <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] ccomp_correct<span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1" id="Compiler2-exec_execl"><span class="command">lemma</span></span> exec_execl <span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊢</span> <span class="free">cf</span> <span class="main">→*</span> <span class="free">cf'</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">cfs</span><span class="main">.</span> <span class="free">P</span> <span class="main">⊨</span> <span class="bound">cfs</span> <span class="main">∧</span> <span class="bound">cfs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="bound">cfs</span> <span class="main">=</span> <span class="free">cf</span> <span class="main">∧</span> last <span class="bound">cfs</span> <span class="main">=</span> <span class="free">cf'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> star.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> list.exhaust<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> last.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> execl.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> ccomp_exec<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ccomp <span class="free">c</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">s</span><span class="main">,</span> <span class="free">stk</span><span class="main">)</span> <span class="main">→*</span> <span class="main">(</span><span class="keyword1">size</span> <span class="main">(</span>ccomp <span class="free">c</span><span class="main">)</span><span class="main">,</span> <span class="free">s'</span><span class="main">,</span> <span class="free">stk'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span> <span class="main">∧</span> <span class="free">stk'</span> <span class="main">=</span> <span class="free">stk</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> ccomp_correct<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hd_conv_nth last_conv_nth execl_all_def cpred_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>