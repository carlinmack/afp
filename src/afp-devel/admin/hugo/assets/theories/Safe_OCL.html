<div id="Errorable">
<div class="head">
<h1>Theory Errorable</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Errorable›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Errorable
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'a</span> errorable <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇩</span><sub>⊥</sub></span>"</span> <span class="main">[</span>21<span class="main">]</span> 21<span class="main">)</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> <span class="tfree">'a</span> option set"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">errorable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> errorable"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇩</span><sub>⊥</sub></span>"</span> <span class="main">[</span>1000<span class="main">]</span> 1000<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">errorable</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Abs_errorable <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> errorable <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">bot</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">≡</span> Abs_errorable None"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">free_constructors</span></span> case_errorable <span class="keyword2"><span class="keyword">for</span></span>
  <span class="quoted">errorable</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">::</span> <span class="tfree">'a</span> errorable"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> errorable_def bot_errorable_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Abs_errorable_cases not_None_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Abs_errorable_inverse UNIV_I option.inject<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_errorable_inject<span class="main">)</span>

<span class="keyword1"><span class="command">copy_bnf</span></span> <span class="tfree">'a</span> errorable

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Transitive_Closure_Ext">
<div class="head">
<h1>Theory Transitive_Closure_Ext</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Transitive Closures›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Transitive_Closure_Ext
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*** Basic Properties *******************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"R<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a transitive closure of a relation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">R</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"R<span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a reflexive transitive closure of a relation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">R</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">f</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is surjective on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"R<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> iff for any
  two elements in the range of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">f</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, related through <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"R<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  all their intermediate elements belong to the range of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">f</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">surj_on_trancl</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">y</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> range <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">f</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is bijective on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"R<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> iff
  it is injective and surjective on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"R<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bij_on_trancl</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> inj <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> surj_on_trancl <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="comment1">(*** Helper Lemmas **********************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Helper Lemmas›</span></span>

<span class="keyword1" id="Transitive_Closure_Ext-rtranclp_eq_rtranclp"><span class="command">lemma</span></span> rtranclp_eq_rtranclp <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">=</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">⟶</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>=</sup><span class="hidden">⇧</span><sup>=</sup></span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mono_rtranclp<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mono_rtranclp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Transitive_Closure_Ext-tranclp_eq_rtranclp"><span class="command">lemma</span></span> tranclp_eq_rtranclp <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">⟶</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>=</sup><span class="hidden">⇧</span><sup>=</sup></span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mono_rtranclp<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tranclp_into_rtranclp <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mono_rtranclp rtranclpD tranclp.r_into_trancl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Transitive_Closure_Ext-rtranclp_eq_rtranclp'"><span class="command">lemma</span></span> rtranclp_eq_rtranclp' <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">=</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mono_rtranclp<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inf <span class="free">P</span> <span class="main">(≠)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtranclp_r_diff_Id<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inf <span class="free">P</span> <span class="main">(≠)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mono_rtranclp<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Transitive_Closure_Ext-tranclp_tranclp_to_tranclp_r"><span class="command">lemma</span></span> tranclp_tranclp_to_tranclp_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span>
         <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">z</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> tranclp_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> tranclp_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*** Transitive Closure Preservation &amp; Reflection ***************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Transitive Closure Preservation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">f</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> preserves <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"R<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if it preserves <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">R</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The proof was derived from the accepted answer on the website
  Stack Overflow that is available at
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://stackoverflow.com/a/52573551/632199"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and provided with the permission of the author of the answer.›</span></span>

<span class="keyword1" id="Transitive_Closure_Ext-preserve_tranclp"><span class="command">lemma</span></span> preserve_tranclp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> assms r<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> tranclp_trans_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P r <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="skolem">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="skolem">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tranclp_trans_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> P <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">f</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> preserves <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"R<span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if it preserves <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">R</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Transitive_Closure_Ext-preserve_rtranclp"><span class="command">lemma</span></span> preserve_rtranclp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Nitpick.rtranclp_unfold
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> preserve_tranclp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If one needs to prove that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"(f x)"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"(g y)"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  are related through <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"S<span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> then one can use the previous
  lemma and add a one more step from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"(f y)"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"(g y)"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Transitive_Closure_Ext-preserve_rtranclp'"><span class="command">lemma</span></span> preserve_rtranclp'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> preserve_rtranclp rtranclp.rtrancl_into_rtrancl<span class="main">)</span>

<span class="keyword1" id="Transitive_Closure_Ext-preserve_rtranclp''"><span class="command">lemma</span></span> preserve_rtranclp''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?b</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rtranclp_into_tranclp1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> preserve_rtranclp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Transitive Closure Reflection›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">f</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> reflects <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"S<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if it reflects
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">S</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and is bijective on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"S<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The proof was derived from the accepted answer on the website
  Stack Overflow that is available at
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://stackoverflow.com/a/52573551/632199"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and provided with the permission of the author of the answer.›</span></span>

<span class="keyword1" id="Transitive_Closure_Ext-reflect_tranclp"><span class="command">lemma</span></span> reflect_tranclp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> refl_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bij_f<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_on_trancl <span class="free">S</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> prem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> range <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> the_inv_into UNIV <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">gr</span></span> <span class="keyword2"><span class="keyword">where</span></span> gr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gr</span> <span class="main">=</span> restrict <span class="skolem">g</span> <span class="skolem">B</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">⟶</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span><span class="skolem">gr</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gr</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> prem <span class="keyword1"><span class="command">have</span></span> major<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> refl_f bij_f <span class="keyword1"><span class="command">have</span></span> cases_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B P g gr
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_the_inv_into_f tranclp.r_into_trancl<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> refl_f bij_f
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?z</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">z</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tranclp_tranclp_to_tranclp_r<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> cases_2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> major cases_1 cases_2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tranclp_trans_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> bij_f <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P B g gr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> the_inv_f_f<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">f</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> reflects <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"S<span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if it reflects
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">S</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and is bijective on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"S<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Transitive_Closure_Ext-reflect_rtranclp"><span class="command">lemma</span></span> reflect_rtranclp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span>
   bij_on_trancl <span class="free">S</span> <span class="free">f</span> <span class="main">⟹</span>
   <span class="free">S</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Nitpick.rtranclp_unfold
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> injD reflect_tranclp<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Finite_Map_Ext">
<div class="head">
<h1>Theory Finite_Map_Ext</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Finite Maps›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Finite_Map_Ext
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Finite_Map.html">HOL-Library.Finite_Map</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_notation</span></span> fmap <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> <span class="keyword3">/</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>22<span class="main">,</span> 21<span class="main">]</span> 21<span class="main">)</span>

<span class="keyword1"><span class="command">nonterminal</span></span> fmaplets <span class="keyword2"><span class="keyword">and</span></span> fmaplet

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_fmaplet"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> fmaplet"</span></span>              <span class="main">(</span><span class="quoted">"_ <span class="keyword3">/</span><span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_fmaplets"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> fmaplet"</span></span>              <span class="main">(</span><span class="quoted">"_ <span class="keyword3">/</span><span class="keyword1">[↦<span class="hidden">⇩</span><sub>f</sub>]</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">""</span>          <span class="main">::</span> <span class="quoted"><span class="quoted">"fmaplet <span class="main">⇒</span> fmaplets"</span></span>              <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_FMaplets"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>fmaplet<span class="main">,</span> fmaplets<span class="main">]</span> <span class="main">⇒</span> fmaplets"</span></span>  <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_FMapUpd"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">⇀</span> <span class="tfree">'b</span><span class="main">,</span> fmaplets<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇀</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword3">/</span><span class="keyword1">'(</span>_<span class="keyword1">')</span>"</span> <span class="main">[</span>900<span class="main">,</span> 0<span class="main">]</span> 900<span class="main">)</span>
  <span class="quoted">"_FMap"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"fmaplets <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇀</span> <span class="tfree">'b</span>"</span></span>             <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">[</span>_<span class="keyword1">]</span><span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_fmaplet"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> fmaplet"</span></span>              <span class="main">(</span><span class="quoted">"_ <span class="keyword3">/</span><span class="keyword1">|-&gt;f</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_fmaplets"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> fmaplet"</span></span>              <span class="main">(</span><span class="quoted">"_ <span class="keyword3">/</span><span class="keyword1">[|-&gt;f]</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_FMapUpd <span class="free">m</span> <span class="main">(</span>_FMaplets <span class="free">xy</span> <span class="free">ms</span><span class="main">)</span>"</span>      <span class="main">⇌</span> <span class="quoted">"_FMapUpd <span class="main">(</span>_FMapUpd <span class="free">m</span> <span class="free">xy</span><span class="main">)</span> <span class="free">ms</span>"</span>
  <span class="quoted">"_FMapUpd <span class="free">m</span> <span class="main">(</span>_fmaplet  <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span>        <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> fmupd <span class="free">x</span> <span class="free">y</span> <span class="free">m</span>"</span>
  <span class="quoted">"_FMap <span class="free">ms</span>"</span>                          <span class="main">⇌</span> <span class="quoted">"_FMapUpd <span class="main">(</span><span class="keyword1">CONST</span> fmempty<span class="main">)</span> <span class="free">ms</span>"</span>
  <span class="quoted">"_FMap <span class="main">(</span>_FMaplets <span class="free">ms1</span> <span class="free">ms2</span><span class="main">)</span>"</span>         <span class="main">↽</span> <span class="quoted">"_FMapUpd <span class="main">(</span>_FMap <span class="free">ms1</span><span class="main">)</span> <span class="free">ms2</span>"</span>
  <span class="quoted">"_FMaplets <span class="free">ms1</span> <span class="main">(</span>_FMaplets <span class="free">ms2</span> <span class="free">ms3</span><span class="main">)</span>"</span> <span class="main">↽</span> <span class="quoted">"_FMaplets <span class="main">(</span>_FMaplets <span class="free">ms1</span> <span class="free">ms2</span><span class="main">)</span> <span class="free">ms3</span>"</span>

<span class="comment1">(*** Helper Lemmas **********************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Helper Lemmas›</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_on_fset_fmdom"><span class="command">lemma</span></span> fmrel_on_fset_fmdom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fmrel_on_fset <span class="main">(</span>fmdom <span class="free">ym</span><span class="main">)</span> <span class="free">f</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   <span class="free">k</span> <span class="main">|∈|</span> fmdom <span class="free">ym</span> <span class="main">⟹</span>
   <span class="free">k</span> <span class="main">|∈|</span> fmdom <span class="free">xm</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmdom_notD fmdom_notI fmrel_on_fsetD option.rel_sel<span class="main">)</span>

<span class="comment1">(*** Finite Map Merge *******************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Merge Operation›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fmmerge</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="free"><span class="bound"><span class="entity">ym</span></span></span> <span class="main">≡</span>
  fmap_of_list <span class="main">(</span>map
    <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>the <span class="main">(</span>fmlookup <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fmlookup <span class="free"><span class="bound"><span class="entity">ym</span></span></span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>sorted_list_of_fset <span class="main">(</span>fmdom <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="main">|∩|</span> fmdom <span class="free"><span class="bound"><span class="entity">ym</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmdom_fmmerge"><span class="command">lemma</span></span> fmdom_fmmerge <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fmdom <span class="main">(</span>fmmerge <span class="free">g</span> <span class="free">xm</span> <span class="free">ym</span><span class="main">)</span> <span class="main">=</span> fmdom <span class="free">xm</span> <span class="main">|∩|</span> fmdom <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmmerge_def fmdom_of_list<span class="main">)</span>

<span class="keyword1" id="Finite_Map_Ext-fmmerge_commut"><span class="command">lemma</span></span> fmmerge_commut<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> fmran' <span class="free">xm</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fmmerge <span class="free">f</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">=</span> fmmerge <span class="free">f</span> <span class="free">ym</span> <span class="free">xm</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zm</span></span> <span class="keyword2"><span class="keyword">where</span></span> zm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zm</span> <span class="main">=</span> sorted_list_of_fset <span class="main">(</span>fmdom <span class="free">xm</span> <span class="main">|∩|</span> fmdom <span class="free">ym</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free">f</span> <span class="main">(</span>the <span class="main">(</span>fmlookup <span class="free">xm</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fmlookup <span class="free">ym</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">zm</span> <span class="main">=</span>
     map <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free">f</span> <span class="main">(</span>the <span class="main">(</span>fmlookup <span class="free">ym</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fmlookup <span class="free">xm</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">zm</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> fmdom_notI fmran'I notin_fset option.collapse<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fmmerge_def zm
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> inf_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_on_fset_fmmerge1"><span class="command">lemma</span></span> fmrel_on_fset_fmmerge1 <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> fmran' <span class="free">zm</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fmrel_on_fset <span class="main">(</span>fmdom <span class="free">zm</span><span class="main">)</span> <span class="free">f</span> <span class="free">xm</span> <span class="free">zm</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fmrel_on_fset <span class="main">(</span>fmdom <span class="free">zm</span><span class="main">)</span> <span class="free">f</span> <span class="free">ym</span> <span class="free">zm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fmrel_on_fset <span class="main">(</span>fmdom <span class="free">zm</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span>fmmerge <span class="free">g</span> <span class="free">xm</span> <span class="free">ym</span><span class="main">)</span> <span class="free">zm</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> fmdom <span class="free">zm</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> fmdom <span class="free">xm</span> <span class="main">|∩|</span> fmdom <span class="free">ym</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> finterI fmrel_on_fset_fmdom<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"fmlookup <span class="free">xm</span> <span class="skolem">x</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fmlookup <span class="free">ym</span> <span class="skolem">x</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fmlookup <span class="free">zm</span> <span class="skolem">x</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms calculation <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmran'I fmrel_on_fsetD option.rel_inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"rel_option <span class="free">f</span> <span class="main">(</span>fmlookup <span class="main">(</span>fmmerge <span class="free">g</span> <span class="free">xm</span> <span class="free">ym</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fmlookup <span class="free">zm</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fmmerge_def fmlookup_of_list <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">unfolding</span></span> option_rel_Some2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?x</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> map_of_map_restrict restrict_map_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fmember.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> fmdomE fmrel_on_fsetI fmrel_on_fset_fmdom<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_on_fset_fmmerge2"><span class="command">lemma</span></span> fmrel_on_fset_fmmerge2 <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> fmran' <span class="free">xm</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fmrel_on_fset <span class="main">(</span>fmdom <span class="free">ym</span><span class="main">)</span> <span class="free">f</span> <span class="free">xm</span> <span class="main">(</span>fmmerge <span class="free">g</span> <span class="free">xm</span> <span class="free">ym</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">|∈|</span> fmdom <span class="free">xm</span> <span class="main">|∩|</span> fmdom <span class="free">ym</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fmlookup <span class="free">xm</span> <span class="skolem">x</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fmlookup <span class="free">ym</span> <span class="skolem">x</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rel_option <span class="free">f</span> <span class="main">(</span>fmlookup <span class="free">xm</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fmlookup <span class="main">(</span>fmmerge <span class="free">g</span> <span class="free">xm</span> <span class="free">ym</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fmmerge_def fmlookup_of_list <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">unfolding</span></span> option_rel_Some1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?x</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_of_map_restrict fmember.rep_eq assms fmran'I<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fmrel_on_fsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> finterD1 fmdomE fmdom_fmmerge fmdom_notD rel_option_None2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*** Acyclicity *************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Acyclicity›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">acyclic_on</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">acyclicP_on</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> acyclic_on <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_acyclic"><span class="command">lemma</span></span> fmrel_acyclic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">xm</span><span class="main">)</span> <span class="free">R</span> <span class="main">⟹</span>
   fmrel <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   fmrel <span class="free">R</span> <span class="free">ym</span> <span class="free">xm</span> <span class="main">⟹</span>
   <span class="free">xm</span> <span class="main">=</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> fmap_ext fmran'I fmrel_cases option.sel
        tranclp.trancl_into_trancl tranclp_unfold<span class="main">)</span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_acyclic'"><span class="command">lemma</span></span> fmrel_acyclic'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">ym</span><span class="main">)</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="free">R</span> <span class="free">ym</span> <span class="free">xm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xm</span> <span class="main">=</span> <span class="free">ym</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"rel_option <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>fmlookup <span class="free">xm</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fmlookup <span class="free">ym</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⟹</span>
       rel_option <span class="free">R</span> <span class="main">(</span>fmlookup <span class="free">ym</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fmlookup <span class="free">xm</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⟹</span>
       rel_option <span class="free">R</span> <span class="main">(</span>fmlookup <span class="free">xm</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fmlookup <span class="free">ym</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> fmdom'_notD fmlookup_dom'_iff
            fmran'I option.rel_sel option.sel
            tranclp_into_tranclp2 tranclp_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fmrel_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmap.rel_mono_strong fmrelI fmrel_acyclic tranclp.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_on_fset_acyclic"><span class="command">lemma</span></span> fmrel_on_fset_acyclic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">xm</span><span class="main">)</span> <span class="free">R</span> <span class="main">⟹</span>
   fmrel_on_fset <span class="main">(</span>fmdom <span class="free">ym</span><span class="main">)</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   fmrel_on_fset <span class="main">(</span>fmdom <span class="free">xm</span><span class="main">)</span> <span class="free">R</span> <span class="free">ym</span> <span class="free">xm</span> <span class="main">⟹</span>
   <span class="free">xm</span> <span class="main">=</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fmrel_on_fset_fmrel_restrict
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fmdom_filter fmfilter_alt_defs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span>
        fmfilter_cong fmlookup_filter fmrel_acyclic fmrel_fmdom_eq
        fmrestrict_fset_dom option.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_on_fset_acyclic'"><span class="command">lemma</span></span> fmrel_on_fset_acyclic'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">ym</span><span class="main">)</span> <span class="free">R</span> <span class="main">⟹</span>
   fmrel_on_fset <span class="main">(</span>fmdom <span class="free">ym</span><span class="main">)</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   fmrel_on_fset <span class="main">(</span>fmdom <span class="free">xm</span><span class="main">)</span> <span class="free">R</span> <span class="free">ym</span> <span class="free">xm</span> <span class="main">⟹</span>
   <span class="free">xm</span> <span class="main">=</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fmrel_on_fset_fmrel_restrict
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ffmember_filter fmdom_filter
        fmfilter_alt_defs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> fmfilter_cong fmrel_acyclic'
        fmrel_fmdom_eq fmrestrict_fset_dom<span class="main">)</span>

<span class="comment1">(*** Transitive Closures ****************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Transitive Closures›</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_trans"><span class="command">lemma</span></span> fmrel_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> fmran' <span class="free">xm</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span>
   fmrel <span class="free">P</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span> fmrel <span class="free">Q</span> <span class="free">ym</span> <span class="free">zm</span> <span class="main">⟹</span> fmrel <span class="free">R</span> <span class="free">xm</span> <span class="free">zm</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fmrel_iff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmdomE fmdom_notD fmran'I option.rel_inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> option.rel_sel<span class="main">)</span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_on_fset_trans"><span class="command">lemma</span></span> fmrel_on_fset_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> fmran' <span class="free">xm</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span>
   fmrel_on_fset <span class="main">(</span>fmdom <span class="free">ym</span><span class="main">)</span> <span class="free">P</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   fmrel_on_fset <span class="main">(</span>fmdom <span class="free">zm</span><span class="main">)</span> <span class="free">Q</span> <span class="free">ym</span> <span class="free">zm</span> <span class="main">⟹</span>
   fmrel_on_fset <span class="main">(</span>fmdom <span class="free">zm</span><span class="main">)</span> <span class="free">R</span> <span class="free">xm</span> <span class="free">zm</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fmrel_on_fsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> option.rel_sel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> fmdom_notI fmrel_on_fset_fmdom<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmdom_notI fmran'I fmrel_on_fsetD fmrel_on_fset_fmdom
            option.rel_sel option.sel<span class="main">)</span>

<span class="keyword1" id="Finite_Map_Ext-trancl_to_fmrel"><span class="command">lemma</span></span> trancl_to_fmrel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>fmrel <span class="free">f</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span> fmrel <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tranclp_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmap.rel_mono_strong<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fmrel_trans<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_trancl_fmdom_eq"><span class="command">lemma</span></span> fmrel_trancl_fmdom_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>fmrel <span class="free">f</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span> fmdom <span class="free">xm</span> <span class="main">=</span> fmdom <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmrel_fmdom_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The proof was derived from the accepted answer on the website
  Stack Overflow that is available at
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://stackoverflow.com/a/53585232/632199"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and provided with the permission of the author of the answer.›</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmupd_fmdrop"><span class="command">lemma</span></span> fmupd_fmdrop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fmlookup <span class="free">xm</span> <span class="free">k</span> <span class="main">=</span> Some <span class="free">x</span> <span class="main">⟹</span>
   <span class="free">xm</span> <span class="main">=</span> fmupd <span class="free">k</span> <span class="free">x</span> <span class="main">(</span>fmdrop <span class="free">k</span> <span class="free">xm</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fmap_ext<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> fmlookup_drop fmupd_lookup
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Finite_Map_Ext-fmap_eqdom_Cons1"><span class="command">lemma</span></span> fmap_eqdom_Cons1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fmlookup <span class="free">xm</span> <span class="free">i</span> <span class="main">=</span> None"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fmdom <span class="main">(</span>fmupd <span class="free">i</span> <span class="free">x</span> <span class="free">xm</span><span class="main">)</span> <span class="main">=</span> fmdom <span class="free">ym</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="free">R</span> <span class="main">(</span>fmupd <span class="free">i</span> <span class="free">x</span> <span class="free">xm</span><span class="main">)</span> <span class="free">ym</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">z</span> <span class="bound">zm</span><span class="main">.</span> fmlookup <span class="bound">zm</span> <span class="free">i</span> <span class="main">=</span> None <span class="main">∧</span> <span class="free">ym</span> <span class="main">=</span> <span class="main">(</span>fmupd <span class="free">i</span> <span class="bound">z</span> <span class="bound">zm</span><span class="main">)</span> <span class="main">∧</span>
                   <span class="free">R</span> <span class="free">x</span> <span class="bound">z</span> <span class="main">∧</span> fmrel <span class="free">R</span> <span class="free">xm</span> <span class="bound">zm</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fmlookup <span class="free">ym</span> <span class="free">i</span> <span class="main">=</span> Some <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">zm</span></span> <span class="keyword2"><span class="keyword">where</span></span> z_zm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ym</span> <span class="main">=</span> fmupd <span class="free">i</span> <span class="skolem">z</span> <span class="skolem">zm</span> <span class="main">∧</span> fmlookup <span class="skolem">zm</span> <span class="free">i</span> <span class="main">=</span> None"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fmupd_fmdrop <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">R</span> <span class="free">x</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> z_zm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> fmrel <span class="free">R</span> <span class="main">(</span>fmupd <span class="free">i</span> <span class="free">x</span> <span class="free">xm</span><span class="main">)</span> <span class="free">ym</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmrel_iff fmupd_lookup option.simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper">moreover</span></span></span> <span class="keyword1"><span class="command"><span class="improper">have</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="free">x</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> fmrel <span class="free">R</span> <span class="free">xm</span> <span class="skolem">zm</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> fmrel <span class="free">R</span> <span class="main">(</span>fmupd <span class="free">i</span> <span class="free">x</span> <span class="free">xm</span><span class="main">)</span> <span class="free">ym</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmrel_iff fmupd_lookup option.rel_sel z_zm<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper">moreover</span></span></span> <span class="keyword1"><span class="command"><span class="improper">have</span></span></span> <span class="quoted"><span class="quoted">"fmrel <span class="free">R</span> <span class="free">xm</span> <span class="skolem">zm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z_zm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The proof was derived from the accepted answer on the website
  Stack Overflow that is available at
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://stackoverflow.com/a/53585232/632199"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and provided with the permission of the author of the answer.›</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmap_eqdom_induct"><span class="command">lemma</span></span> fmap_eqdom_induct <span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> nil step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"fmrel <span class="free">R</span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dom_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fmdom <span class="free">xm</span> <span class="main">=</span> fmdom <span class="free">ym</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>fmap_of_list <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>fmap_of_list <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xm</span> <span class="bound">y</span> <span class="bound">ym</span> <span class="bound">i</span><span class="main">.</span>
    <span class="main">⟦</span><span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">;</span> fmrel <span class="free">R</span> <span class="bound">xm</span> <span class="bound">ym</span><span class="main">;</span> fmdom <span class="bound">xm</span> <span class="main">=</span> fmdom <span class="bound">ym</span><span class="main">;</span> <span class="free">P</span> <span class="bound">xm</span> <span class="bound">ym</span><span class="main">⟧</span> <span class="main">⟹</span>
    <span class="free">P</span> <span class="main">(</span>fmupd <span class="bound">i</span> <span class="bound">x</span> <span class="bound">xm</span><span class="main">)</span> <span class="main">(</span>fmupd <span class="bound">i</span> <span class="bound">y</span> <span class="bound">ym</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> R dom_eq
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xm</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ym</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> fmempty <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fempty_iff fmdom_empty fmempty_of_list fmfilter_alt_defs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span>
              fmfilter_false fmrestrict_fset_dom local.nil<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">x</span> <span class="skolem">xm</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fmlookup <span class="skolem">ym</span> <span class="skolem">i</span> <span class="main">=</span> Some <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmupd.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> fmrel_cases fmupd_lookup option.discI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> fmupd.hyps<span class="main">(</span>2<span class="main">)</span> fmupd.prems<span class="main">(</span>1<span class="main">)</span> fmupd.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">zm</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"fmlookup <span class="skolem">zm</span> <span class="skolem">i</span> <span class="main">=</span> None"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      ym_eq_z_zm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ym</span> <span class="main">=</span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">z</span> <span class="skolem">zm</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      R_x_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="skolem">x</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      R_xm_zm<span class="main">:</span> <span class="quoted"><span class="quoted">"fmrel <span class="free">R</span> <span class="skolem">xm</span> <span class="skolem">zm</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fmap_eqdom_Cons1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> dom_xm_eq_dom_zm<span class="main">:</span> <span class="quoted"><span class="quoted">"fmdom <span class="skolem">xm</span> <span class="main">=</span> fmdom <span class="skolem">zm</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fmrel_fmdom_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> R_xm_zm fmupd.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">xm</span> <span class="skolem">zm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> R_x_z R_xm_zm dom_xm_eq_dom_zm <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">x</span> <span class="skolem">xm</span><span class="main">)</span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">z</span> <span class="skolem">zm</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ym_eq_z_zm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The proof was derived from the accepted answer on the website
  Stack Overflow that is available at
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://stackoverflow.com/a/53585232/632199"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and provided with the permission of the author of the answer.›</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_to_rtrancl"><span class="command">lemma</span></span> fmrel_to_rtrancl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> as_r<span class="main">:</span> <span class="quoted"><span class="quoted">"reflp <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> rel_rpp_xm_ym<span class="main">:</span> <span class="quoted"><span class="quoted">"fmrel <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fmrel <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> rel_rpp_xm_ym <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fmdom <span class="free">xm</span> <span class="main">=</span> fmdom <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fmrel_fmdom_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> rel_rpp_xm_ym <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fmrel <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fmap_eqdom_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span> <span class="skolem">xm</span> <span class="skolem">y</span> <span class="skolem">ym</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fmrel <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">x</span> <span class="skolem">xm</span><span class="main">)</span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">y</span> <span class="skolem">xm</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> base <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> as_r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="free">r</span> <span class="skolem">xm</span> <span class="skolem">xm</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmap.rel_reflp reflpD<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> step.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fmrel <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">y</span> <span class="skolem">xm</span><span class="main">)</span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">z</span> <span class="skolem">xm</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmrel_upd r_into_rtranclp<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> step.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fmrel <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">y</span> <span class="skolem">xm</span><span class="main">)</span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">y</span> <span class="skolem">ym</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> base <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">ya</span> <span class="skolem">za</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> step.hyps<span class="main">(</span>2<span class="main">)</span> as_r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fmrel <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">y</span> <span class="skolem">ya</span><span class="main">)</span> <span class="main">(</span>fmupd <span class="skolem">i</span> <span class="skolem">y</span> <span class="skolem">za</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmrel_upd r_into_rtranclp reflp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> step.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The proof was derived from the accepted answer on the website
  Stack Overflow that is available at
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://stackoverflow.com/a/53585232/632199"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and provided with the permission of the author of the answer.›</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_to_trancl"><span class="command">lemma</span></span> fmrel_to_trancl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reflp <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fmrel <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> <span class="var">?Ra</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fmap.rel_mono_strong<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fmrel <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmrel_to_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmap.rel_reflp reflpD rtranclpD tranclp.r_into_trancl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_tranclp_induct"><span class="command">lemma</span></span> fmrel_tranclp_induct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fmrel <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
   reflp <span class="free">r</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> fmrel <span class="free">r</span> <span class="free">a</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span>fmrel <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">a</span> <span class="bound">y</span> <span class="main">⟹</span> fmrel <span class="free">r</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> fmrel_to_trancl<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_converse_tranclp_induct"><span class="command">lemma</span></span> fmrel_converse_tranclp_induct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fmrel <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
   reflp <span class="free">r</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> fmrel <span class="free">r</span> <span class="bound">y</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> fmrel <span class="free">r</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> fmrel <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">z</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> fmrel_to_trancl<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trancl_to_fmrel<span class="main">)</span>

<span class="keyword1" id="Finite_Map_Ext-fmrel_tranclp_trans_induct"><span class="command">lemma</span></span> fmrel_tranclp_trans_induct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fmrel <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
   reflp <span class="free">r</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> fmrel <span class="free">r</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> fmrel <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> fmrel <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free">P</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> fmrel_to_trancl<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> tranclp_trans_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> trancl_to_fmrel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*** Finite Map Size Calculation ********************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Size Calculation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The contents of the subsection was derived from the accepted answer
  on the website Stack Overflow that is available at
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://stackoverflow.com/a/53244203/632199"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and provided with the permission of the author of the answer.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">tcf</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">r</span><span class="main">::</span>nat<span class="main">.</span> snd <span class="bound">v</span> <span class="main">+</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> tcf<span class="main">:</span> comp_fun_commute <span class="quoted">tcf</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> nat"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tcf <span class="skolem">y</span> <span class="main">∘</span> tcf <span class="skolem">x</span> <span class="main">=</span> tcf <span class="skolem">x</span> <span class="main">∘</span> tcf <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tcf <span class="skolem">y</span> <span class="main">∘</span> tcf <span class="skolem">x</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> snd <span class="skolem">y</span> <span class="main">+</span> snd <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tcf <span class="skolem">x</span> <span class="main">∘</span> tcf <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> snd <span class="skolem">y</span> <span class="main">+</span> snd <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tcf <span class="skolem">y</span> <span class="main">∘</span> tcf <span class="skolem">x</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span>tcf <span class="skolem">x</span> <span class="main">∘</span> tcf <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tcf <span class="skolem">y</span> <span class="main">∘</span> tcf <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tcf <span class="skolem">x</span> <span class="main">∘</span> tcf <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Finite_Map_Ext-ffold_rec_exp"><span class="command">lemma</span></span> ffold_rec_exp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">|∈|</span> fmdom <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ky</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span><span class="main">,</span> the <span class="main">(</span>fmlookup <span class="main">(</span>fmmap <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ffold tcf <span class="main">0</span> <span class="main">(</span>fset_of_fmap <span class="main">(</span>fmmap <span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        tcf <span class="free">ky</span> <span class="main">(</span>ffold tcf <span class="main">0</span> <span class="main">(</span><span class="main">(</span>fset_of_fmap <span class="main">(</span>fmmap <span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">|-|</span> <span class="main">{|</span><span class="free">ky</span><span class="main">|}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ky</span> <span class="main">|∈|</span> <span class="main">(</span>fset_of_fmap <span class="main">(</span>fmmap <span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tcf.ffold_rec<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Finite_Map_Ext-elem_le_ffold"><span class="command">lemma</span></span> elem_le_ffold <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">|∈|</span> fmdom <span class="free">x</span> <span class="main">⟹</span>
   <span class="free">f</span> <span class="main">(</span>the <span class="main">(</span>fmlookup <span class="free">x</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>ffold tcf <span class="main">0</span> <span class="main">(</span>fset_of_fmap <span class="main">(</span>fmmap <span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ffold_rec_exp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Finite_Map_Ext-elem_le_ffold'"><span class="command">lemma</span></span> elem_le_ffold' <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> fmran' <span class="free">x</span> <span class="main">⟹</span>
   <span class="free">f</span> <span class="free">z</span> <span class="main">&lt;</span> Suc <span class="main">(</span>ffold tcf <span class="main">0</span> <span class="main">(</span>fset_of_fmap <span class="main">(</span>fmmap <span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> fmran'E<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> fmdomI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ffold_rec_exp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(*** Code Setup *************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code Setup›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">fmmerge_fun</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="free"><span class="bound"><span class="entity">ym</span></span></span> <span class="main">≡</span>
  fmap_of_list <span class="main">(</span>map
    <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">|∈|</span> fmdom <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">|∈|</span> fmdom <span class="free"><span class="bound"><span class="entity">ym</span></span></span>
         <span class="keyword1">then</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>the <span class="main">(</span>fmlookup <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fmlookup <span class="free"><span class="bound"><span class="entity">ym</span></span></span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">else</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> undefined<span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>sorted_list_of_fset <span class="main">(</span>fmdom <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="main">|∩|</span> fmdom <span class="free"><span class="bound"><span class="entity">ym</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Finite_Map_Ext-fmmerge_fun_simp"><span class="command">lemma</span></span> fmmerge_fun_simp <span class="main">[</span><span class="operator">code_abbrev</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fmmerge_fun <span class="free">f</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">=</span> fmmerge <span class="free">f</span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fmmerge_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?f</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fmap_of_list"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HOL.arg_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> notin_fset<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tuple">
<div class="head">
<h1>Theory Tuple</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="comment1">(* TODO: There are a lot of similar lemmas in the theory.
         They should be generalized *)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Tuples›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Tuple
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Finite_Map_Ext">Finite_Map_Ext</a> <a href="#Transitive_Closure_Ext">Transitive_Closure_Ext</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">subtuple</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="free"><span class="bound"><span class="entity">ym</span></span></span> <span class="main">≡</span> fmrel_on_fset <span class="main">(</span>fmdom <span class="free"><span class="bound"><span class="entity">ym</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="free"><span class="bound"><span class="entity">ym</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">strict_subtuple</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="free"><span class="bound"><span class="entity">ym</span></span></span> <span class="main">≡</span> subtuple <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="free"><span class="bound"><span class="entity">ym</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">ym</span></span></span>"</span></span>

<span class="comment1">(*** Helper Lemmas **********************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Helper Lemmas›</span></span>

<span class="keyword1" id="Tuple-fmrel_to_subtuple"><span class="command">lemma</span></span> fmrel_to_subtuple<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fmrel <span class="free">r</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span> subtuple <span class="free">r</span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fmrel_on_fset_fmrel_restrict <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Tuple-subtuple_eq_fmrel_fmrestrict_fset"><span class="command">lemma</span></span> subtuple_eq_fmrel_fmrestrict_fset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subtuple <span class="free">r</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">=</span> fmrel <span class="free">r</span> <span class="main">(</span>fmrestrict_fset <span class="main">(</span>fmdom <span class="free">ym</span><span class="main">)</span> <span class="free">xm</span><span class="main">)</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmrel_on_fset_fmrel_restrict<span class="main">)</span>

<span class="keyword1" id="Tuple-subtuple_fmdom"><span class="command">lemma</span></span> subtuple_fmdom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subtuple <span class="free">f</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   subtuple <span class="free">g</span> <span class="free">ym</span> <span class="free">xm</span> <span class="main">⟹</span>
   fmdom <span class="free">xm</span> <span class="main">=</span> fmdom <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> fmrel_on_fset_fmdom fset_eqI<span class="main">)</span>

<span class="comment1">(*** Basic Properties *******************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Properties›</span></span>

<span class="keyword1" id="Tuple-subtuple_refl"><span class="command">lemma</span></span> subtuple_refl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflp <span class="free">R</span> <span class="main">⟹</span> subtuple <span class="free">R</span> <span class="free">xm</span> <span class="free">xm</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmrel_on_fsetI option.rel_reflp reflpD<span class="main">)</span>

<span class="keyword1" id="Tuple-subtuple_mono"><span class="command">lemma</span></span> subtuple_mono <span class="main">[</span><span class="operator">mono</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> fmran' <span class="free">xm</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> fmran' <span class="free">ym</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span>
   subtuple <span class="free">f</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟶</span> subtuple <span class="free">g</span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fmrel_on_fsetI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> <span class="var">?P</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?m</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">xm</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?n</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">ym</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fmrel_on_fsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> option.rel_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> option.rel_sel fmran'I<span class="main">)</span>

<span class="keyword1" id="Tuple-strict_subtuple_mono"><span class="command">lemma</span></span> strict_subtuple_mono <span class="main">[</span><span class="operator">mono</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> fmran' <span class="free">xm</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> fmran' <span class="free">ym</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span>
   strict_subtuple <span class="free">f</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟶</span> strict_subtuple <span class="free">g</span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subtuple_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Tuple-subtuple_antisym"><span class="command">lemma</span></span> subtuple_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">x</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">ym</span> <span class="free">xm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xm</span> <span class="main">=</span> <span class="free">ym</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fmap_ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fmdom <span class="free">xm</span> <span class="main">=</span> fmdom <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subtuple_fmdom <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">x</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">ym</span> <span class="free">xm</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fmrel_code fmrel_on_fset_alt_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fmlookup <span class="free">xm</span> <span class="skolem">x</span> <span class="main">=</span> fmlookup <span class="free">ym</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?x</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fmrel_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?x</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">x</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fmrel_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tuple-strict_subtuple_antisym"><span class="command">lemma</span></span> strict_subtuple_antisym<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">x</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">ym</span> <span class="free">xm</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subtuple_antisym<span class="main">)</span>

<span class="keyword1" id="Tuple-subtuple_acyclic"><span class="command">lemma</span></span> subtuple_acyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">xm</span><span class="main">)</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">ym</span> <span class="free">xm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xm</span> <span class="main">=</span> <span class="free">ym</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fmap_ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> fmdom_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fmdom <span class="free">xm</span> <span class="main">=</span> fmdom <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subtuple_fmdom <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> acyclicP_on <span class="main">(</span>fmran' <span class="free">xm</span><span class="main">)</span> <span class="free">P</span> <span class="main">⟹</span>
     fmlookup <span class="free">xm</span> <span class="bound">x</span> <span class="main">=</span> Some <span class="bound">a</span> <span class="main">⟹</span>
     fmlookup <span class="free">ym</span> <span class="bound">x</span> <span class="main">=</span> Some <span class="bound">b</span> <span class="main">⟹</span>
    <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">b</span> <span class="bound">a</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Nitpick.tranclp_unfold fmran'I rtranclp_into_tranclp1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fmdom_eq assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fmrel_on_fset_fmrel_restrict <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmrestrict_fset_dom<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fmdom_eq assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">ym</span> <span class="free">xm</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fmrel_on_fset_fmrel_restrict <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmrestrict_fset_dom<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fmlookup <span class="free">xm</span> <span class="skolem">x</span> <span class="main">=</span> fmlookup <span class="free">ym</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?x</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fmrel_cases<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?x</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fmrel_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tuple-subtuple_acyclic'"><span class="command">lemma</span></span> subtuple_acyclic'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">ym</span><span class="main">)</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">ym</span> <span class="free">xm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xm</span> <span class="main">=</span> <span class="free">ym</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fmap_ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> fmdom_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fmdom <span class="free">xm</span> <span class="main">=</span> fmdom <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subtuple_fmdom <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> acyclicP_on <span class="main">(</span>fmran' <span class="free">ym</span><span class="main">)</span> <span class="free">P</span> <span class="main">⟹</span>
     fmlookup <span class="free">xm</span> <span class="bound">x</span> <span class="main">=</span> Some <span class="bound">a</span> <span class="main">⟹</span>
     fmlookup <span class="free">ym</span> <span class="bound">x</span> <span class="main">=</span> Some <span class="bound">b</span> <span class="main">⟹</span>
    <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">b</span> <span class="bound">a</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Nitpick.tranclp_unfold fmran'I rtranclp_into_tranclp2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fmdom_eq assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="free">P</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fmrel_on_fset_fmrel_restrict <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmrestrict_fset_dom<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fmdom_eq assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fmrel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">ym</span> <span class="free">xm</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fmrel_on_fset_fmrel_restrict <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fmrestrict_fset_dom<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fmlookup <span class="free">xm</span> <span class="skolem">x</span> <span class="main">=</span> fmlookup <span class="free">ym</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?x</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fmrel_cases<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?x</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fmrel_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tuple-subtuple_acyclic''"><span class="command">lemma</span></span> subtuple_acyclic''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">ym</span><span class="main">)</span> <span class="free">R</span> <span class="main">⟹</span>
   subtuple <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   subtuple <span class="free">R</span> <span class="free">ym</span> <span class="free">xm</span> <span class="main">⟹</span>
   <span class="free">xm</span> <span class="main">=</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> subtuple_acyclic' subtuple_mono tranclp_eq_rtranclp<span class="main">)</span>

<span class="keyword1" id="Tuple-strict_subtuple_trans"><span class="command">lemma</span></span> strict_subtuple_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">xm</span><span class="main">)</span> <span class="free">P</span> <span class="main">⟹</span>
   strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">ym</span> <span class="free">zm</span> <span class="main">⟹</span>
   strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">zm</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fmrel_on_fset_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> <span class="var">?ym</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">ym</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subtuple_acyclic<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Tuple-strict_subtuple_trans'"><span class="command">lemma</span></span> strict_subtuple_trans'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">zm</span><span class="main">)</span> <span class="free">P</span> <span class="main">⟹</span>
   strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">ym</span> <span class="free">zm</span> <span class="main">⟹</span>
   strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">zm</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fmrel_on_fset_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> <span class="var">?xm</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">ym</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subtuple_acyclic'<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Tuple-strict_subtuple_trans''"><span class="command">lemma</span></span> strict_subtuple_trans''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">zm</span><span class="main">)</span> <span class="free">R</span> <span class="main">⟹</span>
   strict_subtuple <span class="free">R</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   strict_subtuple <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">ym</span> <span class="free">zm</span> <span class="main">⟹</span>
   strict_subtuple <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">zm</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fmrel_on_fset_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> <span class="var">?xm</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">ym</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subtuple_acyclic''<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Tuple-strict_subtuple_trans'''"><span class="command">lemma</span></span> strict_subtuple_trans'''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">zm</span><span class="main">)</span> <span class="free">P</span> <span class="main">⟹</span>
   strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">ym</span> <span class="free">zm</span> <span class="main">⟹</span>
   strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">zm</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fmrel_on_fset_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> <span class="var">?xm</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">ym</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subtuple_acyclic'<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Tuple-subtuple_fmmerge2"><span class="command">lemma</span></span> subtuple_fmmerge2 <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> fmran' <span class="free">xm</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   subtuple <span class="free">f</span> <span class="free">xm</span> <span class="main">(</span>fmmerge <span class="free">g</span> <span class="free">xm</span> <span class="free">ym</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?S</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fmdom <span class="free">ym</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fmrel_on_fsubset<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(*** Transitive Closures ****************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Transitive Closures›</span></span>

<span class="keyword1" id="Tuple-trancl_to_subtuple"><span class="command">lemma</span></span> trancl_to_subtuple<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>subtuple <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   subtuple <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tranclp_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> subtuple_mono tranclp.r_into_trancl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fmrel_on_fset_trans<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Tuple-rtrancl_to_subtuple"><span class="command">lemma</span></span> rtrancl_to_subtuple<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>subtuple <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   subtuple <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmap.rel_refl_strong fmrel_to_subtuple<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fmrel_on_fset_trans<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Tuple-fmrel_to_subtuple_trancl"><span class="command">lemma</span></span> fmrel_to_subtuple_trancl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflp <span class="free">r</span> <span class="main">⟹</span>
   <span class="main">(</span>fmrel <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>fmrestrict_fset <span class="main">(</span>fmdom <span class="free">ym</span><span class="main">)</span> <span class="free">xm</span><span class="main">)</span> <span class="free">ym</span> <span class="main">⟹</span>
   <span class="main">(</span>subtuple <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> trancl_to_fmrel<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?r</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fmrel_tranclp_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fmrel_fmdom_eq
          subtuple_eq_fmrel_fmrestrict_fset tranclp.r_into_trancl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> fmrel_to_subtuple tranclp.simps<span class="main">)</span>

<span class="keyword1" id="Tuple-subtuple_to_trancl"><span class="command">lemma</span></span> subtuple_to_trancl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflp <span class="free">r</span> <span class="main">⟹</span>
   subtuple <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   <span class="main">(</span>subtuple <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fmrel_to_subtuple_trancl<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> fmrel_on_fset_fmrel_restrict
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmrel_to_trancl<span class="main">)</span>

<span class="keyword1" id="Tuple-trancl_to_strict_subtuple"><span class="command">lemma</span></span> trancl_to_strict_subtuple<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">ym</span><span class="main">)</span> <span class="free">R</span> <span class="main">⟹</span>
   <span class="main">(</span>strict_subtuple <span class="free">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   strict_subtuple <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> converse_tranclp_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> r_into_rtranclp strict_subtuple_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> strict_subtuple_trans'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Tuple-trancl_to_strict_subtuple'"><span class="command">lemma</span></span> trancl_to_strict_subtuple'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">ym</span><span class="main">)</span> <span class="free">R</span> <span class="main">⟹</span>
   <span class="main">(</span>strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">⟹</span>
   strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> converse_tranclp_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> r_into_rtranclp strict_subtuple_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> strict_subtuple_trans''' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Tuple-subtuple_rtranclp_intro"><span class="command">lemma</span></span> subtuple_rtranclp_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xm</span> <span class="bound">ym</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span><span class="free">f</span> <span class="bound">xm</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">ym</span><span class="main">)</span> <span class="main">⟹</span> subtuple <span class="free">R</span> <span class="bound">xm</span> <span class="bound">ym</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bij_on_trancl <span class="free">R</span> <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">f</span> <span class="free">xm</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">ym</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subtuple <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">xm</span> <span class="bound">ym</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span><span class="free">f</span> <span class="bound">xm</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">ym</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reflect_rtranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subtuple <span class="free">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mono_rtranclp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"subtuple <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_to_subtuple<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tuple-strict_subtuple_rtranclp_intro"><span class="command">lemma</span></span> strict_subtuple_rtranclp_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xm</span> <span class="bound">ym</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span><span class="free">f</span> <span class="bound">xm</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">ym</span><span class="main">)</span> <span class="main">⟹</span>
           strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">xm</span> <span class="bound">ym</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bij_on_trancl <span class="free">R</span> <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">ym</span><span class="main">)</span> <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span><span class="free">f</span> <span class="free">xm</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">ym</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_subtuple <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">xm</span> <span class="bound">ym</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span><span class="free">f</span> <span class="bound">xm</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">ym</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reflect_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tranclp_trans_induct<span class="main"><span class="keyword3">;</span></span>
        <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tranclp.r_into_trancl<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> trancl_to_strict_subtuple'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*** Code Setup *************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code Setup›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">subtuple_fun</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="free"><span class="bound"><span class="entity">ym</span></span></span> <span class="main">≡</span>
  fBall <span class="main">(</span>fmdom <span class="free"><span class="bound"><span class="entity">ym</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> rel_option <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>fmlookup <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>fmlookup <span class="free"><span class="bound"><span class="entity">ym</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">strict_subtuple_fun</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="free"><span class="bound"><span class="entity">ym</span></span></span> <span class="main">≡</span>
  subtuple_fun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="free"><span class="bound"><span class="entity">ym</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">xm</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">ym</span></span></span>"</span></span>

<span class="keyword1" id="Tuple-subtuple_fun_simp"><span class="command">lemma</span></span> subtuple_fun_simp <span class="main">[</span><span class="operator">code_abbrev</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subtuple_fun <span class="free">f</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">=</span> subtuple <span class="free">f</span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmrel_on_fset_alt_def<span class="main">)</span>

<span class="keyword1" id="Tuple-strict_subtuple_fun_simp"><span class="command">lemma</span></span> strict_subtuple_fun_simp <span class="main">[</span><span class="operator">code_abbrev</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_subtuple_fun <span class="free">f</span> <span class="free">xm</span> <span class="free">ym</span> <span class="main">=</span> strict_subtuple <span class="free">f</span> <span class="free">xm</span> <span class="free">ym</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Object_Model">
<div class="head">
<h1>Theory Object_Model</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Object Model›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Object_Model
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Extended_Nat.html">HOL-Library.Extended_Nat</a>"</span> <a href="#Finite_Map_Ext">Finite_Map_Ext</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The section defines a generic object model.›</span></span>

<span class="comment1">(*** Type Synonyms **********************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Type Synonyms›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> attr <span class="main">=</span> <span class="quoted">String.literal</span>
<span class="keyword1"><span class="command">type_synonym</span></span> assoc <span class="main">=</span> <span class="quoted">String.literal</span>
<span class="keyword1"><span class="command">type_synonym</span></span> role <span class="main">=</span> <span class="quoted">String.literal</span>
<span class="keyword1"><span class="command">type_synonym</span></span> oper <span class="main">=</span> <span class="quoted">String.literal</span>
<span class="keyword1"><span class="command">type_synonym</span></span> param <span class="main">=</span> <span class="quoted">String.literal</span>
<span class="keyword1"><span class="command">type_synonym</span></span> elit <span class="main">=</span> <span class="quoted">String.literal</span>

<span class="keyword1"><span class="command">datatype</span></span> param_dir <span class="main">=</span> In <span class="main">|</span> Out <span class="main">|</span> InOut

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'c</span> assoc_end <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> <span class="main">×</span> nat <span class="main">×</span> enat <span class="main">×</span> bool <span class="main">×</span> bool"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'t</span> param_spec <span class="main">=</span> <span class="quoted"><span class="quoted">"param <span class="main">×</span> <span class="tfree">'t</span> <span class="main">×</span> param_dir"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">)</span> oper_spec <span class="main">=</span>
  <span class="quoted"><span class="quoted">"oper <span class="main">×</span> <span class="tfree">'t</span> <span class="main">×</span> <span class="tfree">'t</span> param_spec list <span class="main">×</span> <span class="tfree">'t</span> <span class="main">×</span> bool <span class="main">×</span> <span class="tfree">'e</span> option"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">assoc_end_class</span> <span class="main">::</span> <span class="tfree">'c</span> assoc_end <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">≡</span> fst"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">assoc_end_min</span> <span class="main">::</span> <span class="tfree">'c</span> assoc_end <span class="main">⇒</span> nat <span class="main">≡</span> fst <span class="main">∘</span> snd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">assoc_end_max</span> <span class="main">::</span> <span class="tfree">'c</span> assoc_end <span class="main">⇒</span> enat <span class="main">≡</span> fst <span class="main">∘</span> snd <span class="main">∘</span> snd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">assoc_end_ordered</span> <span class="main">::</span> <span class="tfree">'c</span> assoc_end <span class="main">⇒</span> bool <span class="main">≡</span> fst <span class="main">∘</span> snd <span class="main">∘</span> snd <span class="main">∘</span> snd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">assoc_end_unique</span> <span class="main">::</span> <span class="tfree">'c</span> assoc_end <span class="main">⇒</span> bool <span class="main">≡</span> snd <span class="main">∘</span> snd <span class="main">∘</span> snd <span class="main">∘</span> snd"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">oper_name</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">)</span> oper_spec <span class="main">⇒</span> oper <span class="main">≡</span> fst"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">oper_context</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">)</span> oper_spec <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">≡</span> fst <span class="main">∘</span> snd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">oper_params</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">)</span> oper_spec <span class="main">⇒</span> <span class="tfree">'t</span> param_spec list <span class="main">≡</span> fst <span class="main">∘</span> snd <span class="main">∘</span> snd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">oper_result</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">)</span> oper_spec <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">≡</span> fst <span class="main">∘</span> snd <span class="main">∘</span> snd <span class="main">∘</span> snd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">oper_static</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">)</span> oper_spec <span class="main">⇒</span> bool <span class="main">≡</span> fst <span class="main">∘</span> snd <span class="main">∘</span> snd <span class="main">∘</span> snd <span class="main">∘</span> snd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">oper_body</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">)</span> oper_spec <span class="main">⇒</span> <span class="tfree">'e</span> option <span class="main">≡</span> snd <span class="main">∘</span> snd <span class="main">∘</span> snd <span class="main">∘</span> snd <span class="main">∘</span> snd"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">param_name</span> <span class="main">::</span><span class="tfree">'t</span> param_spec <span class="main">⇒</span> param <span class="main">≡</span> fst"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">param_type</span> <span class="main">::</span><span class="tfree">'t</span> param_spec <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">≡</span> fst <span class="main">∘</span> snd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">param_dir</span> <span class="main">::</span><span class="tfree">'t</span> param_spec <span class="main">⇒</span> param_dir <span class="main">≡</span> snd <span class="main">∘</span> snd"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">oper_in_params</span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main">≡</span>
  filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> param_dir <span class="bound">p</span> <span class="main">=</span> In <span class="main">∨</span> param_dir <span class="bound">p</span> <span class="main">=</span> InOut<span class="main">)</span> <span class="main">(</span>oper_params <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">oper_out_params</span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main">≡</span>
  filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> param_dir <span class="bound">p</span> <span class="main">=</span> Out <span class="main">∨</span> param_dir <span class="bound">p</span> <span class="main">=</span> InOut<span class="main">)</span> <span class="main">(</span>oper_params <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Attributes›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">owned_attribute'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">|∈|</span> fmdom <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="main">⟹</span>
   fmlookup <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">attrs<span class="hidden">⇩</span><sub>𝒞</sub></span></span></span> <span class="main">⟹</span>
   fmlookup <span class="free"><span class="bound"><span class="entity">attrs<span class="hidden">⇩</span><sub>𝒞</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">owned_attribute'</span> <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">attribute_not_closest</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"owned_attribute' <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="free"><span class="bound"><span class="entity">τ'</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">⟹</span>
   <span class="free">attribute_not_closest</span> <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">closest_attribute</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"owned_attribute' <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">⟹</span>
   <span class="main">¬</span> attribute_not_closest <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">closest_attribute</span> <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">closest_attribute_not_unique</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"closest_attribute <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="free"><span class="bound"><span class="entity">τ'</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">τ'</span></span></span> <span class="main">⟹</span>
   <span class="free">closest_attribute_not_unique</span> <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">unique_closest_attribute</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"closest_attribute <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="main">¬</span> closest_attribute_not_unique <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">unique_closest_attribute</span> <span class="free"><span class="bound"><span class="entity">attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Association Ends›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">role_refer_class</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="main">|∈|</span> fmdom <span class="free"><span class="bound"><span class="entity">ends</span></span></span> <span class="main">⟹</span>
   fmlookup <span class="free"><span class="bound"><span class="entity">ends</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   assoc_end_class <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">⟹</span>
   <span class="free">role_refer_class</span> <span class="free"><span class="bound"><span class="entity">ends</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">association_ends'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">|∈|</span> <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">assoc</span></span></span> <span class="main">|∈|</span> fmdom <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="main">⟹</span>
   fmlookup <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">assoc</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ends</span></span></span> <span class="main">⟹</span>
   role_refer_class <span class="free"><span class="bound"><span class="entity">ends</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="main">|∈|</span> fmdom <span class="free"><span class="bound"><span class="entity">ends</span></span></span> <span class="main">⟹</span>
   fmlookup <span class="free"><span class="bound"><span class="entity">ends</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="main">⟹</span>
   <span class="free">association_ends'</span> <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">association_ends_not_unique'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"association_ends' <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⟹</span>
   association_ends' <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">end<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">end<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free">association_ends_not_unique'</span> <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">owned_association_end'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"association_ends' <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="free">owned_association_end'</span> <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> None <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"association_ends' <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="free">owned_association_end'</span> <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">from</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">association_end_not_closest</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"owned_association_end' <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end'</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">⟹</span>
   <span class="free">association_end_not_closest</span> <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">closest_association_end</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"owned_association_end' <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">⟹</span>
   <span class="main">¬</span> association_end_not_closest <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="free">closest_association_end</span> <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">closest_association_end_not_unique</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"closest_association_end <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="free"><span class="bound"><span class="entity">end'</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">end'</span></span></span> <span class="main">⟹</span>
   <span class="free">closest_association_end_not_unique</span> <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">unique_closest_association_end</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"closest_association_end <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="main">¬</span> closest_association_end_not_unique <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="free">unique_closest_association_end</span> <span class="free"><span class="bound"><span class="entity">classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Association Classes›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">referred_by_association_class''</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"fmlookup <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">assoc</span></span></span> <span class="main">⟹</span>
   fmlookup <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">assoc</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ends</span></span></span> <span class="main">⟹</span>
   role_refer_class <span class="free"><span class="bound"><span class="entity">ends</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="main">⟹</span>
   <span class="free">referred_by_association_class''</span> <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">referred_by_association_class'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"referred_by_association_class'' <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">⟹</span>
   <span class="free">referred_by_association_class'</span> <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> None <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"referred_by_association_class'' <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">⟹</span>
   <span class="free">referred_by_association_class'</span> <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">from</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">association_class_not_closest</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"referred_by_association_class' <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">⟹</span>
   <span class="free">association_class_not_closest</span> <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">closest_association_class</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"referred_by_association_class' <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">⟹</span>
   <span class="main">¬</span> association_class_not_closest <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">⟹</span>
   <span class="free">closest_association_class</span> <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">closest_association_class_not_unique</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"closest_association_class <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">𝒟'</span></span></span> <span class="main">⟹</span>
   <span class="free">closest_association_class_not_unique</span>
        <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">unique_closest_association_class</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"closest_association_class <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">⟹</span>
   <span class="main">¬</span> closest_association_class_not_unique
        <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">⟹</span>
   <span class="free">unique_closest_association_class</span> <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Association Class Ends›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">association_class_end'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"fmlookup <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">assoc</span></span></span> <span class="main">⟹</span>
   fmlookup <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">assoc</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">ends</span></span></span> <span class="main">⟹</span>
   fmlookup <span class="free"><span class="bound"><span class="entity">ends</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="free">association_class_end'</span> <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">association_class_end_not_unique</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"association_class_end' <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end'</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">end'</span></span></span> <span class="main">⟹</span>
   <span class="free">association_class_end_not_unique</span> <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">unique_association_class_end</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"association_class_end' <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="main">¬</span> association_class_end_not_unique
        <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="free">unique_association_class_end</span> <span class="free"><span class="bound"><span class="entity">association_classes</span></span></span> <span class="free"><span class="bound"><span class="entity">associations</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Operations›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">any_operation'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main">|∈|</span> fset_of_list <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="main">⟹</span>
   oper_name <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> oper_context <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main">⟹</span>
   list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span> <span class="bound">param</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">≤</span> param_type <span class="bound">param</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">(</span>oper_in_params <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free">any_operation'</span> <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">operation'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"any_operation' <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main">⟹</span>
   <span class="main">¬</span> oper_static <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main">⟹</span>
   <span class="free">operation'</span> <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">operation_not_unique</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"operation' <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper'</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">oper'</span></span></span> <span class="main">⟹</span>
   <span class="free">operation_not_unique</span> <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">unique_operation</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"operation' <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">⟹</span>
   <span class="main">¬</span> operation_not_unique <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">⟹</span>
   <span class="free">unique_operation</span> <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">operation_defined'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"unique_operation <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">⟹</span>
   <span class="free">operation_defined'</span> <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">static_operation'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"any_operation' <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main">⟹</span>
   oper_static <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main">⟹</span>
   <span class="free">static_operation'</span> <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">static_operation_not_unique</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"static_operation' <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper'</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">oper'</span></span></span> <span class="main">⟹</span>
   <span class="free">static_operation_not_unique</span> <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">unique_static_operation</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"static_operation' <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">⟹</span>
   <span class="main">¬</span> static_operation_not_unique <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">⟹</span>
   <span class="free">unique_static_operation</span> <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">static_operation_defined'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"unique_static_operation <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">⟹</span>
   <span class="free">static_operation_defined'</span> <span class="free"><span class="bound"><span class="entity">operations</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Literals›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">has_literal'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"fmlookup <span class="free"><span class="bound"><span class="entity">literals</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">lits</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">lit</span></span></span> <span class="main">|∈|</span> <span class="free"><span class="bound"><span class="entity">lits</span></span></span> <span class="main">⟹</span>
   <span class="free">has_literal'</span> <span class="free"><span class="bound"><span class="entity">literals</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">lit</span></span></span>"</span></span>

<span class="comment1">(*** Definition *************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition›</span></span>

<span class="keyword1"><span class="command">locale</span></span> object_model <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">classes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semilattice_sup fset"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">attributes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> attr <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> <span class="tfree">'t</span> <span class="main">::</span> order"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">associations</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assoc <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> role <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> <span class="tfree">'a</span> assoc_end"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">association_classes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> assoc"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">operations</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'e</span><span class="main">)</span> oper_spec list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">literals</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'n</span> <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> elit fset"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> assoc_end_min_less_eq_max<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">assoc</span> <span class="main">|∈|</span> fmdom <span class="free">associations</span> <span class="main">⟹</span>
     fmlookup <span class="free">associations</span> <span class="free">assoc</span> <span class="main">=</span> Some <span class="free">ends</span> <span class="main">⟹</span>
     <span class="free">role</span> <span class="main">|∈|</span> fmdom <span class="free">ends</span>  <span class="main">⟹</span>
     fmlookup <span class="free">ends</span> <span class="free">role</span> <span class="main">=</span> Some <span class="free">end</span> <span class="main">⟹</span>
     assoc_end_min <span class="free">end</span> <span class="main">≤</span> assoc_end_max <span class="free">end</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> association_ends_unique<span class="main">:</span>
    <span class="quoted"><span class="quoted">"association_ends' <span class="free">classes</span> <span class="free">associations</span> <span class="free">𝒞</span> <span class="free">from</span> <span class="free">role</span> <span class="free">end<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
     association_ends' <span class="free">classes</span> <span class="free">associations</span> <span class="free">𝒞</span> <span class="free">from</span> <span class="free">role</span> <span class="free">end<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">end<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">end<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">owned_attribute</span> <span class="main">≡</span>
  owned_attribute' <span class="free">attributes</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">attribute</span> <span class="main">≡</span>
  unique_closest_attribute <span class="free">attributes</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">association_ends</span> <span class="main">≡</span>
  association_ends' <span class="free">classes</span> <span class="free">associations</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">owned_association_end</span> <span class="main">≡</span>
  owned_association_end' <span class="free">classes</span> <span class="free">associations</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">association_end</span> <span class="main">≡</span>
  unique_closest_association_end <span class="free">classes</span> <span class="free">associations</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">referred_by_association_class</span> <span class="main">≡</span>
  unique_closest_association_class <span class="free">association_classes</span> <span class="free">associations</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">association_class_end</span> <span class="main">≡</span>
  unique_association_class_end <span class="free">association_classes</span> <span class="free">associations</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">operation</span> <span class="main">≡</span>
  unique_operation <span class="free">operations</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">operation_defined</span> <span class="main">≡</span>
  operation_defined' <span class="free">operations</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">static_operation</span> <span class="main">≡</span>
  unique_static_operation <span class="free">operations</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">static_operation_defined</span> <span class="main">≡</span>
  static_operation_defined' <span class="free">operations</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_literal</span> <span class="main">≡</span>
  has_literal' <span class="free">literals</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">declare</span></span> operation_defined'.simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> static_operation_defined'.simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> has_literal'.simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="comment1">(*** Properties *************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> object_model<span class="main">)</span> attribute_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"attribute <span class="free">𝒞</span> <span class="free">attr</span> <span class="free">𝒟<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">τ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   attribute <span class="free">𝒞</span> <span class="free">attr</span> <span class="free">𝒟<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">τ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">𝒟<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">𝒟<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="free">τ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">τ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> closest_attribute_not_unique.intros unique_closest_attribute.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> object_model<span class="main">)</span> attribute_self_or_inherited<span class="main">:</span>
  <span class="quoted"><span class="quoted">"attribute <span class="free">𝒞</span> <span class="free">attr</span> <span class="free">𝒟</span> <span class="free">τ</span> <span class="main">⟹</span> <span class="free">𝒞</span> <span class="main">≤</span> <span class="free">𝒟</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> closest_attribute.cases unique_closest_attribute.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> object_model<span class="main">)</span> attribute_closest<span class="main">:</span>
  <span class="quoted"><span class="quoted">"attribute <span class="free">𝒞</span> <span class="free">attr</span> <span class="free">𝒟</span> <span class="free">τ</span> <span class="main">⟹</span>
   owned_attribute <span class="free">𝒟'</span> <span class="free">attr</span> <span class="free">τ</span> <span class="main">⟹</span>
   <span class="free">𝒞</span> <span class="main">≤</span> <span class="free">𝒟'</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">𝒟'</span> <span class="main">&lt;</span> <span class="free">𝒟</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> attribute_not_closest.intros closest_attribute.cases
      unique_closest_attribute.cases<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> object_model<span class="main">)</span> association_end_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"association_end <span class="free">𝒞</span> <span class="free">from</span> <span class="free">role</span> <span class="free">𝒟<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">end<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   association_end <span class="free">𝒞</span> <span class="free">from</span> <span class="free">role</span> <span class="free">𝒟<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">end<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">𝒟<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">𝒟<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="free">end<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">end<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> closest_association_end_not_unique.intros
      unique_closest_association_end.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> object_model<span class="main">)</span> association_end_self_or_inherited<span class="main">:</span>
  <span class="quoted"><span class="quoted">"association_end <span class="free">𝒞</span> <span class="free">from</span> <span class="free">role</span> <span class="free">𝒟</span> <span class="free">end</span> <span class="main">⟹</span> <span class="free">𝒞</span> <span class="main">≤</span> <span class="free">𝒟</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> closest_association_end.cases unique_closest_association_end.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> object_model<span class="main">)</span> association_end_closest<span class="main">:</span>
  <span class="quoted"><span class="quoted">"association_end <span class="free">𝒞</span> <span class="free">from</span> <span class="free">role</span> <span class="free">𝒟</span> <span class="free">end</span> <span class="main">⟹</span>
   owned_association_end <span class="free">𝒟'</span> <span class="free">from</span> <span class="free">role</span> <span class="free">end</span> <span class="main">⟹</span>
   <span class="free">𝒞</span> <span class="main">≤</span> <span class="free">𝒟'</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">𝒟'</span> <span class="main">&lt;</span> <span class="free">𝒟</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> association_end_not_closest.intros closest_association_end.cases
      unique_closest_association_end.cases<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> object_model<span class="main">)</span> association_class_end_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"association_class_end <span class="free">𝒜</span> <span class="free">role</span> <span class="free">end<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   association_class_end <span class="free">𝒜</span> <span class="free">role</span> <span class="free">end<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">end<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">end<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> association_class_end_not_unique.intros unique_association_class_end.cases<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> object_model<span class="main">)</span> operation_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"operation <span class="free">τ</span> <span class="free">name</span> <span class="free">π</span> <span class="free">oper<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   operation <span class="free">τ</span> <span class="free">name</span> <span class="free">π</span> <span class="free">oper<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">oper<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">oper<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> operation_not_unique.intros unique_operation.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> object_model<span class="main">)</span> static_operation_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"static_operation <span class="free">τ</span> <span class="free">name</span> <span class="free">π</span> <span class="free">oper<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   static_operation <span class="free">τ</span> <span class="free">name</span> <span class="free">π</span> <span class="free">oper<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">oper<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">oper<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> static_operation_not_unique.intros unique_static_operation.cases<span class="main">)</span>

<span class="comment1">(*** Code Setup *************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code Setup›</span></span>

<span class="keyword1" id="Object_Model-fmember_code_predI"><span class="command">lemma</span></span> fmember_code_predI <span class="main">[</span><span class="operator">code_pred_intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">|∈|</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Predicate_Compile.contains <span class="main">(</span>fset <span class="free">xs</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Predicate_Compile.contains_def fmember.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">fmember</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Predicate_Compile.contains_def fmember.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">unique_closest_attribute</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ i ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ i ⇒ o ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ o ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ o ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ o ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ o ⇒ o ⇒ o ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">association_ends'</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">association_ends_not_unique'</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ i ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ i ⇒ o ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ o ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ o ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ o ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ o ⇒ o ⇒ o ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">owned_association_end'</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ o ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ o ⇒ o ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">closest_association_end</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ i ⇒ i ⇒ bool <span class="main">)</span> <span class="quoted"><span class="quoted">closest_association_end_not_unique</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ o ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">unique_closest_association_end</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">unique_closest_association_class</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">association_class_end'</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">association_class_end_not_unique</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">unique_association_class_end</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">any_operation'</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">operation'</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">operation_not_unique</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">unique_operation</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">operation_defined'</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">static_operation'</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">static_operation_not_unique</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ i ⇒ i ⇒ o ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">unique_static_operation</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">static_operation_defined'</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">has_literal'</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="OCL_Basic_Types">
<div class="head">
<h1>Theory OCL_Basic_Types</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Basic Types›</span></span>
<span class="keyword1"><span class="command">theory</span></span> OCL_Basic_Types
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/FSet.html">HOL-Library.FSet</a>"</span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Phantom_Type.html">HOL-Library.Phantom_Type</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*** Definition *************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Definition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Basic types are parameterized over classes.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> enum <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> String.literal<span class="main">)</span> phantom"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> elit <span class="main">=</span> <span class="quoted">String.literal</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="quoted">order</span><span class="main">)</span> basic_type <span class="main">=</span>
  OclAny
<span class="main">|</span> OclVoid
<span class="main">|</span> Boolean
<span class="main">|</span> Real
<span class="main">|</span> Integer
<span class="main">|</span> UnlimitedNatural
<span class="main">|</span> String
<span class="main">|</span> ObjectType <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⟨</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>0<span class="main">]</span> 1000<span class="main">)</span>
<span class="main">|</span> Enum <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> enum"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">basic_subtype</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"OclVoid <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> Boolean"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"OclVoid <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> UnlimitedNatural"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"OclVoid <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> String"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"OclVoid <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"OclVoid <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> Enum <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"UnlimitedNatural <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> Integer"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Integer <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> Real"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒟</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"Boolean <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> OclAny"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Real <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> OclAny"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"String <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> OclAny"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> OclAny"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Enum <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="keyword1"><span class="free">⊏<span class="hidden">⇩</span><sub>B</sub></span></span> OclAny"</span></span>

<span class="keyword1"><span class="command">declare</span></span> basic_subtype.intros <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">]</span>

<span class="keyword1"><span class="command">inductive_cases</span></span> basic_subtype_x_OclAny <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> OclAny"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> basic_subtype_x_OclVoid <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> OclVoid"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> basic_subtype_x_Boolean <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> Boolean"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> basic_subtype_x_Real <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> Real"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> basic_subtype_x_Integer <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> Integer"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> basic_subtype_x_UnlimitedNatural <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> UnlimitedNatural"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> basic_subtype_x_String <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> String"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> basic_subtype_x_ObjectType <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">⟨</span><span class="free">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> basic_subtype_x_Enum <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> Enum <span class="free">ℰ</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> basic_subtype_OclAny_x <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"OclAny <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> basic_subtype_ObjectType_x <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">σ</span>"</span></span>

<span class="keyword1" id="OCL_Basic_Types-basic_subtype_asym"><span class="command">lemma</span></span> basic_subtype_asym<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">τ</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> basic_subtype.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(*** Partial Order of Basic Types *******************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Partial Order of Basic Types›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> basic_type <span class="main">::</span> <span class="main">(</span><span class="quoted">order</span><span class="main">)</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span> <span class="main">≡</span> basic_subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span> <span class="main">≡</span> basic_subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>

<span class="comment1">(*** Strict Introduction Rules **********************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Strict Introduction Rules›</span></span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_OclAny_intro"><span class="command">lemma</span></span> type_less_x_OclAny_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≠</span> OclAny <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> OclAny"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basic_subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> OclVoid OclAny"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?b</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Boolean"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tranclp.trancl_into_trancl<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basic_subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> Integer OclAny"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?b</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Real"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tranclp.trancl_into_trancl<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"basic_subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> UnlimitedNatural OclAny"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?b</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Integer"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tranclp_into_tranclp2<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≠</span> OclAny <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> OclAny"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">τ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Basic_Types-type_less_OclVoid_x_intro"><span class="command">lemma</span></span> type_less_OclVoid_x_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≠</span> OclVoid <span class="main">⟹</span> OclVoid <span class="main">&lt;</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basic_subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> OclVoid OclAny"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?b</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Boolean"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tranclp.trancl_into_trancl<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basic_subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> OclVoid Integer"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?b</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"UnlimitedNatural"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tranclp.trancl_into_trancl<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"basic_subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> OclVoid Real"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?b</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Integer"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tranclp.trancl_into_trancl<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≠</span> OclVoid <span class="main">⟹</span> OclVoid <span class="main">&lt;</span> <span class="free">τ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">τ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_Real_intro"><span class="command">lemma</span></span> type_less_x_Real_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> Real"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Integer <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> Real"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtranclp_into_tranclp2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_Integer_intro"><span class="command">lemma</span></span> type_less_x_Integer_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> Integer"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtranclp_into_tranclp2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_ObjectType_intro"><span class="command">lemma</span></span> type_less_x_ObjectType_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⟹</span> <span class="free">𝒞</span> <span class="main">&lt;</span> <span class="free">𝒟</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> <span class="main">⟨</span><span class="free">𝒟</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command">using</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*** Strict Elimination Rules ***********************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Strict Elimination Rules›</span></span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_OclAny"><span class="command">lemma</span></span> type_less_x_OclAny <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> OclAny <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Boolean <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Integer <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Real <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> String <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ℰ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Enum <span class="bound">ℰ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋀</span><span class="bound">𝒞</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_OclVoid"><span class="command">lemma</span></span> type_less_x_OclVoid <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> OclVoid <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_Boolean"><span class="command">lemma</span></span> type_less_x_Boolean <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Boolean <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_Real"><span class="command">lemma</span></span> type_less_x_Real <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Real <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Integer <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_Integer"><span class="command">lemma</span></span> type_less_x_Integer <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Integer <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_UnlimitedNatural"><span class="command">lemma</span></span> type_less_x_UnlimitedNatural <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> UnlimitedNatural <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_String"><span class="command">lemma</span></span> type_less_x_String <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> String <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_ObjectType"><span class="command">lemma</span></span> type_less_x_ObjectType <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> <span class="main">⟨</span><span class="free">𝒟</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">𝒞</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⟹</span> <span class="bound">𝒞</span> <span class="main">&lt;</span> <span class="free">𝒟</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_x_Enum"><span class="command">lemma</span></span> type_less_x_Enum <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Enum <span class="free">ℰ</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(*** Properties *************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1" id="OCL_Basic_Types-basic_subtype_irrefl"><span class="command">lemma</span></span> basic_subtype_irrefl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> <span class="free">τ</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> basic_type"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">τ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-tranclp_less_basic_type"><span class="command">lemma</span></span> tranclp_less_basic_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">τ</span><span class="main">,</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">τ</span><span class="main">,</span> <span class="bound">σ</span><span class="main">)</span><span class="main">.</span> <span class="bound">τ</span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> <span class="bound">σ</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟷</span> <span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tranclp_unfold less_basic_type_def<span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-basic_subtype_acyclic"><span class="command">lemma</span></span> basic_subtype_acyclic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP basic_subtype"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> acyclicI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> OCL_Basic_Types.basic_subtype_irrefl
    OCL_Basic_Types.tranclp_less_basic_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Basic_Types-less_le_not_le_basic_type"><span class="command">lemma</span></span> less_le_not_le_basic_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟷</span> <span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">σ</span> <span class="main">≤</span> <span class="free">τ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="free">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> basic_type"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_basic_type_def less_eq_basic_type_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> basic_subtype_irrefl
      less_basic_type_def tranclp_rtranclp_tranclp<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> rtranclpD<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-antisym_basic_type"><span class="command">lemma</span></span> antisym_basic_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">≤</span> <span class="free">τ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="free">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> basic_type"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_eq_basic_type_def less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> less_eq_basic_type_def
      less_le_not_le_basic_type less_basic_type_def rtranclpD<span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-order_refl_basic_type"><span class="command">lemma</span></span> order_refl_basic_type <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">τ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> basic_type"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_basic_type_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_basic_type_def
        less_le_not_le_basic_type antisym_basic_type<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*** Non-Strict Introduction Rules ******************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Non-Strict Introduction Rules›</span></span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_OclAny_intro"><span class="command">lemma</span></span> type_less_eq_x_OclAny_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> OclAny"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_OclVoid_x_intro"><span class="command">lemma</span></span> type_less_eq_OclVoid_x_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"OclVoid <span class="main">≤</span> <span class="free">τ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_Real_intro"><span class="command">lemma</span></span> type_less_eq_x_Real_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Real"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Integer <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Real"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_Integer_intro"><span class="command">lemma</span></span> type_less_eq_x_Integer_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Integer"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_ObjectType_intro"><span class="command">lemma</span></span> type_less_eq_x_ObjectType_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⟹</span> <span class="free">𝒞</span> <span class="main">≤</span> <span class="free">𝒟</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> <span class="main">⟨</span><span class="free">𝒟</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="comment1">(*** Non-Strict Elimination Rules *******************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Non-Strict Elimination Rules›</span></span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_OclAny"><span class="command">lemma</span></span> type_less_eq_x_OclAny <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> OclAny <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclAny <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Boolean <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Integer <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Real <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> String <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ℰ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Enum <span class="bound">ℰ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋀</span><span class="bound">𝒞</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_OclVoid"><span class="command">lemma</span></span> type_less_eq_x_OclVoid <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> OclVoid <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_Boolean"><span class="command">lemma</span></span> type_less_eq_x_Boolean <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> Boolean <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Boolean <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_Real"><span class="command">lemma</span></span> type_less_eq_x_Real <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> Real <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Integer <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Real <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_Integer"><span class="command">lemma</span></span> type_less_eq_x_Integer <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> Integer <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Integer <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_UnlimitedNatural"><span class="command">lemma</span></span> type_less_eq_x_UnlimitedNatural <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> UnlimitedNatural <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_String"><span class="command">lemma</span></span> type_less_eq_x_String <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> String <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> String <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_ObjectType"><span class="command">lemma</span></span> type_less_eq_x_ObjectType <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="main">⟨</span><span class="free">𝒟</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">𝒞</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⟹</span> <span class="bound">𝒞</span> <span class="main">≤</span> <span class="free">𝒟</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-type_less_eq_x_Enum"><span class="command">lemma</span></span> type_less_eq_x_Enum <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> Enum <span class="free">ℰ</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Enum <span class="free">ℰ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(*** Simplification Rules ***************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simplification Rules›</span></span>

<span class="keyword1" id="OCL_Basic_Types-basic_type_less_left_simps"><span class="command">lemma</span></span> basic_type_less_left_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"OclAny <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> False"</span></span>
  <span class="quoted"><span class="quoted">"OclVoid <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">≠</span> OclVoid<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"Boolean <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">=</span> OclAny<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"Real <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">=</span> OclAny<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"Integer <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">=</span> OclAny <span class="main">∨</span> <span class="free">σ</span> <span class="main">=</span> Real<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"UnlimitedNatural <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">=</span> OclAny <span class="main">∨</span> <span class="free">σ</span> <span class="main">=</span> Real <span class="main">∨</span> <span class="free">σ</span> <span class="main">=</span> Integer<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"String <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">=</span> OclAny<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"ObjectType <span class="free">𝒞</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">𝒟</span><span class="main">.</span> <span class="free">σ</span> <span class="main">=</span> OclAny <span class="main">∨</span> <span class="free">σ</span> <span class="main">=</span> ObjectType <span class="bound">𝒟</span> <span class="main">∧</span> <span class="free">𝒞</span> <span class="main">&lt;</span> <span class="bound">𝒟</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"Enum <span class="free">ℰ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ</span> <span class="main">=</span> OclAny<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">σ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-basic_type_less_right_simps"><span class="command">lemma</span></span> basic_type_less_right_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> OclAny <span class="main">=</span> <span class="main">(</span><span class="free">τ</span> <span class="main">≠</span> OclAny<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> OclVoid <span class="main">=</span> False"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Boolean <span class="main">=</span> <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Real <span class="main">=</span> <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> Integer <span class="main">∨</span> <span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">∨</span> <span class="free">τ</span> <span class="main">=</span> OclVoid<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Integer <span class="main">=</span> <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> UnlimitedNatural <span class="main">∨</span> <span class="free">τ</span> <span class="main">=</span> OclVoid<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> UnlimitedNatural <span class="main">=</span> <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> String <span class="main">=</span> <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> ObjectType <span class="free">𝒟</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">𝒞</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> ObjectType <span class="bound">𝒞</span> <span class="main">∧</span> <span class="bound">𝒞</span> <span class="main">&lt;</span> <span class="free">𝒟</span> <span class="main">∨</span> <span class="free">τ</span> <span class="main">=</span> OclVoid<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Enum <span class="free">ℰ</span> <span class="main">=</span> <span class="main">(</span><span class="free">τ</span> <span class="main">=</span> OclVoid<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*** Upper Semilattice of Basic Types ***************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Upper Semilattice of Basic Types›</span></span>

<span class="keyword1"><span class="command">notation</span></span> sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> basic_type <span class="main">::</span> <span class="main">(</span><span class="quoted">semilattice_sup</span><span class="main">)</span> <span class="quoted">semilattice_sup</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* We use "case"-style because it works faster *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">sup_basic_type</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">of</span> OclVoid <span class="main">⇒</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">|</span> <span class="main">⟨</span><span class="bound">𝒟</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⇒</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">⊔</span> <span class="bound">𝒟</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> OclAny<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="keyword1">else</span> OclAny<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="OCL_Basic_Types-sup_ge1_ObjectType"><span class="command">lemma</span></span> sup_ge1_ObjectType<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">≤</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⊔</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> basic_subtype.simps
        less_eq_basic_type_def r_into_rtranclp<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nitpick.rtranclp_unfold basic_subtype.intros<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span>
        le_imp_less_or_eq r_into_rtranclp sup_ge1<span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-sup_ge1_basic_type"><span class="command">lemma</span></span> sup_ge1_basic_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">τ</span> <span class="main">⊔</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="free">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> basic_type"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">τ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> sup_ge1_ObjectType <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Basic_Types-sup_commut_basic_type"><span class="command">lemma</span></span> sup_commut_basic_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊔</span> <span class="free">σ</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">⊔</span> <span class="free">τ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="free">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> basic_type"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">τ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.commute<span class="main">)</span>

<span class="keyword1" id="OCL_Basic_Types-sup_least_basic_type"><span class="command">lemma</span></span> sup_least_basic_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">≤</span> <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">⊔</span> <span class="free">σ</span> <span class="main">≤</span> <span class="free">ρ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> basic_type"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ρ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_ge1_basic_type
        sup_commut_basic_type sup_least_basic_type<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*** Code Setup *************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Code Setup›</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">basic_subtype</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">basic_subtype_fun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>order basic_type <span class="main">⇒</span> <span class="tfree">'a</span> basic_type <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">basic_subtype_fun</span> OclAny <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">basic_subtype_fun</span> OclVoid <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≠</span> OclVoid<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">basic_subtype_fun</span> Boolean <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> OclAny<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">basic_subtype_fun</span> Real <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> OclAny<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">basic_subtype_fun</span> Integer <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> Real <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> OclAny<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">basic_subtype_fun</span> UnlimitedNatural <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> Integer <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> Real <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> OclAny<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">basic_subtype_fun</span> String <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> OclAny<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">basic_subtype_fun</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> <span class="main">⟨</span><span class="bound">𝒟</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">&lt;</span> <span class="bound">𝒟</span>
     <span class="main">|</span> OclAny <span class="main">⇒</span> True
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">basic_subtype_fun</span> <span class="main">(</span>Enum <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> OclAny<span class="main">)</span>"</span></span>

<span class="keyword1" id="OCL_Basic_Types-less_basic_type_code"><span class="command">lemma</span></span> less_basic_type_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span> <span class="main">=</span> basic_subtype_fun"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> basic_type"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">τ</span> <span class="main">&lt;</span> <span class="skolem">σ</span> <span class="main">⟹</span> basic_subtype_fun <span class="skolem">τ</span> <span class="skolem">σ</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> basic_subtype_fun.elims<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"basic_subtype_fun <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="main">⟹</span> <span class="skolem">τ</span> <span class="main">&lt;</span> <span class="skolem">σ</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> basic_subtype_fun.elims<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Basic_Types-less_eq_basic_type_code"><span class="command">lemma</span></span> less_eq_basic_type_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(≤)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> basic_subtype_fun <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dual_order.order_iff_strict less_basic_type_code
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="OCL_Types">
<div class="head">
<h1>Theory OCL_Types</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Types›</span></span>
<span class="keyword1"><span class="command">theory</span></span> OCL_Types
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#OCL_Basic_Types">OCL_Basic_Types</a> <a href="#Errorable">Errorable</a> <a href="#Tuple">Tuple</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*** Definition *************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Definition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Types are parameterized over classes.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> telem <span class="main">=</span> <span class="quoted">String.literal</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="quasi_keyword">plugins</span> <span class="quasi_keyword">del</span><span class="main">:</span> size<span class="main">)</span> <span class="tfree">'a</span> type <span class="main">=</span>
  OclSuper
<span class="main">|</span> Required <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> basic_type"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">[1]</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>1000<span class="main">]</span> 1000<span class="main">)</span>
<span class="main">|</span> Optional <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> basic_type"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">[?]</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>1000<span class="main">]</span> 1000<span class="main">)</span>
<span class="main">|</span> Collection <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
<span class="main">|</span> Set <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
<span class="main">|</span> OrderedSet <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
<span class="main">|</span> Bag <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
<span class="main">|</span> Sequence <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
<span class="main">|</span> Tuple <span class="quoted"><span class="quoted">"telem <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> <span class="tfree">'a</span> type"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">OclInvalid</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> type separately, because we
  do not need types like <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"Set(OclInvalid)"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in the theory.
  The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"OclVoid[1]"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> type is not equal to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">OclInvalid</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  For example, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"Set(OclVoid[1])"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> could theoretically be
  a valid type of the following expression:›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Set{null}-&gt;excluding(null)›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">OclInvalid</span> <span class="main">::</span> <span class="tfree">'a</span> type<span class="main"><span class="hidden">⇩</span><sub>⊥</sub></span> <span class="main">≡</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> type <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">size</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity"><span class="class_parameter">size_type</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">size_type</span> OclSuper <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">size_type</span> <span class="main">(</span>Required <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">size_type</span> <span class="main">(</span>Optional <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">size_type</span> <span class="main">(</span>Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">size_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">size_type</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">size_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">size_type</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">size_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">size_type</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">size_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">size_type</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">size_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">size_type</span> <span class="main">(</span>Tuple <span class="free"><span class="bound"><span class="entity">π</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>ffold tcf <span class="main">0</span> <span class="main">(</span>fset_of_fmap <span class="main">(</span>fmmap <span class="free">size_type</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">subtype</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>order type <span class="main">⇒</span> <span class="tfree">'a</span> type <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[1]</span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="keyword1">⊏<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[?]</span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">[?]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[1]</span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[?]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"OclAny<span class="main">[?]</span> <span class="main"><span class="free">⊏</span></span> OclSuper"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> Collection <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> Set <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> OrderedSet <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> Bag <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> Sequence <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="free">⊏</span></span> Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Collection OclSuper <span class="main"><span class="free">⊏</span></span> OclSuper"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">τ</span> <span class="main"><span class="free">⊏</span></span> <span class="bound">σ</span> <span class="main">∨</span> <span class="bound">τ</span> <span class="main">=</span> <span class="bound">σ</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">⟹</span>
   Tuple <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main"><span class="free">⊏</span></span> Tuple <span class="free"><span class="bound"><span class="entity">ξ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Tuple <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main"><span class="free">⊏</span></span> OclSuper"</span></span>

<span class="keyword1"><span class="command">declare</span></span> subtype.intros <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">]</span>

<span class="keyword1"><span class="command">inductive_cases</span></span> subtype_x_OclSuper <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊏</span> OclSuper"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> subtype_x_Required <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊏</span> <span class="free">σ</span><span class="main">[1]</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> subtype_x_Optional <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊏</span> <span class="free">σ</span><span class="main">[?]</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> subtype_x_Collection <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊏</span> Collection <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> subtype_x_Set <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊏</span> Set <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> subtype_x_OrderedSet <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊏</span> OrderedSet <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> subtype_x_Bag <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊏</span> Bag <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> subtype_x_Sequence <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊏</span> Sequence <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> subtype_x_Tuple <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊏</span> Tuple <span class="free">π</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> subtype_OclSuper_x <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"OclSuper <span class="main">⊏</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> subtype_Collection_x <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Collection <span class="free">τ</span> <span class="main">⊏</span> <span class="free">σ</span>"</span></span>

<span class="keyword1" id="OCL_Types-subtype_asym"><span class="command">lemma</span></span> subtype_asym<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊏</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">⊏</span> <span class="free">τ</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> subtype.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> basic_subtype_asym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">using</span></span> subtuple_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="comment1">(*** Constructors Bijectivity on Transitive Closures ************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Constructors Bijectivity on Transitive Closures›</span></span>

<span class="keyword1" id="OCL_Types-Required_bij_on_trancl"><span class="command">lemma</span></span> Required_bij_on_trancl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_on_trancl subtype Required"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_def<span class="main">)</span>

<span class="keyword1" id="OCL_Types-not_subtype_Optional_Required"><span class="command">lemma</span></span> not_subtype_Optional_Required<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">τ</span><span class="main">[?]</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">=</span> <span class="free">ρ</span><span class="main">[1]</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-Optional_bij_on_trancl"><span class="command">lemma</span></span> Optional_bij_on_trancl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_on_trancl subtype Optional"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> not_subtype_Optional_Required <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="OCL_Types-subtype_tranclp_Collection_x"><span class="command">lemma</span></span> subtype_tranclp_Collection_x<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Collection <span class="free">τ</span><span class="main">)</span> <span class="free">σ</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">σ</span> <span class="main">=</span> Collection <span class="bound">ρ</span> <span class="main">⟹</span> subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">τ</span> <span class="bound">ρ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">σ</span> <span class="main">=</span> OclSuper <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tranclp_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subtype_Collection_x subtype_OclSuper_x tranclp.trancl_into_trancl<span class="main">)</span>

<span class="keyword1" id="OCL_Types-Collection_bij_on_trancl"><span class="command">lemma</span></span> Collection_bij_on_trancl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_on_trancl subtype Collection"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> subtype_tranclp_Collection_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Types-Set_bij_on_trancl"><span class="command">lemma</span></span> Set_bij_on_trancl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_on_trancl subtype Set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_def<span class="main">)</span>

<span class="keyword1" id="OCL_Types-OrderedSet_bij_on_trancl"><span class="command">lemma</span></span> OrderedSet_bij_on_trancl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_on_trancl subtype OrderedSet"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_def<span class="main">)</span>

<span class="keyword1" id="OCL_Types-Bag_bij_on_trancl"><span class="command">lemma</span></span> Bag_bij_on_trancl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_on_trancl subtype Bag"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_def<span class="main">)</span>

<span class="keyword1" id="OCL_Types-Sequence_bij_on_trancl"><span class="command">lemma</span></span> Sequence_bij_on_trancl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_on_trancl subtype Sequence"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_def<span class="main">)</span>

<span class="keyword1" id="OCL_Types-Tuple_bij_on_trancl"><span class="command">lemma</span></span> Tuple_bij_on_trancl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_on_trancl subtype Tuple"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_def<span class="main">)</span>

<span class="comment1">(*** Partial Order of Types *************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Partial Order of Types›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> type <span class="main">::</span> <span class="main">(</span><span class="quoted">order</span><span class="main">)</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span> <span class="main">≡</span> subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span> <span class="main">≡</span> subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>

<span class="comment1">(*** Strict Introduction Rules **********************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Strict Introduction Rules›</span></span>

<span class="keyword1" id="OCL_Types-type_less_x_Required_intro"><span class="command">lemma</span></span> type_less_x_Required_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> <span class="free">ρ</span><span class="main">[1]</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span><span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def less_basic_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule</span> preserve_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_x_Optional_intro"><span class="command">lemma</span></span> type_less_x_Optional_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> <span class="free">ρ</span><span class="main">[1]</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span><span class="main">[?]</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> <span class="free">ρ</span><span class="main">[?]</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span><span class="main">[?]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def less_basic_type_def less_eq_basic_type_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> preserve_rtranclp''<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> preserve_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_x_Collection_intro"><span class="command">lemma</span></span> type_less_x_Collection_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Collection <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> Collection <span class="free">σ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Set <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> Collection <span class="free">σ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> OrderedSet <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> Collection <span class="free">σ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Bag <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> Collection <span class="free">σ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Sequence <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> Collection <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def less_eq_type_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?f</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Collection"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> preserve_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> preserve_rtranclp''<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> preserve_rtranclp''<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> preserve_rtranclp''<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> preserve_rtranclp''<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_x_Set_intro"><span class="command">lemma</span></span> type_less_x_Set_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Set <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> Set <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule</span> preserve_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_x_OrderedSet_intro"><span class="command">lemma</span></span> type_less_x_OrderedSet_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> OrderedSet <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> OrderedSet <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule</span> preserve_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_x_Bag_intro"><span class="command">lemma</span></span> type_less_x_Bag_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Bag <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> Bag <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule</span> preserve_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_x_Sequence_intro"><span class="command">lemma</span></span> type_less_x_Sequence_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Sequence <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> Sequence <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule</span> preserve_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-fun_or_eq_refl"><span class="command">lemma</span></span> fun_or_eq_refl <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflpI<span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_x_Tuple_intro"><span class="command">lemma</span></span> type_less_x_Tuple_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Tuple <span class="free">π</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"strict_subtuple <span class="main">(≤)</span> <span class="free">π</span> <span class="free">ξ</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Tuple <span class="free">ξ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">⊏</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="bound">τ</span> <span class="main">=</span> <span class="bound">σ</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">π</span> <span class="free">ξ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> less_eq_type_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">⊏</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="bound">τ</span> <span class="main">=</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">π</span> <span class="free">ξ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule</span> subtuple_to_trancl<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">⊏</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="bound">τ</span> <span class="main">=</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">π</span> <span class="free">ξ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tranclp_into_rtranclp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>strict_subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">⊏</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="bound">τ</span> <span class="main">=</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free">π</span> <span class="free">ξ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rtranclpD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> preserve_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Types-type_less_x_OclSuper_intro"><span class="command">lemma</span></span> type_less_x_OclSuper_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≠</span> OclSuper <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> OclSuper"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">τ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> OclSuper <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Required <span class="skolem">τ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">τ</span><span class="main">[1]</span> OclAny<span class="main">[1]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?f</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Required"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> preserve_rtranclp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">basic_subtype</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_basic_type_def type_less_eq_x_OclAny_intro<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> OclAny<span class="main">[1]</span> OclAny<span class="main">[?]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> OclAny<span class="main">[?]</span> OclSuper"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Optional <span class="skolem">τ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">τ</span><span class="main">[?]</span> OclAny<span class="main">[?]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?f</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Optional"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> preserve_rtranclp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">basic_subtype</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_basic_type_def type_less_eq_x_OclAny_intro<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> OclAny<span class="main">[?]</span> OclSuper"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span> <span class="main">(</span>Collection OclSuper<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?f</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Collection"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> preserve_rtranclp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">subtype</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Collection.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Collection OclSuper<span class="main">)</span> OclSuper"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set <span class="skolem">τ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Set <span class="skolem">τ</span><span class="main">)</span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span> <span class="main">(</span>Collection OclSuper<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?f</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Collection"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> preserve_rtranclp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">subtype</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Set.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Collection OclSuper<span class="main">)</span> OclSuper"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrderedSet <span class="skolem">τ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>OrderedSet <span class="skolem">τ</span><span class="main">)</span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span> <span class="main">(</span>Collection OclSuper<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?f</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Collection"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> preserve_rtranclp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">subtype</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> OrderedSet.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Collection OclSuper<span class="main">)</span> OclSuper"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bag <span class="skolem">τ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Bag <span class="skolem">τ</span><span class="main">)</span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span> <span class="main">(</span>Collection OclSuper<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?f</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Collection"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> preserve_rtranclp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">subtype</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Bag.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Collection OclSuper<span class="main">)</span> OclSuper"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sequence <span class="skolem">τ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Sequence <span class="skolem">τ</span><span class="main">)</span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span> <span class="main">(</span>Collection OclSuper<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?f</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Collection"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> preserve_rtranclp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">subtype</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Sequence.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subtype<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Collection OclSuper<span class="main">)</span> OclSuper"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tuple <span class="skolem">x</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*** Strict Elimination Rules ***********************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Strict Elimination Rules›</span></span>

<span class="keyword1" id="OCL_Types-type_less_x_Required"><span class="command">lemma</span></span> type_less_x_Required <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span><span class="main">[1]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="bound">ρ</span><span class="main">[1]</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ρ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> <span class="skolem">ρ</span><span class="main">[1]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">τ</span><span class="main">[1]</span> <span class="main">&lt;</span> <span class="bound">σ</span><span class="main">[1]</span> <span class="main">⟹</span> <span class="bound">τ</span> <span class="main">&lt;</span> <span class="bound">σ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def less_basic_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reflect_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(*
lemma type_less_x_Optional [elim!]:
  assumes "τ &lt; σ[?]"
      and "τ = OclVoid ⟹ P"
      and "⋀ρ. τ = ρ[1] ⟹ ρ ≤ σ ⟹ P"
      and "⋀ρ. τ = ρ[?] ⟹ ρ &lt; σ ⟹ P"
    shows "P"
proof -
  from assms(1) obtain ρ where
    "τ = OclVoid ∨ τ = ρ[1] ∨ τ = ρ[?]"
    unfolding less_type_def
    by (induct rule: converse_tranclp_induct; auto)
  moreover have "⋀τ σ. τ[1] &lt; σ[?] ⟹ τ ≤ σ"
    unfolding less_type_def less_eq_basic_type_def
    apply (drule tranclpD, auto)
    apply (erule subtype.cases, auto)
  moreover have "⋀τ σ. τ[?] &lt; σ[?] ⟹ τ &lt; σ"
    unfolding less_type_def less_basic_type_def
    by (rule reflect_tranclp; auto)
  ultimately show ?thesis
    using assms by auto
qed
*)</span>
<span class="keyword1" id="OCL_Types-type_less_x_Optional"><span class="command">lemma</span></span> type_less_x_Optional <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span><span class="main">[?]</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="bound">ρ</span><span class="main">[1]</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="bound">ρ</span><span class="main">[?]</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> subtype_x_Optional eq_refl less_basic_type_def tranclp.r_into_trancl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subtype.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> converse_rtranclp_into_rtranclp less_eq_basic_type_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_basic_type_def tranclp_into_tranclp2<span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_x_Collection"><span class="command">lemma</span></span> type_less_x_Collection <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Collection <span class="free">σ</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Collection <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Set <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> OrderedSet <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Bag <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Sequence <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Nitpick.rtranclp_unfold
          subtype_x_Collection less_eq_type_def tranclp.r_into_trancl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> subtype.cases<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> converse_rtranclp_into_rtranclp less_eq_type_def
                     tranclp_into_tranclp2 tranclp_into_rtranclp<span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_x_Set"><span class="command">lemma</span></span> type_less_x_Set <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Set <span class="free">σ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Set <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ρ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Set <span class="skolem">ρ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> Set <span class="bound">τ</span> <span class="main">&lt;</span> Set <span class="bound">σ</span> <span class="main">⟹</span> <span class="bound">τ</span> <span class="main">&lt;</span> <span class="bound">σ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reflect_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Types-type_less_x_OrderedSet"><span class="command">lemma</span></span> type_less_x_OrderedSet <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> OrderedSet <span class="free">σ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> OrderedSet <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ρ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> OrderedSet <span class="skolem">ρ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> OrderedSet <span class="bound">τ</span> <span class="main">&lt;</span> OrderedSet <span class="bound">σ</span> <span class="main">⟹</span> <span class="bound">τ</span> <span class="main">&lt;</span> <span class="bound">σ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reflect_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Types-type_less_x_Bag"><span class="command">lemma</span></span> type_less_x_Bag <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Bag <span class="free">σ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Bag <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ρ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Bag <span class="skolem">ρ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> Bag <span class="bound">τ</span> <span class="main">&lt;</span> Bag <span class="bound">σ</span> <span class="main">⟹</span> <span class="bound">τ</span> <span class="main">&lt;</span> <span class="bound">σ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reflect_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Types-type_less_x_Sequence"><span class="command">lemma</span></span> type_less_x_Sequence <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Sequence <span class="free">σ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Sequence <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ρ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Sequence <span class="skolem">ρ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> Sequence <span class="bound">τ</span> <span class="main">&lt;</span> Sequence <span class="bound">σ</span> <span class="main">⟹</span> <span class="bound">τ</span> <span class="main">&lt;</span> <span class="bound">σ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reflect_tranclp<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We will be able to remove the acyclicity assumption only after
  we prove that the subtype relation is acyclic.›</span></span>

<span class="keyword1" id="OCL_Types-type_less_x_Tuple'"><span class="command">lemma</span></span> type_less_x_Tuple'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Tuple <span class="free">ξ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"acyclicP_on <span class="main">(</span>fmran' <span class="free">ξ</span><span class="main">)</span> subtype"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">π</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Tuple <span class="bound">π</span> <span class="main">⟹</span> strict_subtuple <span class="main">(≤)</span> <span class="bound">π</span> <span class="free">ξ</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Tuple <span class="skolem">π</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_tranclp_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">π</span><span class="main">.</span> Tuple <span class="bound">π</span> <span class="main">&lt;</span> Tuple <span class="free">ξ</span> <span class="main">⟹</span> strict_subtuple <span class="main">(≤)</span> <span class="bound">π</span> <span class="free">ξ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_type_def less_eq_type_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?f</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Tuple"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> strict_subtuple_rtranclp_intro<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Types-type_less_x_OclSuper"><span class="command">lemma</span></span> type_less_x_OclSuper <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> OclSuper <span class="main">⟹</span> <span class="main">(</span><span class="free">τ</span> <span class="main">≠</span> OclSuper <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> tranclpD<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(*** Properties *************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1" id="OCL_Types-subtype_irrefl"><span class="command">lemma</span></span> subtype_irrefl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> <span class="free">τ</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">τ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> type_less_x_Tuple'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_type_def tranclp_unfold
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Types-subtype_acyclic"><span class="command">lemma</span></span> subtype_acyclic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclicP subtype"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> acyclicI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trancl_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> OCL_Types.less_type_def OCL_Types.subtype_irrefl<span class="main">)</span>

<span class="keyword1" id="OCL_Types-less_le_not_le_type"><span class="command">lemma</span></span> less_le_not_le_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟷</span> <span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">σ</span> <span class="main">≤</span> <span class="free">τ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="free">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">σ</span> <span class="main">≤</span> <span class="free">τ</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_type_def less_eq_type_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> subtype_irrefl less_type_def tranclp_rtranclp_tranclp<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">σ</span> <span class="main">≤</span> <span class="free">τ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_type_def less_eq_type_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rtranclpD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Types-order_refl_type"><span class="command">lemma</span></span> order_refl_type <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">τ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_eq_type_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="OCL_Types-order_trans_type"><span class="command">lemma</span></span> order_trans_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">≤</span> <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> <span class="free">ρ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_eq_type_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="OCL_Types-antisym_type"><span class="command">lemma</span></span> antisym_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">≤</span> <span class="free">τ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="free">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_eq_type_def less_type_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> less_eq_type_def
      less_le_not_le_type less_type_def rtranclpD<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le_not_le_type<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> order_trans_type <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym_type<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*** Non-Strict Introduction Rules ******************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Non-Strict Introduction Rules›</span></span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Required_intro"><span class="command">lemma</span></span> type_less_eq_x_Required_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> <span class="free">ρ</span><span class="main">[1]</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span><span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Optional_intro"><span class="command">lemma</span></span> type_less_eq_x_Optional_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> <span class="free">ρ</span><span class="main">[1]</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span><span class="main">[?]</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> <span class="free">ρ</span><span class="main">[?]</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span><span class="main">[?]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Collection_intro"><span class="command">lemma</span></span> type_less_eq_x_Collection_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Collection <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Collection <span class="free">σ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Set <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Collection <span class="free">σ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> OrderedSet <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Collection <span class="free">σ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Bag <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Collection <span class="free">σ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Sequence <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Collection <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Set_intro"><span class="command">lemma</span></span> type_less_eq_x_Set_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Set <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Set <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_OrderedSet_intro"><span class="command">lemma</span></span> type_less_eq_x_OrderedSet_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> OrderedSet <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> OrderedSet <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Bag_intro"><span class="command">lemma</span></span> type_less_eq_x_Bag_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Bag <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Bag <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Sequence_intro"><span class="command">lemma</span></span> type_less_eq_x_Sequence_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Sequence <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Sequence <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Tuple_intro"><span class="command">lemma</span></span> type_less_eq_x_Tuple_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">=</span> Tuple <span class="free">π</span> <span class="main">⟹</span> subtuple <span class="main">(≤)</span> <span class="free">π</span> <span class="free">ξ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> Tuple <span class="free">ξ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dual_order.strict_iff_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_OclSuper_intro"><span class="command">lemma</span></span> type_less_eq_x_OclSuper_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> OclSuper"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*** Non-Strict Elimination Rules *******************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Non-Strict Elimination Rules›</span></span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Required"><span class="command">lemma</span></span> type_less_eq_x_Required <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span><span class="main">[1]</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="bound">ρ</span><span class="main">[1]</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Optional"><span class="command">lemma</span></span> type_less_eq_x_Optional <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">σ</span><span class="main">[?]</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="bound">ρ</span><span class="main">[1]</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="bound">ρ</span><span class="main">[?]</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Collection"><span class="command">lemma</span></span> type_less_eq_x_Collection <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> Collection <span class="free">σ</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Set <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> OrderedSet <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Bag <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Sequence <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Collection <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Set"><span class="command">lemma</span></span> type_less_eq_x_Set <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> Set <span class="free">σ</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Set <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_OrderedSet"><span class="command">lemma</span></span> type_less_eq_x_OrderedSet <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> OrderedSet <span class="free">σ</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> OrderedSet <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Bag"><span class="command">lemma</span></span> type_less_eq_x_Bag <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> Bag <span class="free">σ</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Bag <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Sequence"><span class="command">lemma</span></span> type_less_eq_x_Sequence <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> Sequence <span class="free">σ</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Sequence <span class="bound">ρ</span> <span class="main">⟹</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_x_Tuple"><span class="command">lemma</span></span> type_less_x_Tuple <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Tuple <span class="free">ξ</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">π</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Tuple <span class="bound">π</span> <span class="main">⟹</span> strict_subtuple <span class="main">(≤)</span> <span class="bound">π</span> <span class="free">ξ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> type_less_x_Tuple'<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> acyclic_def subtype_acyclic<span class="main">)</span>

<span class="keyword1" id="OCL_Types-type_less_eq_x_Tuple"><span class="command">lemma</span></span> type_less_eq_x_Tuple <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> Tuple <span class="free">ξ</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">π</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Tuple <span class="bound">π</span> <span class="main">⟹</span> subtuple <span class="main">(≤)</span> <span class="bound">π</span> <span class="free">ξ</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmap.rel_refl fmrel_to_subtuple<span class="main">)</span>

<span class="comment1">(*** Simplification Rules ***************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simplification Rules›</span></span>

<span class="keyword1" id="OCL_Types-type_less_left_simps"><span class="command">lemma</span></span> type_less_left_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"OclSuper <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> False"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ρ</span><span class="main">[1]</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">υ</span><span class="main">.</span>
      <span class="free">σ</span> <span class="main">=</span> OclSuper <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> <span class="bound">υ</span><span class="main">[1]</span> <span class="main">∧</span> <span class="free">ρ</span> <span class="main">&lt;</span> <span class="bound">υ</span> <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> <span class="bound">υ</span><span class="main">[?]</span> <span class="main">∧</span> <span class="free">ρ</span> <span class="main">≤</span> <span class="bound">υ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ρ</span><span class="main">[?]</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">υ</span><span class="main">.</span>
      <span class="free">σ</span> <span class="main">=</span> OclSuper <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> <span class="bound">υ</span><span class="main">[?]</span> <span class="main">∧</span> <span class="free">ρ</span> <span class="main">&lt;</span> <span class="bound">υ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"Collection <span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span><span class="main">.</span>
      <span class="free">σ</span> <span class="main">=</span> OclSuper <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> Collection <span class="bound">φ</span> <span class="main">∧</span> <span class="free">τ</span> <span class="main">&lt;</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"Set <span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span><span class="main">.</span>
      <span class="free">σ</span> <span class="main">=</span> OclSuper <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> Collection <span class="bound">φ</span> <span class="main">∧</span> <span class="free">τ</span> <span class="main">≤</span> <span class="bound">φ</span> <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> Set <span class="bound">φ</span> <span class="main">∧</span> <span class="free">τ</span> <span class="main">&lt;</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"OrderedSet <span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span><span class="main">.</span>
      <span class="free">σ</span> <span class="main">=</span> OclSuper <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> Collection <span class="bound">φ</span> <span class="main">∧</span> <span class="free">τ</span> <span class="main">≤</span> <span class="bound">φ</span> <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> OrderedSet <span class="bound">φ</span> <span class="main">∧</span> <span class="free">τ</span> <span class="main">&lt;</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"Bag <span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span><span class="main">.</span>
      <span class="free">σ</span> <span class="main">=</span> OclSuper <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> Collection <span class="bound">φ</span> <span class="main">∧</span> <span class="free">τ</span> <span class="main">≤</span> <span class="bound">φ</span> <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> Bag <span class="bound">φ</span> <span class="main">∧</span> <span class="free">τ</span> <span class="main">&lt;</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"Sequence <span class="free">τ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span><span class="main">.</span>
      <span class="free">σ</span> <span class="main">=</span> OclSuper <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> Collection <span class="bound">φ</span> <span class="main">∧</span> <span class="free">τ</span> <span class="main">≤</span> <span class="bound">φ</span> <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> Sequence <span class="bound">φ</span> <span class="main">∧</span> <span class="free">τ</span> <span class="main">&lt;</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"Tuple <span class="free">π</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ξ</span><span class="main">.</span>
      <span class="free">σ</span> <span class="main">=</span> OclSuper <span class="main">∨</span>
      <span class="free">σ</span> <span class="main">=</span> Tuple <span class="bound">ξ</span> <span class="main">∧</span> strict_subtuple <span class="main">(≤)</span> <span class="free">π</span> <span class="bound">ξ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="OCL_Types-type_less_right_simps"><span class="command">lemma</span></span> type_less_right_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> OclSuper <span class="main">=</span> <span class="main">(</span><span class="free">τ</span> <span class="main">≠</span> OclSuper<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> <span class="free">υ</span><span class="main">[1]</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="bound">ρ</span><span class="main">[1]</span> <span class="main">∧</span> <span class="bound">ρ</span> <span class="main">&lt;</span> <span class="free">υ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> <span class="free">υ</span><span class="main">[?]</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> <span class="bound">ρ</span><span class="main">[1]</span> <span class="main">∧</span> <span class="bound">ρ</span> <span class="main">≤</span> <span class="free">υ</span> <span class="main">∨</span> <span class="free">τ</span> <span class="main">=</span> <span class="bound">ρ</span><span class="main">[?]</span> <span class="main">∧</span> <span class="bound">ρ</span> <span class="main">&lt;</span> <span class="free">υ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Collection <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span><span class="main">.</span>
      <span class="free">τ</span> <span class="main">=</span> Collection <span class="bound">φ</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="main">&lt;</span> <span class="free">σ</span> <span class="main">∨</span>
      <span class="free">τ</span> <span class="main">=</span> Set <span class="bound">φ</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">∨</span>
      <span class="free">τ</span> <span class="main">=</span> OrderedSet <span class="bound">φ</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">∨</span>
      <span class="free">τ</span> <span class="main">=</span> Bag <span class="bound">φ</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="main">≤</span> <span class="free">σ</span> <span class="main">∨</span>
      <span class="free">τ</span> <span class="main">=</span> Sequence <span class="bound">φ</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="main">≤</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Set <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Set <span class="bound">φ</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="main">&lt;</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> OrderedSet <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> OrderedSet <span class="bound">φ</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="main">&lt;</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Bag <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Bag <span class="bound">φ</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="main">&lt;</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Sequence <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Sequence <span class="bound">φ</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="main">&lt;</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">&lt;</span> Tuple <span class="free">ξ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">π</span><span class="main">.</span> <span class="free">τ</span> <span class="main">=</span> Tuple <span class="bound">π</span> <span class="main">∧</span> strict_subtuple <span class="main">(≤)</span> <span class="bound">π</span> <span class="free">ξ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*** Upper Semilattice of Types *********************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Upper Semilattice of Types›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> type <span class="main">::</span> <span class="main">(</span><span class="quoted">semilattice_sup</span><span class="main">)</span> <span class="quoted">semilattice_sup</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">sup_type</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"OclSuper <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> OclSuper"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Required <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> <span class="bound">ρ</span><span class="main">[1]</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span><span class="main">[1]</span>
     <span class="main">|</span> <span class="bound">ρ</span><span class="main">[?]</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span><span class="main">[?]</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> OclSuper<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Optional <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> <span class="bound">ρ</span><span class="main">[1]</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span><span class="main">[?]</span>
     <span class="main">|</span> <span class="bound">ρ</span><span class="main">[?]</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span><span class="main">[?]</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> OclSuper<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> Collection <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Set <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> OrderedSet <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Bag <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Sequence <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> OclSuper<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> Collection <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Set <span class="bound">ρ</span> <span class="main">⇒</span> Set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> OrderedSet <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Bag <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Sequence <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> OclSuper<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> Collection <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Set <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> OrderedSet <span class="bound">ρ</span> <span class="main">⇒</span> OrderedSet <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Bag <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Sequence <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> OclSuper<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> Collection <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Set <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> OrderedSet <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Bag <span class="bound">ρ</span> <span class="main">⇒</span> Bag <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Sequence <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> OclSuper<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> Collection <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Set <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> OrderedSet <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Bag <span class="bound">ρ</span> <span class="main">⇒</span> Collection <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> Sequence <span class="bound">ρ</span> <span class="main">⇒</span> Sequence <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="bound">ρ</span><span class="main">)</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> OclSuper<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Tuple <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> Tuple <span class="bound">ξ</span> <span class="main">⇒</span> Tuple <span class="main">(</span>fmmerge_fun <span class="main">(⊔)</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="bound">ξ</span><span class="main">)</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> OclSuper<span class="main">)</span>"</span></span>

<span class="keyword1" id="OCL_Types-sup_ge1_type"><span class="command">lemma</span></span> sup_ge1_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">τ</span> <span class="main">⊔</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="free">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">τ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">σ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> OclSuper <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Required <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Optional <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrderedSet <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bag <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sequence <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tuple <span class="skolem">π</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> Tuple_less_eq_sup<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> fmran' <span class="skolem">π</span> <span class="main">⟹</span> <span class="bound">τ</span> <span class="main">≤</span> <span class="bound">τ</span> <span class="main">⊔</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">⟹</span>
     Tuple <span class="skolem">π</span> <span class="main">≤</span> Tuple <span class="skolem">π</span> <span class="main">⊔</span> <span class="skolem">σ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Types-sup_commut_type"><span class="command">lemma</span></span> sup_commut_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">⊔</span> <span class="free">σ</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">⊔</span> <span class="free">τ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="free">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">τ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">σ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> OclSuper <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_type_def<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Required <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Optional <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrderedSet <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bag <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sequence <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tuple <span class="skolem">π</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_type_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> fmmerge_commut <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Types-sup_least_type"><span class="command">lemma</span></span> sup_least_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">≤</span> <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">≤</span> <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">⊔</span> <span class="free">σ</span> <span class="main">≤</span> <span class="free">ρ</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ρ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">τ</span></span> <span class="quoted"><span class="free">σ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> OclSuper <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> eq_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Required <span class="skolem">x</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> Required<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> type_less_eq_x_Required<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> type_less_eq_x_Required<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Optional <span class="skolem">x</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> Optional<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> type_less_eq_x_Optional<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> type_less_eq_x_Optional<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Collection <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> Collection<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> type_less_eq_x_Collection<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> type_less_eq_x_Collection<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> Set<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> type_less_eq_x_Set<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> type_less_eq_x_Set<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrderedSet <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> OrderedSet<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> type_less_eq_x_OrderedSet<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> type_less_eq_x_OrderedSet<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bag <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> Bag<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> type_less_eq_x_Bag<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> type_less_eq_x_Bag<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sequence <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> Sequence<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> type_less_eq_x_Sequence<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> type_less_eq_x_Sequence<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tuple <span class="skolem">π</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> Tuple<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> type_less_eq_x_Tuple<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> type_less_eq_x_Tuple<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?π</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>fmmerge <span class="main">(⊔)</span> <span class="improper">π'</span> <span class="improper">π''</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> type_less_eq_x_Tuple_intro<span class="main"><span class="keyword3">;</span></span>
        <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fmrel_on_fset_fmmerge1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_ge1_type<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commut_type sup_ge1_type<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_least_type<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*** Helper Relations *******************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Helper Relations›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">between</span> <span class="main">(</span><span class="quoted">"_<span class="keyword3">/ </span><span class="keyword1">=</span> _<span class="keyword1">─</span>_"</span>  <span class="main">[</span>51<span class="main">,</span> 51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">=</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="free">─</span></span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">element_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">element_type</span> <span class="main">(</span>Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">element_type</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">element_type</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">element_type</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">element_type</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="keyword1" id="OCL_Types-element_type_alt_simps"><span class="command">lemma</span></span> element_type_alt_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"element_type <span class="free">τ</span> <span class="free">σ</span> <span class="main">=</span> 
     <span class="main">(</span>Collection <span class="free">σ</span> <span class="main">=</span> <span class="free">τ</span> <span class="main">∨</span>
      Set <span class="free">σ</span> <span class="main">=</span> <span class="free">τ</span> <span class="main">∨</span>
      OrderedSet <span class="free">σ</span> <span class="main">=</span> <span class="free">τ</span> <span class="main">∨</span>
      Bag <span class="free">σ</span> <span class="main">=</span> <span class="free">τ</span> <span class="main">∨</span>
      Sequence <span class="free">σ</span> <span class="main">=</span> <span class="free">τ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_type.simps<span class="main">)</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">update_element_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">update_element_type</span> <span class="main">(</span>Collection <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">update_element_type</span> <span class="main">(</span>Set <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">update_element_type</span> <span class="main">(</span>OrderedSet <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">update_element_type</span> <span class="main">(</span>Bag <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">update_element_type</span> <span class="main">(</span>Sequence <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">to_unique_collection</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_unique_collection</span> <span class="main">(</span>Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_unique_collection</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_unique_collection</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_unique_collection</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_unique_collection</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">to_nonunique_collection</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_nonunique_collection</span> <span class="main">(</span>Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_nonunique_collection</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_nonunique_collection</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_nonunique_collection</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_nonunique_collection</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">to_ordered_collection</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_ordered_collection</span> <span class="main">(</span>Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_ordered_collection</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_ordered_collection</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_ordered_collection</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_ordered_collection</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">to_single_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_single_type</span> OclSuper <span class="main">=</span> OclSuper"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_single_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[1]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_single_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[?]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[?]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_single_type</span> <span class="main">(</span>Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">to_single_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_single_type</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">to_single_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_single_type</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">to_single_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_single_type</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">to_single_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_single_type</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">to_single_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_single_type</span> <span class="main">(</span>Tuple <span class="free"><span class="bound"><span class="entity">π</span></span></span><span class="main">)</span> <span class="main">=</span> Tuple <span class="free"><span class="bound"><span class="entity">π</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">to_required_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_required_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[1]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_required_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[?]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_required_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">to_optional_type_nested</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_optional_type_nested</span> OclSuper <span class="main">=</span> OclSuper"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_optional_type_nested</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[1]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[?]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_optional_type_nested</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[?]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">[?]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_optional_type_nested</span> <span class="main">(</span>Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> Collection <span class="main">(</span><span class="free">to_optional_type_nested</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_optional_type_nested</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> Set <span class="main">(</span><span class="free">to_optional_type_nested</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_optional_type_nested</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> OrderedSet <span class="main">(</span><span class="free">to_optional_type_nested</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_optional_type_nested</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> Bag <span class="main">(</span><span class="free">to_optional_type_nested</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_optional_type_nested</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">=</span> Sequence <span class="main">(</span><span class="free">to_optional_type_nested</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_optional_type_nested</span> <span class="main">(</span>Tuple <span class="free"><span class="bound"><span class="entity">π</span></span></span><span class="main">)</span> <span class="main">=</span> Tuple <span class="main">(</span>fmmap <span class="free">to_optional_type_nested</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*** Determinism ************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Determinism›</span></span>

<span class="keyword1" id="OCL_Types-element_type_det"><span class="command">lemma</span></span> element_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"element_type <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   element_type <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> element_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_type.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Types-update_element_type_det"><span class="command">lemma</span></span> update_element_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"update_element_type <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   update_element_type <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> update_element_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> update_element_type.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Types-to_unique_collection_det"><span class="command">lemma</span></span> to_unique_collection_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_unique_collection <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   to_unique_collection <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> to_unique_collection.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_unique_collection.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Types-to_nonunique_collection_det"><span class="command">lemma</span></span> to_nonunique_collection_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_nonunique_collection <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   to_nonunique_collection <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> to_nonunique_collection.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nonunique_collection.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Types-to_ordered_collection_det"><span class="command">lemma</span></span> to_ordered_collection_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"to_ordered_collection <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   to_ordered_collection <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> to_ordered_collection.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_ordered_collection.simps<span class="main">)</span>

<span class="comment1">(*** Code Setup *************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Code Setup›</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">subtype</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">subtype_fun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>order type <span class="main">⇒</span> <span class="tfree">'a</span> type <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subtype_fun</span> OclSuper <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subtype_fun</span> <span class="main">(</span>Required <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> OclSuper <span class="main">⇒</span> True
     <span class="main">|</span> <span class="bound">ρ</span><span class="main">[1]</span> <span class="main">⇒</span> basic_subtype_fun <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span>
     <span class="main">|</span> <span class="bound">ρ</span><span class="main">[?]</span> <span class="main">⇒</span> basic_subtype_fun <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> <span class="bound">ρ</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subtype_fun</span> <span class="main">(</span>Optional <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> OclSuper <span class="main">⇒</span> True
     <span class="main">|</span> <span class="bound">ρ</span><span class="main">[?]</span> <span class="main">⇒</span> basic_subtype_fun <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subtype_fun</span> <span class="main">(</span>Collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> OclSuper <span class="main">⇒</span> True
     <span class="main">|</span> Collection <span class="bound">ρ</span> <span class="main">⇒</span> <span class="free">subtype_fun</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subtype_fun</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> OclSuper <span class="main">⇒</span> True
     <span class="main">|</span> Collection <span class="bound">ρ</span> <span class="main">⇒</span> <span class="free">subtype_fun</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> <span class="bound">ρ</span>
     <span class="main">|</span> Set <span class="bound">ρ</span> <span class="main">⇒</span> <span class="free">subtype_fun</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subtype_fun</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> OclSuper <span class="main">⇒</span> True
     <span class="main">|</span> Collection <span class="bound">ρ</span> <span class="main">⇒</span> <span class="free">subtype_fun</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> <span class="bound">ρ</span>
     <span class="main">|</span> OrderedSet <span class="bound">ρ</span> <span class="main">⇒</span> <span class="free">subtype_fun</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subtype_fun</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> OclSuper <span class="main">⇒</span> True
     <span class="main">|</span> Collection <span class="bound">ρ</span> <span class="main">⇒</span> <span class="free">subtype_fun</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> <span class="bound">ρ</span>
     <span class="main">|</span> Bag <span class="bound">ρ</span> <span class="main">⇒</span> <span class="free">subtype_fun</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subtype_fun</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> OclSuper <span class="main">⇒</span> True
     <span class="main">|</span> Collection <span class="bound">ρ</span> <span class="main">⇒</span> <span class="free">subtype_fun</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> <span class="bound">ρ</span>
     <span class="main">|</span> Sequence <span class="bound">ρ</span> <span class="main">⇒</span> <span class="free">subtype_fun</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="bound">ρ</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subtype_fun</span> <span class="main">(</span>Tuple <span class="free"><span class="bound"><span class="entity">π</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
    <span class="keyword1">of</span> OclSuper <span class="main">⇒</span> True
     <span class="main">|</span> Tuple <span class="bound">ξ</span> <span class="main">⇒</span> strict_subtuple_fun <span class="main">(</span><span class="main">λ</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> <span class="free">subtype_fun</span> <span class="bound">τ</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="bound">τ</span> <span class="main">=</span> <span class="bound">σ</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="bound">ξ</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span><span class="main">.</span> size <span class="bound">ys</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">;</span></span>
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elem_le_ffold' fmran'I<span class="main">)</span>

<span class="keyword1" id="OCL_Types-less_type_code"><span class="command">lemma</span></span> less_type_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span> <span class="main">=</span> subtype_fun"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">τ</span> <span class="main">&lt;</span> <span class="skolem">σ</span> <span class="main">⟹</span> subtype_fun <span class="skolem">τ</span> <span class="skolem">σ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">τ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">σ</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> OclSuper <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Required <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_basic_type_code less_eq_basic_type_code<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Optional <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_basic_type_code less_eq_basic_type_code<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Collection <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrderedSet <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bag <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sequence <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tuple <span class="skolem">π</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ξ</span><span class="main">.</span> subtuple <span class="main">(≤)</span> <span class="skolem">π</span> <span class="bound">ξ</span> <span class="main">⟶</span>
       subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> subtype_fun <span class="bound">τ</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="bound">τ</span> <span class="main">=</span> <span class="bound">σ</span><span class="main">)</span> <span class="skolem">π</span> <span class="bound">ξ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subtuple_mono<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tuple.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Tuple.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subtype_fun <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="main">⟹</span> <span class="skolem">τ</span> <span class="main">&lt;</span> <span class="skolem">σ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">σ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">τ</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> OclSuper <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Required <span class="skolem">σ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> Required<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> subtype_fun.elims<span class="main"><span class="keyword3">;</span></span>
          <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_basic_type_code less_eq_basic_type_code<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Optional <span class="skolem">σ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> Optional<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> subtype_fun.elims<span class="main"><span class="keyword3">;</span></span>
          <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_basic_type_code less_eq_basic_type_code<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Collection <span class="skolem">σ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> Collection<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subtype_fun.elims<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> order.strict_implies_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Set <span class="skolem">σ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> Set<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> subtype_fun.elims<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrderedSet <span class="skolem">σ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> OrderedSet<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> subtype_fun.elims<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bag <span class="skolem">σ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> Bag<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> subtype_fun.elims<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sequence <span class="skolem">σ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> Sequence<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> subtype_fun.elims<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Tuple <span class="skolem">ξ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> subtuple_imp_simp<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">π</span><span class="main">.</span> subtuple <span class="main">(</span><span class="main">λ</span><span class="bound">τ</span> <span class="bound">σ</span><span class="main">.</span> subtype_fun <span class="bound">τ</span> <span class="bound">σ</span> <span class="main">∨</span> <span class="bound">τ</span> <span class="main">=</span> <span class="bound">σ</span><span class="main">)</span> <span class="bound">π</span> <span class="skolem">ξ</span> <span class="main">⟶</span>
       subtuple <span class="main">(≤)</span> <span class="bound">π</span> <span class="skolem">ξ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subtuple_mono<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tuple.hyps less_imp_le<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> Tuple<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> subtype_fun.elims<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subtuple_imp_simp<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Types-less_eq_type_code"><span class="command">lemma</span></span> less_eq_type_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(≤)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> subtype_fun <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dual_order.order_iff_strict less_type_code
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">element_type</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">update_element_type</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">to_unique_collection</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">to_nonunique_collection</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">to_ordered_collection</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="OCL_Syntax">
<div class="head">
<h1>Theory OCL_Syntax</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Abstract Syntax›</span></span>
<span class="keyword1"><span class="command">theory</span></span> OCL_Syntax
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a> <a href="#Object_Model">Object_Model</a> <a href="#OCL_Types">OCL_Types</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> vname <span class="main">=</span> <span class="quoted"><span class="quoted">"String.literal"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> env <span class="main">=</span> <span class="quoted"><span class="quoted">"vname <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In OCL <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"1 + ∞ = ⊥"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. So we do not use <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">enat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  define the new data type.›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> unat <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> nat option set"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">unat</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> Abs_unat <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> unat <span class="main">::</span> <span class="quoted">infinity</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">∞</span> <span class="main">≡</span> Abs_unat None"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">free_constructors</span></span> cases_unat <span class="keyword2"><span class="keyword">for</span></span>
  <span class="quoted">unat</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">∞</span> <span class="main">::</span> unat"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> unat_def infinity_unat_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Rep_unat_inverse option.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Abs_unat_inverse UNIV_I option.sel<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_unat_inject<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Standard Library Operations›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> metaop <span class="main">=</span> AllInstancesOp

<span class="keyword1"><span class="command">datatype</span></span> typeop <span class="main">=</span> OclAsTypeOp <span class="main">|</span> OclIsTypeOfOp <span class="main">|</span> OclIsKindOfOp
<span class="main">|</span> SelectByKindOp <span class="main">|</span> SelectByTypeOp

<span class="keyword1"><span class="command">datatype</span></span> super_binop <span class="main">=</span> EqualOp <span class="main">|</span> NotEqualOp

<span class="keyword1"><span class="command">datatype</span></span> any_unop <span class="main">=</span> OclAsSetOp <span class="main">|</span> OclIsNewOp
<span class="main">|</span> OclIsUndefinedOp <span class="main">|</span> OclIsInvalidOp <span class="main">|</span> OclLocaleOp <span class="main">|</span> ToStringOp

<span class="keyword1"><span class="command">datatype</span></span> boolean_unop <span class="main">=</span> NotOp
<span class="keyword1"><span class="command">datatype</span></span> boolean_binop <span class="main">=</span> AndOp <span class="main">|</span> OrOp <span class="main">|</span> XorOp <span class="main">|</span> ImpliesOp

<span class="keyword1"><span class="command">datatype</span></span> numeric_unop <span class="main">=</span> UMinusOp <span class="main">|</span> AbsOp <span class="main">|</span> FloorOp <span class="main">|</span> RoundOp <span class="main">|</span> ToIntegerOp
<span class="keyword1"><span class="command">datatype</span></span> numeric_binop <span class="main">=</span> PlusOp <span class="main">|</span> MinusOp <span class="main">|</span> MultOp <span class="main">|</span> DivideOp
<span class="main">|</span> DivOp <span class="main">|</span> ModOp <span class="main">|</span> MaxOp <span class="main">|</span> MinOp
<span class="main">|</span> LessOp <span class="main">|</span> LessEqOp <span class="main">|</span> GreaterOp <span class="main">|</span> GreaterEqOp

<span class="keyword1"><span class="command">datatype</span></span> string_unop <span class="main">=</span> SizeOp <span class="main">|</span> ToUpperCaseOp <span class="main">|</span> ToLowerCaseOp <span class="main">|</span> CharactersOp
<span class="main">|</span> ToBooleanOp <span class="main">|</span> ToIntegerOp <span class="main">|</span> ToRealOp
<span class="keyword1"><span class="command">datatype</span></span> string_binop <span class="main">=</span> ConcatOp <span class="main">|</span> IndexOfOp <span class="main">|</span> EqualsIgnoreCaseOp <span class="main">|</span> AtOp
<span class="main">|</span> LessOp <span class="main">|</span> LessEqOp <span class="main">|</span> GreaterOp <span class="main">|</span> GreaterEqOp
<span class="keyword1"><span class="command">datatype</span></span> string_ternop <span class="main">=</span> SubstringOp

<span class="keyword1"><span class="command">datatype</span></span> collection_unop <span class="main">=</span> CollectionSizeOp <span class="main">|</span> IsEmptyOp <span class="main">|</span> NotEmptyOp
<span class="main">|</span> CollectionMaxOp <span class="main">|</span> CollectionMinOp <span class="main">|</span> SumOp
<span class="main">|</span> AsSetOp <span class="main">|</span> AsOrderedSetOp <span class="main">|</span> AsSequenceOp <span class="main">|</span> AsBagOp <span class="main">|</span> FlattenOp
<span class="main">|</span> FirstOp <span class="main">|</span> LastOp <span class="main">|</span> ReverseOp
<span class="keyword1"><span class="command">datatype</span></span> collection_binop <span class="main">=</span> IncludesOp <span class="main">|</span> ExcludesOp
<span class="main">|</span> CountOp<span class="main">|</span> IncludesAllOp <span class="main">|</span> ExcludesAllOp <span class="main">|</span> ProductOp
<span class="main">|</span> UnionOp <span class="main">|</span> IntersectionOp <span class="main">|</span> SetMinusOp <span class="main">|</span> SymmetricDifferenceOp
<span class="main">|</span> IncludingOp <span class="main">|</span> ExcludingOp
<span class="main">|</span> AppendOp <span class="main">|</span> PrependOp <span class="main">|</span> CollectionAtOp <span class="main">|</span> CollectionIndexOfOp
<span class="keyword1"><span class="command">datatype</span></span> collection_ternop <span class="main">=</span> InsertAtOp <span class="main">|</span> SubOrderedSetOp <span class="main">|</span> SubSequenceOp

<span class="keyword1"><span class="command">type_synonym</span></span> unop <span class="main">=</span> <span class="quoted"><span class="quoted">"any_unop <span class="main">+</span> boolean_unop <span class="main">+</span> numeric_unop <span class="main">+</span> string_unop <span class="main">+</span> collection_unop"</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inl <span class="main">::</span> any_unop <span class="main">⇒</span> unop"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inl <span class="main">::</span> boolean_unop <span class="main">⇒</span> unop"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">::</span> numeric_unop <span class="main">⇒</span> unop"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">::</span> string_unop <span class="main">⇒</span> unop"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">::</span> collection_unop <span class="main">⇒</span> unop"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">type_synonym</span></span> binop <span class="main">=</span> <span class="quoted"><span class="quoted">"super_binop <span class="main">+</span> boolean_binop <span class="main">+</span> numeric_binop <span class="main">+</span> string_binop <span class="main">+</span> collection_binop"</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inl <span class="main">::</span> super_binop <span class="main">⇒</span> binop"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inl <span class="main">::</span> boolean_binop <span class="main">⇒</span> binop"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">::</span> numeric_binop <span class="main">⇒</span> binop"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">::</span> string_binop <span class="main">⇒</span> binop"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">::</span> collection_binop <span class="main">⇒</span> binop"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">type_synonym</span></span> ternop <span class="main">=</span> <span class="quoted"><span class="quoted">"string_ternop <span class="main">+</span> collection_ternop"</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inl <span class="main">::</span> string_ternop <span class="main">⇒</span> ternop"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">::</span> collection_ternop <span class="main">⇒</span> ternop"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">type_synonym</span></span> op <span class="main">=</span> <span class="quoted"><span class="quoted">"unop <span class="main">+</span> binop <span class="main">+</span> ternop <span class="main">+</span> oper"</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inl <span class="main">∘</span> Inl <span class="main">::</span> any_unop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inl <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">::</span> boolean_unop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inl <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">::</span> numeric_unop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inl <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">::</span> string_unop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inl <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">::</span> collection_unop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inl <span class="main">∘</span> Inl <span class="main">::</span> super_binop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inl <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">::</span> boolean_binop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inl <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">::</span> numeric_binop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inl <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">::</span> string_binop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inl <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">::</span> collection_binop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">∘</span> Inl <span class="main">::</span> string_ternop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inl <span class="main">∘</span> Inr <span class="main">::</span> collection_ternop <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Inr <span class="main">∘</span> Inr <span class="main">∘</span> Inr <span class="main">::</span> oper <span class="main">⇒</span> op"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">datatype</span></span> iterator <span class="main">=</span> AnyIter <span class="main">|</span> ClosureIter <span class="main">|</span> CollectIter <span class="main">|</span> CollectNestedIter
<span class="main">|</span> ExistsIter <span class="main">|</span> ForAllIter <span class="main">|</span> OneIter <span class="main">|</span> IsUniqueIter
<span class="main">|</span> SelectIter <span class="main">|</span> RejectIter <span class="main">|</span> SortedByIter

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Expressions›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> collection_literal_kind <span class="main">=</span>
  CollectionKind <span class="main">|</span> SetKind <span class="main">|</span> OrderedSetKind <span class="main">|</span> BagKind <span class="main">|</span> SequenceKind

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A call kind could be defined as two boolean values (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"is_arrow_call"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"is_safe_call"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>). Also we could derive <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"is_arrow_call"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  value automatically based on an operation kind.
  However, it is much easier and more natural to use the following enumeration.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> call_kind <span class="main">=</span> DotCall <span class="main">|</span> ArrowCall <span class="main">|</span> SafeDotCall <span class="main">|</span> SafeArrowCall

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We do not define a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">Classifier</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> type (a type of all types),
  because it will add unnecessary complications to the theory.
  So we have to define type operations as a pure syntactic constructs.
  We do not define <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">Type</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> expressions either.

  We do not define <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">InvalidLiteral</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, because it allows us to
  exclude <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">OclInvalid</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> type from typing rules. It simplifies
  the types system.

  Please take a note that for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">AssociationEnd</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">AssociationClass</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> call expressions one can specify an
  optional role of a source class (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">from_role</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>).
  It differs from the OCL specification, which allows one to specify
  a role of a destination class. However, the latter one does not
  allow one to determine uniquely a set of linked objects, for example,
  in a ternary self relation.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> expr <span class="main">=</span>
  Literal <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> literal_expr"</span></span>
<span class="main">|</span> Let <span class="main">(</span><span class="free"><span class="entity">var</span></span> <span class="main">:</span> <span class="quoted">vname</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">var_type</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type option"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">init_expr</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span>
    <span class="main">(</span><span class="free"><span class="entity">body_expr</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span>
<span class="main">|</span> Var <span class="main">(</span>var <span class="main">:</span> <span class="quoted">vname</span><span class="main">)</span>
<span class="main">|</span> If <span class="main">(</span><span class="free"><span class="entity">if_expr</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">then_expr</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">else_expr</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span>
<span class="main">|</span> MetaOperationCall <span class="main">(</span><span class="free"><span class="entity">type</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span><span class="main">)</span> <span class="quoted">metaop</span>
<span class="main">|</span> StaticOperationCall <span class="main">(</span>type <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span><span class="main">)</span> <span class="quoted">oper</span> <span class="main">(</span><span class="free"><span class="entity">args</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr list"</span></span><span class="main">)</span>
<span class="main">|</span> Call <span class="main">(</span><span class="free"><span class="entity">source</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">kind</span></span> <span class="main">:</span> <span class="quoted">call_kind</span><span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> call_expr"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="tfree">'a</span> literal_expr <span class="main">=</span>
  NullLiteral
<span class="main">|</span> BooleanLiteral <span class="main">(</span><span class="free"><span class="entity">boolean_symbol</span></span> <span class="main">:</span> <span class="quoted">bool</span><span class="main">)</span>
<span class="main">|</span> RealLiteral <span class="main">(</span><span class="free"><span class="entity">real_symbol</span></span> <span class="main">:</span> <span class="quoted">real</span><span class="main">)</span>
<span class="main">|</span> IntegerLiteral <span class="main">(</span><span class="free"><span class="entity">integer_symbol</span></span> <span class="main">:</span> <span class="quoted">int</span><span class="main">)</span>
<span class="main">|</span> UnlimitedNaturalLiteral <span class="main">(</span><span class="free"><span class="entity">unlimited_natural_symbol</span></span> <span class="main">:</span> <span class="quoted">unat</span><span class="main">)</span>
<span class="main">|</span> StringLiteral <span class="main">(</span><span class="free"><span class="entity">string_symbol</span></span> <span class="main">:</span> <span class="quoted">string</span><span class="main">)</span>
<span class="main">|</span> EnumLiteral <span class="main">(</span><span class="free"><span class="entity">enum_type</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> enum"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">enum_literal</span></span> <span class="main">:</span> <span class="quoted">elit</span><span class="main">)</span>
<span class="main">|</span> CollectionLiteral <span class="main">(</span><span class="free"><span class="entity">kind</span></span> <span class="main">:</span> <span class="quoted">collection_literal_kind</span><span class="main">)</span>
    <span class="main">(</span><span class="free"><span class="entity">parts</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> collection_literal_part_expr list"</span></span><span class="main">)</span>
<span class="main">|</span> TupleLiteral <span class="main">(</span><span class="free"><span class="entity">tuple_elements</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>telem <span class="main">×</span> <span class="tfree">'a</span> type option <span class="main">×</span> <span class="tfree">'a</span> expr<span class="main">)</span> list"</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="tfree">'a</span> collection_literal_part_expr <span class="main">=</span>
  CollectionItem <span class="main">(</span><span class="free"><span class="entity">item</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span>
<span class="main">|</span> CollectionRange <span class="main">(</span><span class="free"><span class="entity">first</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">last</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="tfree">'a</span> call_expr <span class="main">=</span>
  TypeOperation <span class="quoted">typeop</span> <span class="main">(</span><span class="free"><span class="entity">type</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type"</span></span><span class="main">)</span>
<span class="main">|</span> Attribute <span class="quoted">attr</span>
<span class="main">|</span> AssociationEnd <span class="main">(</span><span class="free"><span class="entity">from_role</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"role option"</span></span><span class="main">)</span> <span class="quoted">role</span>
<span class="main">|</span> AssociationClass <span class="main">(</span>from_role <span class="main">:</span> <span class="quoted"><span class="quoted">"role option"</span></span><span class="main">)</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
<span class="main">|</span> AssociationClassEnd <span class="quoted">role</span>
<span class="main">|</span> Operation <span class="quoted">op</span> <span class="main">(</span><span class="free"><span class="entity">args</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr list"</span></span><span class="main">)</span>
<span class="main">|</span> TupleElement <span class="quoted">telem</span>
<span class="main">|</span> Iterate <span class="main">(</span><span class="free"><span class="entity">iterators</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"vname list"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">iterators_type</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type option"</span></span><span class="main">)</span>
    <span class="main">(</span><span class="free"><span class="entity">var</span></span> <span class="main">:</span> <span class="quoted">vname</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">var_type</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type option"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">init_expr</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span>
    <span class="main">(</span><span class="free"><span class="entity">body_expr</span></span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span>
<span class="main">|</span> Iterator <span class="quoted">iterator</span> <span class="main">(</span>iterators <span class="main">:</span> <span class="quoted"><span class="quoted">"vname list"</span></span><span class="main">)</span> <span class="main">(</span>iterators_type <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> type option"</span></span><span class="main">)</span>
    <span class="main">(</span>body_expr <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> expr"</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tuple_element_name</span> <span class="main">≡</span> fst"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tuple_element_type</span> <span class="main">≡</span> fst <span class="main">∘</span> snd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tuple_element_expr</span> <span class="main">≡</span> snd <span class="main">∘</span> snd"</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"Literal <span class="main">::</span> <span class="tfree">'a</span> literal_expr <span class="main">⇒</span> <span class="tfree">'a</span> expr"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">TypeOperationCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>TypeOperation <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">AttributeCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Attribute <span class="free"><span class="bound"><span class="entity">attr</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">AssociationEndCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>AssociationEnd <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">AssociationClassCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">cls</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>AssociationClass <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">cls</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">AssociationClassEndCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>AssociationClassEnd <span class="free"><span class="bound"><span class="entity">role</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">OperationCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Operation <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">TupleElementCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">elem</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>TupleElement <span class="free"><span class="bound"><span class="entity">elem</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">IterateCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterate <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">AnyIteratorCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterator AnyIter <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ClosureIteratorCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterator ClosureIter <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">CollectIteratorCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterator CollectIter <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">CollectNestedIteratorCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterator CollectNestedIter <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ExistsIteratorCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterator ExistsIter <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ForAllIteratorCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterator ForAllIter <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">OneIteratorCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterator OneIter <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">IsUniqueIteratorCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterator IsUniqueIter <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">SelectIteratorCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterator SelectIter <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">RejectIteratorCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterator RejectIter <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">SortedByIteratorCall</span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">≡</span>
  Call <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Iterator SortedByIter <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="OCL_Object_Model">
<div class="head">
<h1>Theory OCL_Object_Model</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Object Model›</span></span>
<span class="keyword1"><span class="command">theory</span></span> OCL_Object_Model
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#OCL_Syntax">OCL_Syntax</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  I see no reason why objects should refer nulls using multi-valued
  associations. Therefore, multi-valued associations have collection
  types with non-nullable element types.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">assoc_end_type</span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">≡</span>
    <span class="keyword1">let</span> <span class="bound">𝒞</span> <span class="main">=</span> assoc_end_class <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="keyword1">in</span>
    <span class="keyword1">if</span> assoc_end_max <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> nat<span class="main">)</span> <span class="keyword1">then</span>
      <span class="keyword1">if</span> assoc_end_min <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span>
      <span class="keyword1">then</span> <span class="main">⟨</span><span class="bound">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[?]</span>
      <span class="keyword1">else</span> <span class="main">⟨</span><span class="bound">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span>
    <span class="keyword1">else</span>
      <span class="keyword1">if</span> assoc_end_unique <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="keyword1">then</span>
        <span class="keyword1">if</span> assoc_end_ordered <span class="free"><span class="bound"><span class="entity">end</span></span></span>
        <span class="keyword1">then</span> OrderedSet <span class="main">⟨</span><span class="bound">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span>
        <span class="keyword1">else</span> Set <span class="main">⟨</span><span class="bound">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span>
      <span class="keyword1">else</span>
        <span class="keyword1">if</span> assoc_end_ordered <span class="free"><span class="bound"><span class="entity">end</span></span></span>
        <span class="keyword1">then</span> Sequence <span class="main">⟨</span><span class="bound">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span>
        <span class="keyword1">else</span> Bag <span class="main">⟨</span><span class="bound">𝒞</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">class_assoc_type</span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main">≡</span> Set <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒜</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">class_assoc_end_type</span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">≡</span> <span class="main">⟨</span>assoc_end_class <span class="free"><span class="bound"><span class="entity">end</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">oper_type</span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main">≡</span>
  <span class="keyword1">let</span> <span class="bound">params</span> <span class="main">=</span> oper_out_params <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="keyword1">in</span>
  <span class="keyword1">if</span> length <span class="bound">params</span> <span class="main">=</span> <span class="main">0</span>
  <span class="keyword1">then</span> oper_result <span class="free"><span class="bound"><span class="entity">op</span></span></span>
  <span class="keyword1">else</span> Tuple <span class="main">(</span>fmap_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>param_name <span class="bound">p</span><span class="main">,</span> param_type <span class="bound">p</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="bound">params</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''result''</span><span class="main">,</span> oper_result <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">,</span> Out<span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> ocl_object_model <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">classes</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semilattice_sup fset"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">attributes</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> attr <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> <span class="tfree">'a</span> type"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">associations</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assoc <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> role <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> <span class="tfree">'a</span> assoc_end"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">association_classes</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> assoc"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">operations</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> type<span class="main">,</span> <span class="tfree">'a</span> expr<span class="main">)</span> oper_spec list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">literals</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> enum <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> elit fset"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> assoc_end_min_less_eq_max<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">assoc</span> <span class="main">|∈|</span> fmdom <span class="free">associations</span> <span class="main">⟹</span>
     fmlookup <span class="free">associations</span> <span class="free">assoc</span> <span class="main">=</span> Some <span class="free">ends</span> <span class="main">⟹</span>
     <span class="free">role</span> <span class="main">|∈|</span> fmdom <span class="free">ends</span>  <span class="main">⟹</span>
     fmlookup <span class="free">ends</span> <span class="free">role</span> <span class="main">=</span> Some <span class="free">end</span> <span class="main">⟹</span>
     assoc_end_min <span class="free">end</span> <span class="main">≤</span> assoc_end_max <span class="free">end</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> association_ends_unique<span class="main">:</span>
    <span class="quoted"><span class="quoted">"association_ends' <span class="free">classes</span> <span class="free">associations</span> <span class="free">𝒞</span> <span class="free">from</span> <span class="free">role</span> <span class="free">end<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
     association_ends' <span class="free">classes</span> <span class="free">associations</span> <span class="free">𝒞</span> <span class="free">from</span> <span class="free">role</span> <span class="free">end<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">end<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">end<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> base<span class="main">:</span> object_model
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.assoc_end_min_less_eq_max local.association_ends_unique<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">owned_attribute</span> <span class="main">≡</span> base.owned_attribute"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">attribute</span> <span class="main">≡</span> base.attribute"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">association_ends</span> <span class="main">≡</span> base.association_ends"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">owned_association_end</span> <span class="main">≡</span> base.owned_association_end"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">association_end</span> <span class="main">≡</span> base.association_end"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">referred_by_association_class</span> <span class="main">≡</span> base.referred_by_association_class"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">association_class_end</span> <span class="main">≡</span> base.association_class_end"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">operation</span> <span class="main">≡</span> base.operation"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">operation_defined</span> <span class="main">≡</span> base.operation_defined"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">static_operation</span> <span class="main">≡</span> base.static_operation"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">static_operation_defined</span> <span class="main">≡</span> base.static_operation_defined"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_literal</span> <span class="main">≡</span> base.has_literal"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> attribute_det <span class="main">=</span> base.attribute_det
<span class="keyword1"><span class="command">lemmas</span></span> attribute_self_or_inherited <span class="main">=</span> base.attribute_self_or_inherited
<span class="keyword1"><span class="command">lemmas</span></span> attribute_closest <span class="main">=</span> base.attribute_closest
<span class="keyword1"><span class="command">lemmas</span></span> association_end_det <span class="main">=</span> base.association_end_det
<span class="keyword1"><span class="command">lemmas</span></span> association_end_self_or_inherited <span class="main">=</span> base.association_end_self_or_inherited
<span class="keyword1"><span class="command">lemmas</span></span> association_end_closest <span class="main">=</span> base.association_end_closest
<span class="keyword1"><span class="command">lemmas</span></span> association_class_end_det <span class="main">=</span> base.association_class_end_det
<span class="keyword1"><span class="command">lemmas</span></span> operation_det <span class="main">=</span> base.operation_det
<span class="keyword1"><span class="command">lemmas</span></span> static_operation_det <span class="main">=</span> base.static_operation_det

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="OCL_Typing">
<div class="head">
<h1>Theory OCL_Typing</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Typing›</span></span>
<span class="keyword1"><span class="command">theory</span></span> OCL_Typing
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#OCL_Object_Model">OCL_Object_Model</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Transitive_Closure_Table.html">HOL-Library.Transitive_Closure_Table</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following rules are more restrictive than rules given in
  the OCL specification. This allows one to identify more errors
  in expressions. However, these restrictions may be revised if necessary.
  Perhaps some of them could be separated and should cause warnings
  instead of errors.›</span></span>

<span class="comment1">(*** Operations Typing ******************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Operations Typing›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Metaclass Operations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  All basic types in the theory are either nullable or non-nullable.
  For example, instead of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">Boolean</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> type we have two types:
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"Boolean[1]"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"Boolean[?]"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"allInstances()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> operation is extended accordingly:›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Boolean[1].allInstances() = Set{true, false}
Boolean[?].allInstances() = Set{true, false, null}›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">mataop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mataop_type</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> AllInstancesOp <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Type Operations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  At first we decided to allow casting only to subtypes.
  However sometimes it is necessary to cast expressions to supertypes,
  for example, to access overridden attributes of a supertype.
  So we allow casting to subtypes and supertypes.
  Casting to other types is meaningless.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  According to the Section 7.4.7 of the OCL specification
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"oclAsType()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can be applied to collections as well as
  to single values. I guess we can allow <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"oclIsTypeOf()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"oclIsKindOf()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for collections too.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Please take a note that the following expressions are prohibited,
  because they always return true or false:›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹1.oclIsKindOf(OclAny[?])
1.oclIsKindOf(String[1])›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Please take a note that:›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Set{1,2,null,'abc'}-&gt;selectByKind(Integer[1]) = Set{1,2}
Set{1,2,null,'abc'}-&gt;selectByKind(Integer[?]) = Set{1,2,null}›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following expressions are prohibited, because they always
  returns either the same or empty collections:›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Set{1,2,null,'abc'}-&gt;selectByKind(OclAny[?])
Set{1,2,null,'abc'}-&gt;selectByKind(Collection(Boolean[1]))›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">typeop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free">typeop_type</span> DotCall OclAsTypeOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">typeop_type</span> DotCall OclIsTypeOfOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">typeop_type</span> DotCall OclIsKindOfOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   update_element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   <span class="free">typeop_type</span> ArrowCall SelectByKindOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   update_element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   <span class="free">typeop_type</span> ArrowCall SelectByTypeOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹OclSuper Operations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It makes sense to compare values only with compatible types.›</span></span>

<span class="comment1">(* We have to specify the predicate type explicitly to let
   a generated code work *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">super_binop_type</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"super_binop <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> order<span class="main">)</span> type <span class="main">⇒</span> <span class="tfree">'a</span> type <span class="main">⇒</span> <span class="tfree">'a</span> type <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">super_binop_type</span> EqualOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">super_binop_type</span> NotEqualOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹OclAny Operations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The OCL specification defines <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"toString()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> operation
  only for boolean and numeric types. However, I guess it is a good
  idea to define it once for all basic types. Maybe it should be defined
  for collections as well.›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">any_unop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> OclAny<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free">any_unop_type</span> OclAsSetOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>Set <span class="main">(</span>to_required_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> OclAny<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free">any_unop_type</span> OclIsNewOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> OclAny<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free">any_unop_type</span> OclIsUndefinedOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> OclAny<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free">any_unop_type</span> OclIsInvalidOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> OclAny<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free">any_unop_type</span> OclLocaleOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> String<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> OclAny<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free">any_unop_type</span> ToStringOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> String<span class="main">[1]</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Boolean Operations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Please take a note that:›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹true or false : Boolean[1]
true and null : Boolean[?]
null and null : OclVoid[?]›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">boolean_unop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> Boolean<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free">boolean_unop_type</span> NotOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">boolean_binop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> Boolean<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free">boolean_binop_type</span> AndOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> Boolean<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free">boolean_binop_type</span> OrOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> Boolean<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free">boolean_binop_type</span> XorOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> Boolean<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free">boolean_binop_type</span> ImpliesOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Numeric Operations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The expression <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"1 + null"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not well-typed.
  Nullable numeric values should be converted to non-nullable ones.
  This is a significant difference from the OCL specification.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Please take a note that many operations automatically casts
  unlimited naturals to integers.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The difference between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"oclAsType(Integer)"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"toInteger()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for unlimited naturals is unclear.›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">numeric_unop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_unop_type</span> UMinusOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Real<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_unop_type</span> UMinusOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Integer<span class="main">[1]</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_unop_type</span> AbsOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Real<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_unop_type</span> AbsOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Integer<span class="main">[1]</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_unop_type</span> FloorOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Integer<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_unop_type</span> RoundOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Integer<span class="main">[1]</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_unop_type</span> numeric_unop.ToIntegerOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Integer<span class="main">[1]</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">numeric_binop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> PlusOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> MinusOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Real<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> MinusOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Integer<span class="main">[1]</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> MultOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> DivideOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Real<span class="main">[1]</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> DivOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> ModOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> MaxOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> MinOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> numeric_binop.LessOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> numeric_binop.LessEqOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> numeric_binop.GreaterOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">numeric_binop_type</span> numeric_binop.GreaterEqOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹String Operations›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">string_unop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">string_unop_type</span> SizeOp String<span class="main">[1]</span> Integer<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_unop_type</span> CharactersOp String<span class="main">[1]</span> <span class="main">(</span>Sequence String<span class="main">[1]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_unop_type</span> ToUpperCaseOp String<span class="main">[1]</span> String<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_unop_type</span> ToLowerCaseOp String<span class="main">[1]</span> String<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_unop_type</span> ToBooleanOp String<span class="main">[1]</span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_unop_type</span> ToIntegerOp String<span class="main">[1]</span> Integer<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_unop_type</span> ToRealOp String<span class="main">[1]</span> Real<span class="main">[1]</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">string_binop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">string_binop_type</span> ConcatOp String<span class="main">[1]</span> String<span class="main">[1]</span> String<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_binop_type</span> EqualsIgnoreCaseOp String<span class="main">[1]</span> String<span class="main">[1]</span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_binop_type</span> LessOp String<span class="main">[1]</span> String<span class="main">[1]</span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_binop_type</span> LessEqOp String<span class="main">[1]</span> String<span class="main">[1]</span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_binop_type</span> GreaterOp String<span class="main">[1]</span> String<span class="main">[1]</span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_binop_type</span> GreaterEqOp String<span class="main">[1]</span> String<span class="main">[1]</span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_binop_type</span> IndexOfOp String<span class="main">[1]</span> String<span class="main">[1]</span> Integer<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">string_binop_type</span> AtOp String<span class="main">[1]</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> String<span class="main">[1]</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">string_ternop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">string_ternop_type</span> SubstringOp String<span class="main">[1]</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> String<span class="main">[1]</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Collection Operations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Please take a note, that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"flatten()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> preserves a collection kind.›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">collection_unop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> CollectionSizeOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Integer<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> IsEmptyOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> NotEmptyOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> CollectionMaxOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> operation <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">STR</span> <span class="inner_quoted">''max''</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> CollectionMaxOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> CollectionMinOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> operation <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">STR</span> <span class="inner_quoted">''min''</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> CollectionMinOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Real<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> SumOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> operation <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="keyword1">STR</span> <span class="inner_quoted">''+''</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> SumOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> AsSetOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> AsOrderedSetOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> AsBagOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> AsSequenceOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"update_element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>to_single_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_unop_type</span> FlattenOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_unop_type</span> FirstOp <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_unop_type</span> FirstOp <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_unop_type</span> LastOp <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_unop_type</span> LastOp <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_unop_type</span> ReverseOp <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_unop_type</span> ReverseOp <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Please take a note that if both arguments are collections,
  then an element type of the resulting collection is a super type
  of element types of orginal collections. However for single-valued
  operations (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"append()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"insertAt()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, ...)
  this behavior looks undesirable. So we restrict such arguments
  to have a subtype of the collection element type.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Please take a note that we allow the following expressions:›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹let nullable_value : Integer[?] = null in
Sequence{1..3}-&gt;inculdes(nullable_value) and
Sequence{1..3}-&gt;inculdes(null) and
Sequence{1..3}-&gt;inculdesAll(Set{1,null})›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The OCL specification defines <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"including()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"excluding()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> operations for the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">Sequence</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> type
  but does not define them for the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">OrderedSet</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> type.
  We define them for all collection types.

  It is a good idea to prohibit including of values that
  do not conform to a collection element type.
  However we do not restrict it.

  At first we defined the following typing rules for the
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"excluding()"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> operation:

{\isacharbar}\ {\isachardoublequoteopen}element{\isacharunderscore}type\ {\isasymtau}\ {\isasymrho}\ {\isasymLongrightarrow}\ {\isasymsigma}\ {\isasymle}\ {\isasymrho}\ {\isasymLongrightarrow}\ {\isasymsigma}\ {\isasymnoteq}\ OclVoid{\isacharbrackleft}{\isacharquery}{\isacharbrackright}\ {\isasymLongrightarrow}\isanewline
\ \ \ collection{\isacharunderscore}binop{\isacharunderscore}type\ ExcludingOp\ {\isasymtau}\ {\isasymsigma}\ {\isasymtau}{\isachardoublequoteclose}\isanewline
{\isacharbar}\ {\isachardoublequoteopen}element{\isacharunderscore}type\ {\isasymtau}\ {\isasymrho}\ {\isasymLongrightarrow}\ {\isasymsigma}\ {\isasymle}\ {\isasymrho}\ {\isasymLongrightarrow}\ {\isasymsigma}\ {\isacharequal}\ OclVoid{\isacharbrackleft}{\isacharquery}{\isacharbrackright}\ {\isasymLongrightarrow}\isanewline
\ \ \ update{\isacharunderscore}element{\isacharunderscore}type\ {\isasymtau}\ {\isacharparenleft}to{\isacharunderscore}required{\isacharunderscore}type\ {\isasymrho}{\isacharparenright}\ {\isasymupsilon}\ {\isasymLongrightarrow}\isanewline
\ \ \ collection{\isacharunderscore}binop{\isacharunderscore}type\ ExcludingOp\ {\isasymtau}\ {\isasymsigma}\ {\isasymupsilon}{\isachardoublequoteclose}\isanewline

  This operation could play a special role in a definition
  of safe navigation operations:›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Sequence{1,2,null}-&gt;exculding(null) : Integer[1]›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  However it is more natural to use a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"selectByKind(T[1])"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  operation instead.›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">collection_binop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> to_optional_type_nested <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> IncludesOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> to_optional_type_nested <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> ExcludesOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> to_optional_type_nested <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> CountOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Integer<span class="main">[1]</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> element_type <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">≤</span> to_optional_type_nested <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> IncludesAllOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> element_type <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">≤</span> to_optional_type_nested <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> ExcludesAllOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Boolean<span class="main">[1]</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> element_type <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> ProductOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>
      <span class="main">(</span>Set <span class="main">(</span>Tuple <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''first''</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''second''</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_binop_type</span> UnionOp <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_binop_type</span> UnionOp <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>Bag <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_binop_type</span> UnionOp <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>Bag <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_binop_type</span> UnionOp <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>Bag <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_binop_type</span> IntersectionOp <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_binop_type</span> IntersectionOp <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_binop_type</span> IntersectionOp <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_binop_type</span> IntersectionOp <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Bag <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>Bag <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_binop_type</span> SetMinusOp <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">collection_binop_type</span> SymmetricDifferenceOp <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>Set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> update_element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> IncludingOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> ExcludingOp <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> AppendOp <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> AppendOp <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> PrependOp <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> PrependOp <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> CollectionAtOp <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> CollectionAtOp <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> CollectionIndexOfOp <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Integer<span class="main">[1]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_binop_type</span> CollectionIndexOfOp <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> Integer<span class="main">[1]</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">collection_ternop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_ternop_type</span> InsertAtOp <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free">collection_ternop_type</span> InsertAtOp <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">collection_ternop_type</span> SubOrderedSetOp <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">(</span>OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free">collection_ternop_type</span> SubSequenceOp <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">(</span>Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Coercions›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">unop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"any_unop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free">unop_type</span> <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"boolean_unop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free">unop_type</span> <span class="main">(</span>Inr <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"numeric_unop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free">unop_type</span> <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"string_unop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free">unop_type</span> <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"collection_unop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free">unop_type</span> <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> ArrowCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">binop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"super_binop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free">binop_type</span> <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"boolean_binop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free">binop_type</span> <span class="main">(</span>Inr <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"numeric_binop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free">binop_type</span> <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"string_binop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free">binop_type</span> <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"collection_binop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free">binop_type</span> <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> ArrowCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">ternop_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"string_ternop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   <span class="free">ternop_type</span> <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"collection_ternop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   <span class="free">ternop_type</span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span> ArrowCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">op_type</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"unop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   <span class="free">op_type</span> <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"binop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   <span class="free">op_type</span> <span class="main">(</span>Inr <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"ternop_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   <span class="free">op_type</span> <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"operation <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">⟹</span>
   <span class="free">op_type</span> <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">op</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">(</span>oper_type <span class="free"><span class="bound"><span class="entity">oper</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*** Simplification Rules ***************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simplification Rules›</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span> op_type_alt_simps<span class="main">:</span>
<span class="quoted"><span class="quoted">"mataop_type <span class="free">τ</span> <span class="free">op</span> <span class="free">σ</span>"</span></span>
<span class="quoted"><span class="quoted">"typeop_type <span class="free">k</span> <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span>"</span></span>

<span class="quoted"><span class="quoted">"op_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">π</span> <span class="free">σ</span>"</span></span>
<span class="quoted"><span class="quoted">"unop_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">σ</span>"</span></span>
<span class="quoted"><span class="quoted">"binop_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span>"</span></span>
<span class="quoted"><span class="quoted">"ternop_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="free">υ</span>"</span></span>

<span class="quoted"><span class="quoted">"any_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span>"</span></span>
<span class="quoted"><span class="quoted">"boolean_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span>"</span></span>
<span class="quoted"><span class="quoted">"numeric_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span>"</span></span>
<span class="quoted"><span class="quoted">"string_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span>"</span></span>
<span class="quoted"><span class="quoted">"collection_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span>"</span></span>

<span class="quoted"><span class="quoted">"super_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span>"</span></span>
<span class="quoted"><span class="quoted">"boolean_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span>"</span></span>
<span class="quoted"><span class="quoted">"numeric_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span>"</span></span>
<span class="quoted"><span class="quoted">"string_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span>"</span></span>
<span class="quoted"><span class="quoted">"collection_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span>"</span></span>

<span class="quoted"><span class="quoted">"string_ternop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="free">υ</span>"</span></span>
<span class="quoted"><span class="quoted">"collection_ternop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="free">υ</span>"</span></span>

<span class="comment1">(*** Determinism ************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Determinism›</span></span>

<span class="keyword1" id="OCL_Typing-typeop_type_det"><span class="command">lemma</span></span> typeop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"typeop_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   typeop_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> typeop_type.induct<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeop_type.simps update_element_type_det<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-any_unop_type_det"><span class="command">lemma</span></span> any_unop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"any_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   any_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> any_unop_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> any_unop_type.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-boolean_unop_type_det"><span class="command">lemma</span></span> boolean_unop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"boolean_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   boolean_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> boolean_unop_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boolean_unop_type.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-numeric_unop_type_det"><span class="command">lemma</span></span> numeric_unop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"numeric_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   numeric_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> numeric_unop_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeric_unop_type.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-string_unop_type_det"><span class="command">lemma</span></span> string_unop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"string_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   string_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> string_unop_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> string_unop_type.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-collection_unop_type_det"><span class="command">lemma</span></span> collection_unop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"collection_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   collection_unop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> collection_unop_type.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> collection_unop_type.cases<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> element_type_det update_element_type_det<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="OCL_Typing-unop_type_det"><span class="command">lemma</span></span> unop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"unop_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   unop_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> unop_type.induct<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unop_type.simps any_unop_type_det
                boolean_unop_type_det numeric_unop_type_det
                string_unop_type_det collection_unop_type_det<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-super_binop_type_det"><span class="command">lemma</span></span> super_binop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"super_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   super_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> super_binop_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> super_binop_type.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-boolean_binop_type_det"><span class="command">lemma</span></span> boolean_binop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"boolean_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   boolean_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> boolean_binop_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boolean_binop_type.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-numeric_binop_type_det"><span class="command">lemma</span></span> numeric_binop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"numeric_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   numeric_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> numeric_binop_type.induct<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeric_binop_type.simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-string_binop_type_det"><span class="command">lemma</span></span> string_binop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"string_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   string_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> string_binop_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> string_binop_type.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-collection_binop_type_det"><span class="command">lemma</span></span> collection_binop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"collection_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   collection_binop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> collection_binop_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> collection_binop_type.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> element_type_det update_element_type_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="OCL_Typing-binop_type_det"><span class="command">lemma</span></span> binop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"binop_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   binop_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">ρ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ρ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> binop_type.induct<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> binop_type.simps super_binop_type_det
                boolean_binop_type_det numeric_binop_type_det
                string_binop_type_det collection_binop_type_det<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-string_ternop_type_det"><span class="command">lemma</span></span> string_ternop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"string_ternop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="free">υ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   string_ternop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="free">υ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">υ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">υ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> string_ternop_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> string_ternop_type.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-collection_ternop_type_det"><span class="command">lemma</span></span> collection_ternop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"collection_ternop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="free">υ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   collection_ternop_type <span class="free">op</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="free">υ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">υ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">υ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> collection_ternop_type.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> collection_ternop_type.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-ternop_type_det"><span class="command">lemma</span></span> ternop_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ternop_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="free">υ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
   ternop_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">σ</span> <span class="free">ρ</span> <span class="free">υ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">υ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">υ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ternop_type.induct<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ternop_type.simps string_ternop_type_det collection_ternop_type_det<span class="main">)</span>

<span class="keyword1" id="OCL_Typing-op_type_det"><span class="command">lemma</span></span> op_type_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"op_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">π</span> <span class="free">σ</span> <span class="main">⟹</span>
   op_type <span class="free">op</span> <span class="free">k</span> <span class="free">τ</span> <span class="free">π</span> <span class="free">ρ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">=</span> <span class="free">ρ</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> op_type.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> op_type.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unop_type_det<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> op_type.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> binop_type_det<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> op_type.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ternop_type_det<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> op_type.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> operation_det<span class="main">)</span>

<span class="comment1">(*** Expressions Typing *****************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Expressions Typing›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following typing rules are preliminary. The final rules are given at
  the end of the next chapter.›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">typing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ocl_object_model<span class="main">)</span> type env <span class="main">⇒</span> <span class="tfree">'a</span> expr <span class="main">⇒</span> <span class="tfree">'a</span> type <span class="main">⇒</span> bool"</span></span>
       <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span>_<span class="keyword3">/ </span><span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span><span class="keyword3">/ </span><span class="keyword3">(</span>_ <span class="keyword1">:</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">,</span>51<span class="main">]</span> 50<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">collection_parts_typing</span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span>_<span class="keyword3">/ </span><span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword3">/ </span><span class="keyword3">(</span>_ <span class="keyword1">:</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">,</span>51<span class="main">]</span> 50<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">collection_part_typing</span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span>_<span class="keyword3">/ </span><span class="keyword1">⊢<span class="hidden">⇩</span><sub>P</sub></span><span class="keyword3">/ </span><span class="keyword3">(</span>_ <span class="keyword1">:</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">,</span>51<span class="main">]</span> 50<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">iterator_typing</span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span>_<span class="keyword3">/ </span><span class="keyword1">⊢<span class="hidden">⇩</span><sub>I</sub></span><span class="keyword3">/ </span><span class="keyword3">(</span>_ <span class="keyword1">:</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">,</span>51<span class="main">]</span> 50<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">expr_list_typing</span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span>_<span class="keyword3">/ </span><span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span><span class="keyword3">/ </span><span class="keyword3">(</span>_ <span class="keyword1">:</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">,</span>51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>

<span class="comment1">― ‹Primitive Literals›</span>

 NullLiteralT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> NullLiteral <span class="main"><span class="free">:</span></span> OclVoid<span class="main">[?]</span>"</span></span>
<span class="main">|</span>BooleanLiteralT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> BooleanLiteral <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">:</span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span>RealLiteralT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> RealLiteral <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">:</span></span> Real<span class="main">[1]</span>"</span></span>
<span class="main">|</span>IntegerLiteralT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> IntegerLiteral <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">:</span></span> Integer<span class="main">[1]</span>"</span></span>
<span class="main">|</span>UnlimitedNaturalLiteralT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> UnlimitedNaturalLiteral <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">:</span></span> UnlimitedNatural<span class="main">[1]</span>"</span></span>
<span class="main">|</span>StringLiteralT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> StringLiteral <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">:</span></span> String<span class="main">[1]</span>"</span></span>
<span class="main">|</span>EnumLiteralT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_literal <span class="free"><span class="bound"><span class="entity">enum</span></span></span> <span class="free"><span class="bound"><span class="entity">lit</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> EnumLiteral <span class="free"><span class="bound"><span class="entity">enum</span></span></span> <span class="free"><span class="bound"><span class="entity">lit</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">(</span>Enum <span class="free"><span class="bound"><span class="entity">enum</span></span></span><span class="main">)</span><span class="main">[1]</span>"</span></span>

<span class="comment1">― ‹Collection Literals›</span>

<span class="main">|</span>SetLiteralT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">prts</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> CollectionLiteral SetKind <span class="free"><span class="bound"><span class="entity">prts</span></span></span> <span class="main"><span class="free">:</span></span> Set <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span>OrderedSetLiteralT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">prts</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> CollectionLiteral OrderedSetKind <span class="free"><span class="bound"><span class="entity">prts</span></span></span> <span class="main"><span class="free">:</span></span> OrderedSet <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span>BagLiteralT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">prts</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> CollectionLiteral BagKind <span class="free"><span class="bound"><span class="entity">prts</span></span></span> <span class="main"><span class="free">:</span></span> Bag <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span>SequenceLiteralT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">prts</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> CollectionLiteral SequenceKind <span class="free"><span class="bound"><span class="entity">prts</span></span></span> <span class="main"><span class="free">:</span></span> Sequence <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="comment1">― ‹We prohibit empty collection literals, because their type is unclear.
  We could use <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"OclVoid[1]"</span><span class="antiquote">}</span></span> element type for empty collections, but
  the typing rules will give wrong types for nested collections, because,
  for example, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"OclVoid[1] ⊔ Set(Integer[1]) = OclSuper"</span><span class="antiquote">}</span></span>›</span>

<span class="main">|</span>CollectionPartsSingletonT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span>CollectionPartsListT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>P</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="main">|</span>CollectionPartItemT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>P</sub></span></span> CollectionItem <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span>CollectionPartRangeT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> UnlimitedNatural<span class="main">[1]</span><span class="main">─</span>Integer<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>P</sub></span></span> CollectionRange <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main"><span class="free">:</span></span> Integer<span class="main">[1]</span>"</span></span>

<span class="comment1">― ‹Tuple Literals›</span>
<span class="comment1">― ‹We do not prohibit empty tuples, because it could be useful.
  <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"Tuple()"</span><span class="antiquote">}</span></span> is a supertype of all other tuple types.›</span>

<span class="main">|</span>TupleLiteralNilT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> TupleLiteral <span class="main">[]</span> <span class="main"><span class="free">:</span></span> Tuple fmempty"</span></span>
<span class="main">|</span>TupleLiteralConsT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> TupleLiteral <span class="free"><span class="bound"><span class="entity">elems</span></span></span> <span class="main"><span class="free">:</span></span> Tuple <span class="free"><span class="bound"><span class="entity">ξ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> tuple_element_expr <span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   tuple_element_type <span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> TupleLiteral <span class="main">(</span><span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">elems</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> Tuple <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ξ</span></span></span><span class="main">(</span>tuple_element_name <span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹Misc Expressions›</span>

<span class="main">|</span>LetT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> Let <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span>VarT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fmlookup <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> Var <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span>IfT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">:</span></span> Boolean<span class="main">[1]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> If <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>

<span class="comment1">― ‹Call Expressions›</span>

<span class="main">|</span>MetaOperationCallT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mataop_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> MetaOperationCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span>StaticOperationCallT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="free"><span class="bound"><span class="entity">params</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">⟹</span>
   static_operation <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">oper</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> StaticOperationCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">params</span></span></span> <span class="main"><span class="free">:</span></span> oper_type <span class="free"><span class="bound"><span class="entity">oper</span></span></span>"</span></span>

<span class="main">|</span>TypeOperationCallT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   typeop_type <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> TypeOperationCall <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>

<span class="main">|</span>AttributeCallT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span> <span class="main">⟹</span>
   attribute <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">prop</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> AttributeCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> DotCall <span class="free"><span class="bound"><span class="entity">prop</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span>AssociationEndCallT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span> <span class="main">⟹</span>
   association_end <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> AssociationEndCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> DotCall <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="main"><span class="free">:</span></span> assoc_end_type <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>
<span class="main">|</span>AssociationClassCallT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span> <span class="main">⟹</span>
   referred_by_association_class <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒟</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> AssociationClassCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> DotCall <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="main"><span class="free">:</span></span> class_assoc_type <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span>"</span></span>
<span class="main">|</span>AssociationClassEndCallT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="main"><span class="free">:</span></span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">𝒜</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span> <span class="main">⟹</span>
   association_class_end <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">end</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> AssociationClassEndCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> DotCall <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="main"><span class="free">:</span></span> class_assoc_end_type <span class="free"><span class="bound"><span class="entity">end</span></span></span>"</span></span>
<span class="main">|</span>OperationCallT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="free"><span class="bound"><span class="entity">params</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">⟹</span>
   op_type <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> OperationCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">params</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="main">|</span>TupleElementCallT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="main"><span class="free">:</span></span> Tuple <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">⟹</span>
   fmlookup <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="free"><span class="bound"><span class="entity">elem</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> TupleElementCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> DotCall <span class="free"><span class="bound"><span class="entity">elem</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="comment1">― ‹Iterator Expressions›</span>

<span class="main">|</span>IteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">src</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">++<span class="hidden">⇩</span><sub>f</sub></span> fmap_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">it</span><span class="main">.</span> <span class="main">(</span><span class="bound">it</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span>IterateT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> Let <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">res_t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">res_init</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">res_t</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> IterateCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">res_t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">res_init</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>

<span class="main">|</span>AnyIteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   length <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> Boolean<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> AnyIteratorCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span>ClosureIteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   length <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span>
   to_single_type <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   to_unique_collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> ClosureIteratorCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span>"</span></span>
<span class="main">|</span>CollectIteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   length <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span>
   to_nonunique_collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   update_element_type <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">(</span>to_single_type <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> CollectIteratorCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span>CollectNestedIteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   length <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span>
   to_nonunique_collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   update_element_type <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> CollectNestedIteratorCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span>ExistsIteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> Boolean<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> ExistsIteratorCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span>ForAllIteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> Boolean<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> ForAllIteratorCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span>"</span></span>
<span class="main">|</span>OneIteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   length <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> Boolean<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> OneIteratorCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span>IsUniqueIteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   length <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> IsUniqueIteratorCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> Boolean<span class="main">[1]</span>"</span></span>
<span class="main">|</span>SelectIteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   length <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> Boolean<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> SelectIteratorCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span>RejectIteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   length <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≤</span> Boolean<span class="main">[?]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> RejectIteratorCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span>SortedByIteratorT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>I</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">src</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   length <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span>
   to_ordered_collection <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> SortedByIteratorCall <span class="free"><span class="bound"><span class="entity">src</span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="free"><span class="bound"><span class="entity">its_ty</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">υ</span></span></span>"</span></span>

<span class="comment1">― ‹Expression Lists›</span>

<span class="main">|</span>ExprListNilT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">[]</span> <span class="main"><span class="free">:</span></span> <span class="main">[]</span>"</span></span>
<span class="main">|</span>ExprListConsT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>E</sub></span></span> <span class="free"><span class="bound"><span class="entity">expr</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="free"><span class="bound"><span class="entity">exprs</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">π</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="free"><span class="bound"><span class="entity">expr</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">exprs</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">π</span></span></span>"</span></span>

<span class="comment1">(*** Elimination Rules ******************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Elimination Rules›</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> NullLiteralTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> NullLiteral <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> BooleanLiteralTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> BooleanLiteral <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> RealLiteralTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> RealLiteral <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> IntegerLiteralTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> IntegerLiteral <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> UnlimitedNaturalLiteralTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> UnlimitedNaturalLiteral <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> StringLiteralTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> StringLiteral <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> EnumLiteralTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> EnumLiteral <span class="free">enm</span> <span class="free">lit</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> CollectionLiteralTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> CollectionLiteral <span class="free">k</span> <span class="free">prts</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> TupleLiteralTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> TupleLiteral <span class="free">elems</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> LetTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> Let <span class="free">v</span> <span class="free">τ</span> <span class="free">init</span> <span class="free">body</span> <span class="main">:</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> VarTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> Var <span class="free">v</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> IfTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> If <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> MetaOperationCallTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> MetaOperationCall <span class="free">τ</span> <span class="free">op</span> <span class="main">:</span> <span class="free">σ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> StaticOperationCallTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> StaticOperationCall <span class="free">τ</span> <span class="free">op</span> <span class="free">as</span> <span class="main">:</span> <span class="free">σ</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> TypeOperationCallTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> TypeOperationCall <span class="free">a</span> <span class="free">k</span> <span class="free">op</span> <span class="free">σ</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> AttributeCallTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> AttributeCall <span class="free">src</span> <span class="free">k</span> <span class="free">prop</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> AssociationEndCallTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> AssociationEndCall <span class="free">src</span> <span class="free">k</span> <span class="free">role</span> <span class="free">from</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> AssociationClassCallTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> AssociationClassCall <span class="free">src</span> <span class="free">k</span> <span class="free">a</span> <span class="free">from</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> AssociationClassEndCallTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> AssociationClassEndCall <span class="free">src</span> <span class="free">k</span> <span class="free">role</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> OperationCallTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> OperationCall <span class="free">src</span> <span class="free">k</span> <span class="free">op</span> <span class="free">params</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> TupleElementCallTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> TupleElementCall <span class="free">src</span> <span class="free">k</span> <span class="free">elem</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> IteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>I</sub></span> <span class="main">(</span><span class="free">src</span><span class="main">,</span> <span class="free">its</span><span class="main">,</span> <span class="free">body</span><span class="main">)</span> <span class="main">:</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> IterateTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> IterateCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">res</span> <span class="free">res_t</span> <span class="free">res_init</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> AnyIteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> AnyIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> ClosureIteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> ClosureIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> CollectIteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> CollectIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> CollectNestedIteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> CollectNestedIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> ExistsIteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> ExistsIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> ForAllIteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> ForAllIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> OneIteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> OneIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> IsUniqueIteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> IsUniqueIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> SelectIteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> SelectIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> RejectIteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> RejectIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> SortedByIteratorTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> SortedByIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> CollectionPartsNilTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> CollectionPartsItemTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span> <span class="main">#</span> <span class="free">y</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> CollectionItemTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>P</sub></span> CollectionItem <span class="free">a</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> CollectionRangeTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>P</sub></span> CollectionRange <span class="free">a</span> <span class="free">b</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> ExprListTE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">exprs</span> <span class="main">:</span> <span class="free">π</span>"</span></span>

<span class="comment1">(*** Simplification Rules ***************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Simplification Rules›</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span> typing_alt_simps<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> NullLiteral <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> BooleanLiteral <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> RealLiteral <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> UnlimitedNaturalLiteral <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> IntegerLiteral <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> StringLiteral <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> EnumLiteral <span class="free">enm</span> <span class="free">lit</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> CollectionLiteral <span class="free">k</span> <span class="free">prts</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> TupleLiteral <span class="main">[]</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> TupleLiteral <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> Let <span class="free">v</span> <span class="free">τ</span> <span class="free">init</span> <span class="free">body</span> <span class="main">:</span> <span class="free">σ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> Var <span class="free">v</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> If <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> MetaOperationCall <span class="free">τ</span> <span class="free">op</span> <span class="main">:</span> <span class="free">σ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> StaticOperationCall <span class="free">τ</span> <span class="free">op</span> <span class="free">as</span> <span class="main">:</span> <span class="free">σ</span>"</span></span>

<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> TypeOperationCall <span class="free">a</span> <span class="free">k</span> <span class="free">op</span> <span class="free">σ</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> AttributeCall <span class="free">src</span> <span class="free">k</span> <span class="free">prop</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> AssociationEndCall <span class="free">src</span> <span class="free">k</span> <span class="free">role</span> <span class="free">from</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> AssociationClassCall <span class="free">src</span> <span class="free">k</span> <span class="free">a</span> <span class="free">from</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> AssociationClassEndCall <span class="free">src</span> <span class="free">k</span> <span class="free">role</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> OperationCall <span class="free">src</span> <span class="free">k</span> <span class="free">op</span> <span class="free">params</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> TupleElementCall <span class="free">src</span> <span class="free">k</span> <span class="free">elem</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>I</sub></span> <span class="main">(</span><span class="free">src</span><span class="main">,</span> <span class="free">its</span><span class="main">,</span> <span class="free">body</span><span class="main">)</span> <span class="main">:</span> <span class="free">ys</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> IterateCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">res</span> <span class="free">res_t</span> <span class="free">res_init</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> AnyIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> ClosureIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> CollectIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> CollectNestedIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> ExistsIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> ForAllIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> OneIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> IsUniqueIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> SelectIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> RejectIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> SortedByIteratorCall <span class="free">src</span> <span class="free">k</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span> <span class="main">#</span> <span class="free">y</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>P</sub></span> CollectionItem <span class="free">a</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>P</sub></span> CollectionRange <span class="free">a</span> <span class="free">b</span> <span class="main">:</span> <span class="free">τ</span>"</span></span>

<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">[]</span> <span class="main">:</span> <span class="free">π</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">:</span> <span class="free">π</span>"</span></span>

<span class="comment1">(*** Determinism ************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Determinism›</span></span>

<span class="keyword1" id="OCL_Typing-typing_det"><span class="command">lemma</span></span>
  typing_det<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">expr</span> <span class="main">:</span> <span class="free">τ</span> <span class="main">⟹</span>
     <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">expr</span> <span class="main">:</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">=</span> <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  collection_parts_typing_det<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">prts</span> <span class="main">:</span> <span class="free">τ</span> <span class="main">⟹</span>
     <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">prts</span> <span class="main">:</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">=</span> <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  collection_part_typing_det<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">prt</span> <span class="main">:</span> <span class="free">τ</span> <span class="main">⟹</span>
     <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">prt</span> <span class="main">:</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">=</span> <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iterator_typing_det<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>I</sub></span> <span class="main">(</span><span class="free">src</span><span class="main">,</span> <span class="free">its</span><span class="main">,</span> <span class="free">body</span><span class="main">)</span> <span class="main">:</span> <span class="free">xs</span> <span class="main">⟹</span>
     <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>I</sub></span> <span class="main">(</span><span class="free">src</span><span class="main">,</span> <span class="free">its</span><span class="main">,</span> <span class="free">body</span><span class="main">)</span> <span class="main">:</span> <span class="free">ys</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  expr_list_typing_det<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">exprs</span> <span class="main">:</span> <span class="free">π</span> <span class="main">⟹</span>
     <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">exprs</span> <span class="main">:</span> <span class="free">ξ</span> <span class="main">⟹</span> <span class="free">π</span> <span class="main">=</span> <span class="free">ξ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">σ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ys</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">ξ</span></span>
       <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> typing_collection_parts_typing_collection_part_typing_iterator_typing_expr_list_typing.inducts<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NullLiteralT <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BooleanLiteralT <span class="skolem">Γ</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RealLiteralT <span class="skolem">Γ</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IntegerLiteralT <span class="skolem">Γ</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>UnlimitedNaturalLiteralT <span class="skolem">Γ</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StringLiteralT <span class="skolem">Γ</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>EnumLiteralT <span class="skolem">Γ</span> <span class="skolem">τ</span> <span class="skolem">lit</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SetLiteralT <span class="skolem">Γ</span> <span class="skolem">prts</span> <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OrderedSetLiteralT <span class="skolem">Γ</span> <span class="skolem">prts</span> <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BagLiteralT <span class="skolem">Γ</span> <span class="skolem">prts</span> <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SequenceLiteralT <span class="skolem">Γ</span> <span class="skolem">prts</span> <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CollectionPartsSingletonT <span class="skolem">Γ</span> <span class="skolem">x</span> <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CollectionPartsListT <span class="skolem">Γ</span> <span class="skolem">x</span> <span class="skolem">τ</span> <span class="skolem">y</span> <span class="skolem">xs</span> <span class="skolem">σ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CollectionPartItemT <span class="skolem">Γ</span> <span class="skolem">a</span> <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CollectionPartRangeT <span class="skolem">Γ</span> <span class="skolem">a</span> <span class="skolem">τ</span> <span class="skolem">b</span> <span class="skolem">σ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TupleLiteralNilT <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TupleLiteralConsT <span class="skolem">Γ</span> <span class="skolem">elems</span> <span class="skolem">ξ</span> <span class="skolem">el</span> <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> TupleLiteralConsT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> TupleLiteralTE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> TupleLiteralConsT.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LetT <span class="skolem">Γ</span> <span class="skolem">ℳ</span> <span class="skolem">init</span> <span class="skolem">σ</span> <span class="skolem">τ</span> <span class="skolem">v</span> <span class="skolem">body</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>VarT <span class="skolem">Γ</span> <span class="skolem">v</span> <span class="skolem">τ</span> <span class="skolem">ℳ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IfT <span class="skolem">Γ</span> <span class="skolem">a</span> <span class="skolem">τ</span> <span class="skolem">b</span> <span class="skolem">σ</span> <span class="skolem">c</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> IfT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> IfTE<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IfT.hyps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MetaOperationCallT <span class="skolem">τ</span> <span class="skolem">op</span> <span class="skolem">σ</span> <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MetaOperationCallTE mataop_type.cases<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StaticOperationCallT <span class="skolem">τ</span> <span class="skolem">op</span> <span class="skolem">π</span> <span class="skolem">oper</span> <span class="skolem">Γ</span> <span class="skolem">as</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> StaticOperationCallT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> StaticOperationCallTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> StaticOperationCallT.hyps static_operation_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TypeOperationCallT <span class="skolem">Γ</span> <span class="skolem">a</span> <span class="skolem">τ</span> <span class="skolem">op</span> <span class="skolem">σ</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TypeOperationCallTE typeop_type_det<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AttributeCallT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">τ</span> <span class="skolem">𝒞</span> <span class="quoted">"<span class="skolem">prop</span>"</span> <span class="skolem">𝒟</span> <span class="skolem">σ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> AttributeCallT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> AttributeCallTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> AttributeCallT.hyps attribute_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AssociationEndCallT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">𝒞</span> <span class="quoted">"<span class="skolem">from</span>"</span> <span class="skolem">role</span> <span class="skolem">𝒟</span> <span class="quoted">"<span class="skolem">end</span>"</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> AssociationEndCallT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> AssociationEndCallTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> AssociationEndCallT.hyps association_end_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AssociationClassCallT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">𝒞</span> <span class="quoted">"<span class="skolem">from</span>"</span> <span class="skolem">𝒜</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AssociationClassEndCallT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">τ</span> <span class="skolem">𝒜</span> <span class="skolem">role</span> <span class="quoted">"<span class="skolem">end</span>"</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> AssociationClassEndCallT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> AssociationClassEndCallTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> AssociationClassEndCallT.hyps association_class_end_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OperationCallT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">τ</span> <span class="skolem">params</span> <span class="skolem">π</span> <span class="skolem">op</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> OperationCallT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> OperationCallTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> OperationCallT.hyps op_type_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TupleElementCallT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">π</span> <span class="skolem">elem</span> <span class="skolem">τ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> TupleElementCallT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> TupleElementCallTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> TupleElementCallT.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IteratorT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">its_ty</span> <span class="skolem">its</span> <span class="skolem">body</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> IteratorT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> IteratorTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> IteratorT.hyps element_type_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IterateT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">res</span> <span class="skolem">res_t</span> <span class="skolem">res_init</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> IterateT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> IterateT.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AnyIteratorT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> AnyIteratorTE Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ClosureIteratorT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span> <span class="skolem">υ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ClosureIteratorT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> ClosureIteratorTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ClosureIteratorT.hyps to_unique_collection_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CollectIteratorT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span> <span class="skolem">υ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> CollectIteratorT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> CollectIteratorTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> CollectIteratorT.hyps to_nonunique_collection_det
      update_element_type_det Pair_inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CollectNestedIteratorT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span> <span class="skolem">υ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> CollectNestedIteratorT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> CollectNestedIteratorTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> CollectNestedIteratorT.hyps to_nonunique_collection_det
      update_element_type_det Pair_inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExistsIteratorT <span class="skolem">Γ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ExistsIteratorT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> ExistsIteratorTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ExistsIteratorT.hyps Pair_inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ForAllIteratorT <span class="skolem">Γ</span> <span class="skolem">ℳ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ForAllIteratorT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> ForAllIteratorTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ForAllIteratorT.hyps Pair_inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OneIteratorT <span class="skolem">Γ</span> <span class="skolem">ℳ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> OneIteratorT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> OneIteratorTE<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IsUniqueIteratorT <span class="skolem">Γ</span> <span class="skolem">ℳ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> IsUniqueIteratorT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> IsUniqueIteratorTE<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SelectIteratorT <span class="skolem">Γ</span> <span class="skolem">ℳ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> SelectIteratorT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> SelectIteratorTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> SelectIteratorT.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RejectIteratorT <span class="skolem">Γ</span> <span class="skolem">ℳ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> RejectIteratorT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> RejectIteratorTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> RejectIteratorT.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SortedByIteratorT <span class="skolem">Γ</span> <span class="skolem">ℳ</span> <span class="skolem">src</span> <span class="skolem">its</span> <span class="skolem">its_ty</span> <span class="skolem">body</span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">ρ</span> <span class="skolem">υ</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> SortedByIteratorT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> SortedByIteratorTE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> SortedByIteratorT.hyps to_ordered_collection_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExprListNilT <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> expr_list_typing.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExprListConsT <span class="skolem">Γ</span> <span class="skolem">expr</span> <span class="skolem">τ</span> <span class="skolem">exprs</span> <span class="skolem">π</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ExprListConsT.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> ExprListTE<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ExprListConsT.hyps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*** Code Setup *************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Code Setup›</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">op_type</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span>
    i ⇒ i ⇒ i ⇒ bool<span class="main">,</span>
    i ⇒ i ⇒ o ⇒ bool<span class="main">)</span> <span class="quoted"><span class="quoted">iterator_typing</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="OCL_Normalization">
<div class="head">
<h1>Theory OCL_Normalization</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Normalization›</span></span>
<span class="keyword1"><span class="command">theory</span></span> OCL_Normalization
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#OCL_Typing">OCL_Typing</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*** Normalization Rules ****************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Normalization Rules›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following expression normalization rules includes two kinds of an
  abstract syntax tree transformations:
\begin{itemize}
\item determination of implicit types of variables, iterators, and
      tuple elements,
\item unfolding of navigation shorthands and safe navigation operators,
      described in \autoref{tab:norm_rules}.
\end{itemize}

  The following variables are used in the table:
\begin{itemize}
\item <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹x›</span></span></span></span> is a non-nullable value,
\item <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹n›</span></span></span></span> is a nullable value,
\item <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹xs›</span></span></span></span> is a collection of non-nullable values,
\item <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹ns›</span></span></span></span> is a collection of nullable values. 
\end{itemize}

\begin{table}[h!]
  \begin{center}
    \caption{Expression Normalization Rules}
    \label{tab:norm_rules}
    \begin{threeparttable}
    \begin{tabular}{c|c}
      \textbf{Orig. expr.} &amp; \textbf{Normalized expression}\\
      \hline
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹x.op()›</span></span></span></span> &amp; <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹x.op()›</span></span></span></span>\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹n.op()›</span></span></span></span> &amp; <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹n.op()›</span></span></span></span>\tnote{*}\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹x?.op()›</span></span></span></span> &amp; ---\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹n?.op()›</span></span></span></span> &amp; <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹if n &lt;&gt; null then n.oclAsType(T[1]).op() else null endif›</span></span></span></span>\tnote{**}\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹x-&gt;op()›</span></span></span></span> &amp; <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹x.oclAsSet()-&gt;op()›</span></span></span></span>\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹n-&gt;op()›</span></span></span></span> &amp; <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹n.oclAsSet()-&gt;op()›</span></span></span></span>\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹x?-&gt;op()›</span></span></span></span> &amp; ---\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹n?-&gt;op()›</span></span></span></span> &amp; ---\\
      \hline
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹xs.op()›</span></span></span></span> &amp; <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹xs-&gt;collect(x | x.op())›</span></span></span></span>\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹ns.op()›</span></span></span></span> &amp; <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹ns-&gt;collect(n | n.op())›</span></span></span></span>\tnote{*}\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹xs?.op()›</span></span></span></span> &amp; ---\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹ns?.op()›</span></span></span></span> &amp; <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹ns-&gt;selectByKind(T[1])-&gt;collect(x | x.op())›</span></span></span></span>\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹xs-&gt;op()›</span></span></span></span> &amp; <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹xs-&gt;op()›</span></span></span></span>\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹ns-&gt;op()›</span></span></span></span> &amp; <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹ns-&gt;op()›</span></span></span></span>\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹xs?-&gt;op()›</span></span></span></span> &amp; ---\\
      <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹ns?-&gt;op()›</span></span></span></span> &amp; <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹ns-&gt;selectByKind(T[1])-&gt;op()›</span></span></span></span>\\
    \end{tabular}
    \begin{tablenotes}
    \item[*] The resulting expression will be ill-typed if the operation is unsafe.
    An unsafe operation is an operation which is well-typed for
    a non-nullable source only.
    \item[**] It would be a good idea to prohibit such a transformation
    for safe operations. A safe operation is an operation which is well-typed
    for a nullable source. However, it is hard to define safe operations
    formally considering operations overloading, complex relations between
    operation parameters types (please see the typing rules for the equality
    operator), and user-defined operations.
    \end{tablenotes}
    \end{threeparttable}
  \end{center}
\end{table}

  Please take a note that name resolution of variables, types,
  attributes, and associations is out of scope of this section.
  It should be done on a previous phase during transformation
  of a concrete syntax tree to an abstract syntax tree.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">string_of_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">string_of_nat</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="numeral">10</span> <span class="keyword1">then</span> <span class="main">[</span>char_of <span class="main">(</span><span class="numeral">48</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">]</span>
      <span class="keyword1">else</span> <span class="free">string_of_nat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="numeral">10</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>char_of <span class="main">(</span><span class="numeral">48</span> <span class="main">+</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">mod</span> <span class="numeral">10</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">new_vname</span> <span class="main">≡</span> String.implode <span class="main">∘</span> string_of_nat <span class="main">∘</span> fcard <span class="main">∘</span> fmdom"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">normalize</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ocl_object_model<span class="main">)</span> type env <span class="main">⇒</span> <span class="tfree">'a</span> expr <span class="main">⇒</span> <span class="tfree">'a</span> expr <span class="main">⇒</span> bool"</span></span>
    <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _ <span class="keyword1">⇛</span><span class="keyword3">/ </span>_"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">,</span>51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="entity">normalize_call</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> _ <span class="keyword1">⇛</span><span class="keyword3">/ </span>_"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">,</span>51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="entity">normalize_expr_list</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span> _ <span class="keyword1">⇛</span><span class="keyword3">/ </span>_"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">,</span>51<span class="main">]</span> 50<span class="main">)</span>
    <span class="keyword2"><span class="keyword">where</span></span>
 LiteralN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Literal <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">⇛</span></span> Literal <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span>ExplicitlyTypedLetN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">init<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">init<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Let <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">init<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> Let <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">init<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span>ImplicitlyTypedLetN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">init<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">init<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">init<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Let <span class="free"><span class="bound"><span class="entity">v</span></span></span> None <span class="free"><span class="bound"><span class="entity">init<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> Let <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">init<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span>VarN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Var <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">⇛</span></span> Var <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="main">|</span>IfN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> If <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> If <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>

<span class="main">|</span>MetaOperationCallN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> MetaOperationCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="main"><span class="free">⇛</span></span> MetaOperationCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span>"</span></span>
<span class="main">|</span>StaticOperationCallN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="free"><span class="bound"><span class="entity">params<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">params<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> StaticOperationCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">params<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> StaticOperationCall <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">params<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>

<span class="main">|</span>OclAnyDotCallN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> OclAny<span class="main">[?]</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> Tuple fmempty <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> DotCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> DotCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span>OclAnySafeDotCallN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   OclVoid<span class="main">[?]</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> to_required_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>3</sub></span></span></span> <span class="main">=</span> TypeOperationCall <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> DotCall OclAsTypeOp <span class="main">(</span>to_required_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> SafeDotCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span>
       If <span class="main">(</span>OperationCall <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> DotCall NotEqualOp <span class="main">[</span>NullLiteral<span class="main">]</span><span class="main">)</span>
          <span class="main">(</span>Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>3</sub></span></span></span> DotCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>
          NullLiteral"</span></span>
<span class="main">|</span>OclAnyArrowCallN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> OclAny<span class="main">[?]</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≤</span> Tuple fmempty <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>3</sub></span></span></span> <span class="main">=</span> OperationCall <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> DotCall OclAsSetOp <span class="main">[]</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>3</sub></span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>3</sub></span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>

<span class="main">|</span>CollectionArrowCallN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span>CollectionSafeArrowCallN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   OclVoid<span class="main">[?]</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>3</sub></span></span></span> <span class="main">=</span> TypeOperationCall <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> ArrowCall SelectByKindOp
              <span class="main">(</span>to_required_type <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>3</sub></span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> SafeArrowCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>3</sub></span></span></span> ArrowCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span>CollectionDotCallN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">it</span></span></span> <span class="main">=</span> new_vname <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> DotCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span>
    CollectIteratorCall <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> ArrowCall <span class="main">[</span><span class="free"><span class="bound"><span class="entity">it</span></span></span><span class="main">]</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">(</span>Call <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">it</span></span></span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span>CollectionSafeDotCallN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   OclVoid<span class="main">[?]</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> to_required_type <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>3</sub></span></span></span> <span class="main">=</span> TypeOperationCall <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>2</sub></span></span></span> ArrowCall SelectByKindOp <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">it</span></span></span> <span class="main">=</span> new_vname <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Call <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>1</sub></span></span></span> SafeDotCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span>
    CollectIteratorCall <span class="free"><span class="bound"><span class="entity">src<span class="hidden">⇩</span><sub>3</sub></span></span></span> ArrowCall <span class="main">[</span><span class="free"><span class="bound"><span class="entity">it</span></span></span><span class="main">]</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">(</span>Call <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">it</span></span></span><span class="main">)</span> DotCall <span class="free"><span class="bound"><span class="entity">call<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span>TypeOperationN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> TypeOperation <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span> <span class="main"><span class="free">⇛</span></span> TypeOperation <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">ty</span></span></span>"</span></span>
<span class="main">|</span>AttributeN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> Attribute <span class="free"><span class="bound"><span class="entity">attr</span></span></span> <span class="main"><span class="free">⇛</span></span> Attribute <span class="free"><span class="bound"><span class="entity">attr</span></span></span>"</span></span>
<span class="main">|</span>AssociationEndN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> AssociationEnd <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="main"><span class="free">⇛</span></span> AssociationEnd <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span>"</span></span>
<span class="main">|</span>AssociationClassN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> AssociationClass <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span> <span class="main"><span class="free">⇛</span></span> AssociationClass <span class="free"><span class="bound"><span class="entity">𝒜</span></span></span> <span class="free"><span class="bound"><span class="entity">from</span></span></span>"</span></span>
<span class="main">|</span>AssociationClassEndN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> AssociationClassEnd <span class="free"><span class="bound"><span class="entity">role</span></span></span> <span class="main"><span class="free">⇛</span></span> AssociationClassEnd <span class="free"><span class="bound"><span class="entity">role</span></span></span>"</span></span>
<span class="main">|</span>OperationN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="free"><span class="bound"><span class="entity">params<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">params<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> Operation <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">params<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> Operation <span class="free"><span class="bound"><span class="entity">op</span></span></span> <span class="free"><span class="bound"><span class="entity">params<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span>TupleElementN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> TupleElement <span class="free"><span class="bound"><span class="entity">elem</span></span></span> <span class="main"><span class="free">⇛</span></span> TupleElement <span class="free"><span class="bound"><span class="entity">elem</span></span></span>"</span></span>

<span class="main">|</span>ExplicitlyTypedIterateN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">++<span class="hidden">⇩</span><sub>f</sub></span> fmap_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">it</span><span class="main">.</span> <span class="main">(</span><span class="bound">it</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">)</span> <span class="main"><span class="free">⊢</span></span>
      Let <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">res_t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> Let <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">res_t<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> Iterate <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">res_t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span>
      Iterate <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">res_t<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span>ImplicitlyTypedIterateN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">++<span class="hidden">⇩</span><sub>f</sub></span> fmap_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">it</span><span class="main">.</span> <span class="main">(</span><span class="bound">it</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">)</span> <span class="main"><span class="free">⊢</span></span>
      Let <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">res_t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> Let <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">res_t<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> Iterate <span class="free"><span class="bound"><span class="entity">its</span></span></span> None <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">res_t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span>
      Iterate <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">res_t<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">res_init<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>

<span class="main">|</span>ExplicitlyTypedIteratorN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">++<span class="hidden">⇩</span><sub>f</sub></span> fmap_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">it</span><span class="main">.</span> <span class="main">(</span><span class="bound">it</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">)</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span>  <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> Iterator <span class="free"><span class="bound"><span class="entity">iter</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> Iterator <span class="free"><span class="bound"><span class="entity">iter</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span>ImplicitlyTypedIteratorN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"element_type <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">++<span class="hidden">⇩</span><sub>f</sub></span> fmap_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">it</span><span class="main">.</span> <span class="main">(</span><span class="bound">it</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">its</span></span></span><span class="main">)</span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span>  <span class="main">⟹</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>C</sub></span></span> Iterator <span class="free"><span class="bound"><span class="entity">iter</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> None <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⇛</span></span> Iterator <span class="free"><span class="bound"><span class="entity">iter</span></span></span> <span class="free"><span class="bound"><span class="entity">its</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">body<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>

<span class="main">|</span>ExprListNilN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">[]</span> <span class="main"><span class="free">⇛</span></span> <span class="main">[]</span>"</span></span>
<span class="main">|</span>ExprListConsN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main"><span class="free">⇛</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="comment1">(*** Elimination Rules ******************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Elimination Rules›</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> LiteralNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Literal <span class="free">a</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> LetNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Let <span class="free">v</span> <span class="free">t</span> <span class="free">init</span> <span class="free">body</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> VarNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Var <span class="free">v</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> IfNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> If <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⇛</span> <span class="free">d</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> MetaOperationCallNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> MetaOperationCall <span class="free">τ</span> <span class="free">op</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> StaticOperationCallNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> StaticOperationCall <span class="free">τ</span> <span class="free">op</span> <span class="free">as</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> DotCallNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Call <span class="free">src</span> DotCall <span class="free">call</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> SafeDotCallNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Call <span class="free">src</span> SafeDotCall <span class="free">call</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> ArrowCallNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Call <span class="free">src</span> ArrowCall <span class="free">call</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> SafeArrowCallNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Call <span class="free">src</span> SafeArrowCall <span class="free">call</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> CallNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">τ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">call</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> OperationCallNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">τ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> Operation <span class="free">op</span> <span class="free">as</span> <span class="main">⇛</span> <span class="free">call</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> IterateCallNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">τ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> Iterate <span class="free">its</span> <span class="free">its_ty</span> <span class="free">res</span> <span class="free">res_t</span> <span class="free">res_init</span> <span class="free">body</span> <span class="main">⇛</span> <span class="free">call</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> IteratorCallNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">τ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> Iterator <span class="free">iter</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">⇛</span> <span class="free">call</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> ExprListNE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">xs</span> <span class="main">⇛</span> <span class="free">ys</span>"</span></span>

<span class="comment1">(*** Simplification Rules ***************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Simplification Rules›</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span> normalize_alt_simps<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Literal <span class="free">a</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Let <span class="free">v</span> <span class="free">t</span> <span class="free">init</span> <span class="free">body</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Var <span class="free">v</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> If <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⇛</span> <span class="free">d</span>"</span></span>

<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> MetaOperationCall <span class="free">τ</span> <span class="free">op</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> StaticOperationCall <span class="free">τ</span> <span class="free">op</span> <span class="free">as</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Call <span class="free">src</span> DotCall <span class="free">call</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Call <span class="free">src</span> SafeDotCall <span class="free">call</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Call <span class="free">src</span> ArrowCall <span class="free">call</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Call <span class="free">src</span> SafeArrowCall <span class="free">call</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>

<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">τ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">call</span> <span class="main">⇛</span> <span class="free">b</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">τ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> Operation <span class="free">op</span> <span class="free">as</span> <span class="main">⇛</span> <span class="free">call</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">τ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> Iterate <span class="free">its</span> <span class="free">its_ty</span> <span class="free">res</span> <span class="free">res_t</span> <span class="free">res_init</span> <span class="free">body</span> <span class="main">⇛</span> <span class="free">call</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">τ</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> Iterator <span class="free">iter</span> <span class="free">its</span> <span class="free">its_ty</span> <span class="free">body</span> <span class="main">⇛</span> <span class="free">call</span>"</span></span>

<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">[]</span> <span class="main">⇛</span> <span class="free">ys</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">⇛</span> <span class="free">ys</span>"</span></span>

<span class="comment1">(*** Determinism ************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Determinism›</span></span>

<span class="keyword1" id="OCL_Normalization-any_has_not_element_type"><span class="command">lemma</span></span> any_has_not_element_type<span class="main">:</span>
  <span class="quoted"><span class="quoted">"element_type <span class="free">τ</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">≤</span> OclAny<span class="main">[?]</span> <span class="main">∨</span> <span class="free">τ</span> <span class="main">≤</span> Tuple fmempty <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> element_type.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Normalization-any_has_not_element_type'"><span class="command">lemma</span></span> any_has_not_element_type'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"element_type <span class="free">τ</span> <span class="free">σ</span> <span class="main">⟹</span> OclVoid<span class="main">[?]</span> <span class="main">≤</span> <span class="free">τ</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> element_type.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="OCL_Normalization-normalize_det"><span class="command">lemma</span></span>
  normalize_det<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">expr</span> <span class="main">⇛</span> <span class="free">expr<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
     <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">expr</span> <span class="main">⇛</span> <span class="free">expr<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">expr<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">expr<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  normalize_call_det<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">Γ_τ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">call</span> <span class="main">⇛</span> <span class="free">call<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
     <span class="free">Γ_τ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">call</span> <span class="main">⇛</span> <span class="free">call<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">call<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">call<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  normalize_expr_list_det<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">xs</span> <span class="main">⇛</span> <span class="free">ys</span> <span class="main">⟹</span>
     <span class="free">Γ</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">xs</span> <span class="main">⇛</span> <span class="free">zs</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">=</span> <span class="free">zs</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">Γ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ocl_object_model<span class="main">)</span> type env"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Γ_τ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ocl_object_model<span class="main">)</span> type env <span class="main">×</span> <span class="tfree">'a</span> type"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">expr<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">call<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free">zs</span></span>
       <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> normalize_normalize_call_normalize_expr_list.inducts<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LiteralN <span class="skolem">Γ</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExplicitlyTypedLetN <span class="skolem">Γ</span> <span class="skolem">init<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">init<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">v</span> <span class="skolem">τ</span> <span class="skolem">body<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">body<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImplicitlyTypedLetN <span class="skolem">Γ</span> <span class="skolem">init<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">init<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span> <span class="skolem">v</span> <span class="skolem">body<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">body<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LetNE option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> typing_det<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>VarN <span class="skolem">Γ</span> <span class="skolem">v</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IfN <span class="skolem">Γ</span> <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> IfN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> IfNE<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IfN.hyps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MetaOperationCallN <span class="skolem">Γ</span> <span class="skolem">τ</span> <span class="skolem">op</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StaticOperationCallN <span class="skolem">Γ</span> <span class="skolem">params<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">params<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span> <span class="skolem">op</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OclAnyDotCallN <span class="skolem">Γ</span> <span class="skolem">src<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">src<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span> <span class="skolem">call<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">call<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> OclAnyDotCallN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> DotCallNE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> OclAnyDotCallN.hyps typing_det <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">using</span></span> OclAnyDotCallN.hyps any_has_not_element_type typing_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OclAnySafeDotCallN <span class="skolem">Γ</span> <span class="skolem">src<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">src<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span> <span class="skolem">call<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">call<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> OclAnySafeDotCallN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> SafeDotCallNE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> OclAnySafeDotCallN.hyps typing_det comp_apply
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> OclAnySafeDotCallN.hyps typing_det any_has_not_element_type'
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OclAnyArrowCallN <span class="skolem">Γ</span> <span class="skolem">src<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">src<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span> <span class="skolem">src<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">σ</span> <span class="skolem">call<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">call<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> OclAnyArrowCallN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> ArrowCallNE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> OclAnyArrowCallN.hyps typing_det comp_apply <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">using</span></span> OclAnyArrowCallN.hyps typing_det any_has_not_element_type
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CollectionArrowCallN <span class="skolem">Γ</span> <span class="skolem">src<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">src<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span> <span class="skolem">uu</span> <span class="skolem">call<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">call<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> CollectionArrowCallN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> ArrowCallNE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> CollectionArrowCallN.hyps typing_det any_has_not_element_type
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">using</span></span> CollectionArrowCallN.hyps typing_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CollectionSafeArrowCallN <span class="skolem">Γ</span> <span class="skolem">src<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">src<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">src<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">ρ</span> <span class="skolem">call<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">call<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> CollectionSafeArrowCallN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> SafeArrowCallNE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> CollectionSafeArrowCallN.hyps typing_det element_type_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CollectionDotCallN <span class="skolem">Γ</span> <span class="skolem">src<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">src<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">call<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">call<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">it</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> CollectionDotCallN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> DotCallNE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> CollectionDotCallN.hyps typing_det any_has_not_element_type
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">using</span></span> CollectionDotCallN.hyps typing_det element_type_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CollectionSafeDotCallN <span class="skolem">Γ</span> <span class="skolem">src<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">src<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">src<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">call<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">call<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">it</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> CollectionSafeDotCallN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> SafeDotCallNE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> CollectionSafeDotCallN.hyps typing_det any_has_not_element_type'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">using</span></span> CollectionSafeDotCallN.hyps typing_det element_type_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TypeOperationN <span class="skolem">Γ</span> <span class="skolem">τ</span> <span class="skolem">op</span> <span class="skolem">ty</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AttributeN <span class="skolem">Γ</span> <span class="skolem">τ</span> <span class="skolem">attr</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AssociationEndN <span class="skolem">Γ</span> <span class="skolem">τ</span> <span class="skolem">role</span> <span class="quoted">"<span class="skolem">from</span>"</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AssociationClassN <span class="skolem">Γ</span> <span class="skolem">τ</span> <span class="skolem">𝒜</span> <span class="quoted">"<span class="skolem">from</span>"</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AssociationClassEndN <span class="skolem">Γ</span> <span class="skolem">τ</span> <span class="skolem">role</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OperationN <span class="skolem">Γ</span> <span class="skolem">params<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">params<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span> <span class="skolem">op</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TupleElementN <span class="skolem">Γ</span> <span class="skolem">τ</span> <span class="skolem">elem</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExplicitlyTypedIterateN
    <span class="skolem">Γ</span> <span class="skolem">res_init<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">res_init<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">σ</span> <span class="skolem">its</span> <span class="skolem">res</span> <span class="skolem">res_t<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">body<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">res_t<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">body<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ExplicitlyTypedIterateN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> IterateCallNE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ExplicitlyTypedIterateN.hyps element_type_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImplicitlyTypedIterateN
    <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">Γ</span> <span class="skolem">res_init<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">res_init<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">its</span> <span class="skolem">res</span> <span class="skolem">res_t<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">body<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">res_t<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">body<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ImplicitlyTypedIterateN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> IterateCallNE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ImplicitlyTypedIterateN.hyps element_type_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExplicitlyTypedIteratorN <span class="skolem">Γ</span> <span class="skolem">σ</span> <span class="skolem">its</span> <span class="skolem">body<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">body<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span> <span class="skolem">iter</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ExplicitlyTypedIteratorN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> IteratorCallNE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ExplicitlyTypedIteratorN.hyps element_type_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImplicitlyTypedIteratorN <span class="skolem">τ</span> <span class="skolem">σ</span> <span class="skolem">Γ</span> <span class="skolem">its</span> <span class="skolem">body<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">body<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">iter</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ImplicitlyTypedIteratorN.prems<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> IteratorCallNE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ImplicitlyTypedIteratorN.hyps element_type_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExprListNilN <span class="skolem">Γ</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> normalize_expr_list.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ExprListConsN <span class="skolem">Γ</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*** Normalized Expressions Typing ******************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Normalized Expressions Typing›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Here is the final typing rules.›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">nf_typing</span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span>_<span class="keyword3">/ </span><span class="keyword1">⊢</span><span class="keyword3">/ </span><span class="keyword3">(</span>_ <span class="keyword1">:</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">,</span>51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">expr</span></span></span> <span class="main">⇛</span> <span class="free"><span class="bound"><span class="entity">expr<span class="hidden">⇩</span><sub>N</sub></span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">expr<span class="hidden">⇩</span><sub>N</sub></span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">⟹</span>
   <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">expr</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>

<span class="keyword1" id="OCL_Normalization-nf_typing_det"><span class="command">lemma</span></span> nf_typing_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">expr</span> <span class="main">:</span> <span class="free">τ</span> <span class="main">⟹</span>
   <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">expr</span> <span class="main">:</span> <span class="free">σ</span> <span class="main">⟹</span> <span class="free">τ</span> <span class="main">=</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nf_typing.cases normalize_det typing_det<span class="main">)</span>

<span class="comment1">(*** Code Setup *************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Code Setup›</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">normalize</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">nf_typing</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">check_type</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">expr</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≡</span>
  Predicate.eval <span class="main">(</span>nf_typing_i_i_i <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">expr</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">()</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">synthesize_type</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">expr</span></span></span> <span class="main">≡</span>
  Predicate.singleton <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> OclInvalid<span class="main">)</span>
    <span class="main">(</span>Predicate.map errorable <span class="main">(</span>nf_typing_i_i_o <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">expr</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It is the only usage of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">OclInvalid</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> type.
  This type is not required to define typing rules.
  It is only required to make the typing function total.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="OCL_Examples">
<div class="head">
<h1>Theory OCL_Examples</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Safe OCL
    Author:      Denis Nikiforov, March 2019
    Maintainer:  Denis Nikiforov &lt;denis.nikif at gmail.com&gt;
    License:     LGPL
*)</span>
<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>
<span class="keyword1"><span class="command">theory</span></span> OCL_Examples
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#OCL_Normalization">OCL_Normalization</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*** Classes ****************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Classes›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> classes1 <span class="main">=</span>
  Object <span class="main">|</span> Person <span class="main">|</span> Employee <span class="main">|</span> Customer <span class="main">|</span> Project <span class="main">|</span> Task <span class="main">|</span> Sprint

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">subclass1</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≠</span> Object <span class="main">⟹</span>
   <span class="free">subclass1</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> Object"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subclass1</span> Employee Person"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subclass1</span> Customer Person"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> classes1 <span class="main">::</span> <span class="quoted">semilattice_sup</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span> <span class="main">≡</span> subclass1"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span> <span class="main">≡</span> subclass1<span class="main"><span class="hidden">⇧</span><sup>=</sup><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">sup_classes1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"Object <span class="main">⊔</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Object"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Person <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Person <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Employee <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Customer
    <span class="keyword1">then</span> Person <span class="keyword1">else</span> Object<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Employee <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Employee <span class="keyword1">then</span> Employee <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Person <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Customer <span class="keyword1">then</span> Person <span class="keyword1">else</span> Object<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Customer <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Customer <span class="keyword1">then</span> Customer <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Person <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Employee <span class="keyword1">then</span> Person <span class="keyword1">else</span> Object<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Project <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Project <span class="keyword1">then</span> Project <span class="keyword1">else</span> Object<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Task <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Task <span class="keyword1">then</span> Task <span class="keyword1">else</span> Object<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Sprint <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Sprint <span class="keyword1">then</span> Sprint <span class="keyword1">else</span> Object<span class="main">)</span>"</span></span>

<span class="keyword1" id="OCL_Examples-less_le_not_le_classes1"><span class="command">lemma</span></span> less_le_not_le_classes1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">c</span> <span class="free">d</span> <span class="main">::</span> <span class="quoted">classes1</span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_classes1_def less_eq_classes1_def
  <span class="keyword1"><span class="command">using</span></span> subclass1.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Examples-order_refl_classes1"><span class="command">lemma</span></span> order_refl_classes1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">classes1</span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_eq_classes1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="OCL_Examples-order_trans_classes1"><span class="command">lemma</span></span> order_trans_classes1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="main">::</span> <span class="quoted">classes1</span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_eq_classes1_def
  <span class="keyword1"><span class="command">using</span></span> subclass1.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Examples-antisym_classes1"><span class="command">lemma</span></span> antisym_classes1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">c</span> <span class="free">d</span> <span class="main">::</span> <span class="quoted">classes1</span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_eq_classes1_def
  <span class="keyword1"><span class="command">using</span></span> subclass1.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Examples-sup_ge1_classes1"><span class="command">lemma</span></span> sup_ge1_classes1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⊔</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">c</span> <span class="free">d</span> <span class="main">::</span> <span class="quoted">classes1</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_classes1_def less_classes1_def subclass1.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Examples-sup_ge2_classes1"><span class="command">lemma</span></span> sup_ge2_classes1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⊔</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">c</span> <span class="free">d</span> <span class="main">::</span> <span class="quoted">classes1</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_classes1_def less_classes1_def subclass1.simps<span class="main">)</span>

<span class="keyword1" id="OCL_Examples-sup_least_classes1"><span class="command">lemma</span></span> sup_least_classes1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">⊔</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">c</span> <span class="free">d</span> <span class="free">e</span> <span class="main">::</span> <span class="quoted">classes1</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">d</span></span><span class="main"><span class="keyword3">;</span></span>
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_classes1_def less_classes1_def subclass1.simps<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le_not_le_classes1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_refl_classes1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans_classes1<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym_classes1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_ge1_classes1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_ge2_classes1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_least_classes1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">subclass1</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subclass1_fun</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subclass1_fun</span> Object <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subclass1_fun</span> Person <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> Object<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subclass1_fun</span> Employee <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> Object <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> Person<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subclass1_fun</span> Customer <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> Object <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> Person<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subclass1_fun</span> Project <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> Object<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subclass1_fun</span> Task <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> Object<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subclass1_fun</span> Sprint <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">=</span> Object<span class="main">)</span>"</span></span>

<span class="keyword1" id="OCL_Examples-less_classes1_code"><span class="command">lemma</span></span> less_classes1_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span> <span class="main">=</span> subclass1_fun"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝒞</span> <span class="skolem">𝒟</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"classes1"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒞</span> <span class="main">&lt;</span> <span class="skolem">𝒟</span> <span class="main">⟹</span> subclass1_fun <span class="skolem">𝒞</span> <span class="skolem">𝒟</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_classes1_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subclass1.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> subclass1_fun.elims<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subclass1_fun <span class="skolem">𝒞</span> <span class="skolem">𝒟</span> <span class="main">⟹</span> <span class="skolem">𝒞</span> <span class="main">&lt;</span> <span class="skolem">𝒟</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> subclass1_fun.elims<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_classes1_def subclass1.intros<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Examples-less_eq_classes1_code"><span class="command">lemma</span></span> less_eq_classes1_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(≤)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> subclass1_fun <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dual_order.order_iff_strict less_classes1_code
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*** Object Model ***********************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Object Model›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≡</span> fmempty <span class="main">::</span> classes1 type env"</span></span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"ObjectType <span class="main">::</span> classes1 <span class="main">⇒</span> classes1 basic_type"</span></span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"phantom <span class="main">::</span> String.literal <span class="main">⇒</span> classes1 enum"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">instantiation</span></span> classes1 <span class="main">::</span> <span class="quoted">ocl_object_model</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">classes_classes1</span></span> <span class="main">≡</span>
  <span class="main">{|</span>Object<span class="main">,</span> Person<span class="main">,</span> Employee<span class="main">,</span> Customer<span class="main">,</span> Project<span class="main">,</span> Task<span class="main">,</span> Sprint<span class="main">|}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">attributes_classes1</span></span> <span class="main">≡</span> fmap_of_list <span class="main">[</span>
  <span class="main">(</span>Person<span class="main">,</span> fmap_of_list <span class="main">[</span>
    <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''name''</span><span class="main">,</span> String<span class="main">[1]</span> <span class="main">::</span> classes1 type<span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span>Employee<span class="main">,</span> fmap_of_list <span class="main">[</span>
    <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''name''</span><span class="main">,</span> String<span class="main">[1]</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''position''</span><span class="main">,</span> String<span class="main">[1]</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span>Customer<span class="main">,</span> fmap_of_list <span class="main">[</span>
    <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''vip''</span><span class="main">,</span> Boolean<span class="main">[1]</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span>Project<span class="main">,</span> fmap_of_list <span class="main">[</span>
    <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''name''</span><span class="main">,</span> String<span class="main">[1]</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''cost''</span><span class="main">,</span> Real<span class="main">[?]</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span>Task<span class="main">,</span> fmap_of_list <span class="main">[</span>
    <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''description''</span><span class="main">,</span> String<span class="main">[1]</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">assocs</span> <span class="main">≡</span> <span class="main">[</span>
  <span class="keyword1">STR</span> <span class="inner_quoted">''ProjectManager''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''projects''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Project<span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">,</span> <span class="main">∞</span><span class="main">::</span>enat<span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span><span class="main">,</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''manager''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Employee<span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> False<span class="main">,</span> False<span class="main">)</span><span class="main">]</span><span class="main">,</span>
  <span class="keyword1">STR</span> <span class="inner_quoted">''ProjectMember''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''member_of''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Project<span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">∞</span><span class="main">,</span> False<span class="main">,</span> False<span class="main">)</span><span class="main">,</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''members''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Employee<span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">20</span><span class="main">,</span> True<span class="main">,</span> True<span class="main">)</span><span class="main">]</span><span class="main">,</span>
  <span class="keyword1">STR</span> <span class="inner_quoted">''ManagerEmployee''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''line_manager''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Employee<span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> False<span class="main">,</span> False<span class="main">)</span><span class="main">,</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''project_manager''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Employee<span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">∞</span><span class="main">,</span> False<span class="main">,</span> False<span class="main">)</span><span class="main">,</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''employees''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Employee<span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> False<span class="main">,</span> False<span class="main">)</span><span class="main">]</span><span class="main">,</span>
  <span class="keyword1">STR</span> <span class="inner_quoted">''ProjectCustomer''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''projects''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Project<span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">∞</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span><span class="main">,</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''customer''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Customer<span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> False<span class="main">,</span> False<span class="main">)</span><span class="main">]</span><span class="main">,</span>
  <span class="keyword1">STR</span> <span class="inner_quoted">''ProjectTask''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''project''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Project<span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> False<span class="main">,</span> False<span class="main">)</span><span class="main">,</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''tasks''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Task<span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">∞</span><span class="main">,</span> True<span class="main">,</span> True<span class="main">)</span><span class="main">]</span><span class="main">,</span>
  <span class="keyword1">STR</span> <span class="inner_quoted">''SprintTaskAssignee''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">[</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''sprint''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Sprint<span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="numeral">10</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span><span class="main">,</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''tasks''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Task<span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span><span class="main">,</span>
    <span class="keyword1">STR</span> <span class="inner_quoted">''assignee''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>Employee<span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> False<span class="main">,</span> False<span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">associations_classes1</span></span> <span class="main">≡</span> assocs"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">association_classes_classes1</span></span> <span class="main">≡</span> fmempty <span class="main">::</span> classes1 <span class="keyword1">⇀<span class="hidden">⇩</span><sub>f</sub></span> assoc"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\begin{verbatim}
context Project
def: membersCount() : Integer[1] = members-&gt;size()
def: membersByName(mn : String[1]) : Set(Employee[1]) =
       members-&gt;select(member | member.name = mn)
static def: allProjects() : Set(Project[1]) =
              Project[1].allInstances()
\end{verbatim}›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">operations_classes1</span></span> <span class="main">≡</span> <span class="main">[</span>
  <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''membersCount''</span><span class="main">,</span> Project<span class="main">[1]</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> Integer<span class="main">[1]</span><span class="main">,</span> False<span class="main">,</span>
   Some <span class="main">(</span>OperationCall
    <span class="main">(</span>AssociationEndCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''self''</span><span class="main">)</span> DotCall None <span class="keyword1">STR</span> <span class="inner_quoted">''members''</span><span class="main">)</span>
    ArrowCall CollectionSizeOp <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''membersByName''</span><span class="main">,</span> Project<span class="main">[1]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''mn''</span><span class="main">,</span> String<span class="main">[1]</span><span class="main">,</span> In<span class="main">)</span><span class="main">]</span><span class="main">,</span>
    Set Employee<span class="main">[1]</span><span class="main">,</span> False<span class="main">,</span>
   Some <span class="main">(</span>SelectIteratorCall
    <span class="main">(</span>AssociationEndCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''self''</span><span class="main">)</span> DotCall None <span class="keyword1">STR</span> <span class="inner_quoted">''members''</span><span class="main">)</span>
    ArrowCall <span class="main">[</span><span class="keyword1">STR</span> <span class="inner_quoted">''member''</span><span class="main">]</span> None
    <span class="main">(</span>OperationCall
      <span class="main">(</span>AttributeCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''member''</span><span class="main">)</span> DotCall <span class="keyword1">STR</span> <span class="inner_quoted">''name''</span><span class="main">)</span>
      DotCall EqualOp <span class="main">[</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''mn''</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''allProjects''</span><span class="main">,</span> Project<span class="main">[1]</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> Set Project<span class="main">[1]</span><span class="main">,</span> True<span class="main">,</span>
   Some <span class="main">(</span>MetaOperationCall Project<span class="main">[1]</span> AllInstancesOp<span class="main">)</span><span class="main">)</span>
  <span class="main">]</span> <span class="main">::</span> <span class="main">(</span>classes1 type<span class="main">,</span> classes1 expr<span class="main">)</span> oper_spec list"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">literals_classes1</span></span> <span class="main">≡</span> fmap_of_list <span class="main">[</span>
  <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''E1''</span> <span class="main">::</span> classes1 enum<span class="main">,</span> <span class="main">{|</span><span class="keyword1">STR</span> <span class="inner_quoted">''A''</span><span class="main">,</span> <span class="keyword1">STR</span> <span class="inner_quoted">''B''</span><span class="main">|}</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''E2''</span><span class="main">,</span> <span class="main">{|</span><span class="keyword1">STR</span> <span class="inner_quoted">''C''</span><span class="main">,</span> <span class="keyword1">STR</span> <span class="inner_quoted">''D''</span><span class="main">,</span> <span class="keyword1">STR</span> <span class="inner_quoted">''E''</span><span class="main">|}</span><span class="main">)</span><span class="main">]</span>"</span></span>


<span class="keyword1" id="OCL_Examples-assoc_end_min_less_eq_max"><span class="command">lemma</span></span> assoc_end_min_less_eq_max<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">assoc</span> <span class="main">|∈|</span> fmdom assocs <span class="main">⟹</span>
   fmlookup assocs <span class="free">assoc</span> <span class="main">=</span> Some <span class="free">ends</span> <span class="main">⟹</span>
   <span class="free">role</span> <span class="main">|∈|</span> fmdom <span class="free">ends</span>  <span class="main">⟹</span>
   fmlookup <span class="free">ends</span> <span class="free">role</span> <span class="main">=</span> Some <span class="free">end</span> <span class="main">⟹</span>
   assoc_end_min <span class="free">end</span> <span class="main">≤</span> assoc_end_max <span class="free">end</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> assoc_end_min_def assoc_end_max_def
  <span class="keyword1"><span class="command">using</span></span> zero_enat_def one_enat_def numeral_eq_enat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="OCL_Examples-association_ends_unique"><span class="command">lemma</span></span> association_ends_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"association_ends' classes assocs <span class="free">𝒞</span> <span class="free">from</span> <span class="free">role</span> <span class="free">end<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"association_ends' classes assocs <span class="free">𝒞</span> <span class="free">from</span> <span class="free">role</span> <span class="free">end<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">end<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">end<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> association_ends_not_unique' classes assocs"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> association_ends_not_unique'.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command">unfolding</span></span> associations_classes1_def
  <span class="keyword1"><span class="command">using</span></span> assoc_end_min_less_eq_max <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> association_ends_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*** Simplification Rules ***************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Simplification Rules›</span></span>

<span class="keyword1" id="OCL_Examples-ex_alt_simps"><span class="command">lemma</span></span> ex_alt_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">a</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">declare</span></span> numeral_eq_enat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> basic_type_le_less <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> Orderings.order_class.le_less
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> basic_type"</span></span>

<span class="keyword1"><span class="command">declare</span></span> element_type_alt_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> update_element_type.simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> to_unique_collection.simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> to_nonunique_collection.simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> to_ordered_collection.simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> assoc_end_class_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> assoc_end_min_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> assoc_end_max_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> assoc_end_ordered_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> assoc_end_unique_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> oper_name_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> oper_context_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> oper_params_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> oper_result_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> oper_static_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> oper_body_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> oper_in_params_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> oper_out_params_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> assoc_end_type_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> oper_type_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> op_type_alt_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> typing_alt_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> normalize_alt_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> nf_typing.simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> subclass1.intros <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> less_classes1_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> literals_classes1_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1" id="OCL_Examples-attribute_Employee_name"><span class="command">lemma</span></span> attribute_Employee_name <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"attribute Employee <span class="keyword1">STR</span> <span class="inner_quoted">''name''</span> <span class="free">𝒟</span> <span class="free">τ</span> <span class="main">=</span>
   <span class="main">(</span><span class="free">𝒟</span> <span class="main">=</span> Employee <span class="main">∧</span> <span class="free">τ</span> <span class="main">=</span> String<span class="main">[1]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"attribute Employee <span class="keyword1">STR</span> <span class="inner_quoted">''name''</span> Employee String<span class="main">[1]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> attribute_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Examples-association_end_Project_members"><span class="command">lemma</span></span> association_end_Project_members <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"association_end Project None <span class="keyword1">STR</span> <span class="inner_quoted">''members''</span> <span class="free">𝒟</span> <span class="free">τ</span> <span class="main">=</span>
   <span class="main">(</span><span class="free">𝒟</span> <span class="main">=</span> Project <span class="main">∧</span> <span class="free">τ</span> <span class="main">=</span> <span class="main">(</span>Employee<span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">20</span><span class="main">,</span> True<span class="main">,</span> True<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"association_end Project None <span class="keyword1">STR</span> <span class="inner_quoted">''members''</span>
          Project <span class="main">(</span>Employee<span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">20</span><span class="main">,</span> True<span class="main">,</span> True<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> association_end_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Examples-association_end_Employee_projects_simp"><span class="command">lemma</span></span> association_end_Employee_projects_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"association_end Employee None <span class="keyword1">STR</span> <span class="inner_quoted">''projects''</span> <span class="free">𝒟</span> <span class="free">τ</span> <span class="main">=</span>
   <span class="main">(</span><span class="free">𝒟</span> <span class="main">=</span> Employee <span class="main">∧</span> <span class="free">τ</span> <span class="main">=</span> <span class="main">(</span>Project<span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">∞</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"association_end Employee None <span class="keyword1">STR</span> <span class="inner_quoted">''projects''</span>
          Employee <span class="main">(</span>Project<span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">∞</span><span class="main">,</span> False<span class="main">,</span> True<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> association_end_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OCL_Examples-static_operation_Project_allProjects"><span class="command">lemma</span></span> static_operation_Project_allProjects <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"static_operation <span class="main">⟨</span>Project<span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span> <span class="keyword1">STR</span> <span class="inner_quoted">''allProjects''</span> <span class="main">[]</span> <span class="free">oper</span> <span class="main">=</span>
   <span class="main">(</span><span class="free">oper</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''allProjects''</span><span class="main">,</span> <span class="main">⟨</span>Project<span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> Set <span class="main">⟨</span>Project<span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span><span class="main">,</span> True<span class="main">,</span>
     Some <span class="main">(</span>MetaOperationCall <span class="main">⟨</span>Project<span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span> AllInstancesOp<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"static_operation <span class="main">⟨</span>Project<span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span> <span class="keyword1">STR</span> <span class="inner_quoted">''allProjects''</span> <span class="main">[]</span>
    <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''allProjects''</span><span class="main">,</span> <span class="main">⟨</span>Project<span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span><span class="main">,</span> <span class="main">[]</span><span class="main">,</span> Set <span class="main">⟨</span>Project<span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span><span class="main">,</span> True<span class="main">,</span>
     Some <span class="main">(</span>MetaOperationCall <span class="main">⟨</span>Project<span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span><span class="main">[1]</span> AllInstancesOp<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> static_operation_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*** Basic Types ************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Basic Types›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Positive Cases›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"UnlimitedNatural <span class="main">&lt;</span> <span class="main">(</span>Real <span class="main">::</span> classes1 basic_type<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>Employee<span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">&lt;</span> <span class="main">⟨</span>Person<span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>Person<span class="keyword1">⟩<span class="hidden">⇩</span><sub>𝒯</sub></span> <span class="main">≤</span> OclAny"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Negative Cases›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> String <span class="main">≤</span> <span class="main">(</span>Boolean <span class="main">::</span> classes1 basic_type<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(*** Types ******************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Types›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Positive Cases›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Integer<span class="main">[?]</span> <span class="main">&lt;</span> <span class="main">(</span>OclSuper <span class="main">::</span> classes1 type<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Collection Real<span class="main">[?]</span> <span class="main">&lt;</span> <span class="main">(</span>OclSuper <span class="main">::</span> classes1 type<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Set <span class="main">(</span>Collection Boolean<span class="main">[1]</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>OclSuper <span class="main">::</span> classes1 type<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Set <span class="main">(</span>Bag Boolean<span class="main">[1]</span><span class="main">)</span> <span class="main">&lt;</span> Set <span class="main">(</span>Collection Boolean<span class="main">[?]</span> <span class="main">::</span> classes1 type<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Tuple <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''a''</span><span class="main">,</span> Boolean<span class="main">[1]</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''b''</span><span class="main">,</span> Integer<span class="main">[1]</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">&lt;</span>
       Tuple <span class="main">(</span>fmap_of_list <span class="main">[</span><span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''a''</span><span class="main">,</span> Boolean<span class="main">[?]</span> <span class="main">::</span> classes1 type<span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Integer<span class="main">[1]</span> <span class="main">⊔</span> <span class="main">(</span>Real<span class="main">[?]</span> <span class="main">::</span> classes1 type<span class="main">)</span> <span class="main">=</span> Real<span class="main">[?]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Set Integer<span class="main">[1]</span> <span class="main">⊔</span> Set <span class="main">(</span>Real<span class="main">[1]</span> <span class="main">::</span> classes1 type<span class="main">)</span> <span class="main">=</span> Set Real<span class="main">[1]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Set Integer<span class="main">[1]</span> <span class="main">⊔</span> Bag <span class="main">(</span>Boolean<span class="main">[?]</span> <span class="main">::</span> classes1 type<span class="main">)</span> <span class="main">=</span> Collection OclAny<span class="main">[?]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Set Integer<span class="main">[1]</span> <span class="main">⊔</span> <span class="main">(</span>Real<span class="main">[1]</span> <span class="main">::</span> classes1 type<span class="main">)</span> <span class="main">=</span> OclSuper"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Negative Cases›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> OrderedSet Boolean<span class="main">[1]</span> <span class="main">&lt;</span> Set <span class="main">(</span>Boolean<span class="main">[1]</span> <span class="main">::</span> classes1 type<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(*** Typing *****************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Typing›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Positive Cases›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹E1::A : E1[1]›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> EnumLiteral <span class="keyword1">STR</span> <span class="inner_quoted">''E1''</span> <span class="keyword1">STR</span> <span class="inner_quoted">''A''</span> <span class="main">:</span> <span class="main">(</span>Enum <span class="keyword1">STR</span> <span class="inner_quoted">''E1''</span><span class="main">)</span><span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹true or false : Boolean[1]›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> OperationCall <span class="main">(</span>BooleanLiteral True<span class="main">)</span> DotCall OrOp
    <span class="main">[</span>BooleanLiteral False<span class="main">]</span> <span class="main">:</span> Boolean<span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹null and true : Boolean[?]›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> OperationCall <span class="main">(</span>NullLiteral<span class="main">)</span> DotCall AndOp
    <span class="main">[</span>BooleanLiteral True<span class="main">]</span> <span class="main">:</span> Boolean<span class="main">[?]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹let x : Real[1] = 5 in x + 7 : Real[1]›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> Let <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>Some Real<span class="main">[1]</span><span class="main">)</span> <span class="main">(</span>IntegerLiteral <span class="numeral">5</span><span class="main">)</span>
    <span class="main">(</span>OperationCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''x''</span><span class="main">)</span> DotCall PlusOp <span class="main">[</span>IntegerLiteral <span class="numeral">7</span><span class="main">]</span><span class="main">)</span> <span class="main">:</span> Real<span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹null.oclIsUndefined() : Boolean[1]›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> OperationCall <span class="main">(</span>NullLiteral<span class="main">)</span> DotCall OclIsUndefinedOp <span class="main">[]</span> <span class="main">:</span> Boolean<span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Sequence{1..5, null}.oclIsUndefined() : Sequence(Boolean[1])›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> OperationCall <span class="main">(</span>CollectionLiteral SequenceKind
    <span class="main">[</span>CollectionRange <span class="main">(</span>IntegerLiteral <span class="main">1</span><span class="main">)</span> <span class="main">(</span>IntegerLiteral <span class="numeral">5</span><span class="main">)</span><span class="main">,</span>
     CollectionItem NullLiteral<span class="main">]</span><span class="main">)</span>
    DotCall OclIsUndefinedOp <span class="main">[]</span> <span class="main">:</span> Sequence Boolean<span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Sequence{1..5}-&gt;product(Set{'a', 'b'})
  : Set(Tuple(first: Integer[1], second: String[1]))›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> OperationCall <span class="main">(</span>CollectionLiteral SequenceKind
    <span class="main">[</span>CollectionRange <span class="main">(</span>IntegerLiteral <span class="main">1</span><span class="main">)</span> <span class="main">(</span>IntegerLiteral <span class="numeral">5</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>
    ArrowCall ProductOp
    <span class="main">[</span>CollectionLiteral SetKind
      <span class="main">[</span>CollectionItem <span class="main">(</span>StringLiteral <span class="inner_quoted">''a''</span><span class="main">)</span><span class="main">,</span>
       CollectionItem <span class="main">(</span>StringLiteral <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">]</span><span class="main">]</span> <span class="main">:</span>
    Set <span class="main">(</span>Tuple <span class="main">(</span>fmap_of_list <span class="main">[</span>
      <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''first''</span><span class="main">,</span> Integer<span class="main">[1]</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''second''</span><span class="main">,</span> String<span class="main">[1]</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Sequence{1..5, null}?-&gt;iterate(x, acc : Real[1] = 0 | acc + x)
  : Real[1]›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> IterateCall <span class="main">(</span>CollectionLiteral SequenceKind
    <span class="main">[</span>CollectionRange <span class="main">(</span>IntegerLiteral <span class="main">1</span><span class="main">)</span> <span class="main">(</span>IntegerLiteral <span class="numeral">5</span><span class="main">)</span><span class="main">,</span>
     CollectionItem NullLiteral<span class="main">]</span><span class="main">)</span> SafeArrowCall
    <span class="main">[</span><span class="keyword1">STR</span> <span class="inner_quoted">''x''</span><span class="main">]</span> None
    <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''acc''</span><span class="main">)</span> <span class="main">(</span>Some Real<span class="main">[1]</span><span class="main">)</span> <span class="main">(</span>IntegerLiteral <span class="main">0</span><span class="main">)</span>
    <span class="main">(</span>OperationCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''acc''</span><span class="main">)</span> DotCall PlusOp <span class="main">[</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''x''</span><span class="main">]</span><span class="main">)</span> <span class="main">:</span> Real<span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Sequence{1..5, null}?-&gt;max() : Integer[1]›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> OperationCall <span class="main">(</span>CollectionLiteral SequenceKind
    <span class="main">[</span>CollectionRange <span class="main">(</span>IntegerLiteral <span class="main">1</span><span class="main">)</span> <span class="main">(</span>IntegerLiteral <span class="numeral">5</span><span class="main">)</span><span class="main">,</span>
     CollectionItem NullLiteral<span class="main">]</span><span class="main">)</span>
    SafeArrowCall CollectionMaxOp <span class="main">[]</span> <span class="main">:</span> Integer<span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹let x : Sequence(String[?]) = Sequence{'abc', 'zxc'} in
x-&gt;any(it | it = 'test') : String[?]›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> Let <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>Sequence String<span class="main">[?]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>CollectionLiteral SequenceKind
      <span class="main">[</span>CollectionItem <span class="main">(</span>StringLiteral <span class="inner_quoted">''abc''</span><span class="main">)</span><span class="main">,</span>
       CollectionItem <span class="main">(</span>StringLiteral <span class="inner_quoted">''zxc''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>
    <span class="main">(</span>AnyIteratorCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''x''</span><span class="main">)</span> ArrowCall
      <span class="main">[</span><span class="keyword1">STR</span> <span class="inner_quoted">''it''</span><span class="main">]</span> None
      <span class="main">(</span>OperationCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''it''</span><span class="main">)</span> DotCall EqualOp
        <span class="main">[</span>StringLiteral <span class="inner_quoted">''test''</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> String<span class="main">[?]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹let x : Sequence(String[?]) = Sequence{'abc', 'zxc'} in
x?-&gt;closure(it | it) : OrderedSet(String[1])›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> Let <span class="keyword1">STR</span> <span class="inner_quoted">''x''</span> <span class="main">(</span>Some <span class="main">(</span>Sequence String<span class="main">[?]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>CollectionLiteral SequenceKind
      <span class="main">[</span>CollectionItem <span class="main">(</span>StringLiteral <span class="inner_quoted">''abc''</span><span class="main">)</span><span class="main">,</span>
       CollectionItem <span class="main">(</span>StringLiteral <span class="inner_quoted">''zxc''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>
    <span class="main">(</span>ClosureIteratorCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''x''</span><span class="main">)</span> SafeArrowCall
      <span class="main">[</span><span class="keyword1">STR</span> <span class="inner_quoted">''it''</span><span class="main">]</span> None
      <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''it''</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> OrderedSet String<span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹context Employee:
name : String[1]›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub><span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''self''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> Employee<span class="main">[1]</span><span class="main">)</span> <span class="main">⊢</span>
    AttributeCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''self''</span><span class="main">)</span> DotCall <span class="keyword1">STR</span> <span class="inner_quoted">''name''</span> <span class="main">:</span> String<span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹context Employee:
projects : Set(Project[1])›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub><span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''self''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> Employee<span class="main">[1]</span><span class="main">)</span> <span class="main">⊢</span>
    AssociationEndCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''self''</span><span class="main">)</span> DotCall None
      <span class="keyword1">STR</span> <span class="inner_quoted">''projects''</span> <span class="main">:</span> Set Project<span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹context Employee:
projects.members : Bag(Employee[1])›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub><span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''self''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> Employee<span class="main">[1]</span><span class="main">)</span> <span class="main">⊢</span>
    AssociationEndCall <span class="main">(</span>AssociationEndCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''self''</span><span class="main">)</span>
        DotCall None <span class="keyword1">STR</span> <span class="inner_quoted">''projects''</span><span class="main">)</span>
      DotCall None <span class="keyword1">STR</span> <span class="inner_quoted">''members''</span> <span class="main">:</span> Bag Employee<span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Project[?].allInstances() : Set(Project[?])›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> MetaOperationCall Project<span class="main">[?]</span> AllInstancesOp <span class="main">:</span> Set Project<span class="main">[?]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Project[1]::allProjects() : Set(Project[1])›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> StaticOperationCall Project<span class="main">[1]</span> <span class="keyword1">STR</span> <span class="inner_quoted">''allProjects''</span> <span class="main">[]</span> <span class="main">:</span> Set Project<span class="main">[1]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Negative Cases›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹true = null›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">τ</span><span class="main">.</span> Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> OperationCall <span class="main">(</span>BooleanLiteral True<span class="main">)</span> DotCall EqualOp
    <span class="main">[</span>NullLiteral<span class="main">]</span> <span class="main">:</span> <span class="bound">τ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹let x : Boolean[1] = 5 in x and true›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">τ</span><span class="main">.</span> Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> Let <span class="keyword1">STR</span> <span class="inner_quoted">''x''</span> <span class="main">(</span>Some Boolean<span class="main">[1]</span><span class="main">)</span> <span class="main">(</span>IntegerLiteral <span class="numeral">5</span><span class="main">)</span>
    <span class="main">(</span>OperationCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''x''</span><span class="main">)</span> DotCall AndOp <span class="main">[</span>BooleanLiteral True<span class="main">]</span><span class="main">)</span> <span class="main">:</span> <span class="bound">τ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹let x : Sequence(String[?]) = Sequence{'abc', 'zxc'} in
x-&gt;closure(it | 1)›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">τ</span><span class="main">.</span> Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> Let <span class="keyword1">STR</span> <span class="inner_quoted">''x''</span> <span class="main">(</span>Some <span class="main">(</span>Sequence String<span class="main">[?]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>CollectionLiteral SequenceKind
      <span class="main">[</span>CollectionItem <span class="main">(</span>StringLiteral <span class="inner_quoted">''abc''</span><span class="main">)</span><span class="main">,</span>
       CollectionItem <span class="main">(</span>StringLiteral <span class="inner_quoted">''zxc''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>
    <span class="main">(</span>ClosureIteratorCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''x''</span><span class="main">)</span> ArrowCall <span class="main">[</span><span class="keyword1">STR</span> <span class="inner_quoted">''it''</span><span class="main">]</span> None
      <span class="main">(</span>IntegerLiteral <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="bound">τ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Sequence{1..5, null}-&gt;max()›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">τ</span><span class="main">.</span> Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> OperationCall <span class="main">(</span>CollectionLiteral SequenceKind
    <span class="main">[</span>CollectionRange <span class="main">(</span>IntegerLiteral <span class="main">1</span><span class="main">)</span> <span class="main">(</span>IntegerLiteral <span class="numeral">5</span><span class="main">)</span><span class="main">,</span>
     CollectionItem NullLiteral<span class="main">]</span><span class="main">)</span>
    ArrowCall CollectionMaxOp <span class="main">[]</span> <span class="main">:</span> <span class="bound">τ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> operation_defined <span class="main">(</span>Integer<span class="main">[?]</span> <span class="main">::</span> classes1 type<span class="main">)</span> <span class="keyword1">STR</span> <span class="inner_quoted">''max''</span> <span class="main">[</span>Integer<span class="main">[?]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*** Code *******************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Code›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Positive Cases›</span></span>

<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">𝒟</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">.</span> attribute Employee <span class="keyword1">STR</span> <span class="inner_quoted">''name''</span> <span class="bound">𝒟</span> <span class="bound">τ</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">𝒟</span><span class="main">,</span> <span class="bound">end</span><span class="main">)</span><span class="main">.</span> association_end Employee None <span class="keyword1">STR</span> <span class="inner_quoted">''employees''</span> <span class="bound">𝒟</span> <span class="bound">end</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">𝒟</span><span class="main">,</span> <span class="bound">end</span><span class="main">)</span><span class="main">.</span> association_end Employee <span class="main">(</span>Some <span class="keyword1">STR</span> <span class="inner_quoted">''project_manager''</span><span class="main">)</span> <span class="keyword1">STR</span> <span class="inner_quoted">''employees''</span> <span class="bound">𝒟</span> <span class="bound">end</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">op</span><span class="main">.</span> operation Project<span class="main">[1]</span> <span class="keyword1">STR</span> <span class="inner_quoted">''membersCount''</span> <span class="main">[]</span> <span class="bound">op</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">op</span><span class="main">.</span> operation Project<span class="main">[1]</span> <span class="keyword1">STR</span> <span class="inner_quoted">''membersByName''</span> <span class="main">[</span>String<span class="main">[1]</span><span class="main">]</span> <span class="bound">op</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"has_literal <span class="keyword1">STR</span> <span class="inner_quoted">''E1''</span> <span class="keyword1">STR</span> <span class="inner_quoted">''A''</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹context Employee:
projects.members : Bag(Employee[1])›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">values</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">τ</span><span class="main">.</span> Γ<span class="hidden">⇩</span><sub>0</sub><span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''self''</span> <span class="keyword1">↦<span class="hidden">⇩</span><sub>f</sub></span> Employee<span class="main">[1]</span><span class="main">)</span> <span class="main">⊢</span>
    AssociationEndCall <span class="main">(</span>AssociationEndCall <span class="main">(</span>Var <span class="keyword1">STR</span> <span class="inner_quoted">''self''</span><span class="main">)</span>
        DotCall None <span class="keyword1">STR</span> <span class="inner_quoted">''projects''</span><span class="main">)</span>
      DotCall None <span class="keyword1">STR</span> <span class="inner_quoted">''members''</span> <span class="main">:</span> <span class="bound">τ</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Negative Cases›</span></span>

<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">𝒟</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">.</span> attribute Employee <span class="keyword1">STR</span> <span class="inner_quoted">''name2''</span> <span class="bound">𝒟</span> <span class="bound">τ</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"has_literal <span class="keyword1">STR</span> <span class="inner_quoted">''E1''</span> <span class="keyword1">STR</span> <span class="inner_quoted">''C''</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Sequence{1..5, null}-&gt;max()›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">values</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">τ</span><span class="main">.</span> Γ<span class="hidden">⇩</span><sub>0</sub> <span class="main">⊢</span> OperationCall <span class="main">(</span>CollectionLiteral SequenceKind
    <span class="main">[</span>CollectionRange <span class="main">(</span>IntegerLiteral <span class="main">1</span><span class="main">)</span> <span class="main">(</span>IntegerLiteral <span class="numeral">5</span><span class="main">)</span><span class="main">,</span>
      CollectionItem NullLiteral<span class="main">]</span><span class="main">)</span>
    ArrowCall CollectionMaxOp <span class="main">[]</span> <span class="main">:</span> <span class="bound">τ</span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>