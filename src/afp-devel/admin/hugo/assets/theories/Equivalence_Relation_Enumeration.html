<div id='Equivalence_Relation_Enumeration'>title>
</head>


<body>
<div class="head">
<h1>Theory Equivalence_Relation_Enumeration</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Introduction</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><span>Equivalence_Relation_Enumeration</span><span>
  </span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><span class="quoted"><span>"</span><a href="../../HOL/HOL-Library/Sublist.html"><span>HOL-Library.Sublist</span></a><span>"</span></span><span> </span><span class="quoted"><span>"</span><a href="../../HOL/HOL-Library/Disjoint_Sets.html"><span>HOL-Library.Disjoint_Sets</span></a><span>"</span></span><span>
    </span><span class="quoted"><span>"</span><a href="../Card_Equiv_Relations/Card_Equiv_Relations.html"><span>Card_Equiv_Relations.Card_Equiv_Relations</span></a><span>"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>As mentioned in the abstract the enumeration algorithm relies on the bijection between
</span><span>restricted growth functions (RGFs) of length </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> and the equivalence relations on
</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>, where the bijection is the operation that forms the equivalence kernels of an RGF.
</span><span>The method is being dicussed, for example, by~\cite{hutchinson1963, milne1977} or
</span><span>\cite[\textsection 1.5]{white1986}.
</span><span>
</span><span>An enumeration algorithm for RGFs is less convoluted than one for equivalence relations or
</span><span>partitions and the representation has the advantage that checking whether a pair of elements are
</span><span>equivalent can be done by performing two list lookup operations.
</span><span>
</span><span>After a few preliminary results in the following section, Section~\ref{sec:enum_rgf} introduces the
</span><span>enumeration algorithm for RGFs and shows that the function enumerates all of them (for the given
</span><span>length) without repetition. Section~\ref{sec:bij_kernel} shows that the operation of forming the 
</span><span>equivalence kernel is a bijection and concludes with the correctness of the entire algorithm. In
</span><span>Section~\ref{sec:app} an interesting application is being discussed, where the enumeration of
</span><span>partitions is applied within a proof. Section~\ref{sec:add} contains a few additional results,
</span><span>such as the fact that the length of the enumerated list is a Bell number. The latter result relies
</span><span>on the formalization of the cardinality of equivalence relations by
</span><span>Bulwahn~\cite{Card_Equiv_Relations-AFP}.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Preliminary Results</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>This section contains a few preliminary results used in the proofs below.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.length_filter|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.length_filter|thm"><span>length_filter</span></span></span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>sum_list</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span>of_bool</span><span> </span><span class="main"><span>(</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.count_list_expand|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.count_list_expand|thm"><span>count_list_expand</span></span></span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>count_list</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(=)</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>An induction schema (similar to </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> [</span><span>source</span><span>] </span><span>list_induct2</span><span class="antiquote"><span>}</span></span></span><span> and </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> [</span><span>source</span><span>] </span><span>rev_induct</span><span class="antiquote"><span>}</span></span></span><span>) 
</span><span>for two lists of equal length, where induction step is shown appending elements at the end.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_2146..2151">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.list_induct_2_rev|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.list_induct_2_rev|thm"><span>list_induct_2_rev</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>consumes</span></span><span> 1</span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>case_names</span></span><span> Nil Cons</span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><span>[]</span></span><span> </span><span class="main"><span>[]</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>ys</span></span><span class="main"><span>.</span></span><span> </span><span>length</span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="bound"><span>ys</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="bound"><span>ys</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>xs</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="bound"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>ys</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="bound"><span>y</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2146..2151"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>x</span></span></span><span> </span><span class="quoted"><span class="free"><span>y</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>0</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2146..2151"><span>assms</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_2471..2474">Suc</span><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>x1</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>x2</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_2499..2500">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>x2</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_2519..2520">c</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="skolem"><span>x1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>n</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2471..2474"><span>Suc</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>append_butlast_last_id</span><span> </span><span>length_append_singleton</span><span> 
        </span><span>length_greater_0_conv</span><span> </span><span>nat.inject</span><span> </span><span>zero_less_Suc</span><span class="main"><span>)</span></span><span>

  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>y1</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>y2</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_2684..2685">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>y1</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>y2</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_2704..2705">d</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="skolem"><span>y1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>n</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2471..2474"><span>Suc</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>,</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>append_butlast_last_id</span><span> </span><span>length_append_singleton</span><span> 
        </span><span>length_greater_0_conv</span><span> </span><span>nat.inject</span><span> </span><span>zero_less_Suc</span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="skolem"><span>x1</span></span><span> </span><span class="skolem"><span>y1</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2519..2520"><span>c</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2704..2705"><span>d</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2471..2474"><span>Suc</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x1</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>x2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>y1</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>y2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2146..2151"><span>assms</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2519..2520"><span>c</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2704..2705"><span>d</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2499..2500"><span>a</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_2684..2685"><span>b</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>If all but one value of a sum is zero then it can be evaluated on the remaining point:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_3079..3084">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.sum_collapse|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.sum_collapse|thm"><span>sum_collapse</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>::</span></span><span class="main"><span>{</span></span><span>comm_monoid_add</span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>finite</span><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>z</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â </span></span><span> </span><span class="free"><span>z</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sum</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>z</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>sum.union_disjoint</span><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> A</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span class="main"><span>-</span></span><span class="main"><span>{</span></span><span class="free"><span>z</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>and</span></span></span></span><span> B</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="free"><span>z</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>and</span></span></span></span><span> g</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>f</span></span><span>"</span></span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_3079..3084"><span>assms</span></a><span> </span><span>sum.insert_if</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Number of occurrences of elements in lists is preserved under injective maps.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_3435..3440">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.count_list_inj_map|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.count_list_inj_map|thm"><span>count_list_inj_map</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>inj_on</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>count_list</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_3435..3440"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>x</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>A relation cannot be an equivalence relation on two distinct sets.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_3694..3699">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_on_unique|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_on_unique|thm"><span>equiv_on_unique</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>equiv</span><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>equiv</span><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>B</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>meson</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_3694..3699"><span>assms</span></a><span> </span><span>equalityI</span><span> </span><span>equiv_class_eq_iff</span><span> </span><span>subsetI</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>The restriction of an equivalence relation is itself an equivalence relation.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_3920..3925">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_subset|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_subset|thm"><span>equiv_subset</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>B</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>equiv</span><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>equiv</span><span> </span><span class="free"><span>B</span></span><span> </span><span class="main"><span>(</span></span><span>Restr</span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>refl_on</span><span> </span><span class="free"><span>B</span></span><span> </span><span class="main"><span>(</span></span><span>Restr</span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_3920..3925"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>refl_on_def</span><span> </span><span>equiv_def</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>blast</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sym</span><span> </span><span class="main"><span>(</span></span><span>Restr</span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_3920..3925"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>sym_def</span><span> </span><span>equiv_def</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>trans</span><span> </span><span class="main"><span>(</span></span><span>Restr</span><span> </span><span class="free"><span>p</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_3920..3925"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>trans_def</span><span> </span><span>equiv_def</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>blast</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>equiv_def</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Enumerating Restricted Growth Functions\label{sec:enum_rgf}</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.elims|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.induct|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.simps|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.pelims|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.cases|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.termination|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.pinduct|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.psimps|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel.inducts|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel.simps|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel.induct|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel.cases|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel.intros|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph.inducts|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph.simps|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph.induct|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph.cases|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph.intros|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.elims|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.induct|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.simps(2)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.simps(1)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.pelims|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.cases|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.termination|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.pinduct|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.psimps(2)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit.psimps(1)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel.inducts|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel.simps|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel.induct|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel.cases|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel.intros|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph.inducts|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph.simps|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph.induct|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph.cases|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph.intros(2)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph.intros(1)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_def|axiom"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel_def|axiom"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_sumC_def|axiom"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph_def|axiom"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_dom|const"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_rel|const"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_sumC|const"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span>list</span><span> </span><span class="main"><span>â</span></span><span> </span><span>nat</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> 
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rgf_limit</span></span><span> </span><span class="main"><span>[]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rgf_limit</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>#</span></span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>max</span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span class="main"><span>+</span></span><span class="main"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>rgf_limit</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_snoc|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_snoc|thm"><span>rgf_limit_snoc</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="free"><span>y</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>max</span><span> </span><span class="main"><span>(</span></span><span class="free"><span>y</span></span><span class="main"><span>+</span></span><span class="main"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>x</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_ge|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_limit_ge|thm"><span>rgf_limit_ge</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>metis</span></span><span> </span><span>lessI</span><span> </span><span>max_less_iff_conj</span><span> </span><span>not_less_eq</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_def|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_def|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span>list</span><span> </span><span class="main"><span>â</span></span><span> </span><span>bool</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rgf</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>ys</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span>prefix</span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>ys</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="bound"><span>y</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="bound"><span>ys</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>The function </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> returns the smallest natural number larger than all list
</span><span>elements, it is the largest allowed value following </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> for restricted growth functions.
</span><span>The definition </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> is the predicate capturing the notion.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.elims|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.induct|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.simps|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.pelims|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.cases|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.termination|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.pinduct|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.psimps|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel.inducts|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel.simps|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel.induct|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel.cases|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel.intros|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph.inducts|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph.simps|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph.induct|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph.cases|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph.intros|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.elims|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.induct|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.simps(2)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.simps(1)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.pelims|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.cases|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.termination|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.pinduct|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.psimps(2)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs.psimps(1)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel.inducts|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel.simps|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel.induct|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel.cases|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel.intros|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph.inducts|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph.simps|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph.induct|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph.cases|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph.intros(2)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph.intros(1)|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_def|axiom"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel_def|axiom"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_sumC_def|axiom"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph_def|axiom"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_dom|const"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_rel|const"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_sumC|const"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>(</span></span><span>nat</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span>list</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>enum_rgfs</span></span><span> </span><span class="main"><span>0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[]</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>enum_rgfs</span></span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="bound"><span>y</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> x </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>enum_rgfs</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>,</span></span><span>  y </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="bound"><span>x</span></span><span class="main"><span>+</span></span><span class="main"><span>1</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>The function </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="free"><span>n</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> returns all RGFs of length </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> without repetition.
</span><span>The fact is verified in the three lemmas at the end of this section.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_snoc|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_snoc|thm"><span>rgf_snoc</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>xs</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="free"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_def|fact"><span>rgf_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>order_antisym</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>less_Suc_eq_le</span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_imp_initial_segment|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_imp_initial_segment|thm"><span>rgf_imp_initial_segment</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span>set</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{..&lt;</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>xs</span></span></span><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span>rev_induct</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_5732..5736">snoc</span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_5750..5751">c</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="skolem"><span>xs</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_5732..5736"><span>snoc</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_snoc|fact"><span>rgf_snoc</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_5801..5802">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>set</span><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{..&lt;</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_5732..5736"><span>snoc</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_5861..5862">b</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>xs</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_5732..5736"><span>snoc</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_snoc|fact"><span>rgf_snoc</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_5750..5751"><span>c</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>set</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>insert</span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>{..&lt;</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_5801..5802"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{..&lt;</span></span><span>max</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span class="main"><span>+</span></span><span class="main"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_5861..5862"><span>b</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>xs</span></span><span>"</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>insert_absorb</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>lessThan_Suc</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{..&lt;</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit_snoc|fact"><span>rgf_limit_snoc</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_6237..6242">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_returns_rgfs|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_returns_rgfs|thm"><span>enum_rgfs_returns_rgfs</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_6237..6242"><span>assms</span></a><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>n</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>x</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>0</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_def|fact"><span>rgf_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_6426..6429">Suc</span><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>x1</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>x2</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> 
    </span><span class="entity_def" id="offset_6459..6464">x_def</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>x2</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x2</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>x1</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x1</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_6426..6429"><span>Suc</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>image_iff</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>force</span></span><span class="main"><span>)</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="skolem"><span>x1</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_6426..6429"><span>Suc</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_6459..6464"><span>x_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_6459..6464"><span>x_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_snoc|fact"><span>rgf_snoc</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_6670..6675">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_len|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.enum_rgfs_len|thm"><span>enum_rgfs_len</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_6670..6675"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>n</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>x</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp_all</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span class="main"><span>)</span></span><span> 

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_6815..6820">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels_enum|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels_enum|thm"><span>equiv_rels_enum</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>count_list</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_6815..6820"><span>assms</span></a><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>x</span></span></span><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span>rev_induct</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_7006..7010">snoc</span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_7024..7025">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="skolem"><span>xs</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_7006..7010"><span>snoc</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_def|fact"><span>rgf_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_snoc|fact"><span>rgf_snoc</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_7006..7010"><span>snoc</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_7134..7135">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>card</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>â©</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>xs</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_7006..7010"><span>snoc</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_7024..7025"><span>b</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>r1</span></span><span class="main"><span>â</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span>of_bool</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>r1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>*</span></span><span> 
      </span><span>card</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>â©</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_7134..7135"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>length_concat</span><span> </span><span>filter_concat</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.count_list_expand|fact"><span>count_list_expand</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.length_filter|fact"><span>length_filter</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>r1</span></span><span class="main"><span>â</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span>of_bool</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>r1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>*</span></span><span> 
      </span><span>card</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="bound"><span>r1</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>â©</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>mono_tags</span><span class="main"><span class="main"><span>,</span></span></span><span> opaque_lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>mult_eq_0_iff</span><span> </span><span>of_bool_eq_0_iff</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>r1</span></span><span class="main"><span>â</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span>of_bool</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>r1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>*</span></span><span> 
      </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>r2</span></span><span class="main"><span>â</span></span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="bound"><span>r1</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>]</span></span><span class="main"><span>.</span></span><span> </span><span>of_bool</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>r2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>interv_sum_list_conv_sum_set_nat</span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><span>One_nat_def</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(=)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>length_concat</span><span> </span><span>filter_concat</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.length_filter|fact"><span>length_filter</span></a><span> </span><span>comp_def</span><span> 
        </span><span>of_bool_conj</span><span> </span><span>sum_list_const_mult</span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><span>upt_Suc</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.count_list_expand|fact"><span>count_list_expand</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.length_filter|fact"><span>length_filter</span></a><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs.simps|fact"><span>enum_rgfs.simps</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>presburger</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Enumerating Equivalence Relations\label{sec:bij_kernel}</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>The following definition returns the equivalence relation induced by a list, for example, by
</span><span>a restricted growth function.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_def|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_def|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span>list</span><span> </span><span class="main"><span>â</span></span><span> </span><span>nat</span><span> </span><span>rel</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>kernel_of</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Using that the enumeration function for equivalence relations on </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> is
</span><span>straight-forward to define:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels_def|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels_def|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>equiv_rels</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>The following lemma shows that the image of 
</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> is indeed an equivalence relation:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_equiv|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_equiv|thm"><span>kernel_of_equiv</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>equiv</span><span> </span><span class="main"><span>{..&lt;</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{..&lt;</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>Ã</span></span><span> </span><span class="main"><span>{..&lt;</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_def|fact"><span>kernel_of_def</span></a><span> </span><span>mem_Times_iff</span><span> </span><span>case_prod_beta</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>equiv_def</span><span> </span><span>refl_on_def</span><span> </span><span>sym_def</span><span> </span><span>trans_def</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_def|fact"><span>kernel_of_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_9133..9138">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_eq_len|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_eq_len|thm"><span>kernel_of_eq_len</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{..&lt;</span></span><span>length</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{..&lt;</span></span><span>length</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_equiv|fact"><span>kernel_of_equiv</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_on_unique|fact"><span>equiv_on_unique</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_9133..9138"><span>assms</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_eq|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_eq|thm"><span>kernel_of_eq</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â·</span></span><span> 
  </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>j</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>i</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>y</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_9536..9540">True</span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span>  </span><span class="main"><span>â·</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>j</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>i</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>y</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><span>set_eq_iff</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_def|fact"><span>kernel_of_def</span></a><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_9536..9540"><span>True</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>blast</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>j</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>i</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>y</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>linorder_cases</span><span> </span><span>order.strict_trans</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_9536..9540"><span>True</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>False</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_eq_len|fact"><span>kernel_of_eq_len</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_snoc|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_snoc|thm"><span>kernel_of_snoc</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Restr</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>xs</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="free"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>  </span><span class="main"><span>{..&lt;</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_def|fact"><span>kernel_of_def</span></a><span> </span><span>nth_append</span><span> </span><span>set_eq_iff</span><span class="main"><span>)</span></span><span> 

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_10123..10128">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_inj_on_rgfs_aux|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_inj_on_rgfs_aux|thm"><span>kernel_of_inj_on_rgfs_aux</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10123..10128"><span>assms</span></a><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induct</span></span><span> </span><span class="quoted"><span class="free"><span>x</span></span></span><span> </span><span class="quoted"><span class="free"><span>y</span></span></span><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.list_induct_2_rev|fact"><span>list_induct_2_rev</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_10385..10389">Cons</span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="skolem"><span>y</span></span><span> </span><span class="skolem"><span>ys</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10408..10409">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="skolem"><span>ys</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10385..10389"><span>Cons</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>5</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_snoc|fact"><span>kernel_of_snoc</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>metis</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10492..10493">d</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="skolem"><span>xs</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="skolem"><span>ys</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10385..10389"><span>Cons</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_def|fact"><span>rgf_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_10547..10548">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>ys</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10385..10389"><span>Cons</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10408..10409"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>ys</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>i</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="entity_def" id="offset_10671..10674">i_l</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>i</span></span><span class="main"><span>,</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10671..10674"><span>i_l</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_def|fact"><span>kernel_of_def</span></a><span> </span><span>less_Suc_eq</span><span> </span><span>nth_append</span><span class="main"><span>)</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>i</span></span><span class="main"><span>,</span></span><span>length</span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>ys</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>y</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10385..10389"><span>Cons</span></a><span class="main"><span>(</span></span><span>5</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>ys</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="skolem"><span>i</span></span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span>  </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10671..10674"><span>i_l</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10385..10389"><span>Cons</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_def|fact"><span>kernel_of_def</span></a><span> </span><span>less_Suc_eq</span><span> </span><span>nth_append</span><span class="main"><span>)</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>ys</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_11085..11086">c</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="skolem"><span>ys</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10547..10548"><span>b</span></a><span> </span><span>in_set_conv_nth</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_11178..11185">x_bound</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10385..10389"><span>Cons</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_snoc|fact"><span>rgf_snoc</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10492..10493"><span>d</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_11253..11260">y_bound</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>ys</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10385..10389"><span>Cons</span></a><span class="main"><span>(</span></span><span>4</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_snoc|fact"><span>rgf_snoc</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10492..10493"><span>d</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>y</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10547..10548"><span>b</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_11085..11086"><span>c</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10492..10493"><span>d</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_imp_initial_segment|fact"><span>rgf_imp_initial_segment</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10385..10389"><span>Cons</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_11178..11185"><span>x_bound</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_11253..11260"><span>y_bound</span></a><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>xs</span></span><span>"</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="skolem"><span>ys</span></span><span>"</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_10547..10548"><span>b</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_inj_on_rgfs|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_inj_on_rgfs|thm"><span>kernel_of_inj_on_rgfs</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span>inj_on</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="main"><span>{</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="bound"><span>x</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>inj_onI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_eq_len|fact"><span>kernel_of_eq_len</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_inj_on_rgfs_aux|fact"><span>kernel_of_inj_on_rgfs_aux</span></a><span class="main"><span>)</span></span><span> 

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Applying an injective map to a list preserves the induced relation:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_11731..11736">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_under_inj_map|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_under_inj_map|thm"><span>kernel_of_under_inj_map</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>inj_on</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>x</span></span><span> 
    </span><span class="main"><span>â¹</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>j</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_11731..11736"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>inj_on_eq_iff</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_def|fact"><span>kernel_of_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_12041..12046">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.all_rels_are_kernels|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.all_rels_are_kernels|thm"><span>all_rels_are_kernels</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>equiv</span><span> </span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>nat</span><span> </span><span>set</span><span> </span><span>list</span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>p</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span>length</span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_12169..12175">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>r</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>p</span></span><span class="main"><span>``</span></span><span class="main"><span>{</span></span><span class="bound"><span>k</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span> </span><span class="bound"><span>u</span></span><span> </span><span class="bound"><span>v</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>u</span></span><span class="main"><span>,</span></span><span class="bound"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="skolem"><span>r</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>u</span></span><span class="main"><span>,</span></span><span class="bound"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>u</span></span><span> </span><span class="skolem"><span>v</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span>nat</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>u</span></span><span class="main"><span>,</span></span><span class="skolem"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="skolem"><span>r</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="skolem"><span>u</span></span><span class="main"><span>,</span></span><span class="skolem"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span class="main"><span>Ã</span></span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="free"><span>p</span></span><span class="main"><span>``</span></span><span class="main"><span>{</span></span><span class="skolem"><span>u</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>p</span></span><span class="main"><span>``</span></span><span class="main"><span>{</span></span><span class="skolem"><span>v</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_def|fact"><span>kernel_of_def</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_12169..12175"><span>r_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>u</span></span><span class="main"><span>,</span></span><span class="skolem"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_12041..12046"><span>assms</span></a><span> </span><span>equiv_class_eq_iff</span><span> </span><span>mem_Sigma_iff</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>u</span></span><span class="main"><span>,</span></span><span class="skolem"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="skolem"><span>r</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>u</span></span><span class="main"><span>,</span></span><span class="skolem"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="skolem"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>p</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="skolem"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_12169..12175"><span>r_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>For any list there is always an injective map on its set, such that its image is an RGF.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.map_list_to_rgf|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.map_list_to_rgf|thm"><span>map_list_to_rgf</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span>inj_on</span><span> </span><span class="bound"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="bound"><span>f</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>x</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>0</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_def|fact"><span>rgf_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_12948..12951">Suc</span><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>x1</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>x2</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_12976..12981">x_def</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>@</span></span><span class="main"><span>[</span></span><span class="skolem"><span>x2</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_13001..13005">l_x1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="skolem"><span>x1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>n</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>append_butlast_last_id</span><span> </span><span>length_append_singleton</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_12948..12951"><span>Suc</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> 
        </span><span>length_greater_0_conv</span><span> </span><span>nat.inject</span><span> </span><span>zero_less_Suc</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>f</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_13165..13170">inj_f</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>inj_on</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_13196..13200">pc_f</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_12948..12951"><span>Suc</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13001..13005"><span>l_x1</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x2</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="skolem"><span>x1</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_13302..13306">True</span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>set</span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>set</span><span> </span><span class="skolem"><span>x1</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_12976..12981"><span>x_def</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13302..13306"><span>True</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_13370..13371">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>inj_on</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="skolem"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13165..13170"><span>inj_f</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>

    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>x2</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit_ge|fact"><span>rgf_limit_ge</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13302..13306"><span>True</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_12976..12981"><span>x_def</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_snoc|fact"><span>rgf_snoc</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13196..13200"><span>pc_f</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13370..13371"><span>b</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_13605..13610">False</span><span>
    </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_13615..13621">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>f'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>f'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>if</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="skolem"><span>x1</span></span><span> </span><span class="keyword1"><span>then</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="keyword1"><span>else</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>inj_on</span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13615..13621"><span>f'_def</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13165..13170"><span>inj_f</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>inj_on_def</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit_ge|fact"><span>rgf_limit_ge</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>f'</span></span><span> </span><span class="skolem"><span>x2</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="main"><span>`</span></span><span> </span><span>set</span><span> </span><span class="skolem"><span>x1</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13605..13610"><span>False</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13615..13621"><span>f'_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>inj_on</span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="main"><span>(</span></span><span>insert</span><span> </span><span class="skolem"><span>x2</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13605..13610"><span>False</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_14008..14009">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>inj_on</span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="skolem"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13605..13610"><span>False</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_12976..12981"><span>x_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_14066..14067">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>map</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>x1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="skolem"><span>x1</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13615..13621"><span>f'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_14122..14123">c</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>f'</span></span><span> </span><span class="skolem"><span>x2</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>Suc</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_limit|const"><span>rgf_limit</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>x1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13615..13621"><span>f'_def</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13605..13610"><span>False</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>f'</span></span><span> </span><span class="skolem"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_12976..12981"><span>x_def</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_14066..14067"><span>b</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_snoc|fact"><span>rgf_snoc</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_13196..13200"><span>pc_f</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_14122..14123"><span>c</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_14008..14009"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>For any relation there is a corresponding RGF:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_14369..14374">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_exists|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.rgf_exists|thm"><span>rgf_exists</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>equiv</span><span> </span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="free"><span>r</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span>length</span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>r</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>y</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span>set</span><span> </span><span>list</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_14510..14511">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>r</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.all_rels_are_kernels|fact"><span>all_rels_are_kernels</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_14369..14374"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>f</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_14613..14614">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>inj_on</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="skolem"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.map_list_to_rgf|fact"><span>map_list_to_rgf</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>r</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_under_inj_map|fact"><span>kernel_of_under_inj_map</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_14510..14511"><span>a</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_14613..14614"><span>b</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_14510..14511"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_14613..14614"><span>b</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>These are the main result of this entry: The function </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="free"><span>n</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> enumerates the
</span><span>equivalence relations on </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> without repetition.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_15034..15041">theorem</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels_set|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels_set|thm"><span>equiv_rels_set</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>equiv</span><span> </span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_15034..15041"><span>assms</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels_def|fact"><span>equiv_rels_def</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_equiv|fact"><span>kernel_of_equiv</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs_len|fact"><span>enum_rgfs_len</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_15186..15193">theorem</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels|thm"><span>equiv_rels</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>equiv</span><span> </span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="free"><span>r</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>count_list</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>y</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_15300..15305">y_def</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="skolem"><span>y</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>r</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf_exists|fact"><span>rgf_exists</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_15186..15193"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_15392..15393">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>y</span></span><span class="main"><span>=</span></span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs_returns_rgfs|fact"><span>enum_rgfs_returns_rgfs</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_15300..15305"><span>y_def</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs_len|fact"><span>enum_rgfs_len</span></a><span> </span><span>inj_onD</span><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_inj_on_rgfs|fact"><span>kernel_of_inj_on_rgfs</span></a><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>count_list</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> 
    </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels_def|fact"><span>equiv_rels_def</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.count_list_expand|fact"><span>count_list_expand</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.length_filter|fact"><span>length_filter</span></a><span> </span><span>comp_def</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_15300..15305"><span>y_def</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_15392..15393"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>cong</span></span><span class="main"><span class="main"><span>:</span></span></span><span>filter_cong</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.enum_rgfs|const"><span>enum_rgfs</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>y</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.count_list_expand|fact"><span>count_list_expand</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.length_filter|fact"><span>length_filter</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels_enum|fact"><span>equiv_rels_enum</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_15300..15305"><span>y_def</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>A corollary of the previous theorem is that the sum of the indicator function for a relation
</span><span>over </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="free"><span>n</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> is always one.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_16290..16299">corollary</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels_2|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.equiv_rels_2|thm"><span>equiv_rels_2</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span class="main"><span>â</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span>of_bool</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>1</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>{</span></span><span>semiring_1</span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|fact"><span>equiv_rels</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_equiv|fact"><span>kernel_of_equiv</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> xs</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_16290..16299"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.count_list_expand|fact"><span>count_list_expand</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_16290..16299"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>of_bool_def</span><span> </span><span>sum_list_map_filter'</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><span>sum_list_triv</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Example Application\label{sec:app}</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>In this section, I wanted to discuss an interesting application within the context of
</span><span>a proof in Isabelle. This is motivated by a real-world example \cite[\textsection 2.2]{alon1999},
</span><span>where a function in a 4-times iterated sum could only be reduced by splitting it according to the
</span><span>equivalence relation formed by the indices. The notepad below illustrates how this can be done
</span><span>(in the case of 3 index variables).</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>notepad</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span> </span><span class="comment1"><span>â</span><span class="quoted"><span>â¹</span><span>tag</span><span> </span><span>visible</span><span>âº</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>Ã</span></span><span> </span><span>nat</span><span> </span><span class="main"><span>Ã</span></span><span> </span><span>nat</span><span>  </span><span class="main"><span>â</span></span><span> </span><span>nat</span><span>"</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>I</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span>set</span><span>"</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="entity_def" id="offset_17273..17274">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>finite</span><span> </span><span class="skolem"><span>I</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>To be able to break down such a sum by partitions let us introduce the function $P$
</span><span>    which is defined to be sum of an indicator function over all possible equivalence relations
</span><span>    its argument can form:</span><span>âº</span></span></span><span>

  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_17506..17512">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>P</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span>list</span><span> </span><span class="main"><span>â</span></span><span> </span><span>nat</span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>P</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>xs</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="bound"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span>of_bool</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Note that its value is always one, hence we can introduce it in an algebraic equation easily:</span><span>âº</span></span></span><span> 

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_17730..17735">P_one</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>xs</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>P</span></span><span> </span><span class="bound"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_17506..17512"><span>P_def</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels_2|fact"><span>equiv_rels_2</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_17799..17816">unfold_equiv_rels</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_17506..17512"><span>P_def</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels_def|fact"><span>equiv_rels_def</span></a><span> </span><span>numeral_eq_Suc</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_eq|fact"><span>kernel_of_eq</span></a><span> 
    </span><span>neq_commute</span><span> </span><span>All_less_Suc</span><span> </span><span>comp_def</span><span>

  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_17910..17916">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>r</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span>  </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span class="bound"><span>j</span></span><span class="main"><span>,</span></span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>As a first step, we just introduce the factor </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="skolem"><span>P</span></span><span> </span><span class="main"><span>[</span></span><span class="free"><span>i</span></span><span class="main"><span>,</span></span><span class="free"><span>j</span></span><span class="main"><span>,</span></span><span class="free"><span>k</span></span><span class="main"><span>]</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>.</span><span>âº</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span>  </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span class="bound"><span>j</span></span><span class="main"><span>,</span></span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="skolem"><span>P</span></span><span> </span><span class="main"><span>[</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span class="bound"><span>j</span></span><span class="main"><span>,</span></span><span class="bound"><span>k</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_17730..17735"><span>P_one</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_17910..17916"><span>r_def</span></a><span> </span><span class="quasi_keyword"><span>cong</span></span><span class="main"><span class="main"><span>:</span></span></span><span>sum.cong</span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>By expanding the definition of P and distributing, the sum can be expanded into 5 sums
</span><span>    each representing a distinct equivalence relation formed by the indices.</span><span>âº</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>â</span></span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>+</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>â</span></span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span>j</span></span><span class="main"><span>â</span></span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span>of_bool</span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â </span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>+</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>â</span></span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span>j</span></span><span class="main"><span>â</span></span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span>of_bool</span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â </span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>+</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>â</span></span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span>j</span></span><span class="main"><span>â</span></span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span>of_bool</span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â </span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>+</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>â</span></span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span>j</span></span><span class="main"><span>â</span></span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span>k</span></span><span class="main"><span>â</span></span><span class="skolem"><span>I</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span>of_bool</span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>â </span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â </span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â </span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="var"><span>?rhs</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_17799..17816"><span>unfold_equiv_rels</span></a><span> </span><span>sum.distrib</span><span> </span><span>distrib_left</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.sum_collapse|fact"><span>sum_collapse</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_17273..17274"><span>a</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="var"><span>?rhs</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Additional Results\label{sec:add}</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>If two lists induce the same equivalence relation, then there is a bijection between the sets
</span><span>that preserves the multiplicities of its elements.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_18938..18943">lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_eq_imp_bij|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.kernel_of_eq_imp_bij|thm"><span>kernel_of_eq_imp_bij</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span>bij_betw</span><span> </span><span class="bound"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â§</span></span><span> 
    </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>z</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span>count_list</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>f</span></span><span> </span><span class="bound"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>x'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_19128..19134">x'_def</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>inj_on</span><span> </span><span class="skolem"><span>x'</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>x'</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.map_list_to_rgf|fact"><span>map_list_to_rgf</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>y'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_19226..19232">y'_def</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>inj_on</span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.rgf|const"><span>rgf</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.map_list_to_rgf|fact"><span>map_list_to_rgf</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>x'</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_18938..18943"><span>assms</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19128..19134"><span>x'_def</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19226..19232"><span>y'_def</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_under_inj_map|fact"><span>kernel_of_under_inj_map</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_19459..19460">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>map</span><span> </span><span class="skolem"><span>x'</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>inj_onD</span><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_inj_on_rgfs|fact"><span>kernel_of_inj_on_rgfs</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19128..19134"><span>x'_def</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19226..19232"><span>y'_def</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><span>length_map</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_19576..19577">f</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x'</span></span><span> </span><span class="main"><span>`</span></span><span> </span><span>set</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="main"><span>`</span></span><span> </span><span>set</span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>list.set_map</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_19636..19642">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>f</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the_inv_into</span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="skolem"><span>x'</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_19693..19694">g</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>z</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span>count_list</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>f</span></span><span> </span><span class="bound"><span>z</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>z</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="entity_def" id="offset_19780..19781">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>z</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_19803..19804">e</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x'</span></span><span> </span><span class="skolem"><span>z</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="main"><span>`</span></span><span> </span><span>set</span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19780..19781"><span>a</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19459..19460"><span>b</span></a><span> </span><span>imageI</span><span> </span><span>image_set</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_19873..19874">c</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>the_inv_into</span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x'</span></span><span> </span><span class="skolem"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="free"><span>y</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19803..19804"><span>e</span></a><span> </span><span>the_inv_into_into</span><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19226..19232"><span>y'_def</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_19980..19981">d</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="skolem"><span>y'</span></span><span> </span><span class="main"><span>(</span></span><span>the_inv_into</span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x'</span></span><span> </span><span class="skolem"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>x'</span></span><span> </span><span class="skolem"><span>z</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19803..19804"><span>e</span></a><span> </span><span>f_the_inv_into_f</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19226..19232"><span>y'_def</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>

    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>count_list</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="skolem"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>x'</span></span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x'</span></span><span> </span><span class="skolem"><span>z</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19780..19781"><span>a</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19128..19134"><span>x'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.count_list_inj_map|fact"><span>count_list_inj_map</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x'</span></span><span> </span><span class="skolem"><span>z</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19459..19460"><span>b</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>y'</span></span><span> </span><span class="main"><span>(</span></span><span>the_inv_into</span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x'</span></span><span> </span><span class="skolem"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19980..19981"><span>d</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>(</span></span><span>the_inv_into</span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>y'</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x'</span></span><span> </span><span class="skolem"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19873..19874"><span>c</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.count_list_inj_map|fact"><span>count_list_inj_map</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19226..19232"><span>y'_def</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>z</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19636..19642"><span>f_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>count_list</span><span> </span><span class="free"><span>x</span></span><span> </span><span class="skolem"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>count_list</span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>z</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>bij_betw</span><span> </span><span class="skolem"><span>x'</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x'</span></span><span> </span><span class="main"><span>`</span></span><span> </span><span>set</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19128..19134"><span>x'_def</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span>bij_betw_imageI</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>bij_betw</span><span> </span><span class="main"><span>(</span></span><span>the_inv_into</span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>y'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>y'</span></span><span> </span><span class="main"><span>`</span></span><span> </span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>bij_betw_the_inv_into</span><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><span>bij_betw_imageI</span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19226..19232"><span>y'_def</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>bij_betw</span><span> </span><span class="main"><span>(</span></span><span>the_inv_into</span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>y'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x'</span></span><span> </span><span class="main"><span>`</span></span><span> </span><span>set</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19576..19577"><span>f</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>bij_betw</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span>y</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>bij_betw_trans</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19636..19642"><span>f_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_19693..19694"><span>g</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>As expected the length of </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="free"><span>n</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> is the $n$-th Bell number.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.len_equiv_rels|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.len_equiv_rels|thm"><span>len_equiv_rels</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../Bell_Numbers_Spivey/Bell_Numbers.html#Bell_Numbers.Bell|const"><span>Bell</span></a><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_21218..21219">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>finite</span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>p</span></span><span class="main"><span>.</span></span><span> </span><span>equiv</span><span> </span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="bound"><span>p</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Card_Equiv_Relations/Card_Equiv_Relations.html#Card_Equiv_Relations.finite_equiv|fact"><span>finite_equiv</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_21289..21290">b</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>set</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span>  </span><span class="main"><span>â</span></span><span>  </span><span class="main"><span>{</span></span><span class="bound"><span>p</span></span><span class="main"><span>.</span></span><span> </span><span>equiv</span><span> </span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="bound"><span>p</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels_set|fact"><span>equiv_rels_set</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> 
    </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>p</span></span><span class="main"><span>.</span></span><span> </span><span>equiv</span><span> </span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="bound"><span>p</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span>count_list</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|const"><span>equiv_rels</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_21218..21219"><span>a</span></a><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#offset_21289..21290"><span>b</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>sum_count_set</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>card</span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>p</span></span><span class="main"><span>.</span></span><span> </span><span>equiv</span><span> </span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="bound"><span>p</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.equiv_rels|fact"><span>equiv_rels</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../Bell_Numbers_Spivey/Bell_Numbers.html#Bell_Numbers.Bell|const"><span>Bell</span></a><span> </span><span class="main"><span>(</span></span><span>card</span><span> </span><span class="main"><span>{..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../Card_Equiv_Relations/Card_Equiv_Relations.html#Card_Equiv_Relations.card_equiv_rel_eq_Bell|fact"><span>card_equiv_rel_eq_Bell</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../Bell_Numbers_Spivey/Bell_Numbers.html#Bell_Numbers.Bell|const"><span>Bell</span></a><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Instead of forming an equivalence relation from a list, it is also possible to induce a
</span><span>partition from it:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Equivalence_Relation_Enumeration.induced_par_def|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.induced_par_def|thm"><span class="entity_def" id="Equivalence_Relation_Enumeration.induced_par_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Equivalence_Relation_Enumeration.induced_par|const"><span>induced_par</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><span>list</span><span> </span><span class="main"><span>â</span></span><span> </span><span>nat</span><span> </span><span>set</span><span> </span><span>set</span><span>"</span></span></span><span>  </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>induced_par</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>`</span></span><span> </span><span class="main"><span>(</span></span><span>set</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>The following lemma verifies the commutative diagram, i.e.,
</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.induced_par|const"><span>induced_par</span></a><span> </span><span class="free"><span>xs</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> is the same partition as the quotient of </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>{..&lt;</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>}</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> over
</span><span>the corresponding equivalence relation.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Equivalence_Relation_Enumeration.quotient_of_kernel_is_induced_par|fact"><span class="entity_def" id="Equivalence_Relation_Enumeration.quotient_of_kernel_is_induced_par|thm"><span>quotient_of_kernel_is_induced_par</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{..&lt;</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>//</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.induced_par|const"><span>induced_par</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>set_eqI</span><span class="main"><span>)</span></span><span> 
  </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>x</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{..&lt;</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>//</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â·</span></span><span> 
    </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>i</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>j</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><span>quotient_def</span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of_def|fact"><span>kernel_of_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>j</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><span>in_set_conv_nth</span><span> </span><span>Bex_def</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>order_antisym</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>force</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.induced_par|const"><span>induced_par</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.induced_par_def|fact"><span>induced_par_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{..&lt;</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>//</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.kernel_of|const"><span>kernel_of</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â·</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="Equivalence_Relation_Enumeration.html#Equivalence_Relation_Enumeration.induced_par|const"><span>induced_par</span></a><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre></div>