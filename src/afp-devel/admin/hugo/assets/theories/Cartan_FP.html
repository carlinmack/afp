<div id="Cartan">
<div class="head">
<h1>Theory Cartan</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Cartan
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Complex_Analysis/Complex_Analysis.html">HOL-Complex_Analysis.Complex_Analysis</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹First Cartan Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Ported from HOL Light. See
      Gianni Ciolli, Graziano Gentili, Marco Maggesi.
      A Certified Proof of the Cartan Fixed Point Theorems.
      J Automated Reasoning (2011) 47:319--336    DOI 10.1007/s10817-010-9198-6›</span></span>

<span class="keyword1" id="Cartan-deriv_left_inverse"><span class="command">lemma</span></span> deriv_left_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">holomorphic_on</span> <span class="free">T</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"open <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"open <span class="free">T</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"deriv <span class="free">f</span> <span class="free">w</span> <span class="main">*</span> deriv <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="free">f</span> <span class="free">w</span> <span class="main">*</span> deriv <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> deriv <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="free">w</span><span class="main">)</span> <span class="main">*</span> deriv <span class="free">f</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> deriv <span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> analytic_on_imp_differentiable_at analytic_on_open deriv_chain image_subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> deriv id <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> complex_derivative_transform_within_open <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> s<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms holomorphic_on_compose_gen <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> higher_deriv_id <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cartan-Cauchy_higher_deriv_bound"><span class="command">lemma</span></span> Cauchy_higher_deriv_bound<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> holf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="main">(</span>ball <span class="free">z</span> <span class="free">r</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> contf<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cball <span class="free">z</span> <span class="free">r</span><span class="main">)</span> <span class="free">f</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> fin <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> ball <span class="free">z</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">w</span> <span class="main">∈</span> ball <span class="free">y</span> <span class="free">B0</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">B0</span> <span class="main">/</span> <span class="free">r</span><span class="main">^</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">B0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span> fin <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ball_eq_empty ex_in_conv fin not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> le_B0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> cmod <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">⟹</span> cmod <span class="main">(</span><span class="free">f</span> <span class="bound">w</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">B0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_closure_norm_le <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"ball <span class="free"><span class="free">z</span></span> <span class="free"><span class="free">r</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">w</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">w</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span>  dist_norm norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> contf<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_commute dist_norm less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="free">f</span> <span class="bound">w</span><span class="main">)</span> <span class="free">z</span> <span class="main">-</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="free">f</span> <span class="bound">w</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> higher_deriv_diff <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holf<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span> holomorphic_on_const<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="free">f</span> <span class="bound">w</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> contf'<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cball <span class="free">z</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">f</span> <span class="bound">u</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contf <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> holf'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">u</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="main">(</span>ball <span class="free">z</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holf holomorphic_on_diff holomorphic_on_const<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">/</span><span class="main">(</span>fact <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">a</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B0</span><span class="main">/</span><span class="free">r</span><span class="main">^</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">r</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">*</span><span class="main">(</span><span class="main">(</span>fact <span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="free">B0</span><span class="main">/</span><span class="free">r</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> der_dif<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="free">f</span> <span class="bound">w</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> higher_deriv_diff <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holf holomorphic_on_const<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>fact <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="free">f</span> <span class="bound">w</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>
        <span class="main">≤</span> <span class="main">(</span><span class="free">B0</span><span class="main">/</span><span class="free">r</span><span class="main">^</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_contour_integral_bound_circlepath <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">u</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">u</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">u</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">z</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">^</span></span><span class="main"><span class="main">(</span></span>Suc <span class="free"><span class="free">n</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">z</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Cauchy_has_contour_integral_higher_derivative_circlepath <span class="main">[</span><span class="operator">OF</span> contf' holf'<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">B0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_divide norm_mult norm_power <span class="dynamic"><span class="dynamic">divide_simps</span></span> le_B0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_divide norm_mult norm_power <span class="dynamic"><span class="dynamic">field_simps</span></span> der_dif le_B0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cartan-higher_deriv_comp_lemma"><span class="command">lemma</span></span> higher_deriv_comp_lemma<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> holf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> holg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">holomorphic_on</span> <span class="free">t</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> fst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">s</span> <span class="main">⊆</span> <span class="free">t</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> dfz<span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span><span class="main">1</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">;</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">i</span><span class="main">)</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> n holg
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"Suc.prems"</span> holf
    <span class="keyword1"><span class="command">using</span></span> fst  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holomorphic_on_compose_gen image_subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holomorphic_deriv s<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> dg<span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="skolem">g</span> <span class="keyword1">holomorphic_on</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> holomorphic_deriv t<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="skolem">g</span> <span class="keyword1">holomorphic_on</span> <span class="free">f</span> <span class="main">`</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fst  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holomorphic_on_subset image_subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dgf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="skolem">g</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holf holomorphic_on_compose<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">(</span>deriv <span class="skolem">g</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="bound">w</span> <span class="main">*</span> deriv <span class="free">f</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> holomorphic_on_compose holf s<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>deriv <span class="main">(</span><span class="skolem">g</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="skolem">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">w</span><span class="main">)</span> <span class="main">*</span> deriv <span class="free">f</span> <span class="bound">w</span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> higher_deriv_transform_within_open <span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 2 <span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span> s <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> deriv_chain<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> holf Suc.prems fst <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> holomorphic_on_imp_differentiable_at s t<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">.</span> of_nat<span class="main">(</span><span class="skolem">i</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="skolem">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>deriv <span class="free">f</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> higher_deriv_mult <span class="main"><span class="main">[</span></span><span class="operator">OF</span> dgf <span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span> _ s <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holf holomorphic_deriv s<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="skolem">i</span><span class="main">..</span><span class="skolem">i</span><span class="main">.</span> of_nat<span class="main">(</span><span class="skolem">i</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="skolem">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="skolem">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>deriv <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">i</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_def funpow.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> funpow_swap1 zero nz<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> funpow_Suc_right o_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> comm_monoid_add_class.sum.mono_neutral_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>deriv <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="main">[</span><span class="operator">OF</span> _ dg<span class="main">]</span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dfz<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> funpow_Suc_right o_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Cartan-higher_deriv_comp_iter_lemma"><span class="command">lemma</span></span> higher_deriv_comp_iter_lemma<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> holf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> fss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">s</span> <span class="main">⊆</span> <span class="free">s</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> dfz<span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span><span class="main">1</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">;</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="free">m</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">i</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> holfm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holomorphic_on_ident<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> funpow_Suc_right holomorphic_on_compose_gen <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holf _ fss<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">with</span></span> dfz <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems holfm <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span> dfz fss higher_deriv_comp_lemma holf s zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">i</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> funpow_Suc_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cartan-higher_deriv_iter_top_lemma"><span class="command">lemma</span></span> higher_deriv_iter_top_lemma<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> holf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> fss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">s</span> <span class="main">⊆</span> <span class="free">s</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> dfz <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span><span class="main">1</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">;</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">m</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> n
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="skolem">m</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fms_sb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="skolem">m</span><span class="main">)</span> <span class="main">`</span> <span class="free">s</span> <span class="main">⊆</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> fss
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> holfm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holomorphic_on_ident<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> funpow_Suc_right holomorphic_on_compose_gen <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holf _ fss<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> holdfm<span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holomorphic_deriv s<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> holdffm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> deriv <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_on_compose_gen <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"deriv <span class="free"><span class="free">f</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> t<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> s <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span> holfm holf fms_sb <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f_cd_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="bound">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> holf holomorphic_on_imp_differentiable_at s <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> f_cd_mw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="bound">m</span><span class="main">)</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="bound">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> holfm holomorphic_on_imp_differentiable_at s <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> der_fm <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deriv_ident<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> funpow_Suc_right<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> deriv_chain<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span> holfm holomorphic_on_imp_differentiable_at s f_cd_w <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">note</span></span> Suc<span class="main">(</span>3<span class="main">)</span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> n_Suc <span class="main">=</span> Suc
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">with</span></span> n_Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Zero_not_Suc funpow_simps_right<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> higher_deriv_id lambda_zero nat_neq_iff of_nat_0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> deriv_nffm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>deriv <span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>deriv <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> higher_deriv_comp_lemma <span class="main"><span class="main">[</span></span><span class="operator">OF</span> s holfm <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span> s _ fms_sb order_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span> fss higher_deriv_comp_iter_lemma holf holf holomorphic_deriv s
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> funpow_Suc_right holdfm<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="main">*</span> deriv <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_on_mult <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holdffm holdfm<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>deriv <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="main">*</span> deriv <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> higher_deriv_transform_within_open <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ s <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_funpow deriv_chain f_cd_mw f_cd_w fms_sb funpow_swap1 image_subset_iff o_id<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> of_nat<span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">*</span>
                     <span class="main">(</span>deriv <span class="main">^^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>deriv <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> higher_deriv_mult <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holdffm holdfm s <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> of_nat<span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">*</span>
                     <span class="main">(</span>deriv <span class="main">^^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>deriv <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>deriv <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> Suc <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span><span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> higher_deriv_comp_iter_lemma <span class="main"><span class="main">[</span></span><span class="operator">OF</span> s holf fss <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>›</span></span> le dfz<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> n_Suc<span class="main">(</span>3<span class="main">)</span> less le le_imp_less_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_swap1 nz<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> comm_monoid_add_class.sum.mono_neutral_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> of_nat <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>deriv <span class="free">f</span><span class="main">)</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Groups_Big.comm_monoid_add_class.sum.insert<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deriv_nffm <span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span> of_nat_Suc <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> n_Suc<span class="main">(</span>2<span class="main">)</span> Suc
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> funpow.simps <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> funpow_simps_right<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>deriv <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> of_nat <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>deriv <span class="free">f</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> funpow_Suc_right<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Should be proved for n-dimensional vectors of complex numbers›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> first_Cartan_dim_1<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> holf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"open <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"bounded <span class="free">s</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> fss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">s</span> <span class="main">⊆</span> <span class="free">s</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> dfz <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊆</span> ball <span class="free">z</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bounded <span class="free">s</span>›</span></span> bounded_subset_ballD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"cball <span class="free">z</span> <span class="skolem">r</span> <span class="main">⊆</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span> open_contains_cball <span class="quoted"><span class="quoted">‹open <span class="free">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bzr<span class="main">:</span> <span class="quoted"><span class="quoted">"ball <span class="free">z</span> <span class="skolem">r</span> <span class="main">⊆</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ball_subset_cball <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> fms_sb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="skolem">m</span><span class="main">)</span> <span class="main">`</span> <span class="free">s</span> <span class="main">⊆</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> fss <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> holfm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="skolem">m</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holomorphic_on_ident<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> funpow_Suc_right holomorphic_on_compose_gen <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holf _ fss<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> id <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">n</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">m</span> <span class="main">*</span> cmod <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> fact <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">/</span> <span class="skolem">r</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> holfm'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> ball <span class="free">z</span> <span class="skolem">r</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> holfm bzr holomorphic_on_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> contfm'<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cball <span class="free">z</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cball <span class="free">z</span> <span class="skolem">r</span> <span class="main">⊆</span> <span class="free">s</span>›</span></span> holfm holomorphic_on_imp_continuous_on holomorphic_on_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">m</span> <span class="main">*</span> cmod <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> cmod <span class="main">(</span>real <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cmod <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> higher_deriv_iter_top_lemma <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹open <span class="free">s</span>›</span></span> holf fss <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>›</span></span> dfz<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> fact <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">/</span> <span class="skolem">r</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Cauchy_higher_deriv_bound <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holfm' contfm' <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> y<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">z</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">using</span></span> fms_sb c r ball_subset_cball
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> real_archimedian_rdiv_eq_0 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>fact <span class="skolem"><span class="skolem">n</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="main"><span class="main">/</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="main"><span class="main">^</span></span> <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">c</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> n1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">w</span> <span class="main">=</span> id <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_fun_eq_on_connected
                 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holf holomorphic_on_id <span class="quoted"><span class="quoted">‹open <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹connected <span class="free">s</span>›</span></span> * <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∈</span> <span class="free">s</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Second Cartan Theorem.›</span></span>

<span class="keyword1" id="Cartan-Cartan_is_linear"><span class="command">lemma</span></span> Cartan_is_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> holf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"open <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ins<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">z</span><span class="main">.</span> <span class="main">⟦</span>norm <span class="bound">u</span> <span class="main">=</span> <span class="main">1</span><span class="main">;</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">u</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> feq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">z</span><span class="main">.</span> <span class="main">⟦</span>norm <span class="bound">u</span> <span class="main">=</span> <span class="main">1</span><span class="main">;</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="bound">u</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">u</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> <span class="free">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> feq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> uneq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">^</span><span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="skolem">z</span>"</span></span>
       <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">u</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">u</span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> holfuw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_on_compose_gen <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ holf<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that ins <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> holomorphic_on_linear<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> hol_d_fuw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_higher_deriv <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> holf assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">w</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> deriv <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="bound">w</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> complex_derivative_transform_within_open <span class="main"><span class="main">[</span></span><span class="operator">OF</span> hol_d_fuw<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> holomorphic_higher_deriv <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> assms Suc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">*</span> deriv <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> deriv_cmult<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Suc <span class="quoted"><span class="quoted">‹open <span class="free">s</span>›</span></span> holf holomorphic_higher_deriv holomorphic_on_imp_differentiable_at <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> higher_deriv_compose_linear <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holf <span class="quoted"><span class="quoted">‹open <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹open <span class="free">s</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ins that<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> higher_deriv_transform_within_open <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holfuw<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">w</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">w</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> holf assms that<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">s</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> dnf0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">::</span>complex<span class="main">.</span> norm <span class="bound">u</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">u</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="bound">u</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">::</span>complex<span class="main">.</span> norm <span class="bound">u</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="bound">u</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> complex_not_root_unity <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> len
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> le_diff_conv2<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> power_diff<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> **<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> uneq <span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∈</span> <span class="free">s</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"deriv <span class="free">f</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_fun_eq_on_connected <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holf _ <span class="quoted"><span class="quoted">‹open <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹connected <span class="free">s</span>›</span></span> _ <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∈</span> <span class="free">s</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> dnf0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> holomorphic_on_linear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Should be proved for n-dimensional vectors of complex numbers›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> second_Cartan_dim_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> holf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> ball <span class="main">0</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> holg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">holomorphic_on</span> ball <span class="main">0</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ballf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ballg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> gf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="free">r</span><span class="main">.</span> <span class="free">g</span> <span class="bound">z</span> <span class="main">=</span> exp<span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> of_real <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> c_le_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">⟹</span> <span class="skolem">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> rst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">∨</span> <span class="bound">s</span><span class="main">/</span><span class="bound">r</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">*</span> <span class="bound">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> mult_less_cancel_left_disj nonzero_mult_div_cancel_left times_divide_eq_right<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">¬</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">r</span> <span class="main">&lt;</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> less_eq_real_def mult.right_neutral mult_left_mono not_less<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">c</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">/</span> <span class="skolem">c</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">c</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rst <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_by_1 frac_less2 less_le_trans mult.commute not_le order_refl pos_divide_le_eq zero_less_one<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> linear not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> ugeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">z</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> nou<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="skolem">u</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> hol1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> ball <span class="main">0</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_on_compose_gen <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ holf<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> holg<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">using</span></span> nou ballg
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_norm norm_mult holomorphic_on_const<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> cdf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span> holf holomorphic_on_imp_differentiable_at <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> cdg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span> holg holomorphic_on_imp_differentiable_at <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> cd_fug<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> field_differentiable_compose <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">u</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">using</span></span> cdf cdg
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="free">g</span> <span class="main">0</span> <span class="main">=</span> deriv <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="free">f</span> <span class="main">0</span> <span class="main">*</span> deriv <span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> open_ball <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span> ballf centre_in_ball deriv_left_inverse gf holf holg image_subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> equ<span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="free">f</span> <span class="main">0</span> <span class="main">*</span> deriv <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cdg deriv_cmult<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> der1<span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> field_class.field_divide_inverse deriv_cmult_right <span class="main"><span class="main">[</span></span><span class="operator">OF</span> cd_fug<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> deriv_chain <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">u</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span> cdf cdg <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equ<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> fugeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">w</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">w</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> first_Cartan_dim_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> hol1<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> z<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> der1<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> nou ballf ballg
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm norm_mult norm_divide<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> fugeq nonzero_mult_div_cancel_left z times_divide_eq_right<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fg mem_ball_0 mult_cancel_right2 norm_mult nou z<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> gf<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm norm_mult nou<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> ballg mem_ball_0 z <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> gf<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm norm_mult nou<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ballg mem_ball_0 mult.left_neutral norm_mult nou z<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Cartan_is_linear <span class="main"><span class="main">[</span></span><span class="operator">OF</span> holg<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span> ugeq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_norm norm_mult<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> gr2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> c<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span> ballf mem_ball_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span> c dist_commute fg mem_ball mult_zero_left perfect_choose_dist<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> xless<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">*</span> cmod <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> norm <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> cmod <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">∈</span> ball <span class="main">0</span> <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mem_ball_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> gf <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssubst<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> c<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballf<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> ballf <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> that
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult dist_0_norm<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> norm <span class="skolem">c</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> c_le_1<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> xless <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">;</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> cmod <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> c <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> ballg <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult dist_0_norm<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">c</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> c_le_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> norm <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> complex_norm_eq_1_exp c <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>