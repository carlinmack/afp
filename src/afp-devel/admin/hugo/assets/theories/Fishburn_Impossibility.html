<div id="Social_Choice_Functions">
<div class="head">
<h1>Theory Social_Choice_Functions</h1>
</div>
<pre class="source"><span class="comment1">(*  
  Title:    Social_Choice_Functions.thy
  Author:   Manuel Eberl, TU München

  Definitions of Social Choice Functions, their properties, and related concepts
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Social Choice Functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Social_Choice_Functions
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../../randomised_social_choice/theories/#Preference_Profile_Cmd">Randomised_Social_Choice.Preference_Profile_Cmd</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Weighted majority graphs›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">supporters</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'agent</span><span class="main">,</span> <span class="tfree">'alt</span><span class="main">)</span> pref_profile <span class="main">⇒</span> <span class="tfree">'alt</span> <span class="main">⇒</span> <span class="tfree">'alt</span> <span class="main">⇒</span> <span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  supporters_auxdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">supporters</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">i</span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">}</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">weighted_majority</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'agent</span><span class="main">,</span> <span class="tfree">'alt</span><span class="main">)</span> pref_profile <span class="main">⇒</span> <span class="tfree">'alt</span> <span class="main">⇒</span> <span class="tfree">'alt</span> <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">weighted_majority</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> int <span class="main">(</span>card <span class="main">(</span>supporters <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span>card <span class="main">(</span>supporters <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="Social_Choice_Functions-weighted_majority_refl"><span class="command">lemma</span></span> weighted_majority_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"weighted_majority <span class="free">R</span> <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weighted_majority_def<span class="main">)</span>
  
<span class="keyword1" id="Social_Choice_Functions-weighted_majority_swap"><span class="command">lemma</span></span> weighted_majority_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"weighted_majority <span class="free">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span>weighted_majority <span class="free">R</span> <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weighted_majority_def<span class="main">)</span>

<span class="keyword1" id="Social_Choice_Functions-eval_set_filter"><span class="command">lemma</span></span> eval_set_filter<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Set.filter <span class="free">P</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> Set.filter <span class="free">P</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">x</span> <span class="main">(</span>Set.filter <span class="free">P</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> Set.filter <span class="free">P</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> Set.filter <span class="free">P</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Set.filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">context</span></span> election
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Social_Choice_Functions-supporters_def"><span class="command">lemma</span></span> supporters_def<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"supporters <span class="free">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">i</span></span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">x</span> <span class="main">≽[</span><span class="free">R</span> <span class="bound">i</span><span class="main">]</span> <span class="free">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_outside <span class="keyword1"><span class="command">unfolding</span></span> supporters_auxdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Social_Choice_Functions-supporters_nonagent1"><span class="command">lemma</span></span> supporters_nonagent1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">alts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"supporters <span class="free">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supporters_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_outside<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Social_Choice_Functions-supporters_nonagent2"><span class="command">lemma</span></span> supporters_nonagent2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">alts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"supporters <span class="free">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> supporters_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_outside<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Social_Choice_Functions-weighted_majority_nonagent1"><span class="command">lemma</span></span> weighted_majority_nonagent1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">alts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"weighted_majority <span class="free">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weighted_majority_def supporters_nonagent1 supporters_nonagent2<span class="main">)</span>

<span class="keyword1" id="Social_Choice_Functions-weighted_majority_nonagent2"><span class="command">lemma</span></span> weighted_majority_nonagent2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">alts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"weighted_majority <span class="free">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> weighted_majority_def supporters_nonagent1 supporters_nonagent2<span class="main">)</span>

<span class="keyword1" id="Social_Choice_Functions-weighted_majority_eq_iff"><span class="command">lemma</span></span> weighted_majority_eq_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R1</span>"</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"weighted_majority <span class="free">R1</span> <span class="main">=</span> weighted_majority <span class="free">R2</span> <span class="main">⟷</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">alts</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">alts</span><span class="main">.</span> weighted_majority <span class="free">R1</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> weighted_majority <span class="free">R2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'alt</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">alts</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">alts</span><span class="main">.</span> weighted_majority <span class="free">R1</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> weighted_majority <span class="free">R2</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"weighted_majority <span class="free">R1</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> weighted_majority <span class="free">R2</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">alts</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">alts</span>"</span></span><span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff weighted_majority_nonagent1 weighted_majority_nonagent2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Social Choice Functions›</span></span>

<span class="keyword1"><span class="command">locale</span></span> social_choice_function <span class="main">=</span> election <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> 
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">scf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'agent</span><span class="main">,</span> <span class="tfree">'alt</span><span class="main">)</span> pref_profile <span class="main">⇒</span> <span class="tfree">'alt</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> scf_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span> <span class="main">⟹</span> <span class="free">scf</span> <span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> scf_alts<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span> <span class="main">⟹</span> <span class="free">scf</span> <span class="free">R</span> <span class="main">⊆</span> <span class="free">alts</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Anonymity›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  An SCF is anonymous if permuting the agents in the input does not change the result.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> anonymous_scf <span class="main">=</span> social_choice_function <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> anonymous<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="keyword1">permutes</span> <span class="free">agents</span> <span class="main">⟹</span> is_pref_profile <span class="free">R</span> <span class="main">⟹</span> <span class="free">scf</span> <span class="main">(</span><span class="free">R</span> <span class="main">∘</span> <span class="free">π</span><span class="main">)</span> <span class="main">=</span> <span class="free">scf</span> <span class="free">R</span>"</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Social_Choice_Functions-anonymous'"><span class="command">lemma</span></span> anonymous'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"anonymous_profile <span class="free">R1</span> <span class="main">=</span> anonymous_profile <span class="free">R2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R1</span>"</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">scf</span> <span class="free">R1</span> <span class="main">=</span> <span class="free">scf</span> <span class="free">R2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> anonymous_profile_agent_permutation<span class="main">[</span><span class="operator">OF</span> assms finite_agents<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">agents</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R1</span> <span class="main">=</span> <span class="free">R2</span> <span class="main">∘</span> <span class="skolem">π</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> anonymous<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">π</span></span> <span class="quoted"><span class="free">R2</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Social_Choice_Functions-anonymity_prefs_from_table"><span class="command">lemma</span></span> anonymity_prefs_from_table<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prefs_from_table_wf <span class="free">agents</span> <span class="free">alts</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"prefs_from_table_wf <span class="free">agents</span> <span class="free">alts</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span>map snd <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> mset <span class="main">(</span>map snd <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">scf</span> <span class="main">(</span>prefs_from_table <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">scf</span> <span class="main">(</span>prefs_from_table <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> prefs_from_table_agent_permutation<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> π <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> anonymous<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">π</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"prefs_from_table <span class="free">xs</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pref_profile_from_tableI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1" id="Social_Choice_Functions-anonymity_prefs_from_table_aux"><span class="command">lemma</span></span> anonymity_prefs_from_table_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R1</span> <span class="main">=</span> prefs_from_table <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"prefs_from_table_wf <span class="free">agents</span> <span class="free">alts</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R2</span> <span class="main">=</span> prefs_from_table <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"prefs_from_table_wf <span class="free">agents</span> <span class="free">alts</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span>map snd <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> mset <span class="main">(</span>map snd <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">scf</span> <span class="free">R1</span> <span class="main">=</span> <span class="free">scf</span> <span class="free">R2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> anonymity_prefs_from_table<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mset_map<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Neutrality›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  An SCF is neutral if permuting the alternatives in the input does not change the
  result, modulo the equivalent permutation in the output lottery.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> neutral_scf <span class="main">=</span> social_choice_function <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> neutral<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="keyword1">permutes</span> <span class="free">alts</span> <span class="main">⟹</span> is_pref_profile <span class="free">R</span> <span class="main">⟹</span> 
                        <span class="free">scf</span> <span class="main">(</span>permute_profile <span class="free">σ</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">`</span> <span class="free">scf</span> <span class="free">R</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Alternative formulation of neutrality that shows that our definition is 
  equivalent to that in the paper.
›</span></span>
<span class="keyword1" id="Social_Choice_Functions-neutral'"><span class="command">lemma</span></span> neutral'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="keyword1">permutes</span> <span class="free">alts</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">alts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">scf</span> <span class="main">(</span>permute_profile <span class="free">σ</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">scf</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">σ</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> permutes_inj<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> injD<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> neutral <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> an_scf <span class="main">=</span> 
  anonymous_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="main">+</span> neutral_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Social_Choice_Functions-scf_anonymous_neutral"><span class="command">lemma</span></span> scf_anonymous_neutral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> perm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="keyword1">permutes</span> <span class="free">alts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R1</span>"</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"anonymous_profile <span class="free">R1</span> <span class="main">=</span> 
                 image_mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="free">σ</span> <span class="main">`</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>anonymous_profile <span class="free">R2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">scf</span> <span class="free">R1</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">`</span> <span class="free">scf</span> <span class="free">R2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> R1<span class="main">:</span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R1</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> R2<span class="main">:</span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R2</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> perm <span class="keyword1"><span class="command">have</span></span> wf'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="main">(</span>permute_profile <span class="free">σ</span> <span class="free">R2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2.wf_permute_alts<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq perm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"anonymous_profile <span class="free">R1</span> <span class="main">=</span> anonymous_profile <span class="main">(</span>permute_profile <span class="free">σ</span> <span class="free">R2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R2.anonymous_profile_permute<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> anonymous_profile_agent_permutation<span class="main">[</span><span class="operator">OF</span> this wf<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wf'<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">agents</span>"</span></span> <span class="quoted"><span class="quoted">"permute_profile <span class="free">σ</span> <span class="free">R2</span> <span class="main">∘</span> <span class="skolem">π</span> <span class="main">=</span> <span class="free">R1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">scf</span> <span class="main">(</span>permute_profile <span class="free">σ</span> <span class="free">R2</span> <span class="main">∘</span> <span class="skolem">π</span><span class="main">)</span> <span class="main">=</span> <span class="free">scf</span> <span class="main">(</span>permute_profile <span class="free">σ</span> <span class="free">R2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> anonymous<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">`</span> <span class="free">scf</span> <span class="free">R2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> neutral<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"permute_profile <span class="free">σ</span> <span class="free">R2</span> <span class="main">∘</span> <span class="skolem">π</span> <span class="main">=</span> <span class="free">R1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Social_Choice_Functions-scf_anonymous_neutral'"><span class="command">lemma</span></span> scf_anonymous_neutral'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> perm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="keyword1">permutes</span> <span class="free">alts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R1</span>"</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"anonymous_profile <span class="free">R1</span> <span class="main">=</span> 
                 image_mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="free">σ</span> <span class="main">`</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>anonymous_profile <span class="free">R2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">scf</span> <span class="free">R1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">scf</span> <span class="free">R2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">scf</span> <span class="free">R1</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">`</span> <span class="free">scf</span> <span class="free">R2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> scf_anonymous_neutral<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">…</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">scf</span> <span class="free">R2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> injD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> permutes_inj<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> perm<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Social_Choice_Functions-scf_automorphism"><span class="command">lemma</span></span> scf_automorphism<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> perm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="keyword1">permutes</span> <span class="free">alts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="free">σ</span> <span class="main">`</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>anonymous_profile <span class="free">R</span><span class="main">)</span> <span class="main">=</span> anonymous_profile <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">`</span> <span class="free">scf</span> <span class="free">R</span> <span class="main">=</span> <span class="free">scf</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> scf_anonymous_neutral<span class="main">[</span><span class="operator">OF</span> perm wf wf eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Social_Choice_Functions-an_scf_automorphism_aux"><span class="command">lemma</span></span> an_scf_automorphism_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"prefs_from_table_wf <span class="free">agents</span> <span class="free">alts</span> <span class="free">yss</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">≡</span> prefs_from_table <span class="free">yss</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> an<span class="main">:</span> <span class="quoted"><span class="quoted">"an_scf <span class="free">agents</span> <span class="free">alts</span> <span class="free">scf</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span>map <span class="main">(</span><span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> permutation_of_list <span class="free">xs</span> <span class="main">`</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> snd<span class="main">)</span> <span class="free">yss</span><span class="main">)</span> <span class="main">=</span> mset <span class="main">(</span>map snd <span class="free">yss</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> perm<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map fst <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">alts</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map snd <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>map fst <span class="free">xs</span><span class="main">)</span>"</span></span> 
                <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">alts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> permutation_of_list <span class="free">xs</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">scf</span> <span class="free">R</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">scf</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> perm <span class="main">=</span> list_permutesI<span class="main">[</span><span class="operator">OF</span> perm<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"permutation_of_list <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> perm' <span class="main">=</span> permutation_of_list_permutes <span class="main">[</span><span class="operator">OF</span> perm<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> wf <span class="keyword1"><span class="command">have</span></span> wf'<span class="main">:</span> <span class="quoted"><span class="quoted">"pref_profile_wf <span class="free">agents</span> <span class="free">alts</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pref_profile_from_tableI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> R<span class="main">:</span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> perm' <span class="keyword1"><span class="command">interpret</span></span> R'<span class="main">:</span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="quoted">"permute_profile <span class="var">?σ</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R.wf_permute_alts<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> an <span class="keyword1"><span class="command">interpret</span></span> an_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> eq wf <span class="keyword1"><span class="command">have</span></span> eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="var">?σ</span> <span class="main">`</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>anonymous_profile <span class="free">R</span><span class="main">)</span> <span class="main">=</span> anonymous_profile <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> anonymise_prefs_from_table mset_map multiset.map_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">scf</span> <span class="free">R</span> <span class="main">⟷</span> <span class="var">?σ</span> <span class="free">x</span> <span class="main">∈</span> <span class="var">?σ</span> <span class="main">`</span> <span class="free">scf</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> injD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> permutes_inj<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> perm'<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> eq' x wf' perm' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?σ</span> <span class="main">`</span> <span class="free">scf</span> <span class="free">R</span> <span class="main">=</span> <span class="free">scf</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> scf_automorphism<span class="main">)</span> 
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R.anonymous_profile_permute pref_profile_from_tableI<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Weighted-majoritarian SCFs›</span></span>

<span class="keyword1"><span class="command">locale</span></span> pairwise_scf <span class="main">=</span> social_choice_function <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pairwise<span class="main">:</span>
    <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R1</span> <span class="main">⟹</span> is_pref_profile <span class="free">R2</span> <span class="main">⟹</span> weighted_majority <span class="free">R1</span> <span class="main">=</span> weighted_majority <span class="free">R2</span> <span class="main">⟹</span>
       <span class="free">scf</span> <span class="free">R1</span> <span class="main">=</span> <span class="free">scf</span> <span class="free">R2</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Pareto efficiency›</span></span>

<span class="keyword1"><span class="command">locale</span></span> pareto_efficient_scf <span class="main">=</span> social_choice_function <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pareto_efficient<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span> <span class="main">⟹</span> <span class="free">scf</span> <span class="free">R</span> <span class="main">∩</span> pareto_losers <span class="free">R</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Social_Choice_Functions-pareto_efficient'"><span class="command">lemma</span></span> pareto_efficient'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≻[</span>Pareto<span class="main">(</span><span class="free">R</span><span class="main">)</span><span class="main">]</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">scf</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pareto_efficient<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span> assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pareto_losers_def<span class="main">)</span>

<span class="keyword1" id="Social_Choice_Functions-pareto_efficient''"><span class="command">lemma</span></span> pareto_efficient''<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">y</span> <span class="main">≽[</span><span class="free">R</span> <span class="bound">i</span><span class="main">]</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">y</span> <span class="main">≼[</span><span class="free">R</span> <span class="free">i</span><span class="main">]</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">scf</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">interpret</span></span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2-<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pareto_efficient'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pareto_iff strongly_preferred_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Set extensions›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'alt</span> set_extension <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> relation <span class="main">⇒</span> <span class="tfree">'alt</span> set relation"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Kelly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set_extension"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≽[</span><span class="free">Kelly</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="bound">a</span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">]</span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Social_Choice_Functions-Kelly_strict_iff"><span class="command">lemma</span></span> Kelly_strict_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≻[</span>Kelly<span class="main">(</span><span class="free">R</span><span class="main">)</span><span class="main">]</span> <span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">R</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">R</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strongly_preferred_def Kelly_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Kelly_eval <span class="main">=</span> Kelly_def Kelly_strict_iff

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Fishb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set_extension"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≽[</span><span class="free">Fishb</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">a</span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">]</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="bound">a</span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">]</span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Social_Choice_Functions-Fishb_strict_iff"><span class="command">lemma</span></span> Fishb_strict_iff<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≻[</span>Fishb<span class="main">(</span><span class="free">R</span><span class="main">)</span><span class="main">]</span> <span class="free">B</span> <span class="main">⟷</span> 
     <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">.</span> <span class="free">R</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">R</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">.</span> <span class="free">R</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">R</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strongly_preferred_def Fishb_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Fishb_eval <span class="main">=</span> Fishb_def Fishb_strict_iff


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Strategyproofness›</span></span>

<span class="keyword1"><span class="command">locale</span></span> strategyproof_scf <span class="main">=</span> 
  social_choice_function <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">set_ext</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set_extension"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> strategyproof<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span> <span class="main">⟹</span> total_preorder_on <span class="free">alts</span> <span class="free">Ri'</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span>
       <span class="main">¬</span> <span class="free">scf</span> <span class="main">(</span><span class="free">R</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="free">Ri'</span><span class="main">)</span><span class="main">)</span> <span class="main">≻[</span><span class="free">set_ext</span><span class="main">(</span><span class="free">R</span> <span class="free">i</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> <span class="free">R</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> strategyproof_anonymous_scf <span class="main">=</span>
  anonymous_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="main">+</span> strategyproof_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="quoted"><span class="free">set_ext</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_ext</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Social_Choice_Functions-strategyproof'"><span class="command">lemma</span></span> strategyproof'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R1</span>"</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"anonymous_profile <span class="free">R2</span> <span class="main">=</span> anonymous_profile <span class="free">R1</span> <span class="main">-</span> 
             <span class="main">{#</span>weak_ranking <span class="main">(</span><span class="free">R1</span> <span class="free">i</span><span class="main">)</span><span class="main">#}</span> <span class="main">+</span> <span class="main">{#</span>weak_ranking <span class="main">(</span><span class="free">R2</span> <span class="free">j</span><span class="main">)</span><span class="main">#}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">scf</span> <span class="free">R2</span> <span class="main">≻[</span><span class="free">set_ext</span> <span class="main">(</span><span class="free">R1</span> <span class="free">i</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> <span class="free">R1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">R1</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="free">R2</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> R1<span class="main">:</span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R1</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> R2<span class="main">:</span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R2</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">∈</span> <span class="free">agents</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"total_preorder_on <span class="free">alts</span> <span class="main">(</span><span class="free">R2</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> strategyproof<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">scf</span> <span class="var">?R3</span> <span class="main">≻[</span><span class="free">set_ext</span> <span class="main">(</span><span class="free">R1</span> <span class="free">i</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> <span class="free">R1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">scf</span> <span class="var">?R3</span> <span class="main">=</span> <span class="free">scf</span> <span class="free">R2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> anonymous'<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1.anonymous_profile_update<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> preorder_on
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Social_Choice_Functions-strict_not_outside"><span class="command">lemma</span></span> strict_not_outside<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≺[</span><span class="free">le</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms not_outside<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> strongly_preferred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lifting preferences›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Preference profiles can be lifted to a setting with more agents and alternatives by padding
  them with dummy agents and alternatives in such a way that every original agent prefers and
  original alternative over any dummy alternative and is indifferent between the dummy alternatives.
  Moreover, every dummy agent is completely indifferent.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lift_prefs</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set <span class="main">⇒</span> <span class="tfree">'alt</span> set <span class="main">⇒</span> <span class="tfree">'alt</span> relation <span class="main">⇒</span> <span class="tfree">'alt</span> relation"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lift_prefs</span> <span class="free"><span class="bound"><span class="entity">alts</span></span></span> <span class="free"><span class="bound"><span class="entity">alts'</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> 
     <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">alts'</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">alts'</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">alts</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">alts</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Social_Choice_Functions-lift_prefs_wf"><span class="command">lemma</span></span> lift_prefs_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"total_preorder_on <span class="free">alts</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">alts</span> <span class="main">⊆</span> <span class="free">alts'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"total_preorder_on <span class="free">alts'</span> <span class="main">(</span>lift_prefs <span class="free">alts</span> <span class="free">alts'</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> R<span class="main">:</span> total_preorder_on <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">insert</span> R.total<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> R.trans <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_prefs_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lift_pref_profile</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set <span class="main">⇒</span> <span class="tfree">'alt</span> set <span class="main">⇒</span> <span class="tfree">'agent</span> set <span class="main">⇒</span> <span class="tfree">'alt</span> set <span class="main">⇒</span>
       <span class="main">(</span><span class="tfree">'agent</span><span class="main">,</span> <span class="tfree">'alt</span><span class="main">)</span> pref_profile <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'agent</span><span class="main">,</span> <span class="tfree">'alt</span><span class="main">)</span> pref_profile"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lift_pref_profile</span> <span class="free"><span class="bound"><span class="entity">agents</span></span></span> <span class="free"><span class="bound"><span class="entity">alts</span></span></span> <span class="free"><span class="bound"><span class="entity">agents'</span></span></span> <span class="free"><span class="bound"><span class="entity">alts'</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> 
     <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">alts'</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">alts'</span></span></span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">agents'</span></span></span> <span class="main">∧</span>
     <span class="main">(</span><span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">alts</span></span></span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">agents</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">alts</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">i</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Social_Choice_Functions-lift_pref_profile_conv_vector"><span class="command">lemma</span></span> lift_pref_profile_conv_vector<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lift_pref_profile <span class="free">agents</span> <span class="free">alts</span> <span class="free">agents'</span> <span class="free">alts'</span> <span class="free">R</span> <span class="free">i</span> <span class="main">=</span> lift_prefs <span class="free">alts</span> <span class="free">alts'</span> <span class="main">(</span><span class="free">R</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_pref_profile_def lift_prefs_def<span class="main">)</span>

<span class="keyword1" id="Social_Choice_Functions-lift_pref_profile_wf"><span class="command">lemma</span></span> lift_pref_profile_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pref_profile_wf <span class="free">agents</span> <span class="free">alts</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">agents</span> <span class="main">⊆</span> <span class="free">agents'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">alts</span> <span class="main">⊆</span> <span class="free">alts'</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">alts'</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">R'</span> <span class="main">≡</span> lift_pref_profile <span class="free">agents</span> <span class="free">alts</span> <span class="free">agents'</span> <span class="free">alts'</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"pref_profile_wf <span class="free">agents'</span> <span class="free">alts'</span> <span class="free">R'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> R<span class="main">:</span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_total_preorder_on <span class="free">alts'</span> <span class="main">(</span><span class="free">R'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">if</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> finite_total_preorder_on <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> True assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_pref_profile_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> total <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trans<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms i <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_pref_profile_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R'</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∉</span> <span class="free">agents'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">unfolding</span></span> lift_pref_profile_def R'_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pref_profile_wf_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Social_Choice_Functions-lift_pref_profile_permute_agents"><span class="command">lemma</span></span> lift_pref_profile_permute_agents<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="keyword1">permutes</span> <span class="free">agents</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">agents</span> <span class="main">⊆</span> <span class="free">agents'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lift_pref_profile <span class="free">agents</span> <span class="free">alts</span> <span class="free">agents'</span> <span class="free">alts'</span> <span class="main">(</span><span class="free">R</span> <span class="main">∘</span> <span class="free">π</span><span class="main">)</span> <span class="main">=</span> 
             lift_pref_profile <span class="free">agents</span> <span class="free">alts</span> <span class="free">agents'</span> <span class="free">alts'</span> <span class="free">R</span> <span class="main">∘</span> <span class="free">π</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms permutes_subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_pref_profile_def o_def permutes_in_image<span class="main">)</span>

<span class="keyword1" id="Social_Choice_Functions-lift_pref_profile_permute_alts"><span class="command">lemma</span></span> lift_pref_profile_permute_alts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="keyword1">permutes</span> <span class="free">alts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">alts</span> <span class="main">⊆</span> <span class="free">alts'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"lift_pref_profile <span class="free">agents</span> <span class="free">alts</span> <span class="free">agents'</span> <span class="free">alts'</span> <span class="main">(</span>permute_profile <span class="free">σ</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> 
             permute_profile <span class="free">σ</span> <span class="main">(</span>lift_pref_profile <span class="free">agents</span> <span class="free">alts</span> <span class="free">agents'</span> <span class="free">alts'</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"inv <span class="free">σ</span> <span class="keyword1">permutes</span> <span class="free">alts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> permutes_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">σ</span> <span class="keyword1">permutes</span> <span class="free">alts'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> permutes_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> inv <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms permutes_inj<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹inv <span class="free">σ</span> <span class="keyword1">permutes</span> <span class="free">alts</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_pref_profile_def permutes_in_image
          permute_profile_def fun_eq_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> injD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">agents</span> <span class="free">alts</span> <span class="free">R</span> <span class="free">agents'</span> <span class="free">alts'</span> <span class="free">R'</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> R_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"pref_profile_wf <span class="free">agents</span> <span class="free">alts</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> election<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">agents</span> <span class="main">⊆</span> <span class="free">agents'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">alts</span> <span class="main">⊆</span> <span class="free">alts'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">alts</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">agents</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">alts'</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">R'</span> <span class="main">≡</span> lift_pref_profile <span class="free">agents</span> <span class="free">alts</span> <span class="free">agents'</span> <span class="free">alts'</span> <span class="free">R</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> R<span class="main">:</span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">interpretation</span></span> R'<span class="main">:</span> pref_profile_wf <span class="quoted"><span class="free">agents'</span></span> <span class="quoted"><span class="free">alts'</span></span> <span class="quoted"><span class="free">R'</span></span> 
  <span class="keyword1"><span class="command">using</span></span> election R_wf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R'_def lift_pref_profile_wf<span class="main">)</span>

<span class="keyword1" id="Social_Choice_Functions-lift_pref_profile_strict_iff"><span class="command">lemma</span></span> lift_pref_profile_strict_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≺[</span>lift_pref_profile <span class="free">agents</span> <span class="free">alts</span> <span class="free">agents'</span> <span class="free">alts'</span> <span class="free">R</span> <span class="free">i</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟷</span>
     <span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">∈</span> <span class="free">alts</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">alts'</span> <span class="main">-</span> <span class="free">alts</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">≺[</span><span class="free">R</span> <span class="free">i</span><span class="main">]</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> total_preorder_on <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_outside election
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lift_pref_profile_def strongly_preferred_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_pref_profile_def strongly_preferred_def<span class="main">)</span>

<span class="keyword1" id="Social_Choice_Functions-preferred_alts_lift_pref_profile"><span class="command">lemma</span></span> preferred_alts_lift_pref_profile<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">alts'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"preferred_alts <span class="main">(</span><span class="free">R'</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
             <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">alts</span> <span class="keyword1">then</span> preferred_alts <span class="main">(</span><span class="free">R</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">alts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> Ri<span class="main">:</span> total_preorder_on <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> i x election Ri.not_outside
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> preferred_alts_def R'_def lift_pref_profile_def Ri.refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> preferred_alts_def R'_def lift_pref_profile_def i x<span class="main">)</span>

<span class="keyword1" id="Social_Choice_Functions-lift_pref_profile_Pareto_iff"><span class="command">lemma</span></span> lift_pref_profile_Pareto_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≼[</span>Pareto<span class="main">(</span><span class="free">R'</span><span class="main">)</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">alts'</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">alts'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">x</span> <span class="main">∉</span> <span class="free">alts</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">≼[</span>Pareto<span class="main">(</span><span class="free">R</span><span class="main">)</span><span class="main">]</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> R.nonempty_agents <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> Ri<span class="main">:</span> finite_total_preorder_on <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> R'.Pareto_iff R.Pareto_iff <span class="keyword1"><span class="command">unfolding</span></span> R'_def lift_pref_profile_def
    <span class="keyword1"><span class="command">using</span></span> election i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> preorder_on.refl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> R.in_dom<span class="main"><span class="main">]</span></span> 
      <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> R.nonempty_alts R.nonempty_agents  <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ri.not_outside<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Social_Choice_Functions-lift_pref_profile_Pareto_strict_iff"><span class="command">lemma</span></span> lift_pref_profile_Pareto_strict_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≺[</span>Pareto<span class="main">(</span><span class="free">R'</span><span class="main">)</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">alts'</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">alts'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">x</span> <span class="main">∉</span> <span class="free">alts</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">alts</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">≺[</span>Pareto<span class="main">(</span><span class="free">R</span><span class="main">)</span><span class="main">]</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strongly_preferred_def lift_pref_profile_Pareto_iff R.Pareto.not_outside<span class="main">)</span>

<span class="keyword1" id="Social_Choice_Functions-pareto_losers_lift_pref_profile"><span class="command">lemma</span></span> pareto_losers_lift_pref_profile<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"pareto_losers <span class="free">R'</span> <span class="main">=</span> pareto_losers <span class="free">R</span> <span class="main">∪</span> <span class="main">(</span><span class="free">alts'</span> <span class="main">-</span> <span class="free">alts</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">alts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">alts</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≺[</span>Pareto<span class="main">(</span><span class="free">R</span><span class="main">)</span><span class="main">]</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that R.Pareto.not_outside <span class="keyword1"><span class="command">unfolding</span></span> strongly_preferred_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">alts'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">alts</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> election that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> R.nonempty_alts <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">alts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pareto_losers_def lift_pref_profile_Pareto_strict_iff <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> A B<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lowering SCFs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Using the preference lifting, we can now \emph{lower} an SCF to a setting with fewer agents
  and alternatives under mild conditions to the original SCF. This preserves many nice properties, 
  such as anonymity, neutrality, and strategyproofness.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> scf_lowering <span class="main">=</span> 
  pareto_efficient_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">agents'</span> <span class="free">alts'</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> agents'_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">agents'</span> <span class="main">⊆</span> <span class="free">agents</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> alts'_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">alts'</span> <span class="main">⊆</span> <span class="free">alts</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> agents'_nonempty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">agents'</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> alts'_nonempty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">alts'</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Social_Choice_Functions-finite_agents'"><span class="command">lemma</span></span> finite_agents' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">agents'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> agents'_subset finite_agents <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>

<span class="keyword1" id="Social_Choice_Functions-finite_alts'"><span class="command">lemma</span></span> finite_alts' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">alts'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alts'_subset finite_alts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">lift</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'agent</span><span class="main">,</span> <span class="tfree">'alt</span><span class="main">)</span> pref_profile <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'agent</span><span class="main">,</span> <span class="tfree">'alt</span><span class="main">)</span> pref_profile"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lift</span> <span class="main">≡</span> lift_pref_profile <span class="free">agents'</span> <span class="free">alts'</span> <span class="free">agents</span> <span class="free">alts</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lowered</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'agent</span><span class="main">,</span> <span class="tfree">'alt</span><span class="main">)</span> pref_profile <span class="main">⇒</span> <span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lowered</span> <span class="main">=</span> <span class="free">scf</span> <span class="main">∘</span> lift"</span></span>

<span class="keyword1" id="Social_Choice_Functions-lift_wf"><span class="command">lemma</span></span> lift_wf <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"pref_profile_wf <span class="free">agents'</span> <span class="free">alts'</span> <span class="free">R</span> <span class="main">⟹</span> is_pref_profile <span class="main">(</span>lift <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alts'_subset agents'_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lift_pref_profile_wf<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">sublocale</span></span> lowered<span class="main">:</span> election <span class="quoted"><span class="free">agents'</span></span> <span class="quoted"><span class="free">alts'</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Social_Choice_Functions-preferred_alts_lift"><span class="command">lemma</span></span> preferred_alts_lift<span class="main">:</span>
  <span class="quoted"><span class="quoted">"lowered.is_pref_profile <span class="free">R</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">alts</span> <span class="main">⟹</span>
     preferred_alts <span class="main">(</span>lift <span class="free">R</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
       <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">agents'</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">alts'</span> <span class="keyword1">then</span> preferred_alts <span class="main">(</span><span class="free">R</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">alts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alts'_subset agents'_subset
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> preferred_alts_lift_pref_profile<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Social_Choice_Functions-pareto_losers_lift"><span class="command">lemma</span></span> pareto_losers_lift<span class="main">:</span>
  <span class="quoted"><span class="quoted">"lowered.is_pref_profile <span class="free">R</span> <span class="main">⟹</span> pareto_losers <span class="main">(</span>lift <span class="free">R</span><span class="main">)</span> <span class="main">=</span> pareto_losers <span class="free">R</span> <span class="main">∪</span> <span class="main">(</span><span class="free">alts</span> <span class="main">-</span> <span class="free">alts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> agents'_subset alts'_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pareto_losers_lift_pref_profile<span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">sublocale</span></span> lowered<span class="main">:</span> social_choice_function <span class="quoted"><span class="free">agents'</span></span> <span class="quoted"><span class="free">alts'</span></span> <span class="quoted">lowered</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="keyword3"><span class="command">assume</span></span> R_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"pref_profile_wf <span class="free">agents'</span> <span class="free">alts'</span> <span class="skolem">R</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> R_wf <span class="keyword1"><span class="command">have</span></span> R'_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"pref_profile_wf <span class="free">agents</span> <span class="free">alts</span> <span class="main">(</span>lift <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_wf<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lowered <span class="skolem">R</span> <span class="main">⊆</span> <span class="free">alts'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> lowered <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">scf</span> <span class="main">(</span>lift <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def lowered_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">scf</span> <span class="main">(</span>lift <span class="skolem">R</span><span class="main">)</span> <span class="main">∩</span> pareto_losers <span class="main">(</span>lift <span class="skolem">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pareto_efficient R'_wf<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">alts'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> scf_alts<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lift <span class="skolem">R</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pareto_losers_lift R_wf R'_wf<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lowered <span class="skolem">R</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R'_wf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lowered_def scf_nonempty<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> lowered<span class="main">:</span> pareto_efficient_scf <span class="quoted"><span class="free">agents'</span></span> <span class="quoted"><span class="free">alts'</span></span> <span class="quoted">lowered</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="keyword3"><span class="command">assume</span></span> R_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"pref_profile_wf <span class="free">agents'</span> <span class="free">alts'</span> <span class="skolem">R</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> R_wf <span class="keyword1"><span class="command">have</span></span> R'_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"pref_profile_wf <span class="free">agents</span> <span class="free">alts</span> <span class="main">(</span>lift <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_wf<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lowered <span class="skolem">R</span> <span class="main">∩</span> pareto_losers <span class="main">(</span>lift <span class="skolem">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lowered_def o_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pareto_efficient R'_wf<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> R_wf <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lowered <span class="skolem">R</span> <span class="main">∩</span> pareto_losers <span class="skolem">R</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pareto_losers_lift<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> scf_lowering_anonymous <span class="main">=</span> 
  anonymous_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="main">+</span>
  scf_lowering <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="quoted"><span class="free">agents'</span></span> <span class="quoted"><span class="free">alts'</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="free">agents'</span> <span class="free">alts'</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> lowered<span class="main">:</span> anonymous_scf <span class="quoted"><span class="free">agents'</span></span> <span class="quoted"><span class="free">alts'</span></span> <span class="quoted">lowered</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="skolem">R</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">agents'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lowered.is_pref_profile <span class="skolem">R</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lowered <span class="main">(</span><span class="skolem">R</span> <span class="main">∘</span> <span class="skolem">π</span><span class="main">)</span> <span class="main">=</span> lowered <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> agents'_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lowered_def lift_pref_profile_permute_agents anonymous permutes_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> scf_lowering_neutral <span class="main">=</span> 
  neutral_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="main">+</span>
  scf_lowering <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="quoted"><span class="free">agents'</span></span> <span class="quoted"><span class="free">alts'</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="free">agents'</span> <span class="free">alts'</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> lowered<span class="main">:</span> neutral_scf <span class="quoted"><span class="free">agents'</span></span> <span class="quoted"><span class="free">alts'</span></span> <span class="quoted">lowered</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="skolem">R</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="free">alts'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lowered.is_pref_profile <span class="skolem">R</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lowered <span class="main">(</span>permute_profile <span class="skolem">σ</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">σ</span> <span class="main">`</span> lowered <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> alts'_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lowered_def lift_pref_profile_permute_alts neutral permutes_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following is a technical condition that we need from a set extensions in order for
  strategyproofness to survive the lowering. The condition could probably be weakened a bit,
  but it is good enough for our purposes the way it is.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> liftable_set_extension <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">alts'</span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_ext</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> relation <span class="main">⇒</span> <span class="tfree">'alt</span> set relation"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_ext_strong_lift<span class="main">:</span>
    <span class="quoted"><span class="quoted">"total_preorder_on <span class="free">alts'</span> <span class="free">R</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">alts'</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">alts'</span> <span class="main">⟹</span>
       <span class="free">A</span> <span class="main">≺[</span><span class="free">set_ext</span> <span class="free">R</span><span class="main">]</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≺[</span><span class="free">set_ext</span> <span class="main">(</span>lift_prefs <span class="free">alts'</span> <span class="free">alts</span> <span class="free">R</span><span class="main">)</span><span class="main">]</span> <span class="free">B</span>"</span></span>

<span class="keyword1" id="Social_Choice_Functions-liftable_set_extensionI_weak"><span class="command">lemma</span></span> liftable_set_extensionI_weak<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">R</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> total_preorder_on <span class="free">alts'</span> <span class="bound">R</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="bound">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> 
                      <span class="bound">A</span> <span class="main">⊆</span> <span class="free">alts'</span> <span class="main">⟹</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">alts'</span> <span class="main">⟹</span>
              <span class="bound">A</span> <span class="main">≼[</span><span class="free">set_ext</span> <span class="bound">R</span><span class="main">]</span> <span class="bound">B</span> <span class="main">⟷</span> <span class="bound">A</span> <span class="main">≼[</span><span class="free">set_ext</span> <span class="main">(</span>lift_prefs <span class="free">alts'</span> <span class="free">alts</span> <span class="bound">R</span><span class="main">)</span><span class="main">]</span> <span class="bound">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"liftable_set_extension <span class="free">alts'</span> <span class="free">alts</span> <span class="free">set_ext</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">R</span> <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">R</span></span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">R</span></span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strongly_preferred_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Social_Choice_Functions-Kelly_liftable"><span class="command">lemma</span></span> Kelly_liftable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">alts'</span> <span class="main">⊆</span> <span class="free">alts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"liftable_set_extension <span class="free">alts'</span> <span class="free">alts</span> Kelly"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> liftable_set_extensionI_weak<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">R</span> <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> R<span class="main">:</span> total_preorder_on <span class="quoted"><span class="free">alts'</span></span> <span class="quoted"><span class="skolem">R</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2-5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms  R.refl
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Kelly_def lift_prefs_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Social_Choice_Functions-Fishburn_liftable"><span class="command">lemma</span></span> Fishburn_liftable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">alts'</span> <span class="main">⊆</span> <span class="free">alts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"liftable_set_extension <span class="free">alts'</span> <span class="free">alts</span> Fishb"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> liftable_set_extensionI_weak<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">R</span> <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> R<span class="main">:</span> total_preorder_on <span class="quoted"><span class="free">alts'</span></span> <span class="quoted"><span class="skolem">R</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> conj_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">∧</span> <span class="skolem">Q1</span> <span class="main">⟷</span> <span class="skolem">P2</span> <span class="main">∧</span> <span class="skolem">Q2</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">⟷</span> <span class="skolem">P2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q1</span> <span class="main">⟷</span> <span class="skolem">Q2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P1</span> <span class="skolem">P2</span> <span class="skolem">Q1</span> <span class="skolem">Q2</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2-5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> Fishb_def lift_prefs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conj_cong ball_cong refl<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> scf_lowering_strategyproof <span class="main">=</span>
  strategyproof_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="quoted"><span class="free">set_ext</span></span> <span class="main">+</span>
  liftable_set_extension <span class="quoted"><span class="free">alts'</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">set_ext</span></span> <span class="main">+</span>
  scf_lowering <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="quoted"><span class="free">agents'</span></span> <span class="quoted"><span class="free">alts'</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="free">agents'</span> <span class="free">alts'</span> <span class="free">set_ext</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> lowered<span class="main">:</span> strategyproof_scf <span class="quoted"><span class="free">agents'</span></span> <span class="quoted"><span class="free">alts'</span></span> <span class="quoted">lowered</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="skolem">Ri'</span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> R_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"lowered.is_pref_profile <span class="skolem">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ri'_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"total_preorder_on <span class="free">alts'</span> <span class="skolem">Ri'</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents'</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> R<span class="main">:</span> pref_profile_wf <span class="quoted"><span class="free">agents'</span></span> <span class="quoted"><span class="free">alts'</span></span> <span class="quoted"><span class="skolem">R</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> Ri'<span class="main">:</span> total_preorder_on <span class="quoted"><span class="free">alts'</span></span> <span class="quoted"><span class="skolem">Ri'</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> R_wf <span class="keyword1"><span class="command">have</span></span> R'_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="main">(</span>lift <span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_wf<span class="main">)</span>

  <span class="comment1">― ‹We lift the alternative preference for the agent <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">i</span></span><span class="antiquote">}</span></span> in <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">R</span></span><span class="antiquote">}</span></span> to 
      preferences in the lifted profile. ›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ri''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ri''</span> <span class="main">=</span> lift_prefs <span class="free">alts'</span> <span class="free">alts</span> <span class="skolem">Ri'</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">scf</span> <span class="main">(</span>lift <span class="skolem">R</span><span class="main">)</span> <span class="main">≺[</span><span class="free">set_ext</span> <span class="main">(</span>lift <span class="skolem">R</span> <span class="skolem">i</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> <span class="main">(</span><span class="main">(</span>lift <span class="skolem">R</span><span class="main">)</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">Ri''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i agents'_subset alts'_subset <span class="keyword1"><span class="command">unfolding</span></span> Ri''_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof R'_wf Ri'_wf lift_prefs_wf<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lift <span class="skolem">R</span><span class="main">)</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">Ri''</span><span class="main">)</span> <span class="main">=</span> lift <span class="main">(</span><span class="skolem">R</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">Ri'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i agents'_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff Ri''_def lift_pref_profile_def lift_prefs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> not_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">scf</span> <span class="main">(</span>lift <span class="skolem">R</span><span class="main">)</span> <span class="main">≺[</span><span class="free">set_ext</span> <span class="main">(</span>lift <span class="skolem">R</span> <span class="skolem">i</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> <span class="main">(</span>lift <span class="main">(</span><span class="skolem">R</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">Ri'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>lowered <span class="skolem">R</span> <span class="main">≺[</span><span class="free">set_ext</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">i</span><span class="main">)</span><span class="main">]</span> lowered <span class="main">(</span><span class="skolem">R</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">Ri'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lowered <span class="skolem">R</span> <span class="main">≺[</span><span class="free">set_ext</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">i</span><span class="main">)</span><span class="main">]</span> lowered <span class="main">(</span><span class="skolem">R</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">Ri'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lowered <span class="skolem">R</span> <span class="main">≺[</span><span class="free">set_ext</span> <span class="main">(</span>lift_prefs <span class="free">alts'</span> <span class="free">alts</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> lowered <span class="main">(</span><span class="skolem">R</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">Ri'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_ext_strong_lift R.prefs_wf'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> i lowered.scf_nonempty lowered.scf_alts
                R.wf_update R_wf Ri'_wf<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lift_prefs <span class="free">alts'</span> <span class="free">alts</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> lift <span class="skolem">R</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> agents'_subset i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lift_pref_profile_conv_vector<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> not_less <span class="keyword1"><span class="command">unfolding</span></span> lowered_def o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Fishburn_Impossibility">
<div class="head">
<h1>Theory Fishburn_Impossibility</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Fishburn_Impossibility.thy
  Author:   Manuel Eberl, TU München
  Author:   Christian Saile, TU München

  Incompatibility of Pareto Optimality and Fishburn-Strategy-Proofness
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Main impossibility result›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Fishburn_Impossibility
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Social_Choice_Functions">Social_Choice_Functions</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Setting of the base case›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Suppose we have an anonymous, Fishburn-strategyproof, and Pareto-efficient SCF
  for three agents $A1$ to $A3$ and three alternatives $a$, $b$, and $c$. We will derive
  a contradiction from this.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> fb_impossibility_3_3 <span class="main">=</span>
  strategyproof_anonymous_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="quoted">Fishb</span> <span class="main">+</span>
  pareto_efficient_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="free">A1</span> <span class="free">A2</span> <span class="free">A3</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> agents_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">agents</span> <span class="main">=</span> <span class="main">{</span><span class="free">A1</span><span class="main">,</span> <span class="free">A2</span><span class="main">,</span> <span class="free">A3</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alts_eq<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">alts</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> distinct_agents<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">A1</span><span class="main">,</span> <span class="free">A2</span><span class="main">,</span> <span class="free">A3</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> distinct_alts<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We first give some simple rules that will allow us to break down the strategyproofness
  and support conditions more easily later.
›</span></span>
<span class="keyword1" id="Fishburn_Impossibility-agents_neq"><span class="command">lemma</span></span> agents_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A1</span> <span class="main">≠</span> <span class="free">A2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A2</span> <span class="main">≠</span> <span class="free">A1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A1</span> <span class="main">≠</span> <span class="free">A3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A3</span> <span class="main">≠</span> <span class="free">A1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A2</span> <span class="main">≠</span> <span class="free">A3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A3</span> <span class="main">≠</span> <span class="free">A2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> distinct_agents <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Fishburn_Impossibility-alts_neq"><span class="command">lemma</span></span> alts_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> distinct_alts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Fishburn_Impossibility-agent_in_agents"><span class="command">lemma</span></span> agent_in_agents <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A1</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A2</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A3</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agents_eq<span class="main">)</span>

<span class="keyword1" id="Fishburn_Impossibility-alt_in_alts"><span class="command">lemma</span></span> alt_in_alts <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">alts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">alts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="free">alts</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alts_eq<span class="main">)</span>

<span class="keyword1" id="Fishburn_Impossibility-Bex_alts"><span class="command">lemma</span></span> Bex_alts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">alts</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="free">a</span> <span class="main">∨</span> <span class="free">P</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">P</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alts_eq<span class="main">)</span>

<span class="keyword1" id="Fishburn_Impossibility-eval_pareto_loser_aux"><span class="command">lemma</span></span> eval_pareto_loser_aux<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> pareto_losers <span class="free">R</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span><span class="main">.</span> <span class="free">x</span> <span class="main">≺[</span>Pareto<span class="main">(</span><span class="free">R</span><span class="main">)</span><span class="main">]</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">R</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≺[</span>Pareto<span class="main">(</span><span class="free">R</span><span class="main">)</span><span class="main">]</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> Pareto.strict_not_outside<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alts_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pareto_losers_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Fishburn_Impossibility-eval_Pareto"><span class="command">lemma</span></span> eval_Pareto<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≺[</span>Pareto<span class="main">(</span><span class="free">R</span><span class="main">)</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="free">A1</span><span class="main">,</span><span class="free">A2</span><span class="main">,</span><span class="free">A3</span><span class="main">}</span><span class="main">.</span> <span class="free">x</span> <span class="main">≼[</span><span class="free">R</span> <span class="bound">i</span><span class="main">]</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="free">A1</span><span class="main">,</span><span class="free">A2</span><span class="main">,</span><span class="free">A3</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span><span class="free">x</span> <span class="main">≽[</span><span class="free">R</span> <span class="bound">i</span><span class="main">]</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> R<span class="main">:</span> pref_profile_wf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> R.Pareto_strict_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strongly_preferred_def agents_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> eval_pareto <span class="main">=</span> eval_pareto_loser_aux eval_Pareto
<span class="keyword1" id="Fishburn_Impossibility-pareto_efficiency"><span class="command">lemma</span></span> pareto_efficiency<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> pareto_losers <span class="free">R</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">scf</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pareto_efficient<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Fishburn_Impossibility-Ball_scf"><span class="command">lemma</span></span> Ball_scf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">scf</span> <span class="free">R</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">∉</span> <span class="free">scf</span> <span class="free">R</span> <span class="main">∨</span> <span class="free">P</span> <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span> <span class="main">∉</span> <span class="free">scf</span> <span class="free">R</span> <span class="main">∨</span> <span class="free">P</span> <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">c</span> <span class="main">∉</span> <span class="free">scf</span> <span class="free">R</span> <span class="main">∨</span> <span class="free">P</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> scf_alts<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> alts_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Fishburn_Impossibility-Ball_scf_diff"><span class="command">lemma</span></span> Ball_scf_diff<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R1</span>"</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">scf</span> <span class="free">R1</span> <span class="main">-</span> <span class="free">scf</span> <span class="free">R2</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> 
             <span class="main">(</span><span class="free">a</span> <span class="main">∈</span> <span class="free">scf</span> <span class="free">R2</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">∉</span> <span class="free">scf</span> <span class="free">R1</span> <span class="main">∨</span> <span class="free">P</span> <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span> <span class="main">∈</span> <span class="free">scf</span> <span class="free">R2</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">∉</span> <span class="free">scf</span> <span class="free">R1</span> <span class="main">∨</span> <span class="free">P</span> <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> 
             <span class="main">(</span><span class="free">c</span> <span class="main">∈</span> <span class="free">scf</span> <span class="free">R2</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">∉</span> <span class="free">scf</span> <span class="free">R1</span> <span class="main">∨</span> <span class="free">P</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">THEN</span> scf_alts<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> alts_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Fishburn_Impossibility-scf_nonempty'"><span class="command">lemma</span></span> scf_nonempty'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_pref_profile <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">alts</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">scf</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> scf_nonempty<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> scf_alts<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Preference Profiles and Fact Gathering›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now define the 21 preference profile that will lead to the impossibility result.
›</span></span>
<span class="keyword1"><span class="command">preference_profile</span></span> 
  agents<span class="main">:</span> <span class="quoted"><span class="free">agents</span></span>
  alts<span class="main">:</span>   <span class="quoted"><span class="free">alts</span></span>
<span class="keyword2"><span class="keyword">where</span></span> R1   <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span>     <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>  
  <span class="keyword2"><span class="keyword">and</span></span> R2   <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>       <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> R3   <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>       <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>   
  <span class="keyword2"><span class="keyword">and</span></span> R4   <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span>  <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>      <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R5   <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span>  <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>      <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R6   <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>     <span class="quoted"><span class="free">A3</span></span><span class="main">:</span>  <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R7   <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>     <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> R8   <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>     <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R9   <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>     <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R10  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>       <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>   
  <span class="keyword2"><span class="keyword">and</span></span> R11  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>       <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>  
  <span class="keyword2"><span class="keyword">and</span></span> R12  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>       <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>   
  <span class="keyword2"><span class="keyword">and</span></span> R13  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>       <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>  
  <span class="keyword2"><span class="keyword">and</span></span> R14  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>     <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span>   
  <span class="keyword2"><span class="keyword">and</span></span> R15  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>     <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>  
  <span class="keyword2"><span class="keyword">and</span></span> R16  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>     <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>  
  <span class="keyword2"><span class="keyword">and</span></span> R17  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>       <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R18  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>     <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> R19  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>     <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R20  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="main">[</span><span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>       <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R21  <span class="main">=</span> <span class="quoted"><span class="free">A1</span></span><span class="main">:</span> <span class="main">[</span><span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>    <span class="quoted"><span class="free">A2</span></span><span class="main">:</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span>       <span class="quoted"><span class="free">A3</span></span><span class="main">:</span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span> <span class="quoted"><span class="free">c</span></span><span class="main">,</span> <span class="quoted"><span class="free">a</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agents_eq alts_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> R_wfs <span class="main">=</span> 
  R1.wf R2.wf R3.wf R4.wf R5.wf R6.wf R7.wf R8.wf R9.wf R10.wf R11.wf R12.wf R13.wf R14.wf R15.wf 
  R16.wf R17.wf R18.wf R19.wf R20.wf R21.wf 

<span class="keyword1"><span class="command">lemmas</span></span> R_evals <span class="main">=</span>
  R1.eval R2.eval R3.eval R4.eval R5.eval R6.eval R7.eval R8.eval R9.eval R10.eval R11.eval R12.eval  R13.eval 
  R14.eval R15.eval R16.eval R17.eval R18.eval R19.eval R20.eval R21.eval

<span class="keyword1"><span class="command">lemmas</span></span> nonemptiness <span class="main">=</span> R_wfs <span class="main">[</span><span class="operator">THEN</span> scf_nonempty'<span class="main">,</span> <span class="operator">unfolded</span> Bex_alts<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We show the support conditions from Pareto efficiency
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">scf</span> R1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R1.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">scf</span> R2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R2.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">scf</span> R3"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R3.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">scf</span> R6"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R6.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">scf</span> R7"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R7.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> <span class="free">scf</span> R8"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R8.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∉</span> <span class="free">scf</span> R9"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R9.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">scf</span> R12"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R12.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> <span class="free">scf</span> R14"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R14.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∉</span> <span class="free">scf</span> R15"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R15.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> <span class="free">scf</span> R16"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R16.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∉</span> <span class="free">scf</span> R17"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R17.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∉</span> <span class="free">scf</span> R18"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R18.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> <span class="free">scf</span> R19"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R19.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∉</span> <span class="free">scf</span> R20"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R20.eval<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∉</span> <span class="free">scf</span> R21"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pareto_efficiency<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_pareto R21.eval<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We derive the strategyproofness conditions:
›</span></span>
<span class="keyword1" id="Fishburn_Impossibility-s41"><span class="command">lemma</span></span> s41<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R4 <span class="main">≻[</span>Fishb<span class="main">(</span>R1 <span class="free">A2</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R1"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R4.eval R1.eval<span class="main">)</span>
   
<span class="keyword1" id="Fishburn_Impossibility-s32"><span class="command">lemma</span></span> s32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R3 <span class="main">≻[</span>Fishb<span class="main">(</span>R2 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R3.eval R2.eval<span class="main">)</span>
 
<span class="keyword1" id="Fishburn_Impossibility-s122"><span class="command">lemma</span></span> s122<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R12 <span class="main">≻[</span>Fishb<span class="main">(</span>R2 <span class="free">A2</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R12.eval R2.eval<span class="main">)</span>
   
<span class="keyword1" id="Fishburn_Impossibility-s133"><span class="command">lemma</span></span> s133<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R13 <span class="main">≻[</span>Fishb<span class="main">(</span>R3 <span class="free">A2</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R3"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R13.eval R3.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s102"><span class="command">lemma</span></span> s102<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R10 <span class="main">≻[</span>Fishb<span class="main">(</span>R2 <span class="free">A2</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R10.eval R2.eval<span class="main">)</span>
         
<span class="keyword1" id="Fishburn_Impossibility-s13"><span class="command">lemma</span></span> s13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R1 <span class="main">≻[</span>Fishb<span class="main">(</span>R3 <span class="free">A3</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R3"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1.eval R3.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s54"><span class="command">lemma</span></span> s54<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R5 <span class="main">≻[</span>Fishb<span class="main">(</span>R4 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R4"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R5.eval R4.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s174"><span class="command">lemma</span></span> s174<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R17 <span class="main">≻[</span>Fishb<span class="main">(</span>R4 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R4"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R17.eval R4.eval<span class="main">)</span>
      
<span class="keyword1" id="Fishburn_Impossibility-s74"><span class="command">lemma</span></span> s74<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R7 <span class="main">≻[</span>Fishb<span class="main">(</span>R4 <span class="free">A2</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R4"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R7.eval R4.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s114"><span class="command">lemma</span></span> s114<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R11 <span class="main">≻[</span>Fishb<span class="main">(</span>R4 <span class="free">A3</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R4"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A3</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R11.eval R4.eval<span class="main">)</span>
  
<span class="keyword1" id="Fishburn_Impossibility-s45"><span class="command">lemma</span></span> s45<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R4 <span class="main">≻[</span>Fishb<span class="main">(</span>R5 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R5"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R4.eval R5.eval<span class="main">)</span>
     
<span class="keyword1" id="Fishburn_Impossibility-s65"><span class="command">lemma</span></span> s65<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R6 <span class="main">≻[</span>Fishb<span class="main">(</span>R5 <span class="free">A2</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R5"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R5.eval R6.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s105"><span class="command">lemma</span></span> s105<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R10 <span class="main">≻[</span>Fishb<span class="main">(</span>R5 <span class="free">A3</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R5"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A3</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  R10.eval R5.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s67"><span class="command">lemma</span></span> s67<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R6 <span class="main">≻[</span>Fishb<span class="main">(</span>R7 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R7"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute  R6.eval R7.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s187"><span class="command">lemma</span></span> s187<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R18 <span class="main">≻[</span>Fishb<span class="main">(</span>R7 <span class="free">A3</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R7"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A3</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R7.eval R18.eval<span class="main">)</span>
   
<span class="keyword1" id="Fishburn_Impossibility-s219"><span class="command">lemma</span></span> s219<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R21 <span class="main">≻[</span>Fishb<span class="main">(</span>R9 <span class="free">A2</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R9"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A3</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R9.eval R21.eval<span class="main">)</span>
   
<span class="keyword1" id="Fishburn_Impossibility-s1011"><span class="command">lemma</span></span> s1011<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R10 <span class="main">≻[</span>Fishb<span class="main">(</span>R11 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R11"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R10.eval R11.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s1012"><span class="command">lemma</span></span> s1012<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R10 <span class="main">≻[</span>Fishb<span class="main">(</span>R12 <span class="free">A2</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R12"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R10.eval R12.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s1213"><span class="command">lemma</span></span> s1213<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R12 <span class="main">≻[</span>Fishb<span class="main">(</span>R13 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R13"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R12.eval R13.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s1113"><span class="command">lemma</span></span> s1113<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R11 <span class="main">≻[</span>Fishb<span class="main">(</span>R13 <span class="free">A2</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R13"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R11.eval R13.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s1813"><span class="command">lemma</span></span> s1813<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R18 <span class="main">≻[</span>Fishb<span class="main">(</span>R13 <span class="free">A3</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R13"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R18.eval R13.eval<span class="main">)</span>
    
<span class="keyword1" id="Fishburn_Impossibility-s814"><span class="command">lemma</span></span> s814<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R8 <span class="main">≻[</span>Fishb<span class="main">(</span>R14 <span class="free">A2</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R14"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R8.eval R14.eval<span class="main">)</span>
   
<span class="keyword1" id="Fishburn_Impossibility-s1914"><span class="command">lemma</span></span> s1914<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R19 <span class="main">≻[</span>Fishb<span class="main">(</span>R14 <span class="free">A3</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R14"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A3</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R19.eval R14.eval<span class="main">)</span>
   
<span class="keyword1" id="Fishburn_Impossibility-s1715"><span class="command">lemma</span></span> s1715<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R17 <span class="main">≻[</span>Fishb<span class="main">(</span>R15 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R15"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A3</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R17.eval R15.eval<span class="main">)</span>

<span class="keyword1" id="Fishburn_Impossibility-s815"><span class="command">lemma</span></span> s815<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R8 <span class="main">≻[</span>Fishb<span class="main">(</span>R15 <span class="free">A3</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R15"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A3</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R8.eval R15.eval<span class="main">)</span>

<span class="keyword1" id="Fishburn_Impossibility-s516"><span class="command">lemma</span></span> s516<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R5 <span class="main">≻[</span>Fishb<span class="main">(</span>R16 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R16"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A3</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R5.eval R16.eval<span class="main">)</span>
  
<span class="keyword1" id="Fishburn_Impossibility-s517"><span class="command">lemma</span></span> s517<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R5 <span class="main">≻[</span>Fishb<span class="main">(</span>R17 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R17"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute R5.eval R17.eval<span class="main">)</span>
   
<span class="keyword1" id="Fishburn_Impossibility-s1619"><span class="command">lemma</span></span> s1619<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R16 <span class="main">≻[</span>Fishb<span class="main">(</span>R19 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R19"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute  R16.eval R19.eval<span class="main">)</span> 
     
<span class="keyword1" id="Fishburn_Impossibility-s1820"><span class="command">lemma</span></span> s1820<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R18 <span class="main">≻[</span>Fishb<span class="main">(</span>R20 <span class="free">A2</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R20"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute  R18.eval R20.eval<span class="main">)</span>
   
<span class="keyword1" id="Fishburn_Impossibility-s920"><span class="command">lemma</span></span> s920<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R9 <span class="main">≻[</span>Fishb<span class="main">(</span>R20 <span class="free">A3</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R20"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute  R20.eval R9.eval<span class="main">)</span>

<span class="keyword1" id="Fishburn_Impossibility-s521"><span class="command">lemma</span></span> s521<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R5 <span class="main">≻[</span>Fishb<span class="main">(</span>R21 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R21"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute  R21.eval R5.eval<span class="main">)</span>
 
<span class="keyword1" id="Fishburn_Impossibility-s421"><span class="command">lemma</span></span> s421<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">scf</span> R4 <span class="main">≻[</span>Fishb<span class="main">(</span>R21 <span class="free">A1</span><span class="main">)</span><span class="main">]</span> <span class="free">scf</span> R21"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strategyproof'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute  R21.eval R4.eval<span class="main">)</span>
 

<span class="keyword1"><span class="command">lemmas</span></span> sp <span class="main">=</span> s41 s32 s122 s102 s133 s13 s54 s174 s54 s74 s114 s45 s65 s105 s67
            s187 s219 s1011 s1012 s1213 s1113 s1813 s814 s1914 s1715 s815 s516
            s517 s1619 s1820 s920 s521 s421 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now use the simplifier to break down the strategyproofness conditions into SAT formulae.
  This takes a few seconds, so we use some low-level ML code to at least do the simplification
  in parallel.
›</span></span>
<span class="keyword1"><span class="command">local_setup</span></span> <span class="quoted">‹<span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">lthy</span> <span class="main">=&gt;</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">lthy'</span> <span class="main">=</span> <span class="entity">lthy</span> addsimps <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> Fishb_strict_iff Ball_scf Ball_scf_diff R_evals<span class="antiquote">}</span></span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thms</span> <span class="main">=</span> Par_List.map <span class="main">(</span><span class="entity">Simplifier.asm_full_simplify</span> <span class="entity">lthy'</span><span class="main">)</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> sp<span class="antiquote">}</span></span></span>
  <span class="keyword2"><span class="keyword">in</span></span>
    Local_Theory.notes <span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> sp'<span class="antiquote">}</span></span></span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="entity">thms</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">]</span> <span class="entity">lthy</span> |&gt; snd
  <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We show that the strategyproofness conditions, the non-emptiness conditions (i.\,e.\ every SCF
  must return at least one winner), and the efficiency conditions are not satisfiable together,
  which means that the SCF whose existence we assumed simply cannot exist.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> absurd<span class="main">:</span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">using</span></span> sp' <span class="keyword2"><span class="keyword">and</span></span> nonemptiness <span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">satx</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lifting to more than 3 agents and alternatives›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now employ the standard lifting argument outlined before to lift this impossibility
  from 3 agents and alternatives to any setting with at least 3 agents and alternatives.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> fb_impossibility <span class="main">=</span>
  strategyproof_anonymous_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="quoted">Fishb</span> <span class="main">+</span>
  pareto_efficient_scf <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'agent</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'alt</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">scf</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> card_agents_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">agents</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> card_alts_ge<span class="main">:</span>   <span class="quoted"><span class="quoted">"card <span class="free">alts</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TODO: Move? *)</span>
<span class="keyword1" id="Fishburn_Impossibility-finite_list'"><span class="command">lemma</span></span> finite_list'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">xs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> set <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> distinct_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"remdups <span class="skolem">xs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"remdups <span class="skolem"><span class="skolem"><span class="skolem">xs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Fishburn_Impossibility-finite_list_subset"><span class="command">lemma</span></span> finite_list_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">xs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> set <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_list'<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"take <span class="free"><span class="free"><span class="free">n</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">xs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_take_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Fishburn_Impossibility-card_ge_3E"><span class="command">lemma</span></span> card_ge_3E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> finite_list_subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> xs <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">c</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_nat_numeral length_Suc_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> absurd<span class="main">:</span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> card_ge_3E<span class="main">[</span><span class="operator">OF</span> finite_agents card_agents_ge<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> A1 A2 A3 <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> agents <span class="main">=</span> this
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?agents'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">A1</span><span class="main">,</span> <span class="skolem">A2</span><span class="main">,</span> <span class="skolem">A3</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> card_ge_3E<span class="main">[</span><span class="operator">OF</span> finite_alts card_alts_ge<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> a b c <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> alts <span class="main">=</span> this
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?alts'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">c</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">interpret</span></span> scf_lowering_anonymous <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="var"><span class="quoted"><span class="var">?agents'</span></span></span> <span class="var"><span class="quoted"><span class="var">?alts'</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">use</span> agents alts <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> liftable_set_extension <span class="var"><span class="quoted"><span class="var">?alts'</span></span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted">Fishb</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Fishburn_liftable alts<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> scf_lowering_strategyproof <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">alts</span></span> <span class="quoted"><span class="free">scf</span></span> <span class="var"><span class="quoted"><span class="var">?agents'</span></span></span> <span class="var"><span class="quoted"><span class="var">?alts'</span></span></span> <span class="quoted">Fishb</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> fb_impossibility_3_3 <span class="var"><span class="quoted"><span class="var">?agents'</span></span></span> <span class="var"><span class="quoted"><span class="var">?alts'</span></span></span> <span class="quoted">lowered</span> <span class="quoted"><span class="skolem">A1</span></span> <span class="quoted"><span class="skolem">A2</span></span> <span class="quoted"><span class="skolem">A3</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">c</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">use</span> agents alts <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> absurd <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>