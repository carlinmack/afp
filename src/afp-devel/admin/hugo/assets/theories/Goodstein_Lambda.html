<div id="Goodstein_Lambda">
<div class="head">
<h1>Theory Goodstein_Lambda</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Specification›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Goodstein_Lambda
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Hereditary base representation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a data type of trees and an evaluation function that sums siblings and
  exponentiates with respect to the given base on nesting.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> C <span class="main">=</span> C <span class="main">(</span><span class="free"><span class="entity">unC</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"C list"</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">evalC</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">evalC</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>C <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">evalC</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">^</span><span class="free">evalC</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free">evalC</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"evalC <span class="numeral">2</span> <span class="main">(</span>C <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="comment1">― ‹$0$›</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"evalC <span class="numeral">2</span> <span class="main">(</span>C <span class="main">[</span>C <span class="main">[]</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="comment1">― ‹$2^0 = 1$›</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"evalC <span class="numeral">2</span> <span class="main">(</span>C <span class="main">[</span>C <span class="main">[</span>C <span class="main">[]</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="comment1">― ‹$2^1 = 2$›</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"evalC <span class="numeral">2</span> <span class="main">(</span>C <span class="main">[</span>C <span class="main">[]</span><span class="main">,</span> C <span class="main">[]</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="comment1">― ‹$2^0 + 2^0 = 2^0 \cdot 2 = 2$; not in hereditary base $2$›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The hereditary base representation is characterized as trees (i.e., nested lists) whose
  lists have monotonically increasing evaluations, with fewer than <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> repetitions for
  each value. We will show later that this representation is unique.›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">hbase</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">b</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"C <span class="main">[]</span> <span class="main">∈</span> <span class="free">hbase</span> <span class="free">b</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> <span class="free">hbase</span> <span class="free">b</span> <span class="main">⟹</span>
   C <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="main">∈</span> <span class="free">hbase</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">m'</span><span class="main">.</span> <span class="bound">m'</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="main">⟹</span> evalC <span class="free">b</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> evalC <span class="free">b</span> <span class="bound">m'</span><span class="main">)</span> <span class="main">⟹</span>
   C <span class="main">(</span>replicate <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">hbase</span> <span class="free">b</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can convert to and from natural numbers as follows.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">H2N</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">H2N</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> evalC <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As we will show later, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"H2N <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> restricted to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"hbase <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is bijective
  if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span> <span class="main"><span class="main">≥</span></span> <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">::</span></span> nat<span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, so we can convert from natural numbers by taking the inverse.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">N2H</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">N2H</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> inv_into <span class="main">(</span>hbase <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">(</span>H2N <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Goodstein function›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a function that computes the length of the Goodstein sequence whose $c$-th element
  is $g_c = n$. Termination will be shown later, thereby establishing Goodstein's theorem.›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">goodstein</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">goodstein</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="comment1">― ‹we start counting at 1; also note that the initial base is <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">c</span><span class="main">+</span><span class="main">1</span> <span class="main">::</span> nat"</span><span class="antiquote">}</span></span> and›</span>
  <span class="comment1">― ‹hereditary base 1 makes no sense, so we have to avoid this case›</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">goodstein</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">goodstein</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free">goodstein</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>H2N <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>N2H <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">𝒢</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒢</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> goodstein <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Ordinals›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following type contains countable ordinals, by the usual case distinction into 0,
  successor ordinal, or limit ordinal; limit ordinals are given by their fundamental sequence.
  Hereditary base <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> representations carry over to such ordinals by replacing each
  occurrence of the base by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ω</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> Ord <span class="main">=</span> Z <span class="main">|</span> S <span class="quoted">Ord</span> <span class="main">|</span> L <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> Ord"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note that the following arithmetic operations are not correct for all ordinals. However, they
  will only be used in cases where they actually correspond to the ordinal arithmetic operations.›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">addO</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">addO</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> Z <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">addO</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>S <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> S <span class="main">(</span><span class="free">addO</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">addO</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>L <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> L <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">addO</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">mulO</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mulO</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> Z <span class="main">=</span> Z"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mulO</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>S <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> addO <span class="main">(</span><span class="free">mulO</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mulO</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>L <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> L <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">mulO</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ω</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ω</span> <span class="main">=</span> L <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>S <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> Z<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">expω</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">expω</span> Z <span class="main">=</span> S Z"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">expω</span> <span class="main">(</span>S <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> mulO <span class="main">(</span><span class="free">expω</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> ω"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">expω</span> <span class="main">(</span>L <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> L <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">expω</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Evaluation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Evaluating an ordinal number at base $b$ is accomplished by taking the $b$-th element of
  all fundamental sequences and interpreting zero and successor over the natural numbers.›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">evalO</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">evalO</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> Z <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">evalO</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>S <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">evalO</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">evalO</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>L <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">evalO</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Goodstein function and sequence›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can define the Goodstein function very easily, but proving correctness will take a while.›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">goodsteinO</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">goodsteinO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> Z <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">goodsteinO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>S <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">goodsteinO</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">goodsteinO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>L <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">goodsteinO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">stepO</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stepO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> Z <span class="main">=</span> Z"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">stepO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>S <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">stepO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>L <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">stepO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can compute a few values of the Goodstein sequence starting at $4$.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">g4O</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">g4O</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> fold stepO <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span> <span class="main">(</span><span class="main">(</span>expω <span class="main">^^</span> <span class="numeral">3</span><span class="main">)</span> Z<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> evalO <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>g4O <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">10</span><span class="main">]</span>"</span></span>
<span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">value</span> <span class="quoted">"<span class="main">[</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">26</span><span class="main">,</span> <span class="numeral">41</span><span class="main">,</span> <span class="numeral">60</span><span class="main">,</span> <span class="numeral">83</span><span class="main">,</span> <span class="numeral">109</span><span class="main">,</span> <span class="numeral">139</span><span class="main">,</span> <span class="numeral">173</span><span class="main">,</span> <span class="numeral">211</span><span class="main">,</span> <span class="numeral">253</span><span class="main">]</span> <span class="main">::</span> nat list"</span><span class="antiquote">}</span></span>›</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of evaluation›</span></span>

<span class="keyword1" id="Goodstein_Lambda-evalO_addO"><span class="command">lemma</span></span> evalO_addO <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalO <span class="free">b</span> <span class="main">(</span>addO <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> evalO <span class="free">b</span> <span class="free">n</span> <span class="main">+</span> evalO <span class="free">b</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-evalO_mulO"><span class="command">lemma</span></span> evalO_mulO <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalO <span class="free">b</span> <span class="main">(</span>mulO <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> evalO <span class="free">b</span> <span class="free">n</span> <span class="main">*</span> evalO <span class="free">b</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-evalO_n"><span class="command">lemma</span></span> evalO_n <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalO <span class="free">b</span> <span class="main">(</span><span class="main">(</span>S <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> Z<span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-evalO_ω"><span class="command">lemma</span></span> evalO_ω <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalO <span class="free">b</span> ω <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ω_def<span class="main">)</span>

<span class="keyword1" id="Goodstein_Lambda-evalO_expω"><span class="command">lemma</span></span> evalO_expω <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalO <span class="free">b</span> <span class="main">(</span>expω <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="main">(</span>evalO <span class="free">b</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note that evaluation is useful for proving that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> "Ord"<span class="antiquote"><span class="antiquote">}</span></span></span></span> values are distinct:›</span></span>
<span class="keyword1"><span class="command">notepad</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"addO <span class="skolem">n</span> <span class="main">(</span>expω <span class="skolem">m</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">m</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"evalO <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Arithmetic properties›</span></span>

<span class="keyword1" id="Goodstein_Lambda-addO_Z"><span class="command">lemma</span></span> addO_Z <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"addO Z <span class="free">n</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-addO_assoc"><span class="command">lemma</span></span> addO_assoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"addO <span class="free">n</span> <span class="main">(</span>addO <span class="free">m</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> addO <span class="main">(</span>addO <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-mul0_distrib"><span class="command">lemma</span></span> mul0_distrib <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mulO <span class="free">n</span> <span class="main">(</span>addO <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> addO <span class="main">(</span>mulO <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>mulO <span class="free">n</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-mulO_assoc"><span class="command">lemma</span></span> mulO_assoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mulO <span class="free">n</span> <span class="main">(</span>mulO <span class="free">m</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> mulO <span class="main">(</span>mulO <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-expω_addO"><span class="command">lemma</span></span> expω_addO <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"expω <span class="main">(</span>addO <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> mulO <span class="main">(</span>expω <span class="free">n</span><span class="main">)</span> <span class="main">(</span>expω <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cantor normal form›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The previously introduced tree type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> C<span class="antiquote"><span class="antiquote">}</span></span></span></span> can be used to represent Cantor normal forms;
  they are trees (evaluated at base <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ω</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>) such that siblings are in non-decreasing order.
  One can think of this as hereditary base <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ω</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. The plan is to mirror selected operations on
  ordinals in Cantor normal forms.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conversion to and from the ordinal type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> Ord<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">C2O</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">C2O</span> <span class="main">(</span>C <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> Z"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">C2O</span> <span class="main">(</span>C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> addO <span class="main">(</span><span class="free">C2O</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>expω <span class="main">(</span><span class="free">C2O</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">O2C</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">O2C</span> <span class="main">=</span> inv C2O"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">C2O</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is injective, meaning the inverse is unique.›</span></span>

<span class="keyword1" id="Goodstein_Lambda-addO_expω_inj"><span class="command">lemma</span></span> addO_expω_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"addO <span class="free">n</span> <span class="main">(</span>expω <span class="free">m</span><span class="main">)</span> <span class="main">=</span> addO <span class="free">n'</span> <span class="main">(</span>expω <span class="free">m'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">m'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"addO <span class="free">n</span> <span class="main">(</span>expω <span class="free">m</span><span class="main">)</span> <span class="main">=</span> addO <span class="free">n'</span> <span class="main">(</span>expω <span class="free">m'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">=</span> <span class="free">n'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m'</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">m'</span></span></span></span></span></span><span class="main"><span class="keyword3">;</span></span>
      <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ω_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fun_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"addO <span class="free">n</span> <span class="main">(</span>expω <span class="free">m</span><span class="main">)</span> <span class="main">=</span> addO <span class="free">n</span> <span class="main">(</span>expω <span class="free">m'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">m'</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">m'</span></span></span></span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ω_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rangeI
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"evalO <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span> fun_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span> fun_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>8<span class="main"><span class="keyword3">]</span></span> <span class="comment1">(* 1 left *)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> ext rangeI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">m'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Goodstein_Lambda-C2O_inj"><span class="command">lemma</span></span> C2O_inj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C2O <span class="free">n</span> <span class="main">=</span> C2O <span class="free">m</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> C2O.induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">m</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> C2O.cases<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> addO_expω_inj arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"evalO <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Goodstein_Lambda-O2C_C2O"><span class="command">lemma</span></span> O2C_C2O <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"O2C <span class="main">(</span>C2O <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inv_f_f <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> O2C_def inj_def C2O_inj<span class="main">)</span>

<span class="keyword1" id="Goodstein_Lambda-O2C_Z"><span class="command">lemma</span></span> O2C_Z <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"O2C Z <span class="main">=</span> C <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> O2C_C2O<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"C <span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> C2O.simps<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Goodstein_Lambda-C2O_replicate"><span class="command">lemma</span></span> C2O_replicate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C2O <span class="main">(</span>C <span class="main">(</span>replicate <span class="free">i</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mulO <span class="main">(</span>expω <span class="main">(</span>C2O <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>S <span class="main">^^</span> <span class="free">i</span><span class="main">)</span> Z<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-C2O_app"><span class="command">lemma</span></span> C2O_app<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C2O <span class="main">(</span>C <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> addO <span class="main">(</span>C2O <span class="main">(</span>C <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>C2O <span class="main">(</span>C <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Evaluation›</span></span>

<span class="keyword1" id="Goodstein_Lambda-evalC_def'"><span class="command">lemma</span></span> evalC_def'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalC <span class="free">b</span> <span class="free">n</span> <span class="main">=</span> evalO <span class="free">b</span> <span class="main">(</span>C2O <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> C2O.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-evalC_app"><span class="command">lemma</span></span> evalC_app <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalC <span class="free">b</span> <span class="main">(</span>C <span class="main">(</span><span class="free">ns</span> <span class="main">@</span> <span class="free">ms</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> evalC <span class="free">b</span> <span class="main">(</span>C <span class="free">ns</span><span class="main">)</span> <span class="main">+</span> evalC <span class="free">b</span> <span class="main">(</span>C <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-evalC_replicate"><span class="command">lemma</span></span> evalC_replicate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalC <span class="free">b</span> <span class="main">(</span>C <span class="main">(</span>replicate <span class="free">c</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> evalC <span class="free">b</span> <span class="main">(</span>C <span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Transfer of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> Ord<span class="antiquote"><span class="antiquote">}</span></span></span></span> induction principle to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> C<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">funC</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">funC</span></span><span class="antiquote">}</span></span> computes the fundamental sequence on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type</span> C<span class="antiquote">}</span></span>›</span>
  <span class="quoted"><span class="quoted">"<span class="free">funC</span> <span class="main">(</span>C <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">[</span>C <span class="main">[]</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">funC</span> <span class="main">(</span>C <span class="main">(</span>C <span class="main">[]</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> replicate <span class="bound">i</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">funC</span> <span class="main">(</span>C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">[</span>C <span class="main">(</span><span class="free">funC</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">i</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Goodstein_Lambda-C2O_cons"><span class="command">lemma</span></span> C2O_cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C2O <span class="main">(</span>C <span class="main">(</span><span class="free">n</span> <span class="main">#</span> <span class="free">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> C <span class="main">[]</span> <span class="keyword1">then</span> S <span class="main">(</span>C2O <span class="main">(</span>C <span class="free">ns</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> L <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> C2O <span class="main">(</span>C <span class="main">(</span>funC <span class="free">n</span> <span class="bound">i</span> <span class="main">@</span> <span class="free">ns</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> funC.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_def C2O_replicate C2O_app <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> expω_addO<span class="main">)</span>

<span class="keyword1" id="Goodstein_Lambda-C_Ord_induct"><span class="command">lemma</span></span> C_Ord_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>C <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ns</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>C <span class="bound">ns</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>C <span class="main">(</span>C <span class="main">[]</span> <span class="main">#</span> <span class="bound">ns</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">ns</span> <span class="bound">ms</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>C <span class="main">(</span>funC <span class="main">(</span>C <span class="main">(</span><span class="bound">n</span> <span class="main">#</span> <span class="bound">ns</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span> <span class="main">@</span> <span class="bound">ms</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">P</span> <span class="main">(</span>C <span class="main">(</span>C <span class="main">(</span><span class="bound">n</span> <span class="main">#</span> <span class="bound">ns</span><span class="main">)</span> <span class="main">#</span> <span class="bound">ms</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> C2O <span class="bound">n</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> allI<span class="main"><span class="keyword3">;</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> funC.cases<span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C2O_cons <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> C2O.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Goodstein function and sequence on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> C<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">goodsteinC</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">goodsteinC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>C <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">goodsteinC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>C <span class="main">(</span>C <span class="main">[]</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">goodsteinC</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">goodsteinC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>C <span class="main">(</span>C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="free">goodsteinC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>C <span class="main">(</span>funC <span class="main">(</span>C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">termination</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"goodsteinC_dom <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> C_Ord_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> goodsteinC.domintros<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Goodstein_Lambda-goodsteinC_def'"><span class="command">lemma</span></span> goodsteinC_def'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"goodsteinC <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> goodsteinO <span class="free">c</span> <span class="main">(</span>C2O <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> goodsteinC.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C2O_cons <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> C2O.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">stepC</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stepC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>C <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> C <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">stepC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>C <span class="main">(</span>C <span class="main">[]</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free"><span class="bound"><span class="entity">ns</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">stepC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>C <span class="main">(</span>C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="free">stepC</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>C <span class="main">(</span>funC <span class="main">(</span>C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">termination</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stepC_dom <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> C_Ord_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> stepC.domintros<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">g4C</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">g4C</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> fold stepC <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span> <span class="main">(</span>C <span class="main">[</span>C <span class="main">[</span>C <span class="main">[</span>C <span class="main">[]</span><span class="main">]</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> evalC <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>g4C <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">10</span><span class="main">]</span>"</span></span>
<span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">value</span> <span class="quoted">"<span class="main">[</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">26</span><span class="main">,</span> <span class="numeral">41</span><span class="main">,</span> <span class="numeral">60</span><span class="main">,</span> <span class="numeral">83</span><span class="main">,</span> <span class="numeral">109</span><span class="main">,</span> <span class="numeral">139</span><span class="main">,</span> <span class="numeral">173</span><span class="main">,</span> <span class="numeral">211</span><span class="main">,</span> <span class="numeral">253</span><span class="main">]</span> <span class="main">::</span> nat list"</span><span class="antiquote">}</span></span>›</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1" id="Goodstein_Lambda-stepC_def'"><span class="command">lemma</span></span> stepC_def'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"stepC <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> O2C <span class="main">(</span>stepO <span class="free">c</span> <span class="main">(</span>C2O <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> stepC.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C2O_cons <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> C2O.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Goodstein_Lambda-funC_ne"><span class="command">lemma</span></span> funC_ne <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"funC <span class="free">m</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> funC.cases<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Goodstein_Lambda-evalC_funC"><span class="command">lemma</span></span> evalC_funC <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalC <span class="free">b</span> <span class="main">(</span>C <span class="main">(</span>funC <span class="free">n</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> evalC <span class="free">b</span> <span class="main">(</span>C <span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> funC.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Goodstein_Lambda-stepC_app"><span class="command">lemma</span></span> stepC_app <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> C <span class="main">[]</span> <span class="main">⟹</span> stepC <span class="free">c</span> <span class="main">(</span>C <span class="main">(</span>unC <span class="free">n</span> <span class="main">@</span> <span class="free">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>unC <span class="main">(</span>stepC <span class="free">c</span> <span class="free">n</span><span class="main">)</span> <span class="main">@</span> <span class="free">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> stepC.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Goodstein_Lambda-stepC_cons"><span class="command">lemma</span></span> stepC_cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ns</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> stepC <span class="free">c</span> <span class="main">(</span>C <span class="main">(</span><span class="free">n</span> <span class="main">#</span> <span class="free">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>unC <span class="main">(</span>stepC <span class="free">c</span> <span class="main">(</span>C <span class="main">[</span><span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="free">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> stepC_app<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"C<span class="main">[</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">ns</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Goodstein_Lambda-stepC_dec"><span class="command">lemma</span></span> stepC_dec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> C <span class="main">[]</span> <span class="main">⟹</span> Suc <span class="main">(</span>evalC <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stepC <span class="free">c</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> evalC <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> stepC.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Goodstein_Lambda-stepC_dec'"><span class="command">lemma</span></span> stepC_dec'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> C <span class="main">[]</span> <span class="main">⟹</span> evalC <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>stepC <span class="free">c</span> <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> evalC <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> stepC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">ns</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"evalC <span class="main">(</span><span class="skolem">c</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>C <span class="main">(</span>funC <span class="main">(</span>C <span class="main">(</span><span class="skolem">n</span> <span class="main">#</span> <span class="skolem">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
      <span class="main">(</span><span class="skolem">c</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> evalC <span class="main">(</span><span class="skolem">c</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">+</span> evalC <span class="main">(</span><span class="skolem">c</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>C <span class="skolem">ns</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> funC.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Hereditary base <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> representation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now turn to properties of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"hbase <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> subset of trees.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Uniqueness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show uniqueness of the hereditary base representation by showing that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"evalC <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  restricted to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"hbase <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is injective.›</span></span>

<span class="keyword1" id="Goodstein_Lambda-hbaseI2"><span class="command">lemma</span></span> hbaseI2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> hbase <span class="free">b</span> <span class="main">⟹</span> C <span class="free">m</span> <span class="main">∈</span> hbase <span class="free">b</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">m'</span><span class="main">.</span> <span class="bound">m'</span> <span class="main">∈</span> set <span class="free">m</span> <span class="main">⟹</span> evalC <span class="free">b</span> <span class="free">n</span> <span class="main">&lt;</span> evalC <span class="free">b</span> <span class="bound">m'</span><span class="main">)</span> <span class="main">⟹</span>
    C <span class="main">(</span>replicate <span class="free">i</span> <span class="free">n</span> <span class="main">@</span> <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> hbase <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hbase.intros <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> replicate.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> hbase_singletonI <span class="main">=</span>
  hbase.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">b</span><span class="main">,</span> <span class="operator">OF</span> _ _ _ hbase.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Goodstein_Lambda-hbase_hd"><span class="command">lemma</span></span> hbase_hd<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C <span class="free">ns</span> <span class="main">∈</span> hbase <span class="free">b</span> <span class="main">⟹</span> <span class="free">ns</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> hd <span class="free">ns</span> <span class="main">∈</span> hbase <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase.cases<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> hbase_hd' <span class="main">[</span><span class="operator">dest</span><span class="main">]</span> <span class="main">=</span> hbase_hd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#</span> <span class="free">ns</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">n</span> <span class="free">ns</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Goodstein_Lambda-hbase_tl"><span class="command">lemma</span></span> hbase_tl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C <span class="free">ns</span> <span class="main">∈</span> hbase <span class="free">b</span> <span class="main">⟹</span> <span class="free">ns</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> C <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> hbase <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"C <span class="free">ns</span>"</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase.cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hbaseI2<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> hbase_tl' <span class="main">[</span><span class="operator">dest</span><span class="main">]</span> <span class="main">=</span> hbase_tl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#</span> <span class="free">ns</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">n</span> <span class="free">ns</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Goodstein_Lambda-hbase_elt"><span class="command">lemma</span></span> hbase_elt <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"C <span class="free">ns</span> <span class="main">∈</span> hbase <span class="free">b</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="free">ns</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> hbase <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-evalC_sum_list"><span class="command">lemma</span></span> evalC_sum_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalC <span class="free">b</span> <span class="main">(</span>C <span class="free">ns</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span><span class="main">^</span>evalC <span class="free">b</span> <span class="bound">n</span><span class="main">)</span> <span class="free">ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-sum_list_replicate"><span class="command">lemma</span></span> sum_list_replicate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>replicate <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-base_red"><span class="command">lemma</span></span> base_red<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">∈</span> set <span class="free">ns</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m'</span><span class="main">.</span> <span class="bound">m'</span> <span class="main">∈</span> set <span class="free">ms</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">*</span> <span class="free">b</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="free">ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">j</span> <span class="main">*</span> <span class="free">b</span><span class="main">^</span><span class="free">m</span> <span class="main">+</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="free">ms</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n<span class="main">(</span>1<span class="main">)</span> m<span class="main">(</span>1<span class="main">)</span> s
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">ns</span></span> <span class="quoted"><span class="free">ms</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span> <span class="skolem">ms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">∈</span> set <span class="skolem">ns</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m'</span><span class="main">.</span> <span class="bound">m'</span> <span class="main">∈</span> set <span class="skolem">ms</span> <span class="main">⟹</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="bound">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">*</span> <span class="free">b</span><span class="main">^</span><span class="main">0</span> <span class="main">+</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="skolem">ns</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">*</span> <span class="free">b</span><span class="main">^</span><span class="skolem">m</span> <span class="main">+</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="skolem">ms</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">(^)</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">ns</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n'<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"sum_list <span class="main"><span class="main"><span class="main">(</span></span></span>map <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">n</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">b</span></span></span><span class="main"><span class="main"><span class="main">^</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">n</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">ns</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_list_const_mult power_Suc <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> map_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">(^)</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">ms</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">*</span><span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> order.strict_trans1<span class="main">[</span><span class="operator">OF</span> le0 m'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"sum_list <span class="main"><span class="main"><span class="main">(</span></span></span>map <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">n</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">b</span></span></span><span class="main"><span class="main"><span class="main">^</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">n</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">ms</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_list_const_mult power_Suc <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> map_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s' n'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="main">(</span><span class="operator">metis</span> Groups.mult_ac<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Groups.mult_ac<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Suc_pred div_less mod_div_mult_eq
          mod_mult_self2 mod_mult_self2_is_0 mult_zero_right nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s' n'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> m'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> div_less mod_div_mult_eq mod_mult_self1<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> BASE <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> BASE<span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="skolem">m'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>2-4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> BASE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ms</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">j</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ns</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> that n<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> m<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m'</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">=</span> map Suc <span class="skolem">ns'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">∈</span> set <span class="skolem">ns'</span> <span class="main">⟹</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="bound">n'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>2<span class="main">)</span> less_trans<span class="main">[</span><span class="operator">OF</span> zero_less_Suc Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">n</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">n</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">ns</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> map_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ms'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span> <span class="main">=</span> map Suc <span class="skolem">ms'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m'</span><span class="main">.</span> <span class="bound">m'</span> <span class="main">∈</span> set <span class="skolem">ms'</span> <span class="main">⟹</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="bound">m'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> m'<span class="main">]</span> less_trans<span class="main">[</span><span class="operator">OF</span> zero_less_Suc Suc<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> m'<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">n</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">n</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">ms</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> map_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword1"><span class="command">using</span></span> n<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"map <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">ns</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"map <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">ms</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">m</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ _ *<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> add_mult_distrib2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_list_const_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Goodstein_Lambda-evalC_inj_on_hbase"><span class="command">lemma</span></span> evalC_inj_on_hbase<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> hbase <span class="free">b</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">∈</span> hbase <span class="free">b</span> <span class="main">⟹</span> evalC <span class="free">b</span> <span class="free">n</span> <span class="main">=</span> evalC <span class="free">b</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase.cases<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">i</span> <span class="skolem">n</span> <span class="skolem">ns</span> <span class="skolem">m'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> C <span class="main">(</span>replicate <span class="skolem">j</span> <span class="skolem">m</span> <span class="main">@</span> <span class="skolem">ms</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> hbase <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"C <span class="skolem">ms</span> <span class="main">∈</span> hbase <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m'</span><span class="main">.</span> <span class="bound">m'</span> <span class="main">∈</span> set <span class="skolem">ms</span> <span class="main">⟹</span> evalC <span class="free">b</span> <span class="skolem">m</span> <span class="main">&lt;</span> evalC <span class="free">b</span> <span class="bound">m'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>8<span class="main">,</span>1<span class="main">,</span>2<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase.cases<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">∧</span> evalC <span class="free">b</span> <span class="skolem">n</span> <span class="main">=</span> evalC <span class="free">b</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>9<span class="main">)</span> m<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> base_red<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map <span class="main"><span class="main"><span class="main">(</span></span></span>evalC <span class="free"><span class="free"><span class="free">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">ns</span></span></span>"</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map <span class="main"><span class="main"><span class="main">(</span></span></span>evalC <span class="free"><span class="free"><span class="free">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">ms</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comp_def evalC_sum_list sum_list_replicate<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> m<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> 2<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> m<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> 2<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Correctness of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> stepC<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"stepC <span class="free"><span class="free">c</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> preserves hereditary base <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">c</span></span> <span class="main"><span class="main">+</span></span> <span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">::</span></span> nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  representations. In order to cover intermediate results produced by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> stepC<span class="antiquote"><span class="antiquote">}</span></span></span></span>, we extend
  the hereditary base representation to allow the least significant digit to be equal to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  which essentially means that we may have an extra sibling in front on every level.›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">hbase_ext</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">b</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> hbase <span class="free">b</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> <span class="free">hbase_ext</span> <span class="free">b</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> <span class="free">hbase_ext</span> <span class="free">b</span> <span class="main">⟹</span>
   C <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∈</span> hbase <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">m'</span><span class="main">.</span> <span class="bound">m'</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">⟹</span> evalC <span class="free">b</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> evalC <span class="free">b</span> <span class="bound">m'</span><span class="main">)</span> <span class="main">⟹</span>
   C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">hbase_ext</span> <span class="free">b</span>"</span></span>

<span class="keyword1" id="Goodstein_Lambda-hbase_ext_hd'"><span class="command">lemma</span></span> hbase_ext_hd' <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"C <span class="main">(</span><span class="free">n</span> <span class="main">#</span> <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> hbase_ext <span class="free">b</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> hbase_ext <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase_ext.cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hbase_ext.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Goodstein_Lambda-hbase_ext_tl"><span class="command">lemma</span></span> hbase_ext_tl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C <span class="free">ns</span> <span class="main">∈</span> hbase_ext <span class="free">b</span> <span class="main">⟹</span> <span class="free">ns</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> C <span class="main">(</span>tl <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> hbase <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"C <span class="free">ns</span>"</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase_ext.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hbase_tl'<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> hbase_ext_tl' <span class="main">[</span><span class="operator">dest</span><span class="main">]</span> <span class="main">=</span> hbase_ext_tl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#</span> <span class="free">ns</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">n</span> <span class="free">ns</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Goodstein_Lambda-hbase_funC"><span class="command">lemma</span></span> hbase_funC<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> C <span class="main">(</span><span class="free">n</span> <span class="main">#</span> <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> hbase_ext <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span> <span class="main">⟹</span>
    C <span class="main">(</span>funC <span class="free">n</span> <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span> <span class="main">@</span> <span class="free">ns</span><span class="main">)</span> <span class="main">∈</span> hbase_ext <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ns</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> funC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"evalC <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span> <span class="main">(</span>C <span class="skolem">ms</span><span class="main">)</span> <span class="main">&lt;</span> evalC <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span> <span class="skolem">m'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m'</span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase_ext.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Suc_lessD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq that<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 4 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hbase_ext.intros hbase.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> order.strict_implies_order<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">m</span> <span class="skolem">ms</span> <span class="skolem">ms'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> funC.simps append_Cons append_Nil
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hbase_ext.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 31 32 33<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>33 <span class="skolem">m'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase_ext.cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 33
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_or_eq_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> 33<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> 3<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Goodstein_Lambda-stepC_sound"><span class="command">lemma</span></span> stepC_sound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> hbase_ext <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> stepC <span class="free">c</span> <span class="free">n</span> <span class="main">∈</span> hbase <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> stepC.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">ns</span> <span class="skolem">ms</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase_ext.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> stepC.simps<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hbase_funC<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hbase.intros<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Surjectivity of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> evalC<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note that the base must be at least <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">::</span></span> nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Goodstein_Lambda-evalC_surjective"><span class="command">lemma</span></span> evalC_surjective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span> <span class="main">∈</span> hbase <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> evalC <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="bound">n'</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"C <span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span> hbase.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">x</span> <span class="main">≤</span> Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> n' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bexE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> evalC <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> hbase <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"C <span class="main"><span class="main"><span class="main">[</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">n'</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hbase.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> hbaseI2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">+</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> n' <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> step<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bexE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> stepC_dec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> C2O.cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> stepC_sound hbase_ext.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Monotonicity of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> hbase<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we show that every hereditary base <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span> <span class="main"><span class="main">::</span></span> nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> number is also a valid hereditary
  base <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span> <span class="main"><span class="main">::</span></span> nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> number. This is not immediate because we have to show that monotonicity
  of siblings is preserved.›</span></span>

<span class="keyword1" id="Goodstein_Lambda-hbase_evalC_mono"><span class="command">lemma</span></span> hbase_evalC_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> hbase <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> hbase <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"evalC <span class="free">b</span> <span class="free">n</span> <span class="main">&lt;</span> evalC <span class="free">b</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"evalC <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span> <span class="free">n</span> <span class="main">&lt;</span> evalC <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase.cases<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">b'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 not_less_eq <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> less_imp_Suc_add<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"evalC <span class="free">b</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"evalC <span class="free">b</span> <span class="free">m</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_Suc_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> stepC_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">b'</span></span><span class="main">,</span> <span class="operator">OF</span> hbase_ext.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      stepC_dec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">b'</span></span><span class="main">]</span> stepC_dec'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">b'</span></span><span class="main">]</span> evalC_inj_on_hbase
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> C2O.cases<span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> evalC_surjective<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b'</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Goodstein_Lambda-hbase_mono"><span class="command">lemma</span></span> hbase_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> hbase <span class="free">b</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> hbase <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hbase.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hbase.intros hbase_evalC_mono<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conversion to and from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> nat<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We have previously defined <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"H2N <span class="free"><span class="free">b</span></span> <span class="main"><span class="main">=</span></span> evalC <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"N2H <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as its inverse.
  So we can use the injectivity and surjectivity of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"evalC <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for simplification.›</span></span>

<span class="keyword1" id="Goodstein_Lambda-N2H_inv"><span class="command">lemma</span></span> N2H_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> hbase <span class="free">b</span> <span class="main">⟹</span> N2H <span class="free">b</span> <span class="main">(</span>H2N <span class="free">b</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> evalC_inj_on_hbase
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N2H_def H2N_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> inj_on_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inv_into_f_f<span class="main">)</span>

<span class="keyword1" id="Goodstein_Lambda-H2N_inv"><span class="command">lemma</span></span> H2N_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"H2N <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>N2H <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> evalC_surjective<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N2H_def H2N_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> f_inv_into_f<span class="main">)</span>

<span class="keyword1" id="Goodstein_Lambda-N2H_eqI"><span class="command">lemma</span></span> N2H_eqI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> hbase <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   H2N <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">⟹</span> N2H <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> N2H_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Goodstein_Lambda-N2H_neI"><span class="command">lemma</span></span> N2H_neI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> hbase <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   H2N <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span> <span class="main">≠</span> <span class="free">m</span> <span class="main">⟹</span> N2H <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H2N_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Goodstein_Lambda-N2H_0"><span class="command">lemma</span></span> N2H_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"N2H <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> C <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H2N_def N2H_inv hbase.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Goodstein_Lambda-N2H_nz"><span class="command">lemma</span></span> N2H_nz <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> N2H <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span> <span class="main">≠</span> C <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> N2H_0 H2N_inv neq0_conv<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Goodstein function revisited›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We are now ready to prove termination of the Goodstein function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> goodstein<span class="antiquote"><span class="antiquote">}</span></span></span></span> as well
  as its relation to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> goodsteinC<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> goodsteinO<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Goodstein_Lambda-goodstein_aux"><span class="command">lemma</span></span> goodstein_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"goodsteinC <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span> <span class="main">(</span>N2H <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    goodsteinC <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>N2H <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>H2N <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>N2H <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> C <span class="main">[]</span> <span class="main">⟹</span> goodsteinC <span class="skolem">c</span> <span class="skolem">n</span> <span class="main">=</span> goodsteinC <span class="main">(</span><span class="skolem">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>stepC <span class="skolem">c</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> stepC.induct<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"stepC <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span> <span class="main">(</span>N2H <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> hbase <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H2N_def N2H_inv evalC_surjective hbase_ext.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hbase_mono stepC_sound<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> stepC_dec<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"N2H <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">folded</span> H2N_def<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> N2H <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span><span class="bound">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral N2H_inv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">goodstein</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> goodsteinC <span class="bound">c</span> <span class="main">(</span>N2H <span class="main">(</span><span class="bound">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="bound">c</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> _ 1<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"goodsteinC <span class="skolem">c</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> goodsteinC.induct<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> goodstein_aux eval_nat_numeral<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> Suc_le_eq diff_less_mono2 lessI *<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Goodstein_Lambda-goodstein_def'"><span class="command">lemma</span></span> goodstein_def'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> goodstein <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> goodsteinC <span class="free">c</span> <span class="main">(</span>N2H <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> goodstein.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> goodstein_aux eval_nat_numeral<span class="main">)</span>

<span class="keyword1" id="Goodstein_Lambda-goodstein_impl"><span class="command">lemma</span></span> goodstein_impl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> goodstein <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> goodsteinO <span class="free">c</span> <span class="main">(</span>C2O <span class="main">(</span>N2H <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹but note that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">N2H</span><span class="antiquote">}</span></span> is not executable as currently defined›</span>
  <span class="keyword1"><span class="command">using</span></span> goodstein_def'<span class="main">[</span><span class="operator">unfolded</span> goodsteinC_def'<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Goodstein_Lambda-goodstein_16"><span class="command">lemma</span></span> goodstein_16<span class="main">:</span>
  <span class="quoted"><span class="quoted">"𝒢 <span class="numeral">16</span> <span class="main">=</span> goodsteinO <span class="main">1</span> <span class="main">(</span>expω <span class="main">(</span>expω <span class="main">(</span>expω <span class="main">(</span>expω Z<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"N2H <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="numeral">16</span> <span class="main">=</span> C <span class="main">[</span>C <span class="main">[</span>C <span class="main">[</span>C <span class="main">[</span>C <span class="main">[]</span><span class="main">]</span><span class="main">]</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H2N_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> N2H_eqI hbase_singletonI hbase.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> goodstein_impl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Translation to $\lambda$-calculus›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define Church encodings for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> nat<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> Ord<span class="antiquote"><span class="antiquote">}</span></span></span></span>. Note that we are basically in a
  Hindley-Milner type system, so we cannot use a proper polymorphic type. We can still express
  Church encodings as folds over values of the original type.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Z<span class="hidden">⇩</span><sub>N</sub></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Z<span class="hidden">⇩</span><sub>N</sub></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">S<span class="hidden">⇩</span><sub>N</sub></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">S<span class="hidden">⇩</span><sub>N</sub></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">s</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">s</span> <span class="main">(</span><span class="bound">n</span> <span class="bound">s</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">fold_nat</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">⟩<span class="hidden">⇩</span><sub>N</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="main">0</span><span class="keyword1"><span class="free">⟩<span class="hidden">⇩</span><sub>N</sub></span></span> <span class="main">=</span> Z<span class="hidden">⇩</span><sub>N</sub>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="keyword1"><span class="free">⟩<span class="hidden">⇩</span><sub>N</sub></span></span> <span class="main">=</span> S<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="keyword1"><span class="free">⟩<span class="hidden">⇩</span><sub>N</sub></span></span>"</span></span>

<span class="keyword1" id="Goodstein_Lambda-one"><span class="command">lemma</span></span> one<span class="hidden">⇩</span><sub>N</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">1</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>N</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Z<span class="hidden">⇩</span><sub>O</sub></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Z<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">S<span class="hidden">⇩</span><sub>O</sub></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">S<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">z</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">s</span> <span class="main">(</span><span class="bound">n</span> <span class="bound">z</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">L<span class="hidden">⇩</span><sub>O</sub></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">z</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="bound">z</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">fold_Ord</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span>Z<span class="keyword1"><span class="free">⟩<span class="hidden">⇩</span><sub>O</sub></span></span> <span class="main">=</span> Z<span class="hidden">⇩</span><sub>O</sub>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span>S <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="keyword1"><span class="free">⟩<span class="hidden">⇩</span><sub>O</sub></span></span> <span class="main">=</span> S<span class="hidden">⇩</span><sub>O</sub> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="keyword1"><span class="free">⟩<span class="hidden">⇩</span><sub>O</sub></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span>L <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="keyword1"><span class="free">⟩<span class="hidden">⇩</span><sub>O</sub></span></span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>O</sub> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span><span class="keyword1"><span class="free">⟩<span class="hidden">⇩</span><sub>O</sub></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following abbreviations and lemmas show how to implement the arithmetic functions and
  the Goodstein function on a Church-encoded <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> Ord<span class="antiquote"><span class="antiquote">}</span></span></span></span> in lambda calculus.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">add<span class="hidden">⇩</span><sub>O</sub></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">add<span class="hidden">⇩</span><sub>O</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">)</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Goodstein_Lambda-add"><span class="command">lemma</span></span> add<span class="hidden">⇩</span><sub>O</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span>addO <span class="free">n</span> <span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">=</span> add<span class="hidden">⇩</span><sub>O</sub> <span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">⟨</span><span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">mul<span class="hidden">⇩</span><sub>O</sub></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mul<span class="hidden">⇩</span><sub>O</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">z</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">m</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">)</span> <span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Goodstein_Lambda-mul"><span class="command">lemma</span></span> mul<span class="hidden">⇩</span><sub>O</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span>mulO <span class="free">n</span> <span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">=</span> mul<span class="hidden">⇩</span><sub>O</sub> <span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">⟨</span><span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add<span class="hidden">⇩</span><sub>O</sub><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">ω<span class="hidden">⇩</span><sub>O</sub></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ω<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>N</sub></span> <span class="bound">s</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Goodstein_Lambda-ω"><span class="command">lemma</span></span> ω<span class="hidden">⇩</span><sub>O</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span>ω<span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">=</span> ω<span class="hidden">⇩</span><sub>O</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">(</span>S <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> Z<span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="skolem">z</span> <span class="skolem">s</span> <span class="skolem">l</span> <span class="main">=</span> <span class="main">⟨</span><span class="skolem">i</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>N</sub></span> <span class="skolem">s</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">z</span> <span class="skolem">s</span> <span class="skolem">l</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ω_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">expω<span class="hidden">⇩</span><sub>O</sub></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">expω<span class="hidden">⇩</span><sub>O</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span> <span class="bound">l</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">l</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>N</sub></span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">l</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">n</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Goodstein_Lambda-expω"><span class="command">lemma</span></span> expω<span class="hidden">⇩</span><sub>O</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span>expω <span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">=</span> expω<span class="hidden">⇩</span><sub>O</sub> <span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mul<span class="hidden">⇩</span><sub>O</sub> ω<span class="hidden">⇩</span><sub>O</sub><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">goodstein<span class="hidden">⇩</span><sub>O</sub></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">goodstein<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">c</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">n</span> <span class="main">(</span><span class="bound">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">m</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="bound">m</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Goodstein_Lambda-goodstein"><span class="command">lemma</span></span> goodstein<span class="hidden">⇩</span><sub>O</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"goodsteinO <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> goodstein<span class="hidden">⇩</span><sub>O</sub> <span class="free">c</span> <span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note that modeling Church encodings with folds is still limited. For example, the meaningful
  expression <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"⟨n⟩<span class="hidden">⇩</span><sub>N</sub> expω<span class="hidden">⇩</span><sub>O</sub> Z<span class="hidden">⇩</span><sub>O</sub>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> cannot be typed in Isabelle/HOL, as that would require rank-2
  polymorphism.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Alternative: free theorems›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following is essentially the free theorem for Church-encoded <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> Ord<span class="antiquote"><span class="antiquote">}</span></span></span></span> values.›</span></span>

<span class="keyword1" id="Goodstein_Lambda-freeOrd"><span class="command">lemma</span></span> freeOrd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span><span class="free">s</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">(</span><span class="free">h</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span><span class="free">l</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">l'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">(</span><span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="free">z</span> <span class="free">s</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">(</span><span class="free">h</span> <span class="free">z</span><span class="main">)</span> <span class="free">s'</span> <span class="free">l'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Each of the following proofs first states a naive definition of the corresponding function
  (which is proved correct by induction), from which we then derive the optimized version using
  the free theorem, by (conditional) rewriting (without induction).›</span></span>

<span class="keyword1" id="Goodstein_Lambda-add"><span class="command">lemma</span></span> add<span class="hidden">⇩</span><sub>O</sub>'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span>addO <span class="free">n</span> <span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">=</span> add<span class="hidden">⇩</span><sub>O</sub> <span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">⟨</span><span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>addO <span class="free">n</span> <span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">=</span> <span class="main">⟨</span><span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> S<span class="hidden">⇩</span><sub>O</sub> L<span class="hidden">⇩</span><sub>O</sub>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> freeOrd<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> h <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Goodstein_Lambda-mul"><span class="command">lemma</span></span> mul<span class="hidden">⇩</span><sub>O</sub>'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span>mulO <span class="free">n</span> <span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">=</span> mul<span class="hidden">⇩</span><sub>O</sub> <span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">⟨</span><span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>mulO <span class="free">n</span> <span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">=</span> <span class="main">⟨</span><span class="free">m</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> Z<span class="hidden">⇩</span><sub>O</sub> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> add<span class="hidden">⇩</span><sub>O</sub> <span class="bound">m</span> <span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span><span class="main">)</span> L<span class="hidden">⇩</span><sub>O</sub>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add<span class="hidden">⇩</span><sub>O</sub><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> freeOrd<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> h <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Goodstein_Lambda-expω"><span class="command">lemma</span></span> expω<span class="hidden">⇩</span><sub>O</sub>'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span>expω <span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">=</span> expω<span class="hidden">⇩</span><sub>O</sub> <span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>expω <span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">=</span> <span class="main">⟨</span><span class="free">n</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>O</sub></span> <span class="main">(</span>S<span class="hidden">⇩</span><sub>O</sub> Z<span class="hidden">⇩</span><sub>O</sub><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> mul<span class="hidden">⇩</span><sub>O</sub> <span class="bound">m</span> ω<span class="hidden">⇩</span><sub>O</sub><span class="main">)</span> L<span class="hidden">⇩</span><sub>O</sub>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mul<span class="hidden">⇩</span><sub>O</sub> ω<span class="hidden">⇩</span><sub>O</sub><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> freeOrd<span class="main"><span class="main"><span class="main">[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> h <span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">n</span> <span class="bound">z</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>