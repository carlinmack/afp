<div id="Girth_Chromatic_Misc">
<div class="head">
<h1>Theory Girth_Chromatic_Misc</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Girth_Chromatic_Misc
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Extended_Real.html">HOL-Library.Extended_Real</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxilliary lemmas and setup›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This section contains facts about general concepts which are not directly
  connected to the proof of the Chromatic-Girth theorem. At some point in time,
  most of them could be moved to the Isabelle base library.

  Also, a little bit of setup happens.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Numbers›</span></span>

<span class="keyword1" id="Girth_Chromatic_Misc-enat_in_Inf"><span class="command">lemma</span></span> enat_in_Inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"enat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Inf <span class="free">S</span> <span class="main">≠</span> top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Inf <span class="free">S</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="var">?thesis</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> Inf_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf <span class="free">S</span> <span class="main">=</span> enat <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> top_enat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="free">S</span> <span class="main">≤</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> complete_lattice_class.Inf_lower<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="free">S</span> <span class="main">≠</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="free">S</span> <span class="main">&lt;</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Inf_conv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> Inf <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_Inf_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Inf_conv <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Girth_Chromatic_Misc-enat_in_INF"><span class="command">lemma</span></span> enat_in_INF<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> enat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> top"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> enat_in_Inf <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">S</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">x</span><span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Girth_Chromatic_Misc-enat_less_INF_I"><span class="command">lemma</span></span> enat_less_INF_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> enat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_ile_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> INF_greatest<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic_Misc-enat_le_Sup_iff"><span class="command">lemma</span></span> enat_le_Sup_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"enat <span class="free">k</span> <span class="main">≤</span> Sup <span class="free">M</span> <span class="main">⟷</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> enat <span class="free">k</span> <span class="main">≤</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enat_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>enat <span class="free">k</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">if</span> finite <span class="free">M</span> <span class="keyword1">then</span> Max <span class="free">M</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span><span class="main">;</span> <span class="free">M</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">m</span><span class="main">∈</span><span class="free">M</span><span class="main">.</span> enat <span class="free">k</span> <span class="main">≤</span> <span class="bound">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Max_in Sup_enat_def finite_enat_bounded linorder_linear<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Sup_enat_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">M</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enat_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enat_0 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> complete_lattice_class.Sup_upper2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Girth_Chromatic_Misc-enat_neq_zero_cancel_iff"><span class="command">lemma</span></span> enat_neq_zero_cancel_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> enat <span class="free">n</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
  <span class="quoted"><span class="quoted">"enat <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enat_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1" id="Girth_Chromatic_Misc-natceiling_lessD"><span class="command">lemma</span></span> natceiling_lessD<span class="main">:</span> <span class="quoted"><span class="quoted">"nat<span class="main">(</span>ceiling <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> real <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="keyword1" id="Girth_Chromatic_Misc-le_natceiling_iff"><span class="command">lemma</span></span> le_natceiling_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">≤</span> nat<span class="main">(</span>ceiling <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="keyword1" id="Girth_Chromatic_Misc-natceiling_le_iff"><span class="command">lemma</span></span> natceiling_le_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> nat<span class="main">(</span>ceiling <span class="free">r</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="keyword1" id="Girth_Chromatic_Misc-dist_real_noabs_less"><span class="command">lemma</span></span> dist_real_noabs_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">a</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic_Misc-n_choose_2_nat"><span class="command">lemma</span></span> n_choose_2_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="free">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc le_Suc_ex numeral_2_eq_2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fact <span class="free">n</span> <span class="keyword1">div</span> fact <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> binomial_altdef_nat
        div_mult2_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult.commute numeral_2_eq_2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> binomial_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Girth_Chromatic_Misc-powr_less_one"><span class="command">lemma</span></span> powr_less_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms less_log_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Girth_Chromatic_Misc-powr_le_one_le"><span class="command">lemma</span></span> powr_le_one_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span>real<span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">1</span>  <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> powr_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="skolem">y</span>›</span></span> neg_le_iff_le powr_minus_divide powr_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lists and Sets›</span></span>

<span class="keyword1" id="Girth_Chromatic_Misc-list_set_tl"><span class="command">lemma</span></span> list_set_tl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Girth_Chromatic_Misc-list_exhaust3"><span class="command">lemma</span></span> list_exhaust3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="main">|</span> <span class="free">x</span> <span class="free">y</span> <span class="free">ys</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">x</span> <span class="main">#</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic_Misc-card_Ex_subset"><span class="command">lemma</span></span> card_Ex_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> card <span class="free">M</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="bound">N</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">∧</span> card <span class="bound">N</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Suc_eq<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Limits and eventually›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We employ filters and the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">eventually</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> predicate to deal with the
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">∃</span></span><span class="bound"><span class="bound">N</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">∀</span></span><span class="bound"><span class="bound"><span class="bound"><span class="bound">n</span></span></span></span><span class="main"><span class="main">≥</span></span><span class="bound"><span class="bound">N</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">P</span></span> <span class="bound"><span class="bound">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> cases. To make this more convenient, introduce
  a shorter syntax.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">evseq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">∀<span class="hidden">⇧</span><sup>∞</sup></span>"</span> 10<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">evseq</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> eventually <span class="free"><span class="bound"><span class="entity">P</span></span></span> sequentially"</span></span>

<span class="keyword1" id="Girth_Chromatic_Misc-eventually_le_le"><span class="command">lemma</span></span> eventually_le_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">::</span> preorder<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="free">net</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">R</span>  <span class="bound">x</span><span class="main">)</span> <span class="free">net</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">R</span> <span class="bound">x</span><span class="main">)</span> <span class="free">net</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic_Misc-LIMSEQ_neg_powr"><span class="command">lemma</span></span> LIMSEQ_neg_powr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_neg_powr<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms filterlim_real_sequentially<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic_Misc-LIMSEQ_inv_powr"><span class="command">lemma</span></span> LIMSEQ_inv_powr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="main">::</span> nat<span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">d</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_zero_powrI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">/</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">/</span> real <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> real <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_divide_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span> filterlim_at_top_imp_at_infinity
              filterlim_real_sequentially tendsto_divide_0<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">d</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Ugraphs">
<div class="head">
<h1>Theory Ugraphs</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Ugraphs
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Girth_Chromatic_Misc">Girth_Chromatic_Misc</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Undirected Simple Graphs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we define some basics of graph theory needed to formalize
  the Chromatic-Girth theorem.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For readability, we introduce synonyms for the types of vertexes, edges,
  graphs and walks.
›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> uvert <span class="main">=</span> <span class="quoted">nat</span>
<span class="keyword1"><span class="command">type_synonym</span></span> uedge <span class="main">=</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> ugraph <span class="main">=</span> <span class="quoted"><span class="quoted">"uvert set <span class="main">×</span> uedge set"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> uwalk <span class="main">=</span> <span class="quoted"><span class="quoted">"uvert list"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">uedges</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> uedge set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uedges</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> snd <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">uverts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> uvert set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uverts</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> fst <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mk_uedge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uvert <span class="main">×</span> uvert <span class="main">⇒</span> uedge"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">mk_uedge</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹All edges over a set of vertexes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">all_edges</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> mk_uedge <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">uv</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">×</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> fst <span class="bound">uv</span> <span class="main">≠</span> snd <span class="bound">uv</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uwellformed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uwellformed</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">∈</span>uedges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> card <span class="bound">e</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> <span class="bound">e</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> uverts <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">uwalk_edges</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uwalk <span class="main">⇒</span> uedge list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">uwalk_edges</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uwalk_edges</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uwalk_edges</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">}</span> <span class="main">#</span> <span class="free">uwalk_edges</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uwalk_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uwalk <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uwalk_length</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> length <span class="main">(</span>uwalk_edges <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uwalks</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> uwalk set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uwalks</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> set <span class="bound">p</span> <span class="main">⊆</span> uverts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> set <span class="main">(</span>uwalk_edges <span class="bound">p</span><span class="main">)</span> <span class="main">⊆</span> uedges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ucycles</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> uwalk set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ucycles</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> uwalk_length <span class="bound">p</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> uwalks <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> distinct <span class="main">(</span>tl <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> hd <span class="bound">p</span> <span class="main">=</span> last <span class="bound">p</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">remove_vertex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> nat <span class="main">⇒</span> ugraph"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">--</span> _"</span> <span class="main">[</span>60<span class="main">,</span>60<span class="main">]</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">remove_vertex</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> <span class="main">(</span>uverts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">}</span><span class="main">,</span> uedges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="bound"><span class="bound">A</span></span> <span class="main">∈</span> uedges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Properties›</span></span>

<span class="keyword1" id="Ugraphs-uwalk_length_conv"><span class="command">lemma</span></span> uwalk_length_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"uwalk_length <span class="free">p</span> <span class="main">=</span> length <span class="free">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> uwalk_edges.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uwalk_length_def<span class="main">)</span>

<span class="keyword1" id="Ugraphs-all_edges_mono"><span class="command">lemma</span></span> all_edges_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">⊆</span> <span class="free">ws</span> <span class="main">⟹</span> all_edges <span class="free">vs</span> <span class="main">⊆</span> all_edges <span class="free">ws</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> all_edges_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Ugraphs-all_edges_subset_Pow"><span class="command">lemma</span></span> all_edges_subset_Pow<span class="main">:</span> <span class="quoted"><span class="quoted">"all_edges <span class="free">A</span> <span class="main">⊆</span> Pow <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> all_edges_def<span class="main">)</span>

<span class="keyword1" id="Ugraphs-in_mk_uedge_img"><span class="command">lemma</span></span> in_mk_uedge_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">∈</span> mk_uedge <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

<span class="keyword1" id="Ugraphs-distinct_edgesI"><span class="command">lemma</span></span> distinct_edgesI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>uwalk_edges <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∉</span> set <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">}</span> <span class="main">∉</span> set <span class="main">(</span>uwalk_edges <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> uwalk_edges.induct<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ugraphs-finite_ucycles"><span class="command">lemma</span></span> finite_ucycles<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>ucycles <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ucycles <span class="free">G</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> uverts <span class="free">G</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ucycles <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>tl <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> uverts <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ucycles_def uwalks_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>tl <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> uverts <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_set_tl<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="main">(</span>tl <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> card <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> distinct_card<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span>tl <span class="skolem">p</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> uverts <span class="free">G</span> <span class="main">∧</span> length <span class="skolem">p</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> uverts <span class="free">G</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_lists_length_le<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ugraphs-ucycles_distinct_edges"><span class="command">lemma</span></span> ucycles_distinct_edges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> ucycles <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>uwalk_edges <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> c_props<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>tl <span class="free">c</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">≤</span> length <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">c</span> <span class="main">=</span> last <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ucycles_def uwalk_length_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>hd <span class="free">c</span><span class="main">,</span> hd <span class="main">(</span>tl <span class="free">c</span><span class="main">)</span><span class="main">}</span> <span class="main">∉</span> set <span class="main">(</span>uwalk_edges <span class="main">(</span>tl <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> uwalk_edges.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">ys</span> <span class="main">≠</span> last <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uwalk_edges <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> hd <span class="skolem">ys</span><span class="main">}</span> <span class="main">#</span> uwalk_edges <span class="skolem">ys</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>uwalk_edges <span class="skolem">xs</span><span class="main">)</span> <span class="main">⊆</span> Pow <span class="main">(</span>set <span class="skolem">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> uwalk_edges.induct<span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>uwalk_edges <span class="main">(</span>tl <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> distinct_edgesI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ucycles_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_exhaust3<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ugraphs-card_left_less_pair"><span class="command">lemma</span></span> card_left_less_pair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> linorder<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span>
    <span class="main">=</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">*</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"card <span class="skolem">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> insert <span class="skolem">x</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> insert <span class="skolem">x</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span>
        <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_less_le<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">×</span> <span class="skolem">A</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert Suc
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Un_disjoint card_image <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_image_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_eq_0_iff insert<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Ugraphs-card_all_edges"><span class="command">lemma</span></span> card_all_edges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>all_edges <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span> <span class="keyword1">choose</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> inj_on_mk_uedge<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on mk_uedge <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> doubleton_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_edges <span class="free">A</span> <span class="main">=</span> mk_uedge <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> all_edges_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> in_mk_uedge_img<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?L</span> <span class="main">=</span> card <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_on_mk_uedge <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_image subset_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">*</span> <span class="main">(</span>card <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_left_less_pair <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>card <span class="free">A</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_choose_2_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ugraphs-verts_Gu"><span class="command">lemma</span></span> verts_Gu<span class="main">:</span> <span class="quoted"><span class="quoted">"uverts <span class="main">(</span><span class="free">G</span> <span class="main">--</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> uverts <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> remove_vertex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Ugraphs-edges_Gu"><span class="command">lemma</span></span> edges_Gu<span class="main">:</span> <span class="quoted"><span class="quoted">"uedges <span class="main">(</span><span class="free">G</span> <span class="main">--</span> <span class="free">u</span><span class="main">)</span> <span class="main">⊆</span> uedges <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> remove_vertex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Girth, Independence and Vertex Colorings›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">girth</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> enat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">girth</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> ucycles <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> enat <span class="main">(</span>uwalk_length <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">independent_sets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> uvert set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">independent_sets</span> <span class="free"><span class="bound"><span class="entity">Gr</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">vs</span><span class="main">.</span> <span class="bound">vs</span> <span class="main">⊆</span> uverts <span class="free"><span class="bound"><span class="entity">Gr</span></span></span> <span class="main">∧</span> all_edges <span class="bound">vs</span> <span class="main">∩</span> uedges <span class="free"><span class="bound"><span class="entity">Gr</span></span></span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">α</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> enat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="keyword1">SUP</span> <span class="bound">vs</span> <span class="main">∈</span> independent_sets <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> enat <span class="main">(</span>card <span class="bound">vs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vertex_colorings</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> uvert set set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vertex_colorings</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">C</span> <span class="main">=</span> uverts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c1</span><span class="main">∈</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">c2</span><span class="main">∈</span><span class="bound">C</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">≠</span> <span class="bound">c2</span> <span class="main">⟶</span> <span class="bound">c1</span> <span class="main">∩</span> <span class="bound">c2</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span><span class="bound">C</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> <span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="bound">c</span><span class="main">.</span> <span class="main">{</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">}</span> <span class="main">∉</span> uedges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The chromatic number $\chi$:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">chromatic_number</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> enat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">chromatic_number</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="keyword1">INF</span> <span class="bound">c</span><span class="main">∈</span> <span class="main">(</span>vertex_colorings <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> enat <span class="main">(</span>card <span class="bound">c</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Ugraphs-independent_sets_mono"><span class="command">lemma</span></span> independent_sets_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> independent_sets <span class="free">G</span> <span class="main">⟹</span> <span class="free">us</span> <span class="main">⊆</span> <span class="free">vs</span> <span class="main">⟹</span> <span class="free">us</span> <span class="main">∈</span> independent_sets <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Int_mono<span class="main">[</span><span class="operator">OF</span> all_edges_mono<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">us</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"uedges <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"uedges <span class="free">G</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> independent_sets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Ugraphs-le_α_iff"><span class="command">lemma</span></span> le_α_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> α <span class="free">Gr</span> <span class="main">⟷</span> <span class="free">k</span> <span class="main">∈</span> card <span class="main">`</span> independent_sets <span class="free">Gr</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">∈</span> independent_sets <span class="free">Gr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> card <span class="skolem">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> α_def enat_le_Sup_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">⊆</span> <span class="skolem">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> card <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_Ex_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">∈</span> independent_sets <span class="free">Gr</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> independent_sets_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">=</span> card <span class="skolem">us</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SUP_upper <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> α_def<span class="main">)</span>

<span class="keyword1" id="Ugraphs-zero_less_α"><span class="command">lemma</span></span> zero_less_α<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"uverts <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> α <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> uverts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> enat <span class="main">(</span>card <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∈</span> independent_sets <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> independent_sets_def all_edges_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> α_def less_SUP_iff <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ugraphs-α_le_card"><span class="command">lemma</span></span> α_le_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"α <span class="free">G</span> <span class="main">≤</span> card<span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> independent_sets <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊆</span> uverts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> independent_sets_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> α_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> SUP_least<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ugraphs-α_fin"><span class="command">lemma</span></span> α_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> α <span class="free">G</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> α_le_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"α <span class="free">G</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Ugraphs-α_remove_le"><span class="command">lemma</span></span> α_remove_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"α <span class="main">(</span><span class="free">G</span> <span class="main">--</span> <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> α <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"independent_sets <span class="main">(</span><span class="free">G</span> <span class="main">--</span> <span class="free">u</span><span class="main">)</span> <span class="main">⊆</span> independent_sets <span class="free">G</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⊆</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> all_edges_subset_Pow <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> independent_sets_def remove_vertex_def<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> α_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SUP_subset_mono<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A lower bound for the chromatic number of a graph can be given in terms of
  the independence number
›</span></span>
<span class="keyword1" id="Ugraphs-chromatic_lb"><span class="command">lemma</span></span> chromatic_lb<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf_G<span class="main">:</span> <span class="quoted"><span class="quoted">"uwellformed <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fin_G<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> neG<span class="main">:</span> <span class="quoted"><span class="quoted">"uverts <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span> <span class="main">/</span> α <span class="free">G</span> <span class="main">≤</span> chromatic_number <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> wf_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">{</span><span class="bound">v</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> uverts <span class="free">G</span> <span class="main">∈</span> vertex_colorings <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vertex_colorings_def uwellformed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"chromatic_number <span class="free">G</span> <span class="main">≠</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chromatic_number_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> top_enat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vc</span></span> <span class="keyword2"><span class="keyword">where</span></span> vc_vc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vc</span> <span class="main">∈</span> vertex_colorings <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> vc_size<span class="main">:</span><span class="quoted"><span class="quoted">"chromatic_number <span class="free">G</span> <span class="main">=</span> card <span class="skolem">vc</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> chromatic_number_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> enat_in_INF<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> fin_vc_elems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">vc</span> <span class="main">⟹</span> finite <span class="bound">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vc_vc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ fin_G<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vertex_colorings_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> sum_vc_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">c</span> <span class="main">∈</span> <span class="skolem">vc</span><span class="main">.</span> card <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fin_vc_elems vc_vc <span class="keyword1"><span class="command">unfolding</span></span> vertex_colorings_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> pairwise_def disjnt_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">vc</span> <span class="main">⟹</span> <span class="bound">c</span> <span class="main">∈</span> independent_sets <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vc_vc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vertex_colorings_def independent_sets_def all_edges_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">vc</span> <span class="main">⟹</span> card <span class="bound">c</span> <span class="main">≤</span> α <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vc_vc fin_vc_elems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> le_α_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vertex_colorings_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">c</span><span class="main">∈</span><span class="skolem">vc</span><span class="main">.</span> card <span class="bound">c</span><span class="main">)</span> <span class="main">≤</span> card <span class="skolem">vc</span> <span class="main">*</span> α <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_bounded_above<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">vc</span></span> <span class="quoted">card</span> <span class="quoted"><span class="quoted">"α <span class="free">G</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_eq_enat<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> of_nat_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ereal_of_enat <span class="main">(</span>card <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ereal_of_enat <span class="main">(</span>α <span class="free">G</span><span class="main">)</span> <span class="main">*</span> ereal_of_enat <span class="main">(</span>card <span class="skolem">vc</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_vc_card ereal_of_enat_pushout <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ereal_of_enat_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> zero_less_α<span class="main">[</span><span class="operator">OF</span> neG<span class="main">]</span> α_fin<span class="main">[</span><span class="operator">OF</span> fin_G<span class="main">]</span> vc_size <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ereal_divide_le_pos<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Girth_Chromatic">
<div class="head">
<h1>Theory Girth_Chromatic</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Girth_Chromatic
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Ugraphs">Ugraphs</a>
  <a href="#Girth_Chromatic_Misc">Girth_Chromatic_Misc</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Probability/Probability.html">HOL-Probability.Probability</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Decision_Procs/Approximation.html">HOL-Decision_Procs.Approximation</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Probability Space on Sets of Edges›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cylinder</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cylinder</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">T</span></span> <span class="main">∈</span> Pow <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⊆</span> <span class="bound">T</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∩</span> <span class="bound">T</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Girth_Chromatic-full_sum"><span class="command">lemma</span></span> full_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">A</span><span class="main">∈</span>Pow <span class="free">S</span><span class="main">.</span> <span class="free">p</span><span class="main">^</span>card <span class="bound">A</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">^</span>card <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>insert <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>Pow <span class="skolem">S</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">-</span> insert <span class="skolem">s</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">-</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Pow <span class="skolem">S</span> <span class="main">∩</span> insert <span class="skolem">s</span> <span class="main">`</span> Pow <span class="skolem">S</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> Pow <span class="skolem">S</span> <span class="main">⟹</span> card <span class="main">(</span>insert <span class="skolem">s</span> <span class="skolem">S</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_Diff_if <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="skolem">S</span> <span class="main">⟹</span> card <span class="main">(</span>insert <span class="skolem">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card.insert<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.reindex sum_distrib_left<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span>
                  insert.hyps sum.union_disjoint Pow_insert<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definition of the probability space on edges:›</span></span>
<span class="keyword1"><span class="command">locale</span></span> edge_space <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_prob<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">S_verts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">S_verts</span> <span class="main">≡</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">S_edges</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uedge set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">S_edges</span> <span class="main">=</span> all_edges S_verts"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">edge_ugraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uedge set <span class="main">⇒</span> ugraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">edge_ugraph</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">≡</span> <span class="main">(</span>S_verts<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">∩</span> S_edges<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> point_measure <span class="main">(</span>Pow S_edges<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">p</span><span class="main">^</span>card <span class="bound">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">^</span>card <span class="main">(</span>S_edges <span class="main">-</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Girth_Chromatic-finite_verts"><span class="command">lemma</span></span> finite_verts<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite S_verts"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_verts_def<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic-finite_edges"><span class="command">lemma</span></span> finite_edges<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite S_edges"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_edges_def all_edges_def finite_verts<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic-finite_graph"><span class="command">lemma</span></span> finite_graph<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="main">(</span>edge_ugraph <span class="free">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> edge_ugraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Girth_Chromatic-uverts_edge_ugraph"><span class="command">lemma</span></span> uverts_edge_ugraph<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uverts <span class="main">(</span>edge_ugraph <span class="free">es</span><span class="main">)</span> <span class="main">=</span> S_verts"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> edge_ugraph_def<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic-uedges_edge_ugraph"><span class="command">lemma</span></span> uedges_edge_ugraph<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uedges <span class="main">(</span>edge_ugraph <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="free">es</span> <span class="main">∩</span> S_edges"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> edge_ugraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Girth_Chromatic-space_eq"><span class="command">lemma</span></span> space_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"space P <span class="main">=</span> Pow S_edges"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def space_point_measure<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic-sets_eq"><span class="command">lemma</span></span> sets_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"sets P <span class="main">=</span> Pow <span class="main">(</span>Pow S_edges<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def sets_point_measure<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic-emeasure_eq"><span class="command">lemma</span></span> emeasure_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"emeasure P <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">A</span> <span class="main">⊆</span> Pow S_edges <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑</span><span class="bound">edges</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">p</span><span class="main">^</span>card <span class="bound">edges</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">^</span>card <span class="main">(</span>S_edges <span class="main">-</span> <span class="bound">edges</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_edges p_prob
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def space_point_measure emeasure_point_measure_finite
    sets_point_measure emeasure_notin_sets<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic-integrable_P"><span class="command">lemma</span></span> integrable_P<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"integrable P <span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_edges <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integrable_point_measure_finite P_def<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic-borel_measurable_P"><span class="command">lemma</span></span> borel_measurable_P<span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable P"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Girth_Chromatic-prob_space_P"><span class="command">lemma</span></span> prob_space_P<span class="main">:</span> <span class="quoted"><span class="quoted">"prob_space P"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"emeasure P <span class="main">(</span>space P<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="comment1">― ‹Sum of probabilities equals 1›</span>
    <span class="keyword1"><span class="command">using</span></span> finite_edges <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emeasure_eq full_sum one_ereal_def space_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> edge_space <span class="main">⊆</span> prob_space <span class="quoted">P</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prob_space_P<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> edge_space
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Girth_Chromatic-prob_eq"><span class="command">lemma</span></span> prob_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prob <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">A</span> <span class="main">⊆</span> Pow S_edges <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑</span><span class="bound">edges</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">p</span><span class="main">^</span>card <span class="bound">edges</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">^</span>card <span class="main">(</span>S_edges <span class="main">-</span> <span class="bound">edges</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> emeasure_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> p_prob <span class="keyword1"><span class="command">unfolding</span></span> emeasure_eq_measure <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_nonneg<span class="main">)</span>

<span class="keyword1" id="Girth_Chromatic-integral_finite_singleton"><span class="command">lemma</span></span> integral_finite_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> P <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>Pow S_edges<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> measure P <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p_prob prob_eq <span class="keyword1"><span class="command">unfolding</span></span> P_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lebesgue_integral_point_measure_finite<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Probability of cylinder sets:›</span></span>
<span class="keyword1" id="Girth_Chromatic-cylinder_prob"><span class="command">lemma</span></span> cylinder_prob<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> S_edges"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> S_edges"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob <span class="main">(</span>cylinder S_edges <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">A</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>card <span class="free">B</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?pp</span> <span class="free">A</span> <span class="free">B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pow S_edges <span class="main">∩</span> cylinder S_edges <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> cylinder S_edges <span class="free">A</span> <span class="free">B</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cylinder S_edges <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">∪</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cylinder S_edges <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> finite <span class="bound">x</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cylinder S_edges <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">∩</span> <span class="main">(</span>S_edges <span class="main">-</span> <span class="free">B</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cylinder S_edges <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">∪</span> <span class="main">(</span>S_edges <span class="main">-</span> <span class="free">B</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> S_edges <span class="main">-</span> <span class="bound">x</span>"</span></span>
       <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cylinder_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">T</span><span class="main">∈</span>cylinder S_edges <span class="free">A</span> <span class="free">B</span><span class="main">.</span> <span class="var">?pp</span> <span class="bound">T</span> <span class="main">(</span>S_edges <span class="main">-</span> <span class="bound">T</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">T</span> <span class="main">∈</span> cylinder S_edges <span class="free">A</span> <span class="free">B</span><span class="main">.</span> <span class="free">p</span><span class="main">^</span><span class="main">(</span>card <span class="free">A</span> <span class="main">+</span> card <span class="main">(</span><span class="bound">T</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>card <span class="free">B</span> <span class="main">+</span> card <span class="main">(</span><span class="main">(</span>S_edges <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">-</span> <span class="bound">T</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_edges <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Un_Int<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?pp</span> <span class="free">A</span> <span class="free">B</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">T</span><span class="main">∈</span>cylinder S_edges <span class="free">A</span> <span class="free">B</span><span class="main">.</span> <span class="var">?pp</span> <span class="main">(</span><span class="bound">T</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>S_edges <span class="main">-</span> <span class="free">B</span> <span class="main">-</span> <span class="bound">T</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add sum_distrib_left <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?pp</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="bound">T</span> <span class="main">∈</span> cylinder S_edges <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> S_edges <span class="main">-</span> <span class="free">B</span> <span class="main">-</span> <span class="bound">T</span> <span class="main">=</span> <span class="main">(</span>S_edges <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">-</span> <span class="free">B</span> <span class="main">-</span> <span class="main">(</span><span class="bound">T</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"Pow <span class="main">(</span>S_edges <span class="main">-</span> <span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">`</span> cylinder S_edges <span class="free">A</span> <span class="free">B</span>"</span></span>
         <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>cylinder S_edges <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"finite <span class="main">(</span>S_edges <span class="main">-</span> <span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cylinder_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> full_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"S_edges <span class="main">-</span> <span class="free">A</span> <span class="main">-</span> <span class="free">B</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.reindex<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prob_eq cylinder_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Girth_Chromatic-Markov_inequality"><span class="command">lemma</span></span> Markov_inequality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"uedge set <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> space P<span class="main">.</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span><span class="main">}</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span> P<span class="main">)</span> <span class="main">/</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>P<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span>P<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_eq_integral<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> nn_integral_Markov_inequality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"space P"</span></span> <span class="quoted">P</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="free">c</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emeasure_eq_measure ennreal_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Graph Probabilities outside of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Edge_Space</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> locale›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
 These abbreviations allow a compact expression of probabilities about random
 graphs outside of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Edge_Space</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> locale. We also transfer a few of the lemmas
 we need from the locale into the toplevel theory.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">MGn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span>uedge set<span class="main">)</span> measure"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MGn</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span>edge_space.P <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">probGn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span>uedge set <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">probGn</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> measure <span class="main">(</span>MGn <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space <span class="main">(</span>MGn <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">es</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Girth_Chromatic-probGn_le"><span class="command">lemma</span></span> probGn_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_prob<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">es</span><span class="main">.</span> <span class="bound">es</span> <span class="main">∈</span> space <span class="main">(</span>MGn <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">es</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">n</span> <span class="bound">es</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"probGn <span class="free">p</span> <span class="free">n</span> <span class="main">(</span><span class="free">P</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> probGn <span class="free">p</span> <span class="free">n</span> <span class="main">(</span><span class="free">Q</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> p_prob <span class="keyword1"><span class="command">interpret</span></span> E<span class="main">:</span> edge_space <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> E.finite_measure_mono sub <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> E.space_eq E.sets_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Short cycles›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">short_cycles</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> nat <span class="main">⇒</span> uwalk set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">short_cycles</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> ucycles <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> uwalk_length <span class="bound">p</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹obtains a vertex in a short cycle:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">choose_v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> nat <span class="main">⇒</span> uvert"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">choose_v</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">u</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> short_cycles <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> set <span class="bound">p</span>"</span></span>

<span class="keyword1"><span class="command">partial_function</span></span> <span class="main">(</span>tailrec<span class="main">)</span> <span class="entity">kill_short</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ugraph <span class="main">⇒</span> nat <span class="main">⇒</span> ugraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">kill_short</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> short_cycles <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">kill_short</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">--</span> <span class="main">(</span>choose_v <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Girth_Chromatic-ksc_simps"><span class="command">lemma</span></span> ksc_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"short_cycles <span class="free">G</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> kill_short <span class="free">G</span> <span class="free">k</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="quoted"><span class="quoted">"short_cycles <span class="free">G</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>  <span class="main">⟹</span> kill_short <span class="free">G</span> <span class="free">k</span> <span class="main">=</span> kill_short <span class="main">(</span><span class="free">G</span> <span class="main">--</span> <span class="main">(</span>choose_v <span class="free">G</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> kill_short.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"short_cycles <span class="free">G</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> choose_v__in_uverts<span class="main">:</span> <span class="quoted"><span class="quoted">"choose_v <span class="free">G</span> <span class="free">k</span> <span class="main">∈</span> uverts <span class="free">G</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> choose_v__in_short<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> short_cycles <span class="free">G</span> <span class="free">k</span> <span class="main">∧</span> choose_v <span class="free">G</span> <span class="free">k</span> <span class="main">∈</span> set <span class="bound">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ucycles <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"uwalk_length <span class="skolem">p</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> short_cycles_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ucycles_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uwalk_length_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> short_cycles <span class="free">G</span> <span class="free">k</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> set <span class="bound">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> short_cycles_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> choose_v_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> someI_ex<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> short_cycles_def ucycles_def uwalks_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Girth_Chromatic-kill_step_smaller"><span class="command">lemma</span></span> kill_step_smaller<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"short_cycles <span class="free">G</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"short_cycles <span class="main">(</span><span class="free">G</span> <span class="main">--</span> <span class="main">(</span>choose_v <span class="free">G</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="main">⊂</span> short_cycles <span class="free">G</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"choose_v <span class="free">G</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> short_cycles <span class="free">G</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cv</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">rule</span> choose_v__in_short<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"short_cycles <span class="main">(</span><span class="free">G</span> <span class="main">--</span> <span class="var">?cv</span><span class="main">)</span> <span class="free">k</span> <span class="main">⊆</span> short_cycles <span class="free">G</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> short_cycles <span class="main">(</span><span class="free">G</span> <span class="main">--</span> <span class="var">?cv</span><span class="main">)</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> short_cycles <span class="free">G</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> short_cycles_def ucycles_def uwalks_def
      <span class="keyword1"><span class="command">using</span></span> edges_Gu<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="var"><span class="quoted"><span class="var">?cv</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts_Gu<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> short_cycles <span class="main">(</span><span class="free">G</span> <span class="main">--</span> <span class="var">?cv</span><span class="main">)</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?cv</span> <span class="main">∈</span> set <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> short_cycles_def ucycles_def uwalks_def verts_Gu<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> short_cycles <span class="free">G</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Induction rule for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">kill_short</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:›</span></span>
<span class="keyword1" id="Girth_Chromatic-kill_short_induct"><span class="command">lemma</span></span> kill_short_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> empty kill_vert<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">G</span><span class="main">.</span> short_cycles <span class="bound">G</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">G</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_kill<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">G</span><span class="main">.</span> finite <span class="main">(</span>short_cycles <span class="bound">G</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> short_cycles <span class="bound">G</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>
    <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">G</span> <span class="main">--</span> <span class="main">(</span>choose_v <span class="bound">G</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">G</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">G</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>short_cycles <span class="free">G</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_ucycles<span class="main">[</span><span class="operator">OF</span> fin<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> short_cycles_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"short_cycles <span class="free">G</span> <span class="free">k</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_psubset_induct<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> kill_step_smaller a_kill a_empty<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Large Girth (after <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">kill_short</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>):›</span></span>
<span class="keyword1" id="Girth_Chromatic-kill_short_large_girth"><span class="command">lemma</span></span> kill_short_large_girth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> girth <span class="main">(</span>kill_short <span class="free">G</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> kill_short_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>empty <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> ucycles <span class="skolem">G</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">&lt;</span> enat <span class="main">(</span>uwalk_length <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> short_cycles_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> girth_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> enat_less_INF_I<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Order of graph (after <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">kill_short</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>):›</span></span>
<span class="keyword1" id="Girth_Chromatic-kill_short_order_of_graph"><span class="command">lemma</span></span> kill_short_order_of_graph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span> <span class="main">-</span> card <span class="main">(</span>short_cycles <span class="free">G</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>uverts <span class="main">(</span>kill_short <span class="free">G</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> kill_short_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>kill_vert <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?oG</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">--</span> <span class="main">(</span>choose_v <span class="skolem">G</span> <span class="free">k</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="var">?oG</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kill_vert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> remove_vertex_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uverts <span class="main">(</span>kill_short <span class="skolem">G</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> uverts <span class="main">(</span>kill_short <span class="var">?oG</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> kill_vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>uverts <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>uverts <span class="var">?oG</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> choose_v__in_uverts kill_vert
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> remove_vertex_def card_Suc_Diff1 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> card_Diff_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>short_cycles <span class="var">?oG</span> <span class="free">k</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>short_cycles <span class="skolem">G</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> psubset_card_mono kill_vert.hyps kill_step_smaller<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> kill_vert.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Independence number (after <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">kill_short</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>):›</span></span>
<span class="keyword1" id="Girth_Chromatic-kill_short_α"><span class="command">lemma</span></span> kill_short_α<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"α <span class="main">(</span>kill_short <span class="free">G</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> α <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> kill_short_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>kill_vert <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> kill_vert<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"α <span class="main">(</span><span class="skolem">G</span> <span class="main">--</span> <span class="main">(</span>choose_v <span class="skolem">G</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> α <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> α_remove_le<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> kill_vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Wellformedness (after <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">kill_short</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>):›</span></span>
<span class="keyword1" id="Girth_Chromatic-kill_short_uwellformed"><span class="command">lemma</span></span> kill_short_uwellformed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"uwellformed <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uwellformed <span class="main">(</span>kill_short <span class="free">G</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> kill_short_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>kill_vert <span class="skolem">G</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> kill_vert.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uwellformed <span class="main">(</span><span class="skolem">G</span> <span class="main">--</span> <span class="main">(</span>choose_v <span class="skolem">G</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uwellformed_def remove_vertex_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> kill_vert.hyps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Chromatic-Girth Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Probability of Independent Edges:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> edge_space<span class="main">)</span> random_prob_independent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob <span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space P<span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> α <span class="main">(</span>edge_ugraph <span class="bound">es</span><span class="main">)</span><span class="main">}</span>
    <span class="main">≤</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k_sets</span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">vs</span><span class="main">.</span> <span class="bound">vs</span> <span class="main">⊆</span> S_verts <span class="main">∧</span> card <span class="bound">vs</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">vs</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">∈</span> <span class="var">?k_sets</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"all_edges <span class="skolem">vs</span> <span class="main">⊆</span> S_edges"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> all_edges_def S_edges_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space P<span class="main">.</span> <span class="skolem">vs</span> <span class="main">∈</span> independent_sets <span class="main">(</span>edge_ugraph <span class="bound">es</span><span class="main">)</span><span class="main">}</span>
        <span class="main">=</span> cylinder S_edges <span class="main">{}</span> <span class="main">(</span>all_edges <span class="skolem">vs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> independent_sets_def edge_ugraph_def space_eq cylinder_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob <span class="var">?L</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A B finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cylinder_prob card_all_edges <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> prob_k_indep <span class="main">=</span> this
    <span class="comment1">― ‹probability that a fixed set of k vertices is independent in a random graph›</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space P<span class="main">.</span> <span class="free">k</span> <span class="main">∈</span> card <span class="main">`</span> independent_sets <span class="main">(</span>edge_ugraph <span class="bound">es</span><span class="main">)</span><span class="main">}</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">vs</span> <span class="main">∈</span> <span class="var">?k_sets</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space P<span class="main">.</span> <span class="bound">vs</span> <span class="main">∈</span> independent_sets <span class="main">(</span>edge_ugraph <span class="bound">es</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_def space_eq independent_sets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob <span class="var">?L</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">vs</span> <span class="main">∈</span> <span class="var">?k_sets</span><span class="main">.</span> prob <span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space P<span class="main">.</span> <span class="bound">vs</span> <span class="main">∈</span> independent_sets <span class="main">(</span>edge_ugraph <span class="bound">es</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_measure_subadditive_finite <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> space_eq sets_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prob_k_indep S_verts_def n_subsets<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_α_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Almost never many independent edges:›</span></span>
<span class="keyword1" id="Girth_Chromatic-almost_never_le_α"><span class="command">lemma</span></span> almost_never_le_α<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_prob<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> N_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">6</span> <span class="main">*</span> <span class="free">k</span> <span class="main">*</span> ln <span class="bound">n</span><span class="main">)</span><span class="main">/</span><span class="bound">n</span> <span class="main">≤</span> <span class="free">p</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> probGn <span class="free">p</span> <span class="bound">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">es</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">/</span><span class="free">k</span> <span class="main">≤</span> α <span class="main">(</span>edge_space.edge_ugraph <span class="bound">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?prob_fun</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?prob_fun_raw</span> <span class="free">n</span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"probGn <span class="free">p</span> <span class="free">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">es</span><span class="main">.</span> nat<span class="main">(</span>ceiling <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">/</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> α <span class="main">(</span>edge_space.edge_ugraph <span class="free">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">/</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> nat<span class="main">(</span>ceiling <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> r_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span> <span class="bound">n</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> r_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> nr_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="var">?nr</span> <span class="bound">n</span> <span class="main">∧</span> <span class="var">?nr</span> <span class="bound">n</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_sequentiallyI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral"><span class="numeral">4</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def nat_ceiling_le_eq le_natceiling_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> nr_bounds p_prob <span class="keyword1"><span class="command">have</span></span> ev_prob_fun_raw_le<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> probGn <span class="free">p</span> <span class="bound">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">es</span><span class="main">.</span> <span class="var">?nr</span> <span class="bound">n</span><span class="main">≤</span> α <span class="main">(</span>edge_space.edge_ugraph <span class="bound">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span>
      <span class="main">≤</span> <span class="main">(</span><span class="bound">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">p</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span><span class="var">?nr</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="var">?nr</span> <span class="bound">n</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="var">?prob_fun_raw_le</span> <span class="bound">n</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_elim2<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="var">?nr</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="var">?nr</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="skolem">n</span> <span class="main">∧</span><span class="free">p</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> pG<span class="main">:</span> edge_space <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"probGn <span class="free">p</span> <span class="skolem">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">es</span><span class="main">.</span> <span class="var">?nr</span> <span class="skolem">n</span> <span class="main">≤</span> α <span class="main">(</span>edge_space.edge_ugraph <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span>
        <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="var">?nr</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pG.random_prob_independent<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="var">?nr</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="keyword1">choose</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_realpow of_nat_power <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> binomial_le_pow  <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_power<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="var">?nr</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_choose_2_nat real_of_nat_div<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="var">?nr</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="var">?nr</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr r <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="var">?nr</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_mono2 diff_conv_add_uminus <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_uminus_conv_diff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_mono2 powr_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"probGn <span class="free">p</span> <span class="skolem">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">es</span><span class="main">.</span> <span class="var">?nr</span> <span class="skolem">n</span> <span class="main">≤</span> α <span class="main">(</span>edge_space.edge_ugraph <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span>
      <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="var">?nr</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A r <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> p_prob N_prop
  <span class="keyword1"><span class="command">have</span></span> ev_expr_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span><span class="var">?nr</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_rev_mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> eventually_sequentiallyI conjI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> n_bound<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="free">p</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">6</span> <span class="main">*</span> <span class="free">k</span> <span class="main">*</span> ln <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="free">p</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="var">?nr</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_nat_ceiling_ge<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span><span class="main">)</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">+</span> <span class="free">p</span> <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> ln <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"n_bound"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="numeral">6</span> <span class="main">*</span> <span class="free">k</span> <span class="main">*</span> ln <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r_bound le_of_int_ceiling<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> le_of_int_ceiling<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">p</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n_bound p_bound r_bound r_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> r_bound <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">1</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p_bound <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def exp_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">1</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_mult_base<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_divide powr_minus_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> ceil_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">G</span> <span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">/</span><span class="free">k</span> <span class="main">≤</span> α <span class="bound">G</span> <span class="main">⟷</span> nat<span class="main">(</span>ceiling <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">/</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> α <span class="bound">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"α <span class="improper">G</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_ceiling_le_eq<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> ceil_bound<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> real_tendsto_sandwich<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="var">?prob_fun_raw</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p_prob <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> measure_nonneg LIMSEQ_inv_powr <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> nr_bounds ev_expr_bound ev_prob_fun_raw_le
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="var">?prob_fun_raw</span> <span class="bound">n</span> <span class="main">≤</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_rev_mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> eventually_sequentiallyI impI conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> nr_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="var">?nr</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="var">?nr</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> prob_fun_raw_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?prob_fun_raw_le</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> expr_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>nat<span class="main">(</span>ceiling <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">1</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">approximation</span> 6<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mono2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ep_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?prob_fun_raw</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">-</span> <span class="free">p</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="var">?nr</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prob_fun_raw_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="var">?nr</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> expr_bound A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nr_bounds ep_bound A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_le_one_le<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?prob_fun_raw</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="main">(</span>exp <span class="main">1</span> <span class="main">/</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Mean number of k-cycles in a graph. (Or rather of paths describing a circle of length <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>):›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> edge_space<span class="main">)</span> mean_k_cycles<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">es</span><span class="main">.</span> card <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> ucycles <span class="main">(</span>edge_ugraph <span class="bound">es</span><span class="main">)</span><span class="main">.</span> uwalk_length <span class="bound">c</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">∂</span> P<span class="main">)</span>
    <span class="main">=</span> of_nat <span class="main">(</span>fact <span class="free">n</span> <span class="keyword1">div</span> fact <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">^</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k_cycle</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">es</span> <span class="bound">c</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> ucycles <span class="main">(</span>edge_ugraph <span class="bound">es</span><span class="main">)</span> <span class="main">∧</span> uwalk_length <span class="bound">c</span> <span class="main">=</span> <span class="bound">k</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">{</span><span class="bound">c</span><span class="main">.</span> <span class="var">?k_cycle</span> S_edges <span class="bound">c</span> <span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">C</span> <span class="free">k</span>"</span><span class="antiquote">}</span></span> is the set of all possible cycles of size <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">k</span></span><span class="antiquote">}</span></span> in <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edge_ugraph S_edges"</span><span class="antiquote">}</span></span>›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">XG</span></span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">XG</span> <span class="skolem">es</span> <span class="main">=</span> <span class="main">{</span><span class="bound">c</span><span class="main">.</span> <span class="var">?k_cycle</span> <span class="skolem">es</span> <span class="bound">c</span> <span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">es</span>
    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">XG</span> <span class="free">es</span>"</span><span class="antiquote">}</span></span> is the set of cycles contained in a <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edge_ugraph <span class="free">es</span>"</span><span class="antiquote">}</span></span>›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">XC</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">XC</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space P<span class="main">.</span> <span class="var">?k_cycle</span> <span class="bound">es</span> <span class="skolem">c</span> <span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span>
    <span class="comment1">― ‹"<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">XC</span> <span class="free">c</span>"</span><span class="antiquote">}</span></span> is the set of graphs (edge sets) containing a cycle c"›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> XC_in_sets<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">XC</span> <span class="bound">c</span> <span class="main">∈</span> sets P"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> XC_cyl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="free">k</span> <span class="main">⟹</span> <span class="skolem">XC</span> <span class="bound">c</span> <span class="main">=</span> cylinder S_edges <span class="main">(</span>set <span class="main">(</span>uwalk_edges <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ucycles_def space_eq uwalks_def C_def cylinder_def sets_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">es</span><span class="main">.</span> card <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> ucycles <span class="main">(</span>edge_ugraph <span class="bound">es</span><span class="main">)</span><span class="main">.</span> uwalk_length <span class="bound">c</span> <span class="main">=</span> <span class="free">k</span><span class="main">}</span> <span class="main">∂</span> P<span class="main">)</span>
      <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>space P<span class="main">.</span> card <span class="main">(</span><span class="skolem">XG</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> prob <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> XG_def integral_finite_singleton space_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">c</span><span class="main">∈</span><span class="skolem">C</span> <span class="free">k</span><span class="main">.</span> prob <span class="main">(</span>cylinder S_edges <span class="main">(</span>set <span class="main">(</span>uwalk_edges <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> XG_Int_C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> space P <span class="main">⟹</span> <span class="skolem">C</span> <span class="free">k</span> <span class="main">∩</span> <span class="skolem">XG</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">XG</span> <span class="bound">s</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> XG_def C_def ucycles_def uwalks_def edge_ugraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fin_XC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> finite <span class="main">(</span><span class="skolem">XC</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin_C<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">C</span> <span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> C_def XC_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_edges space_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_ucycles<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>space P<span class="main">.</span> card <span class="main">(</span><span class="skolem">XG</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> prob <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>space P<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">c</span> <span class="main">∈</span> <span class="skolem">XG</span> <span class="bound">x</span><span class="main">.</span> prob <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>space P<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">c</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="free">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">XG</span> <span class="bound">x</span> <span class="keyword1">then</span> prob <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fin_C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.If_cases<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> XG_Int_C<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">c</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">x</span> <span class="main">∈</span> space P <span class="main">∩</span> <span class="skolem">XC</span> <span class="bound">c</span><span class="main">.</span> prob <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_edges <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.swap<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.inter_restrict XG_def XC_def space_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">c</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="free">k</span><span class="main">.</span> prob <span class="main">(</span><span class="skolem">XC</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fin_XC XC_in_sets
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prob_eq sets_eq space_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> XC_cyl<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">c</span><span class="main">∈</span><span class="skolem">C</span> <span class="free">k</span><span class="main">.</span> <span class="free">p</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="free">k</span> <span class="main">⟹</span> card <span class="main">(</span>set <span class="main">(</span>uwalk_edges <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> uwalk_length <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uwalk_length_def C_def ucycles_distinct_edges <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> distinct_card<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def ucycles_def uwalks_def cylinder_prob<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_nat <span class="main">(</span>fact <span class="free">n</span> <span class="keyword1">div</span> fact <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">^</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> inj_last_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">es</span><span class="main">.</span> last <span class="bound">es</span> <span class="main">#</span> <span class="bound">es</span><span class="main">)</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">A</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> length <span class="skolem">xs</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">xs</span> <span class="main">=</span> last <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> last <span class="bound">xs</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">A</span> <span class="main">⟷</span> tl <span class="skolem">xs</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_image_mem_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_last_Cons<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> image_mem_iff_inst <span class="main">=</span> this

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> uwalks <span class="main">(</span>edge_ugraph S_edges<span class="main">)</span> <span class="main">⟹</span> set <span class="main">(</span>tl <span class="skolem">xs</span><span class="main">)</span> <span class="main">⊆</span> S_verts"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uwalks_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> S_verts"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> length <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>last <span class="skolem">xs</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">∈</span> uwalks <span class="main">(</span>edge_ugraph S_edges<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> uwalk_edges.induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> S_edges_memI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> S_verts <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> S_verts <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∈</span> S_edges"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> S_edges_def all_edges_def image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> set <span class="skolem">ys</span> <span class="main">⊆</span> S_verts <span class="main">⟹</span> last <span class="skolem">ys</span> <span class="main">∈</span> S_verts"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uwalks_def Suc_le_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> S_edges_memI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span><span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≤</span> <span class="free">k</span>›</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> last <span class="bound">xs</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> distinct <span class="bound">xs</span> <span class="main">∧</span> set <span class="bound">xs</span> <span class="main">⊆</span> S_verts<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def ucycles_def uwalk_length_conv image_mem_iff_inst<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card S_verts <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_verts_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> fact <span class="free">n</span> <span class="keyword1">div</span> fact <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_last_Cons<span class="main"><span class="main">]</span></span> card_lists_distinct_length_eq' fact_div_fact<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Girth-Chromatic number theorem:›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> girth_chromatic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">G</span><span class="main">.</span> uwellformed <span class="bound">G</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">&lt;</span> girth <span class="bound">G</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">&lt;</span> chromatic_number <span class="bound">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> max <span class="numeral">3</span> <span class="free">l</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ε</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">n</span> <span class="main">=</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ug</span></span></span> <span class="main">=</span> <span class="quoted">edge_space.edge_ugraph</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">short_count</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">short_count</span> <span class="skolem">g</span> <span class="main">=</span> card <span class="main">(</span>short_cycles <span class="skolem">g</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
    <span class="comment1">― ‹This random variable differs from the one used in the proof of theorem 11.2.2,
          as we count the number of paths describing a circle, not the circles themselves›</span>

  <span class="keyword1"><span class="command">from</span></span> k_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> ε_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ε_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> ev_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_sequentiallyI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> powr_less_one<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> prob_short_count_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> probGn <span class="skolem">p</span> <span class="bound">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">es</span><span class="main">.</span> <span class="main">(</span>real <span class="bound">n</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">short_count</span> <span class="main">(</span><span class="var">?ug</span> <span class="bound">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span>
      <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_rev_mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> eventually_sequentiallyI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> pG<span class="main">:</span> edge_space <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mean_short_count</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mean_short_count</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">es</span><span class="main">.</span> <span class="skolem">short_count</span> <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span> <span class="main">∂</span> pG.P<span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> mean_short_count_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mean_short_count</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> small_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">es</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">⟹</span> short_cycles <span class="main">(</span>edge_space.edge_ugraph <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> short_cycles_def ucycles_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> short_count_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">es</span><span class="main">.</span> <span class="skolem">short_count</span> <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="numeral">3</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> real <span class="main">(</span>card <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> ucycles <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">.</span> uwalk_length <span class="bound">c</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> short_count_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">with</span></span> small_empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> small_empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> ucycles <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="skolem">es</span><span class="main">)</span><span class="main">.</span> uwalk_length <span class="bound">c</span> <span class="main">≤</span> Suc <span class="skolem">k</span><span class="main">}</span>
              <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> ucycles <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="skolem">es</span><span class="main">)</span><span class="main">.</span> uwalk_length <span class="bound">c</span> <span class="main">≤</span> <span class="skolem">k</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> ucycles <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="skolem">es</span><span class="main">)</span><span class="main">.</span> uwalk_length <span class="bound">c</span> <span class="main">=</span> Suc <span class="skolem">k</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="main">(</span>edge_space.edge_ugraph <span class="skolem">n</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> ucycles <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="skolem">es</span><span class="main">)</span><span class="main">.</span> uwalk_length <span class="bound">c</span> <span class="main">≤</span> Suc <span class="skolem">k</span><span class="main">}</span>
            <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> ucycles <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="skolem">es</span><span class="main">)</span><span class="main">.</span> uwalk_length <span class="bound">c</span> <span class="main">≤</span> <span class="skolem">k</span><span class="main">}</span> <span class="main">+</span> card <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> ucycles <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="skolem">es</span><span class="main">)</span><span class="main">.</span> uwalk_length <span class="bound">c</span> <span class="main">=</span> Suc <span class="skolem">k</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> finite_ucycles <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Un_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> Suc False <span class="keyword1"><span class="command">unfolding</span></span> short_cycles_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_le<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mean_short_count</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="numeral">3</span><span class="main">..</span><span class="skolem">k</span><span class="main">.</span> <span class="main">∫</span><span class="bound">es</span><span class="main">.</span> card <span class="main">{</span><span class="bound"><span class="bound">c</span></span> <span class="main">∈</span> ucycles <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">.</span> uwalk_length <span class="bound">c</span> <span class="main">=</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∂</span> pG.P<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mean_short_count_def short_count_conv
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Bochner_Integration.integral_sum<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pG.integral_finite_singleton<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="numeral">3</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> of_nat <span class="main">(</span>fact <span class="skolem">n</span> <span class="keyword1">div</span> fact <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pG.mean_k_cycles<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="numeral">3</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> A fact_div_fact_le_pow  Suc_leD atLeastAtMost_iff of_nat_le_iff order_trans mult_le_cancel_iff1 zero_less_power<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="numeral">3</span><span class="main">..</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ε</span>›</span></span> A
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_def <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_mult_base powr_powr
          powr_realpow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> powr_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> powr_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pG.prob <span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space pG.P<span class="main">.</span> <span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">short_count</span> <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">}</span> <span class="main">≤</span> <span class="skolem">mean_short_count</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mean_short_count_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pG.Markov_inequality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> short_count_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mean_short_count</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mean_short_count_le <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pf_short_count</span></span> <span class="skolem"><span class="skolem">pf_α</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pf_short_count</span> <span class="skolem">n</span> <span class="main">=</span> probGn <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">es</span><span class="main">.</span> <span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">short_count</span> <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pf_α</span> <span class="skolem">n</span> <span class="main">=</span> probGn <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">es</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">/</span><span class="skolem">k</span> <span class="main">≤</span> α <span class="main">(</span>edge_space.edge_ugraph <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>

  <span class="keyword1"><span class="command">have</span></span> ev_short_count_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">pf_short_count</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ε_props <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bound</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_right_zero LIMSEQ_neg_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> dist <span class="main">(</span><span class="var">?bound</span> <span class="bound">n</span><span class="main">)</span> <span class="main">0</span>  <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendstoD<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> prob_short_count_le <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_elim2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_real_def pf_short_count_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> lim_α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pf_α</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="bound">n</span> <span class="main">⟷</span> <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">ε</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_sequentiallyI<span class="main">)</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">6</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">/</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">⟷</span> <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">subst</span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse p_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">ε</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">/</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">⟷</span> <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">ε</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">6</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="bound">n</span><span class="main">)</span>
        <span class="main">⟷</span> <span class="main">(</span><span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">ε</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_subst<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">ε</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ε</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ln_powr_bound<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">/</span><span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">)</span>  <span class="main">≤</span> <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">12</span><span class="main">*</span><span class="skolem">k</span><span class="main">/</span><span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> divide_inverse
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_minus<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> powr_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">12</span><span class="main">*</span><span class="skolem">k</span><span class="main">/</span><span class="skolem">ε</span> <span class="main">*</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="skolem">ε</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">12</span><span class="main">*</span><span class="skolem">k</span><span class="main">/</span><span class="skolem">ε</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_sequentiallyI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="numeral">12</span><span class="main">*</span><span class="skolem">k</span><span class="main">/</span><span class="skolem">ε</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">12</span><span class="main">*</span><span class="skolem">k</span><span class="main">/</span><span class="skolem">ε</span> <span class="main">*</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="skolem">ε</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ε</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_right_zero LIMSEQ_neg_powr<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ε</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> tendstoD<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="main">(</span>eventually_le_le<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> real <span class="main">(</span><span class="numeral">6</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> ev_p <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pf_α_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> almost_never_le_α<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> ev_short_count_le lim_α<span class="main">[</span><span class="operator">THEN</span> tendstoD<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> ev_p
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇧</span><sup>∞</sup></span> <span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">pf_short_count</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">pf_α</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">elim</span> eventually_rev_mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_sequentially dist_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> probs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pf_short_count</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pf_α</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_sequentially<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ES<span class="main">:</span> edge_space <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> rest_compl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">A</span> <span class="main">-</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="main">¬</span><span class="bound">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> probs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ES.prob <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space ES.P<span class="main">.</span> <span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">short_count</span> <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">}</span>
      <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space ES.P<span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">/</span><span class="skolem">k</span> <span class="main">≤</span> α <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">pf_short_count</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">pf_α</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pf_short_count_def pf_α_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ES.finite_measure_subadditive<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> probs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> ES.prob <span class="main">(</span>space ES.P <span class="main">-</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space ES.P<span class="main">.</span> <span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">short_count</span> <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">}</span>
      <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space ES.P<span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">/</span><span class="skolem">k</span> <span class="main">≤</span> α <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> ES.prob <span class="var">?S</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ES.prob_compl<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">es</span></span> <span class="main">∈</span> space ES.P<span class="main">.</span> <span class="skolem">short_count</span> <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> α <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="bound">es</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">*</span> <span class="skolem">n</span><span class="main">/</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less rest_compl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">es</span></span> <span class="keyword2"><span class="keyword">where</span></span> es_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">es</span> <span class="main">∈</span> space ES.P"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">short_count</span> <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"α <span class="main">(</span><span class="var">?ug</span> <span class="skolem">n</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">/</span><span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="comment1">― ‹now we obtained a high colored graph (few independent nodes) with almost no short cycles›</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="var">?ug</span> <span class="skolem">n</span> <span class="skolem">es</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> kill_short <span class="skolem">G</span> <span class="skolem">k</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> G_props<span class="main">:</span> <span class="quoted"><span class="quoted">"uverts <span class="skolem">G</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>uverts <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">short_count</span> <span class="skolem">G</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"α <span class="skolem">G</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">/</span><span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> G_def <span class="keyword1"><span class="command">using</span></span> es_props <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ES.S_verts_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uwellformed <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G_def uwellformed_def all_edges_def ES.S_edges_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> G_props <span class="keyword1"><span class="command">have</span></span> T1<span class="main">:</span> <span class="quoted"><span class="quoted">"uwellformed <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> kill_short_uwellformed<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">l</span> <span class="main">≤</span> enat <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> girth <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G_props <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> kill_short_large_girth H_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> T2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> girth <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> card_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span> <span class="main">≤</span> card <span class="main">(</span>uverts <span class="skolem">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> G_props es_props kill_short_order_of_graph<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> short_count_def H_def<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> uverts_H<span class="main">:</span> <span class="quoted"><span class="quoted">"uverts <span class="skolem">H</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="main">(</span>uverts <span class="skolem">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> α <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_less_α uverts_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> α_HG<span class="main">:</span> <span class="quoted"><span class="quoted">"α <span class="skolem">H</span> <span class="main">≤</span> α <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> H_def G_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> kill_short_α<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">l</span> <span class="main">≤</span> ereal <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> α <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G_props <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"α <span class="skolem">G</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">n</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> α <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> α_HG <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> α <span class="skolem">H</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ereal_of_enat_pushout <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ereal_divide_left_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> card <span class="main">(</span>uverts <span class="skolem">H</span><span class="main">)</span> <span class="main">/</span> α <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_H <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> α <span class="skolem">H</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ereal_divide_right_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> chromatic_number <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uverts_H T1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> chromatic_lb<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> T3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> chromatic_number <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ereal_of_enat_simps<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> T1 T2 T3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>