<div id="Semantics">
<div class="head">
<h1>Theory Semantics</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Semantics
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Language›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Variables and Values›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> vname <span class="main">=</span> <span class="quoted">string</span> <span class="comment1">― ‹names for variables›</span>

<span class="keyword1"><span class="command">datatype</span></span> val
  <span class="main">=</span> Bool <span class="quoted">bool</span>      <span class="comment1">― ‹Boolean value›</span>
  <span class="main">|</span> Intg <span class="quoted">int</span>       <span class="comment1">― ‹integer value›</span> 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">true</span> <span class="main">==</span> Bool True"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">false</span> <span class="main">==</span> Bool False"</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Expressions and Commands›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> bop <span class="main">=</span> Eq <span class="main">|</span> And <span class="main">|</span> Less <span class="main">|</span> Add <span class="main">|</span> Sub     <span class="comment1">― ‹names of binary operations›</span>

<span class="keyword1"><span class="command">datatype</span></span> expr
  <span class="main">=</span> Val <span class="quoted">val</span>                                          <span class="comment1">― ‹value›</span>
  <span class="main">|</span> Var <span class="quoted">vname</span>                                        <span class="comment1">― ‹local variable›</span>
  <span class="main">|</span> BinOp <span class="quoted">expr</span> <span class="quoted">bop</span> <span class="quoted">expr</span>    <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">«</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">»</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>80<span class="main">,</span>0<span class="main">,</span>81<span class="main">]</span> 80<span class="main">)</span>  <span class="comment1">― ‹binary operation›</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note: we assume that only type correct expressions are regarded
  as later proofs fail if expressions evaluate to None due to type errors.
  However there is [yet] no typing system›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">binop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bop <span class="main">⇒</span> val <span class="main">⇒</span> val <span class="main">⇒</span> val option"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">binop</span> Eq <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>2</sub></span></span></span>               <span class="main">=</span> Some<span class="main">(</span>Bool<span class="main">(</span><span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">binop</span> And <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>  <span class="main">=</span> Some<span class="main">(</span>Bool<span class="main">(</span><span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">binop</span> Less <span class="main">(</span>Intg <span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span>Intg <span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> Some<span class="main">(</span>Bool<span class="main">(</span><span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">binop</span> Add <span class="main">(</span>Intg <span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span>Intg <span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>  <span class="main">=</span> Some<span class="main">(</span>Intg<span class="main">(</span><span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">binop</span> Sub <span class="main">(</span>Intg <span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span>Intg <span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>  <span class="main">=</span> Some<span class="main">(</span>Intg<span class="main">(</span><span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">i<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">binop</span> <span class="free"><span class="bound"><span class="entity">bop</span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>2</sub></span></span></span>                <span class="main">=</span> Some<span class="main">(</span>Intg<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">datatype</span></span> com
  <span class="main">=</span> Skip
  <span class="main">|</span> LAss <span class="quoted">vname</span> <span class="quoted">expr</span>        <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">:=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span> <span class="main">[</span>70<span class="main">,</span>70<span class="main">]</span> 70<span class="main">)</span>  <span class="comment1">― ‹local assignment›</span>
  <span class="main">|</span> Seq <span class="quoted">com</span> <span class="quoted">com</span>            <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span> <span class="main">[</span>61<span class="main">,</span>60<span class="main">]</span> 60<span class="main">)</span>
  <span class="main">|</span> Cond <span class="quoted">expr</span> <span class="quoted">com</span> <span class="quoted">com</span>      <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">if</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">else</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>80<span class="main">,</span>79<span class="main">,</span>79<span class="main">]</span> 70<span class="main">)</span>
  <span class="main">|</span> While <span class="quoted">expr</span> <span class="quoted">com</span>         <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">while</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>80<span class="main">,</span>79<span class="main">]</span> 70<span class="main">)</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"expr <span class="main">⇒</span> vname set"</span></span> <span class="comment1">― ‹free variables in an expression›</span>
<span class="keyword2"><span class="keyword">where</span></span>
  FVc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fv</span> <span class="main">(</span>Val <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="main">|</span> FVv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fv</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">}</span>"</span></span>
  <span class="main">|</span> FVe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fv</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">«</span><span class="free"><span class="bound"><span class="entity">bop</span></span></span><span class="main">»</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">∪</span> <span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹State›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> state <span class="main">=</span> <span class="quoted"><span class="quoted">"vname <span class="main">⇀</span> val"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>interpret›</span></span></span></span> silently assumes type correct expressions, 
  i.e. no expression evaluates to None›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="quoted">"<span class="entity">interpret</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"expr <span class="main">⇒</span> state <span class="main">⇒</span> val option"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟦</span>_<span class="keyword1">⟧</span>_"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> Val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟦</span></span>Val <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main"><span class="free">⟧</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
  <span class="main">|</span> Var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟦</span></span>Var <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main"><span class="free">⟧</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span>
  <span class="main">|</span> BinOp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟦</span></span><span class="free"><span class="bound"><span class="entity">e<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">«</span><span class="free"><span class="bound"><span class="entity">bop</span></span></span><span class="main">»</span><span class="free"><span class="bound"><span class="entity">e<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">⟧</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main"><span class="free">⟦</span></span><span class="free"><span class="bound"><span class="entity">e<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">⟧</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None
    <span class="main">|</span> Some <span class="bound">v<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main"><span class="free">⟦</span></span><span class="free"><span class="bound"><span class="entity">e<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">⟧</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None
                           <span class="main">|</span> Some <span class="bound">v<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇒</span> binop <span class="free"><span class="bound"><span class="entity">bop</span></span></span> <span class="bound">v<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">v<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Small Step Semantics›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">red</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">*</span> state <span class="main">⇒</span> com <span class="main">*</span> state <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity"><span class="free">red'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> state <span class="main">⇒</span> com <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>
   <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span> <span class="keyword1">→</span><span class="keyword3">/ </span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 81<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">==</span> <span class="free">red</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  RedLAss<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span>Skip<span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">:=</span><span class="main">(</span><span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">⟧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⟩</span></span>"</span></span>

  <span class="main">|</span> SeqRed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub>'</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">⟹</span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub>'</span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>

  <span class="main">|</span> RedSeq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span>Skip<span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>

  <span class="main">|</span> RedCondTrue<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⟧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> Some true <span class="main">⟹</span> <span class="main"><span class="free">⟨</span></span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>

  <span class="main">|</span> RedCondFalse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⟧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> Some false <span class="main">⟹</span> <span class="main"><span class="free">⟨</span></span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>

  <span class="main">|</span> RedWhileTrue<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⟧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> Some true <span class="main">⟹</span> <span class="main"><span class="free">⟨</span></span><span class="keyword1">while</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;;</span><span class="keyword1">while</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>

  <span class="main">|</span> RedWhileFalse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⟧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> Some false <span class="main">⟹</span> <span class="main"><span class="free">⟨</span></span><span class="keyword1">while</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span>Skip<span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> red_induct <span class="main">=</span> red.induct<span class="main">[</span><span class="operator">split_format</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">complete</span><span class="main"><span class="main">)</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">reds</span> <span class="main">::</span><span class="quoted"><span class="quoted">"com <span class="main">⇒</span> state <span class="main">⇒</span> com <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> 
   <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span> <span class="keyword1">→*</span><span class="keyword3">/ </span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 81<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→*</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">==</span>  red<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Semantics-Skip_reds"><span class="command">lemma</span></span> Skip_reds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">∧</span> <span class="free">c'</span> <span class="main">=</span> Skip"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>converse_rtranclpE red.cases<span class="main">)</span>

<span class="keyword1" id="Semantics-LAss_reds"><span class="command">lemma</span></span> LAss_reds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">V</span><span class="main">:=</span><span class="free">e</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟹</span> <span class="free">s'</span> <span class="main">=</span> <span class="free">s</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span><span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">:=</span><span class="free">e</span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>converse_rtranclp_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">s</span> <span class="skolem">c''</span> <span class="skolem">s''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="main">=</span> Skip"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">s</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span><span class="main">(</span><span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Skip_reds<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semantics-Seq2_reds"><span class="command">lemma</span></span> Seq2_reds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span>Skip<span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="skolem">c</span><span class="main"><span class="main">==</span></span><span class="quoted"><span class="quoted">"Skip<span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>converse_rtranclp_induct2<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>

<span class="keyword1" id="Semantics-Seq_reds"><span class="command">lemma</span></span> Seq_reds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s''</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s''</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s''</span><span class="main">.</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">c'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span><span class="skolem">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Skip"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s''</span><span class="main">.</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>converse_rtranclp_induct2<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> refl <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c''</span> <span class="skolem">s''</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">⟦</span><span class="skolem">c''</span> <span class="main">=</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">;</span> <span class="skolem">c'</span> <span class="main">=</span> Skip<span class="main">⟧</span> 
          <span class="main">⟹</span> <span class="main">∃</span><span class="bound">sx</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">sx</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="bound">sx</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>›</span></span>
        <span class="keyword1"><span class="command">from</span></span> step
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Skip <span class="main">∧</span> <span class="skolem">c''</span> <span class="main">=</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s''</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">c''</span> <span class="main">=</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Skip <span class="main">∧</span> <span class="skolem">c''</span> <span class="main">=</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s''</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span><span class="skolem">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span> <span class="main">=</span> Skip›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">c''</span> <span class="main">=</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> IH<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c''</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span> <span class="main">=</span> Skip›</span></span><span class="main">]</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>converse_rtranclp_into_rtranclp<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Semantics-Cond_True_or_False"><span class="command">lemma</span></span> Cond_True_or_False<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟹</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="free">s</span> <span class="main">=</span> Some true <span class="main">∨</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="free">s</span> <span class="main">=</span> Some false"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="skolem">c</span><span class="main"><span class="main">==</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>converse_rtranclp_induct2<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>

<span class="keyword1" id="Semantics-CondTrue_reds"><span class="command">lemma</span></span> CondTrue_reds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟹</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="free">s</span> <span class="main">=</span> Some true <span class="main">⟹</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="skolem">c</span><span class="main"><span class="main">==</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>converse_rtranclp_induct2<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>

<span class="keyword1" id="Semantics-CondFalse_reds"><span class="command">lemma</span></span> CondFalse_reds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟹</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="free">s</span> <span class="main">=</span> Some false <span class="main">⟹</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="skolem">c</span><span class="main"><span class="main">==</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>converse_rtranclp_induct2<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>

<span class="keyword1" id="Semantics-WhileFalse_reds"><span class="command">lemma</span></span> WhileFalse_reds<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟹</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="free">s</span> <span class="main">=</span> Some false <span class="main">⟹</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>converse_rtranclp_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> step <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Skip_reds<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semantics-WhileTrue_reds"><span class="command">lemma</span></span> WhileTrue_reds<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟹</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="free">s</span> <span class="main">=</span> Some true
  <span class="main">⟹</span> <span class="main">∃</span><span class="bound">sx</span><span class="main">.</span> <span class="main">⟨</span><span class="free">cx</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">sx</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="bound">sx</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>converse_rtranclp_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">s</span> <span class="skolem">c''</span> <span class="skolem">s''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="main">=</span> <span class="free">cx</span><span class="main">;;</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span> <span class="main">∧</span> <span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Seq_reds<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semantics-While_True_or_False"><span class="command">lemma</span></span> While_True_or_False<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">com</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟹</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="free">s</span> <span class="main">=</span> Some true <span class="main">∨</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="free">s</span> <span class="main">=</span> Some false"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="skolem">c</span><span class="main"><span class="main">==</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">com</span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>converse_rtranclp_induct2<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>


<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">red_n</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> state <span class="main">⇒</span> nat <span class="main">⇒</span> com <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>
   <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span> <span class="keyword1">→⇗</span>_<span class="keyword1">⇖</span> <span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 81<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> red_n_Base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span> →<span class="hidden">⇗</span><sup><span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>
     <span class="main">|</span> red_n_Rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c''</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s''</span></span></span><span class="main">⟩</span><span class="main">;</span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c''</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s''</span></span></span><span class="main"><span class="free">⟩</span></span> →<span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">n</span></span></span></sup><span class="hidden">⇖</span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main"><span class="free">⟩</span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⟩</span></span> →<span class="hidden">⇗</span><sup>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span></sup><span class="hidden">⇖</span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>


<span class="keyword1" id="Semantics-Seq_red_nE"><span class="command">lemma</span></span> Seq_red_nE<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i</span> <span class="free">j</span> <span class="free">s''</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="free">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s''</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="free">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">i</span> <span class="main">+</span> <span class="free">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>›</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">s''</span><span class="main">.</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"Skip"</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>red_n.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>red_n_Rec <span class="skolem">s</span> <span class="skolem">c''</span> <span class="skolem">s''</span> <span class="skolem">n</span> <span class="skolem">s'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="skolem">c''</span> <span class="main">=</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>
      <span class="main">⟹</span> <span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">sx</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">sx</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="bound">sx</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Skip <span class="main">∧</span> <span class="skolem">c''</span> <span class="main">=</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s''</span><span class="main">)</span> <span class="main">∨</span> 
      <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">.</span> <span class="skolem">c''</span> <span class="main">=</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>red_induct<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Skip <span class="main">∧</span> <span class="skolem">c''</span> <span class="main">=</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s''</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Skip"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="main">=</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Skip›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>red_n_Base<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s'</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c''</span> <span class="main">=</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s''</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">.</span> <span class="skolem">c''</span> <span class="main">=</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> IH<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c''</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">sx</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s'</span><span class="main">⟩</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup>Suc <span class="skolem">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> red_n.red_n_Rec<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s'</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Semantics-while_red_nE"><span class="command">lemma</span></span> while_red_nE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> 
  <span class="main">⟹</span> <span class="main">(</span><span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="free">s</span> <span class="main">=</span> Some false <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">s''</span><span class="main">.</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="free">s</span> <span class="main">=</span> Some true <span class="main">∧</span> <span class="main">⟨</span><span class="free">cx</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> <span class="main">∧</span> 
                <span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"Skip"</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>red_n.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>red_n_Rec <span class="skolem">s</span> <span class="skolem">c''</span> <span class="skolem">s''</span> <span class="skolem">n</span> <span class="skolem">s'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some false <span class="main">∧</span> <span class="skolem">c''</span> <span class="main">=</span> Skip <span class="main">∧</span> <span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some true <span class="main">∧</span> <span class="skolem">c''</span> <span class="main">=</span> <span class="free">cx</span><span class="main">;;</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span> <span class="main">∧</span> <span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span>"</span></span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>red_induct<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some false <span class="main">∧</span> <span class="skolem">c''</span> <span class="main">=</span> Skip <span class="main">∧</span> <span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some false"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="main">=</span> Skip"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s'</span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted">Skip</span> <span class="main">_</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>red_n.induct<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some false›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some true <span class="main">∧</span> <span class="skolem">c''</span> <span class="main">=</span> <span class="free">cx</span><span class="main">;;</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span> <span class="main">∧</span> <span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some true"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="main">=</span> <span class="free">cx</span><span class="main">;;</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s'</span><span class="main">⟩</span>›</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">sx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">cx</span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="skolem">sx</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s'</span><span class="main">⟩</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>Seq_red_nE<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some true›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Semantics-while_red_n_induct"><span class="command">lemma</span></span> while_red_n_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> false true<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> major<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> IHfalse<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span>  <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="bound">s</span> <span class="main">=</span> Some false <span class="main">⟹</span> <span class="free">P</span> <span class="bound">s</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> IHtrue<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">s''</span><span class="main">.</span> <span class="main">⟦</span>  <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="bound">s</span> <span class="main">=</span> Some true<span class="main">;</span> <span class="main">⟨</span><span class="free">cx</span><span class="main">,</span><span class="bound">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span><span class="main">;</span> 
                            <span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span><span class="main">;</span> <span class="free">P</span> <span class="bound">s''</span> <span class="free">s'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">s</span> <span class="free">s'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">s</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> major
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> IHall<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="bound">x</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">m</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">s'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some false <span class="main">∧</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">s''</span><span class="main">.</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some true <span class="main">∧</span> <span class="main">⟨</span><span class="free">cx</span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> <span class="main">∧</span> 
                <span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> while_red_nE<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some false <span class="main">∧</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">s'</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some false"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> IHfalse<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some false›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="free">s'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">s''</span><span class="main">.</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some true <span class="main">∧</span> <span class="main">⟨</span><span class="free">cx</span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> <span class="main">∧</span> 
                      <span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some true"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">cx</span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> IHall <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s''</span> <span class="free">s'</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> IHtrue<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> Some true›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">cx</span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">i</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="skolem">j</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>›</span></span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Semantics-reds_to_red_n"><span class="command">lemma</span></span> reds_to_red_n<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="bound">n</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>converse_rtranclp_induct2<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>red_n.intros<span class="main">)</span>


<span class="keyword1" id="Semantics-red_n_to_reds"><span class="command">lemma</span></span> red_n_to_reds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> →<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">⟩</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>red_n.induct<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>converse_rtranclp_into_rtranclp<span class="main">)</span>


<span class="keyword1" id="Semantics-while_reds_induct"><span class="command">lemma</span></span> while_reds_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> false true<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="bound">s</span> <span class="main">=</span> Some false <span class="main">⟹</span> <span class="free">P</span> <span class="bound">s</span> <span class="bound">s</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">s</span> <span class="bound">s''</span><span class="main">.</span> <span class="main">⟦</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="bound">s</span> <span class="main">=</span> Some true<span class="main">;</span> <span class="main">⟨</span><span class="free">cx</span><span class="main">,</span><span class="bound">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span><span class="main">;</span> 
             <span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">cx</span><span class="main">,</span><span class="bound">s''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s'</span><span class="main">⟩</span><span class="main">;</span> <span class="free">P</span> <span class="bound">s''</span> <span class="free">s'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">s</span> <span class="free">s'</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">P</span> <span class="free">s</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> reds_to_red_n<span class="main"><span class="keyword3">,</span></span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> while_red_n_induct<span class="main"><span class="keyword3">,</span></span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>red_n_to_reds<span class="main">)</span>


<span class="keyword1" id="Semantics-red_det"><span class="command">lemma</span></span> red_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span><span class="main">;</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="free">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>red_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SeqRed <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">s</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">s'</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Skip <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cx</span><span class="main">.</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="bound">cx</span><span class="main">;;</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">cx</span><span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Skip"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cx</span><span class="main">.</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="bound">cx</span><span class="main">;;</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">cx</span><span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">cx</span><span class="main">;;</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">cx</span><span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> IH<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">cx</span><span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">cx</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="skolem">cx</span><span class="main">;;</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub>'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">theorem</span></span> reds_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span><span class="main">;</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>converse_rtranclp_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> refl
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">erule</span> converse_rtranclpE<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">c''</span> <span class="skolem">s''</span> <span class="skolem">c'</span> <span class="skolem">s'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span> <span class="main">⟹</span> <span class="free">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword1"><span class="command">from</span></span> step <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span><span class="main">(</span><span class="operator">erule</span> converse_rtranclpE<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>red.cases <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>red_det<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> IH<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="secTypes">
<div class="head">
<h1>Theory secTypes</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> secTypes
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Semantics.html">Semantics</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Security types›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Security definitions›</span></span>


<span class="keyword1"><span class="command">datatype</span></span> secLevel <span class="main">=</span> Low <span class="main">|</span> High

<span class="keyword1"><span class="command">type_synonym</span></span> typeEnv <span class="main">=</span> <span class="quoted"><span class="quoted">"vname <span class="main">⇀</span> secLevel"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">secExprTyping</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"typeEnv <span class="main">⇒</span> expr <span class="main">⇒</span> secLevel <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _ <span class="keyword1">:</span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> typeVal<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Val <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">lev</span></span></span>"</span></span>

  <span class="main">|</span> typeVar<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">Vn</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">lev</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> Var <span class="free"><span class="bound"><span class="entity">Vn</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">lev</span></span></span>"</span></span>

  <span class="main">|</span> typeBinOp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main"><span class="free">:</span></span> Low<span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main"><span class="free">:</span></span> Low<span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">«</span><span class="free"><span class="bound"><span class="entity">bop</span></span></span><span class="main">»</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main"><span class="free">:</span></span> Low"</span></span>

  <span class="main">|</span> typeBinOp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main"><span class="free">:</span></span> High<span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">lev</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">«</span><span class="free"><span class="bound"><span class="entity">bop</span></span></span><span class="main">»</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main"><span class="free">:</span></span> High"</span></span>

  <span class="main">|</span> typeBinOp3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">lev</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main"><span class="free">:</span></span> High<span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">«</span><span class="free"><span class="bound"><span class="entity">bop</span></span></span><span class="main">»</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main"><span class="free">:</span></span> High"</span></span>



<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">secComTyping</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"typeEnv <span class="main">⇒</span> secLevel <span class="main">⇒</span> com <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span>_ <span class="keyword1">⊢</span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> typeSkip<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main"><span class="free">⊢</span></span> Skip"</span></span>

  <span class="main">|</span> typeAssH<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> Some High <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>

  <span class="main">|</span> typeAssL<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">:</span> Low<span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> Some Low<span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span>Low <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>

  <span class="main">|</span> typeSeq<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span>

  <span class="main">|</span> typeWhile<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="keyword1">while</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

  <span class="main">|</span> typeIf<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span>

  <span class="main">|</span> typeConvert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span>High <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span>Low <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas concerning expressions›</span></span>

<span class="keyword1" id="secTypes-exprTypeable"><span class="command">lemma</span></span> exprTypeable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fv <span class="free">e</span> <span class="main">⊆</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">T</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹fv <span class="free">e</span> <span class="main">⊆</span> dom <span class="free">Γ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> <span class="bound">T</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Val <span class="skolem">V</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Val <span class="skolem">V</span> <span class="main">:</span> Low"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> typeVal<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">∈</span> fv <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹fv <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span> <span class="main">⊆</span> dom <span class="free">Γ</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">∈</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> Var <span class="skolem">V</span> <span class="main">:</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> typeVar<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BinOp <span class="skolem">e1</span> <span class="skolem">bop</span> <span class="skolem">e2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹fv <span class="skolem">e1</span> <span class="main">⊆</span> dom <span class="free">Γ</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">T</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="bound">T</span>›</span></span>
    <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> <span class="quoted"><span class="quoted">‹fv <span class="skolem">e2</span> <span class="main">⊆</span> dom <span class="free">Γ</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">T</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="bound">T</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹fv <span class="main">(</span><span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">⊆</span> dom <span class="free">Γ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fv <span class="skolem">e1</span> <span class="main">⊆</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fv <span class="skolem">e2</span> <span class="main">⊆</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹fv <span class="skolem">e1</span> <span class="main">⊆</span> dom <span class="free">Γ</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">T1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹fv <span class="skolem">e2</span> <span class="main">⊆</span> dom <span class="free">Γ</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T1</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Low
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T2</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Low
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">T1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T1</span> <span class="main">=</span> Low›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span> <span class="main">:</span> Low"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>typeBinOp1<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> High
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">T1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T1</span> <span class="main">=</span> Low›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span> <span class="main">:</span> High"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>typeBinOp3<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> High
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">T1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T2</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span> <span class="main">:</span> High"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeBinOp2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="secTypes-exprBinopTypeable"><span class="command">lemma</span></span> exprBinopTypeable<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e1</span> <span class="main">«</span><span class="free">bop</span><span class="main">»</span> <span class="free">e2</span> <span class="main">:</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">T1</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e1</span> <span class="main">:</span> <span class="bound">T1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">T2</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e2</span> <span class="main">:</span> <span class="bound">T2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secExprTyping.cases<span class="main">)</span>



<span class="keyword1" id="secTypes-exprTypingHigh"><span class="command">lemma</span></span> exprTypingHigh<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fv <span class="free">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="free">x</span> <span class="main">=</span> Some High"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> High"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">e</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Val <span class="skolem">V</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> typeVal<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> fv <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="free">x</span> <span class="main">=</span> Some High›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>typeVar<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BinOp <span class="skolem">e1</span> <span class="skolem">bop</span> <span class="skolem">e2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="bound">T</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e1</span><span class="main">;</span> <span class="free">Γ</span> <span class="free">x</span> <span class="main">=</span> Some High<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> High›</span></span>
  <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="bound">T</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e2</span><span class="main">;</span> <span class="free">Γ</span> <span class="free">x</span> <span class="main">=</span> Some High<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> High›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T</span>›</span></span> 
  <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">T1</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="bound">T1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">T2</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="bound">T2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>exprBinopTypeable<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">T1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> T <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> fv <span class="main">(</span><span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>fv <span class="skolem">e1</span> <span class="main">∪</span> fv <span class="skolem">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e1</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e1</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">T1</span>›</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="free">x</span> <span class="main">=</span> Some High›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> High"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>typeBinOp2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e2</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T2</span>›</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="free">x</span> <span class="main">=</span> Some High›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> High"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">T1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>typeBinOp3<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="secTypes-exprTypingLow"><span class="command">lemma</span></span> exprTypingLow<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> Low"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fv <span class="free">e</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="free">x</span> <span class="main">=</span> Some Low"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Val <span class="skolem">V</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fv <span class="main">(</span>Val <span class="skolem">V</span><span class="main">)</span> <span class="main">=</span>  <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> FVc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> fv <span class="main">(</span>Val <span class="skolem">V</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> fv <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> xV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> Var <span class="skolem">V</span> <span class="main">:</span> Low›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some Low"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secExprTyping.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> xV <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BinOp <span class="skolem">e1</span> <span class="skolem">bop</span> <span class="skolem">e2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> Low<span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e1</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="free">x</span> <span class="main">=</span> Some Low›</span></span>
  <span class="keyword1"><span class="command">note</span></span> IH2<span class="main">=</span><span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> Low<span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e2</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="free">x</span> <span class="main">=</span> Some Low›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span> <span class="main">:</span> Low›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> Low"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> Low"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secExprTyping.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> fv <span class="main">(</span><span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e1</span> <span class="main">∪</span> fv <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>FVe<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e1</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e1</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> Low›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fv <span class="skolem">e2</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> Low›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="secTypes-typeableFreevars"><span class="command">lemma</span></span> typeableFreevars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fv <span class="free">e</span> <span class="main">⊆</span> dom <span class="free">Γ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">e</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Val <span class="skolem">V</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fv <span class="main">(</span>Val <span class="skolem">V</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> FVc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fv <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> Var <span class="skolem">V</span> <span class="main">:</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secExprTyping.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">V</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BinOp <span class="skolem">e1</span> <span class="skolem">bop</span> <span class="skolem">e2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="bound">T</span>  <span class="main">⟹</span> fv <span class="skolem">e1</span> <span class="main">⊆</span> dom <span class="free">Γ</span>›</span></span>
  <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="bound">T</span>  <span class="main">⟹</span> fv <span class="skolem">e2</span> <span class="main">⊆</span> dom <span class="free">Γ</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fv <span class="main">(</span><span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">T1</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="bound">T1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">T2</span><span class="main">.</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="bound">T2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> exprBinopTypeable<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">T1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> Q <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">T1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fv <span class="skolem">e1</span> <span class="main">⊆</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fv <span class="skolem">e2</span> <span class="main">⊆</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fv <span class="skolem">e1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>fv <span class="skolem">e2</span><span class="main">)</span> <span class="main">⊆</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fv <span class="main">(</span><span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">⊆</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>FVe<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> fv <span class="main">(</span><span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* We assume that expressions are type correct and thus never evaluate to None.
   In this setting, the first premise is not needed.
   But for further extensions of the language with a standard type system 
   we do not remove it. *)</span>
<span class="keyword1" id="secTypes-exprNotNone"><span class="command">lemma</span></span> exprNotNone<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fv <span class="free">e</span> <span class="main">⊆</span> dom <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s</span> <span class="main">≠</span> None"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">e</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Val <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Val<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Var <span class="skolem">V</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Var<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">∈</span> fv <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>FVv<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹fv <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span> <span class="main">⊆</span> dom <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">∈</span> dom <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BinOp <span class="skolem">e1</span> <span class="skolem">bop</span> <span class="skolem">e2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="main">⟦</span><span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="bound">T</span><span class="main">;</span> fv <span class="skolem">e1</span> <span class="main">⊆</span> dom <span class="skolem">s</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="main">⟦</span><span class="skolem">e1</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">≠</span> None›</span></span>
  <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="main">⟦</span><span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="bound">T</span><span class="main">;</span> fv <span class="skolem">e2</span> <span class="main">⊆</span> dom <span class="skolem">s</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="main">⟦</span><span class="skolem">e2</span><span class="main">⟧</span> <span class="skolem">s</span> <span class="main">≠</span> None›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span> <span class="main">:</span>  <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">T1</span><span class="main">.</span> <span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="bound">T1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">T2</span><span class="main">.</span> <span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="bound">T2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> exprBinopTypeable<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T1</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">T1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹fv <span class="main">(</span><span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span><span class="main">)</span>  <span class="main">⊆</span> dom <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fv <span class="skolem">e1</span> <span class="main">∪</span> fv <span class="skolem">e2</span> <span class="main">⊆</span> dom <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>FVe<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fv <span class="skolem">e1</span> <span class="main">⊆</span> dom <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fv <span class="skolem">e2</span> <span class="main">⊆</span> dom <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">T1</span>›</span></span> <span class="quoted"><span class="quoted">‹fv <span class="skolem">e1</span> <span class="main">⊆</span> dom <span class="skolem">s</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">e1</span><span class="main">⟧</span><span class="skolem">s</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">T2</span>›</span></span> <span class="quoted"><span class="quoted">‹fv <span class="skolem">e2</span> <span class="main">⊆</span> dom <span class="skolem">s</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">e2</span><span class="main">⟧</span><span class="skolem">s</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bop</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">y</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">ya</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Noninterference definitions›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Low Equivalence›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Low Equivalence is reflexive even if the involved states are undefined. 
  But in non-reflexive situations low variables must be initialized 
  (i.e. <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∈ dom state›</span></span></span></span>), otherwise the proof will not work. This is not 
  a restriction, but a natural requirement, and could be formalized as part of 
  a standard type system.

  Low equivalence is also symmetric and transitiv (see lemmas) hence an
  equivalence relation.›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lowEquiv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"typeEnv <span class="main">⇒</span> state <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _ <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="keyword1"><span class="free">≈<span class="hidden">⇩</span><sub>L</sub></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>dom <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="bound">v</span> <span class="main">=</span> Some Low <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="bound">v</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="bound">v</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="secTypes-lowEquivReflexive"><span class="command">lemma</span></span> lowEquivReflexive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s1</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lowEquiv_def<span class="main">)</span>

<span class="keyword1" id="secTypes-lowEquivSymmetric"><span class="command">lemma</span></span> lowEquivSymmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s2</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lowEquiv_def<span class="main">)</span>

<span class="keyword1" id="secTypes-lowEquivTransitive"><span class="command">lemma</span></span> lowEquivTransitive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span><span class="main">;</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s2</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s3</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s3</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lowEquiv_def<span class="main">)</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Non Interference›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nonInterference</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"typeEnv <span class="main">⇒</span> com <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nonInterference</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> 
  <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span> <span class="bound">s1'</span> <span class="bound">s2'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⊢</span> <span class="bound">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2</span> <span class="main">∧</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s1'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s2'</span><span class="main">⟩</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⊢</span> <span class="bound">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2'</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="secTypes-nonInterferenceI"><span class="command">lemma</span></span> nonInterferenceI<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span> <span class="bound">s1'</span> <span class="bound">s2'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2</span><span class="main">;</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="bound">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s1'</span><span class="main">⟩</span><span class="main">;</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="bound">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s2'</span><span class="main">⟩</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2'</span><span class="main">⟧</span> <span class="main">⟹</span> nonInterference <span class="free">Γ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nonInterference_def<span class="main">)</span>


<span class="keyword1" id="secTypes-interpretLow"><span class="command">lemma</span></span> interpretLow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> all<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">V</span><span class="main">∈</span>fv <span class="free">e</span><span class="main">.</span> <span class="free">Γ</span> <span class="bound">V</span> <span class="main">=</span> Some Low"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> all
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Val <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Val<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Var <span class="skolem">V</span><span class="main">⟧</span> <span class="free">s1</span> <span class="main">=</span> <span class="free">s1</span> <span class="skolem">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Var <span class="skolem">V</span><span class="main">⟧</span> <span class="free">s2</span> <span class="main">=</span> <span class="free">s2</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Var<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">∈</span> fv <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>FVv<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> fv <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span>fv <span class="main">(</span>Var <span class="skolem">V</span><span class="main">)</span><span class="main">.</span> <span class="free">Γ</span> <span class="bound">X</span> <span class="main">=</span> Some Low›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some Low"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="skolem">V</span> <span class="main">=</span> <span class="free">s2</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lowEquiv_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BinOp <span class="skolem">e1</span> <span class="skolem">bop</span> <span class="skolem">e2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">V</span><span class="main">∈</span>fv <span class="skolem">e1</span><span class="main">.</span> <span class="free">Γ</span> <span class="bound">V</span> <span class="main">=</span> Some Low <span class="main">⟹</span> <span class="main">⟦</span><span class="skolem">e1</span><span class="main">⟧</span><span class="free">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="skolem">e1</span><span class="main">⟧</span><span class="free">s2</span>›</span></span>
  <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">V</span><span class="main">∈</span>fv <span class="skolem">e2</span><span class="main">.</span> <span class="free">Γ</span> <span class="bound">V</span> <span class="main">=</span> Some Low <span class="main">⟹</span> <span class="main">⟦</span><span class="skolem">e2</span><span class="main">⟧</span><span class="free">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="skolem">e2</span><span class="main">⟧</span><span class="free">s2</span>›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">V</span><span class="main">∈</span>fv <span class="main">(</span><span class="skolem">e1</span> <span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span><span class="main">)</span><span class="main">.</span> <span class="free">Γ</span> <span class="bound">V</span> <span class="main">=</span> Some Low›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">V</span><span class="main">∈</span>fv <span class="skolem">e1</span><span class="main">.</span> <span class="free">Γ</span> <span class="bound">V</span> <span class="main">=</span> Some Low"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">V</span><span class="main">∈</span> fv <span class="skolem">e2</span><span class="main">.</span> <span class="free">Γ</span> <span class="bound">V</span> <span class="main">=</span> Some Low"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">V</span><span class="main">∈</span>fv <span class="skolem">e1</span><span class="main">.</span> <span class="free">Γ</span> <span class="bound">V</span> <span class="main">=</span> Some Low›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">e1</span><span class="main">⟧</span> <span class="free">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="skolem">e1</span><span class="main">⟧</span> <span class="free">s2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">V</span><span class="main">∈</span>fv <span class="skolem">e2</span><span class="main">.</span> <span class="free">Γ</span> <span class="bound">V</span> <span class="main">=</span> Some Low›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">e2</span><span class="main">⟧</span> <span class="free">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="skolem">e2</span><span class="main">⟧</span> <span class="free">s2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">e1</span><span class="main">⟧</span> <span class="free">s2</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="secTypes-interpretLow2"><span class="command">lemma</span></span> interpretLow2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> Low"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> Low›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fv <span class="free">e</span> <span class="main">⊆</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>typeableFreevars<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> fv <span class="free">e</span><span class="main">.</span> <span class="free">Γ</span> <span class="bound">x</span> <span class="main">=</span> Some Low"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fv <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> Low›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="skolem">x</span> <span class="main">=</span> Some Low"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exprTypingLow<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> interpretLow<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="secTypes-assignNIhighlemma"><span class="command">lemma</span></span> assignNIhighlemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="free">V</span> <span class="main">=</span> Some High"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1'</span> <span class="main">=</span> <span class="free">s1</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s1</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s2'</span> <span class="main">=</span> <span class="free">s2</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">∈</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="skolem">V'</span> <span class="main">=</span> Some Low"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="skolem">V'</span> <span class="main">=</span> Some Low›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s2</span> <span class="skolem">V'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lowEquiv_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1'</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s2'</span> <span class="skolem">V'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="free">V</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="skolem">V'</span> <span class="main">=</span> Some Low›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="free">V</span> <span class="main">=</span> Some High›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s1'</span> <span class="main">=</span> <span class="free">s1</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s2'</span> <span class="main">=</span> <span class="free">s2</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s2</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s1'</span> <span class="skolem">V'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s2</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s2'</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s1</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s2</span> <span class="skolem">V'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lowEquiv_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="secTypes-assignNIlowlemma"><span class="command">lemma</span></span> assignNIlowlemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="free">V</span> <span class="main">=</span> Some Low"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> Low"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1'</span> <span class="main">=</span> <span class="free">s1</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s2'</span> <span class="main">=</span> <span class="free">s2</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2'</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">∈</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="skolem">V'</span> <span class="main">=</span> Some Low"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="skolem">V'</span> <span class="main">=</span> Some Low›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s2</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lowEquiv_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1'</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s2'</span> <span class="skolem">V'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="free">V</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s1'</span> <span class="main">=</span> <span class="free">s1</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s2'</span> <span class="main">=</span> <span class="free">s2</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s2</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1'</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s2'</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">e</span> <span class="main">:</span> Low›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s2</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>interpretLow2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s1'</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s2'</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s1'</span> <span class="main">=</span> <span class="free">s1</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s2'</span> <span class="main">=</span> <span class="free">s2</span><span class="main">(</span><span class="free">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="free">e</span><span class="main">⟧</span> <span class="free">s2</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1'</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s1</span> <span class="skolem">V'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s2'</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s2</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s1</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s2</span> <span class="skolem">V'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1'</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s2'</span> <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="quoted"><span class="quoted">‹<span class="free">s1'</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s1</span> <span class="skolem">V'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s2'</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="free">s2</span> <span class="skolem">V'</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lowEquiv_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sequential Compositionality is given the status of a theorem because 
  compositionality is no longer valid in case of concurrency›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> SeqCompositionality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="free">c2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="main">(</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nonInterferenceI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="skolem">s1'</span> <span class="skolem">s2'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c1</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1''</span><span class="main">⟩</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c2</span><span class="main">,</span><span class="skolem">s1''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Seq_reds<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s2''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c1</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2''</span><span class="main">⟩</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c2</span><span class="main">,</span><span class="skolem">s2''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Seq_reds<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c1</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1''</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c1</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2''</span><span class="main">⟩</span>›</span></span>
    <span class="quoted"><span class="quoted">‹nonInterference <span class="free">Γ</span> <span class="free">c1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1''</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nonInterference_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c2</span><span class="main">,</span><span class="skolem">s1''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c2</span><span class="main">,</span><span class="skolem">s2''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹nonInterference <span class="free">Γ</span> <span class="free">c2</span>›</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nonInterference_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="secTypes-WhileStepInduct"><span class="command">lemma</span></span> WhileStepInduct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> while<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c</span><span class="main">,</span><span class="free">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s2</span><span class="main">⟩</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> body<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="bound">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s2</span><span class="main">⟩</span>  <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> while
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>while_reds_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>false <span class="skolem">s</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lowEquiv_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>true <span class="skolem">s1</span> <span class="skolem">s3</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> body<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s3</span><span class="main">⟩</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s3</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lowEquivTransitive<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In case control conditions from if/while are high, the body of an
  if/while must not change low variables in order to prevent implicit flow.
  That is, start and end state of any if/while body must be low equivalent.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> highBodies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s2</span><span class="main">⟩</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>"</span></span>
  <span class="comment1">― ‹all intermediate states must be well formed, otherwise the proof does not 
  work for uninitialized variables. Thus it is propagated through the 
  theorem conclusion›</span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">s1</span></span> <span class="quoted"><span class="free">s2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>com.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Skip
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">=</span> <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Skip_reds<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lowEquiv_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LAss <span class="skolem">V</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">V</span><span class="main">:=</span><span class="skolem">e</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some High"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secComTyping.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">V</span><span class="main">:=</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">=</span> <span class="skolem">s1</span><span class="main">(</span><span class="skolem">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="skolem">e</span><span class="main">⟧</span><span class="skolem">s1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>LAss_reds<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">∈</span> dom <span class="free">Γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="skolem">V'</span> <span class="main">=</span> Some Low"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="skolem">s2</span> <span class="skolem">V'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="skolem">V'</span> <span class="main">=</span> Some Low›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some High›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">=</span> <span class="skolem">s1</span><span class="main">(</span><span class="skolem">V</span><span class="main">:=</span> <span class="main">⟦</span><span class="skolem">e</span><span class="main">⟧</span><span class="skolem">s1</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lowEquiv_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span><span class="main">;</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="bound">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s2</span><span class="main">⟩</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2</span>›</span></span>
  <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c2</span><span class="main">;</span> <span class="main">⟨</span><span class="skolem">c2</span><span class="main">,</span><span class="bound">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s2</span><span class="main">⟩</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2</span>›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span><span class="main">;;</span><span class="skolem">c2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secComTyping.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c1</span><span class="main">;;</span><span class="skolem">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>›</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s3</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s3</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c2</span><span class="main">,</span><span class="bound">s3</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>Seq_reds<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s3</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c2</span><span class="main">,</span><span class="skolem">s3</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s3</span><span class="main">⟩</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">c2</span><span class="main">,</span><span class="skolem">s3</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s3</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s3</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lowEquivTransitive<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cond <span class="skolem">b</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span><span class="main">;</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="bound">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s2</span><span class="main">⟩</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2</span>›</span></span>
  <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c2</span><span class="main">;</span> <span class="main">⟨</span><span class="skolem">c2</span><span class="main">,</span><span class="bound">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s2</span><span class="main">⟩</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2</span>›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">if</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secComTyping.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>›</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some true <span class="main">∨</span> <span class="main">⟦</span><span class="skolem">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some false"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Cond_True_or_False<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some true"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>CondTrue_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span>›</span></span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some false"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>CondFalse_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c2</span>›</span></span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">b</span> <span class="skolem">c'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c'</span><span class="main">;</span> <span class="main">⟨</span><span class="skolem">c'</span><span class="main">,</span><span class="bound">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s2</span><span class="main">⟩</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2</span>›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">while</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secComTyping.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> IH<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">⟦</span><span class="main">⟨</span><span class="skolem">c'</span><span class="main">,</span><span class="bound">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s2</span><span class="main">⟩</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c'</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c'</span>›</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>WhileStepInduct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="secTypes-CondHighCompositionality"><span class="command">lemma</span></span> CondHighCompositionality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nonInterferenceI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="skolem">s1'</span> <span class="skolem">s2'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s1'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>highBodies<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s2</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>highBodies<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lowEquivTransitive<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s1'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lowEquivSymmetric<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lowEquivTransitive<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="secTypes-CondLowCompositionality"><span class="command">lemma</span></span> CondLowCompositionality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="free">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">b</span> <span class="main">:</span> Low"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nonInterferenceI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="skolem">s1'</span> <span class="skolem">s2'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">b</span> <span class="main">:</span> Low›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>interpretLow2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some true <span class="main">∨</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some false"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Cond_True_or_False<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some true"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s2</span> <span class="main">=</span> Some true"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>CondTrue_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some true›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c1</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>CondTrue_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s2</span> <span class="main">=</span> Some true›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c1</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>CondTrue_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c1</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="quoted"><span class="quoted">‹nonInterference <span class="free">Γ</span> <span class="free">c1</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nonInterference_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some false"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s2</span> <span class="main">=</span> Some false"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>CondTrue_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some false›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>CondFalse_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s2</span> <span class="main">=</span> Some false›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c2</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>CondFalse_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="quoted"><span class="quoted">‹nonInterference <span class="free">Γ</span> <span class="free">c2</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nonInterference_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="secTypes-WhileHighCompositionality"><span class="command">lemma</span></span> WhileHighCompositionality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="main">(</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nonInterferenceI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="skolem">s1'</span> <span class="skolem">s2'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s1'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>highBodies<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s2</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>highBodies<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lowEquivTransitive<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s1'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lowEquivSymmetric<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lowEquivTransitive<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="secTypes-WhileLowStepInduct"><span class="command">lemma</span></span> WhileLowStepInduct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  while1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="free">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s1'</span><span class="main">⟩</span>"</span></span>   
  <span class="keyword2"><span class="keyword">and</span></span>      while2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="free">s2</span><span class="main">⟩</span><span class="main">→*</span><span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s2'</span><span class="main">⟩</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>      <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">b</span> <span class="main">:</span> Low"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>      body<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s1'</span> <span class="bound">s2</span> <span class="bound">s2'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="bound">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s1'</span><span class="main">⟩</span><span class="main">;</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="bound">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s2'</span><span class="main">⟩</span><span class="main">;</span>
                                   <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2</span><span class="main">⟧</span>  <span class="main">⟹</span>  <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>      le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> while1 le while2
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">s2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>while_reds_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>false <span class="skolem">s1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">b</span> <span class="main">:</span> Low›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>interpretLow2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some false›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s2</span> <span class="main">=</span> Some false"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span><span class="main">→*</span><span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s2'</span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">=</span> <span class="free">s2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>WhileFalse_reds<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>true <span class="skolem">s1</span> <span class="skolem">s1''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">s2''</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1''</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2''</span><span class="main">;</span> <span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="bound">s2''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s2'</span><span class="main">⟩</span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="free">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">s2'</span>›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">b</span> <span class="main">:</span> Low›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> <span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>interpretLow2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s1</span> <span class="main">=</span> Some true›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span><span class="main">⟧</span> <span class="skolem">s2</span> <span class="main">=</span> Some true"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s2'</span><span class="main">⟩</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s2''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2''</span><span class="main">⟩</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s2''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s2'</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>WhileTrue_reds<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> body<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1''</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2''</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1''</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2''</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> IH<span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s2''</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="free">s2'</span><span class="main">⟩</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="secTypes-WhileLowCompositionality"><span class="command">lemma</span></span> WhileLowCompositionality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="free">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">b</span> <span class="main">:</span> Low"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="free">c'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="main">(</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nonInterferenceI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="skolem">s1'</span> <span class="skolem">s2'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="skolem">s1''</span> <span class="skolem">s2''</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1''</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2''</span><span class="main">⟩</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>"</span></span>  
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹nonInterference <span class="free">Γ</span> <span class="free">c'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1''</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2''</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nonInterference_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s1''</span> <span class="bound">s2</span> <span class="bound">s2''</span><span class="main">.</span> <span class="main">⟦</span><span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="bound">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s1''</span><span class="main">⟩</span><span class="main">;</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span><span class="bound">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="bound">s2''</span><span class="main">⟩</span><span class="main">;</span>
                             <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2</span><span class="main">⟧</span>  <span class="main">⟹</span>  <span class="free">Γ</span> <span class="main">⊢</span> <span class="bound">s1''</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="bound">s2''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="keyword1">while</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="free">c'</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="free">b</span> <span class="main">:</span> Low›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>WhileLowStepInduct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹and now: the main theorem:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> secTypeImpliesNonInterference<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span><span class="free">T</span> <span class="main">⊢</span> <span class="free">c</span> <span class="main">⟹</span> nonInterference <span class="free">Γ</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">T</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>com.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Skip
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nonInterferenceI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="skolem">s1'</span> <span class="skolem">s2'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">=</span> <span class="skolem">s1'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Skip_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">=</span> <span class="skolem">s2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Skip_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">=</span> <span class="skolem">s1'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">=</span> <span class="skolem">s2'</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LAss <span class="skolem">V</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="skolem">V</span><span class="main">:=</span><span class="skolem">e</span>›</span></span> 
  <span class="keyword1"><span class="command">have</span></span> varprem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some High<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some Low <span class="main">∧</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e</span> <span class="main">:</span> Low <span class="main">∧</span> <span class="skolem">T</span> <span class="main">=</span> Low<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secComTyping.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nonInterferenceI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="skolem">s1'</span> <span class="skolem">s2'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">:=</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">:=</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">V</span><span class="main">:=</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">s1</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s1'</span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1'</span> <span class="main">=</span> <span class="skolem">s1</span><span class="main">(</span><span class="skolem">V</span><span class="main">:=</span><span class="main">⟦</span><span class="skolem">e</span><span class="main">⟧</span> <span class="skolem">s1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>LAss_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">V</span><span class="main">:=</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">s2</span><span class="main">⟩</span> <span class="main">→*</span> <span class="main">⟨</span>Skip<span class="main">,</span><span class="skolem">s2'</span><span class="main">⟩</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2'</span> <span class="main">=</span> <span class="skolem">s2</span><span class="main">(</span><span class="skolem">V</span><span class="main">:=</span><span class="main">⟦</span><span class="skolem">e</span><span class="main">⟧</span> <span class="skolem">s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>LAss_reds<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> varprem <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1'</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some High"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1'</span> <span class="main">=</span> <span class="skolem">s1</span><span class="main">(</span><span class="skolem">V</span><span class="main">:=</span><span class="main">⟦</span><span class="skolem">e</span><span class="main">⟧</span> <span class="skolem">s1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2'</span> <span class="main">=</span> <span class="skolem">s2</span><span class="main">(</span><span class="skolem">V</span><span class="main">:=</span><span class="main">⟦</span><span class="skolem">e</span><span class="main">⟧</span> <span class="skolem">s2</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>assignNIhighlemma<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some Low <span class="main">∧</span> <span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">e</span> <span class="main">:</span> Low <span class="main">∧</span> <span class="skolem">T</span> <span class="main">=</span> Low"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">s1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">s2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1'</span> <span class="main">=</span> <span class="skolem">s1</span><span class="main">(</span><span class="skolem">V</span><span class="main">:=</span><span class="main">⟦</span><span class="skolem">e</span><span class="main">⟧</span> <span class="skolem">s1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2'</span> <span class="main">=</span> <span class="skolem">s2</span><span class="main">(</span><span class="skolem">V</span><span class="main">:=</span><span class="main">⟦</span><span class="skolem">e</span><span class="main">⟧</span> <span class="skolem">s2</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>assignNIlowlemma<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="free">Γ</span><span class="main">,</span><span class="bound">T</span> <span class="main">⊢</span> <span class="skolem">c1</span> <span class="main">⟹</span> nonInterference <span class="free">Γ</span> <span class="skolem">c1</span>›</span></span>
  <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="free">Γ</span><span class="main">,</span><span class="bound">T</span> <span class="main">⊢</span> <span class="skolem">c2</span> <span class="main">⟹</span> nonInterference <span class="free">Γ</span> <span class="skolem">c2</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> High
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="skolem">c1</span><span class="main">;;</span><span class="skolem">c2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secComTyping.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="skolem">c1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>SeqCompositionality<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Low
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="skolem">c1</span><span class="main">;;</span><span class="skolem">c2</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c1</span> <span class="main">∧</span> <span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span><span class="main">;;</span><span class="skolem">c2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secComTyping.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c1</span> <span class="main">∧</span> <span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c2</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="skolem">c1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>SeqCompositionality<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span><span class="main">;;</span><span class="skolem">c2</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secComTyping.cases<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="skolem">c1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>SeqCompositionality<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cond <span class="skolem">b</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="free">Γ</span><span class="main">,</span><span class="bound">T</span> <span class="main">⊢</span> <span class="skolem">c1</span> <span class="main">⟹</span> nonInterference <span class="free">Γ</span> <span class="skolem">c1</span>›</span></span>
  <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="free">Γ</span><span class="main">,</span><span class="bound">T</span> <span class="main">⊢</span> <span class="skolem">c2</span> <span class="main">⟹</span> nonInterference <span class="free">Γ</span> <span class="skolem">c2</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> High
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="keyword1">if</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>CondHighCompositionality<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Low
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="keyword1">if</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">b</span> <span class="main">:</span> Low <span class="main">∧</span> <span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c1</span> <span class="main">∧</span><span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">if</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secComTyping.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">b</span> <span class="main">:</span> Low <span class="main">∧</span> <span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c1</span> <span class="main">∧</span> <span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c2</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">b</span> <span class="main">:</span> Low"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> IH1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="skolem">c1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> IH2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">b</span> <span class="main">:</span> Low›</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>CondLowCompositionality<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">if</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>CondHighCompositionality<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">b</span> <span class="skolem">c'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">T</span><span class="main">.</span> <span class="free">Γ</span><span class="main">,</span><span class="bound">T</span> <span class="main">⊢</span> <span class="skolem">c'</span> <span class="main">⟹</span> nonInterference <span class="free">Γ</span> <span class="skolem">c'</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> High
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="keyword1">while</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>WhileHighCompositionality<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Low
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="keyword1">while</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c'</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">b</span> <span class="main">:</span> Low <span class="main">∧</span> <span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c'</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">while</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>secComTyping.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">b</span> <span class="main">:</span> Low <span class="main">∧</span> <span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">⊢</span> <span class="skolem">b</span> <span class="main">:</span> Low"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> IH<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span><span class="main">,</span>Low <span class="main">⊢</span> <span class="skolem">c'</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonInterference <span class="free">Γ</span> <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>WhileLowCompositionality<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="keyword1">while</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c'</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>WhileHighCompositionality<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Execute">
<div class="head">
<h1>Theory Execute</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Lukas Bulwahn, TU Muenchen, 2009  *)</span>

<span class="keyword1"><span class="command">theory</span></span> Execute
<span class="keyword2"><span class="keyword">imports</span></span> <a href="secTypes.html">secTypes</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Executing the small step semantics›</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span> i <span class="main">=&gt;</span> o <span class="main">=&gt;</span> bool as exec_red<span class="main">,</span> i <span class="main">=&gt;</span> i * o <span class="main">=&gt;</span> bool<span class="main">,</span> i <span class="main">=&gt;</span> o * i <span class="main">=&gt;</span> bool<span class="main">,</span> i <span class="main">=&gt;</span> i <span class="main">=&gt;</span> bool<span class="main">)</span> <span class="quoted"><span class="quoted">red</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">thm</span></span> red.equation

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">one_step</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Predicate.the <span class="main">(</span>exec_red <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">code_pred_intro</span><span class="main">]</span> <span class="main">=</span> typeVal<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> lev <span class="main"><span class="main">=</span></span> <span class="quoted">Low</span><span class="main">]</span> typeVal<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> lev <span class="main"><span class="main">=</span></span> <span class="quoted">High</span><span class="main">]</span>
  typeVar
  typeBinOp1 typeBinOp2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> lev <span class="main"><span class="main">=</span></span> <span class="quoted">Low</span><span class="main">]</span> typeBinOp2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> lev <span class="main"><span class="main">=</span></span> <span class="quoted">High</span><span class="main">]</span> typeBinOp3<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> lev <span class="main"><span class="main">=</span></span> <span class="quoted">Low</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span> i <span class="main">=&gt;</span> i <span class="main">=&gt;</span> o <span class="main">=&gt;</span> bool as compute_secExprTyping<span class="main">,</span>
  i <span class="main">=&gt;</span> i <span class="main">=&gt;</span> i <span class="main">=&gt;</span> bool as check_secExprTyping<span class="main">)</span> <span class="quoted"><span class="quoted">secExprTyping</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">case</span></span> secExprTyping
  <span class="keyword1"><span class="command">from</span></span> secExprTyping.prems <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">V</span> <span class="skolem">lev</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> Val <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> <span class="skolem">lev</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secExprTyping<span class="main">(</span>1-2<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lev</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">Vn</span> <span class="skolem">lev</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> Var <span class="skolem">Vn</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> <span class="skolem">lev</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="skolem">Vn</span> <span class="main">=</span> Some <span class="skolem">lev</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secExprTyping<span class="main">(</span>3<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Predicate.eq_is_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="skolem">bop</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> <span class="skolem">e1</span><span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> Low"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> Low"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> Low"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secExprTyping<span class="main">(</span>4<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="skolem">lev</span> <span class="skolem">bop</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> <span class="skolem">e1</span><span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> High"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> High"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> <span class="skolem">lev</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secExprTyping<span class="main">(</span>5-6<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lev</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="skolem">lev</span> <span class="skolem">bop</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> <span class="skolem">e1</span><span class="main">«</span><span class="skolem">bop</span><span class="main">»</span> <span class="skolem">e2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> High"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e1</span> <span class="main">:</span> <span class="skolem">lev</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e2</span> <span class="main">:</span> High"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secExprTyping<span class="main">(</span>6-7<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lev</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">code_pred_intro</span><span class="main">]</span> <span class="main">=</span> typeSkip<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted">Low</span><span class="main">]</span> typeSkip<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted">High</span><span class="main">]</span>
  typeAssH<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> T <span class="main"><span class="main">=</span></span> <span class="quoted">Low</span><span class="main">]</span> typeAssH<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> T<span class="main"><span class="main">=</span></span><span class="quoted">High</span><span class="main">]</span>
  typeAssL typeSeq typeWhile typeIf typeConvert

<span class="keyword1"><span class="command">code_pred</span></span> <span class="main">(</span>modes<span class="main">:</span> i <span class="main">=&gt;</span> o <span class="main">=&gt;</span> i <span class="main">=&gt;</span> bool as compute_secComTyping<span class="main">,</span>
  i <span class="main">=&gt;</span> i <span class="main">=&gt;</span> i <span class="main">=&gt;</span> bool as check_secComTyping<span class="main">)</span> <span class="quoted"><span class="quoted">secComTyping</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">case</span></span> secComTyping
  <span class="keyword1"><span class="command">from</span></span> secComTyping.prems <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">T</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> Skip"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secComTyping<span class="main">(</span>1-2<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">V</span> <span class="skolem">T</span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> <span class="skolem">V</span><span class="main">:=</span><span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some High"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secComTyping<span class="main">(</span>3-4<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">e</span> <span class="skolem">V</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> Low"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> <span class="skolem">V</span><span class="main">:=</span><span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">e</span> <span class="main">:</span> Low"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="skolem">V</span> <span class="main">=</span> Some Low"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secComTyping<span class="main">(</span>5<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">T</span> <span class="skolem">c1</span> <span class="skolem">c2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> Seq <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="skolem">c1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="skolem">c2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secComTyping<span class="main">(</span>6<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">b</span> <span class="skolem">T</span> <span class="skolem">c</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> <span class="keyword1">while</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">b</span> <span class="main">:</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secComTyping<span class="main">(</span>7<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">b</span> <span class="skolem">T</span> <span class="skolem">c1</span> <span class="skolem">c2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> <span class="keyword1">if</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span> <span class="main">⊢</span> <span class="skolem">b</span> <span class="main">:</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="skolem">c1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span><span class="main">,</span><span class="skolem">T</span> <span class="main">⊢</span> <span class="skolem">c2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secComTyping<span class="main">(</span>8<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">c</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">Γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">=</span> Low"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Γ</span><span class="main">,</span>High <span class="main">⊢</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> secComTyping<span class="main">(</span>9<span class="main">)</span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">thm</span></span> secComTyping.equation

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹An example taken from Volpano, Smith, Irvine›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">com</span> <span class="main">=</span> <span class="keyword1">if</span> <span class="main">(</span>Var <span class="inner_quoted">''x''</span> <span class="main">«</span>Eq<span class="main">»</span> Val <span class="main">(</span>Intg <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">:=</span>  Val <span class="main">(</span>Intg <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">:=</span> Val <span class="main">(</span>Intg <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Env</span> <span class="main">=</span> map_of <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''x''</span><span class="main">,</span> High<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''y''</span><span class="main">,</span> High<span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">T</span><span class="main">.</span> Env <span class="main">⊢</span> <span class="main">(</span>Var <span class="inner_quoted">''x''</span> <span class="main">«</span>Eq<span class="main">»</span> Val <span class="main">(</span>Intg <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">:</span> <span class="bound">T</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Env<span class="main">,</span> High <span class="main">⊢</span> com"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Env<span class="main">,</span> Low <span class="main">⊢</span> com"</span></span>
<span class="keyword1"><span class="command">values</span></span> 1 <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">T</span><span class="main">.</span> Env<span class="main">,</span> <span class="bound">T</span> <span class="main">⊢</span> com<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Env'</span> <span class="main">=</span> map_of <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''x''</span><span class="main">,</span> Low<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''y''</span><span class="main">,</span> High<span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Env'<span class="main">,</span> Low <span class="main">⊢</span> com"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Env'<span class="main">,</span> High <span class="main">⊢</span> com"</span></span>
<span class="keyword1"><span class="command">values</span></span> 1 <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">T</span><span class="main">.</span> Env<span class="main">,</span> <span class="bound">T</span> <span class="main">⊢</span> com<span class="main">}</span>"</span></span>

  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>