<div id="Power_int">
<div class="head">
<h1>Theory Power_int</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Integer Powers ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Power_int
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Real.html">HOL.Real</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The standard HOL power operator is only for natural powers. This operator allows integers. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">intpow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>linordered_field<span class="main">}</span> <span class="main">⇒</span> int <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span>"</span> 80<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">intpow</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> inverse <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">^</span> nat <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">^</span> nat <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Power_int-intpow_zero"><span class="command">lemma</span></span> intpow_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intpow_def<span class="main">)</span>

<span class="keyword1" id="Power_int-intpow_spos"><span class="command">lemma</span></span> intpow_spos <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intpow_def<span class="main">)</span>

<span class="keyword1" id="Power_int-intpow_one"><span class="command">lemma</span></span> intpow_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">1</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intpow_def<span class="main">)</span>

<span class="keyword1" id="Power_int-one_intpow"><span class="command">lemma</span></span> one_intpow <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intpow_def<span class="main">)</span>

<span class="keyword1" id="Power_int-intpow_plus"><span class="command">lemma</span></span> intpow_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">m</span> <span class="main">*</span> <span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intpow_def <span class="dynamic"><span class="dynamic">field_simps</span></span> power_add<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> abs_ge_zero add.commute add_diff_cancel_right' nat_add_distrib power_add uminus_add_conv_diff zabs_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Power_int-intpow_mult_combine"><span class="command">lemma</span></span> intpow_mult_combine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">m</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">n</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intpow_plus<span class="main">)</span>

<span class="keyword1" id="Power_int-intpow_pos"><span class="command">lemma</span></span> intpow_pos <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> nat <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intpow_def<span class="main">)</span>

<span class="keyword1" id="Power_int-intpow_uminus"><span class="command">lemma</span></span> intpow_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">-</span><span class="free">n</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intpow_def<span class="main">)</span>

<span class="keyword1" id="Power_int-intpow_uminus_nat"><span class="command">lemma</span></span> intpow_uminus_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">-</span><span class="free">n</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">x</span> <span class="main">^</span> nat <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intpow_def<span class="main">)</span>

<span class="keyword1" id="Power_int-intpow_inverse"><span class="command">lemma</span></span> intpow_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="free">a</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">n</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">a</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intpow_def power_inverse<span class="main">)</span>

<span class="keyword1" id="Power_int-intpow_mult_distrib"><span class="command">lemma</span></span> intpow_mult_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">m</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">m</span> <span class="main">*</span> <span class="free">y</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intpow_def power_mult_distrib<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Enum_extra">
<div class="head">
<h1>Theory Enum_extra</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Enumeration Extras ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Enum_extra
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Cardinality.html">HOL-Library.Cardinality</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ First Index Function ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following function extracts the index of the first occurrence of an element in a list, 
  assuming it is indeed an element. ›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">first_ind</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">first_ind</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> undefined"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">first_ind</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">else</span> <span class="free">first_ind</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Enum_extra-first_ind_length"><span class="command">lemma</span></span> first_ind_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set<span class="main">(</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> first_ind <span class="free">xs</span> <span class="free">x</span> <span class="free">i</span> <span class="main">&lt;</span> length<span class="main">(</span><span class="free">xs</span><span class="main">)</span> <span class="main">+</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add_Suc_right<span class="main">)</span>

<span class="keyword1" id="Enum_extra-nth_first_ind"><span class="command">lemma</span></span> nth_first_ind<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> distinct <span class="free">xs</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> set<span class="main">(</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span>first_ind <span class="free">xs</span> <span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def add.right_neutral add_Suc_right add_diff_cancel_left' diff_diff_left empty_iff first_ind.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> neq_Nil_conv nth_Cons' zero_diff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Enum_extra-first_ind_nth"><span class="command">lemma</span></span> first_ind_nth<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> distinct <span class="free">xs</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span> first_ind <span class="free">xs</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="free">i</span> <span class="main">+</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> less_Suc_eq_le nth_equal_first_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> less_Suc_eq_0_disj <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Enumeration Indices ›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_ENUM"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ENUM'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">ENUM(</span><span class="tfree"><span class="free">'a</span></span><span class="main">)</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> Enum.enum <span class="main">::</span> <span class="main">(</span><span class="tfree"><span class="free">'a</span></span><span class="main">::</span>enum<span class="main">)</span> list"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Extract a unique natural number associated with an enumerated value by using its index
  in the characteristic list <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="keyword1">ENUM(</span></span><span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">)</span></span>›</span></span></span></span>. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">enum_ind</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>enum <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">enum_ind</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>enum<span class="main">)</span> <span class="main">=</span> first_ind <span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span>"</span></span>

<span class="keyword1" id="Enum_extra-length_enum_CARD"><span class="command">lemma</span></span> length_enum_CARD<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UNIV_enum distinct_card enum_distinct<span class="main">)</span>

<span class="keyword1" id="Enum_extra-CARD_length_enum"><span class="command">lemma</span></span> CARD_length_enum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> length <span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_enum_CARD<span class="main">)</span>

<span class="keyword1" id="Enum_extra-enum_ind_less_CARD"><span class="command">lemma</span></span> enum_ind_less_CARD <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"enum_ind <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>enum<span class="main">)</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> first_ind_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">,</span> <span class="operator">OF</span> in_enum<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_ind_def CARD_length_enum<span class="main">)</span>
  
<span class="keyword1" id="Enum_extra-enum_nth_ind"><span class="command">lemma</span></span> enum_nth_ind <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Enum.enum <span class="main">!</span> <span class="main">(</span>enum_ind <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nth_first_ind<span class="main">[</span><span class="operator">of</span> <span class="quoted">Enum.enum</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">OF</span> enum_distinct in_enum<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_ind_def<span class="main">)</span>

<span class="keyword1" id="Enum_extra-enum_distinct_conv_nth"><span class="command">lemma</span></span> enum_distinct_conv_nth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">!</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≠</span> <span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distinct_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">THEN</span> sym<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_distinct<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CARD_length_enum<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Enum_extra-enum_ind_nth"><span class="command">lemma</span></span> enum_ind_nth <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>enum<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"enum_ind <span class="main">(</span><span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms first_ind_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">OF</span> enum_distinct<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_ind_def CARD_length_enum<span class="main">)</span>

<span class="keyword1" id="Enum_extra-enum_ind_spec"><span class="command">lemma</span></span> enum_ind_spec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"enum_ind <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>enum<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∧</span> Enum.enum <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> the_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"enum_ind <span class="free">x</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_ind_less_CARD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"enum_class.enum <span class="main">!</span> enum_ind <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">=</span> enum_ind <span class="main">(</span><span class="keyword1">ENUM(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_ind_nth<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Enum_extra-enum_ind_inj"><span class="command">lemma</span></span> enum_ind_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>enum_ind <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>enum <span class="main">⇒</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_inverseI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">ENUM(</span></span></span><span class="tfree"><span class="tfree"><span class="tfree">'a</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">!</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Enum_extra-enum_ind_neq"><span class="command">lemma</span></span> enum_ind_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> enum_ind <span class="free">x</span> <span class="main">≠</span> enum_ind <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_ind_inj inj_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Groups_mult">
<div class="head">
<h1>Theory Groups_mult</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Multiplication Groups ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Groups_mult
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The HOL standard library only has groups based on addition. Here, we build one based on
  multiplication. ›</span></span>

<span class="keyword1"><span class="command">notation</span></span> times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> group_mult <span class="main">=</span> inverse <span class="main">+</span> monoid_mult <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> left_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="free">a</span> <span class="main">⋅</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> multi_inverse_conv_div <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⋅</span> <span class="main">(</span>inverse <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">/</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Groups_mult-div_conv_mult_inverse"><span class="command">lemma</span></span> div_conv_mult_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">/</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅</span> <span class="main">(</span>inverse <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">sublocale</span></span> mult<span class="main">:</span> group <span class="quoted">times</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted">inverse</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_inverse<span class="main">)</span>

<span class="keyword1" id="Groups_mult-diff_self"><span class="command">lemma</span></span> diff_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">/</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult.right_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Groups_mult-mult_distrib_inverse"><span class="command">lemma</span></span> mult_distrib_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_1_right local.multi_inverse_conv_div mult.right_inverse mult_assoc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> ab_group_mult <span class="main">=</span> comm_monoid_mult <span class="main">+</span> group_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Groups_mult-mult_distrib_inverse'"><span class="command">lemma</span></span> mult_distrib_inverse' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.mult_distrib_inverse mult_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Groups_mult-inverse_distrib"><span class="command">lemma</span></span> inverse_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>  <span class="main">=</span>  <span class="main">(</span>inverse <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>inverse <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.mult.inverse_distrib_swap mult_commute<span class="main">)</span>

<span class="keyword1" id="Groups_mult-inverse_divide"><span class="command">lemma</span></span> inverse_divide <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">/</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_conv_mult_inverse inverse_distrib mult.commute mult.inverse_inverse<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">npower</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>power<span class="main">,</span>inverse<span class="main">}</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>-</sup>⇧</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">,</span>999<span class="main">]</span> 999<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">npower</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> inverse <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">^</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="ISQ_Dimensions">
<div class="head">
<h1>Theory ISQ_Dimensions</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹ International System of Quantities ›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Quantity Dimensions ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ISQ_Dimensions
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Groups_mult">Groups_mult</a> <a href="#Power_int">Power_int</a> <a href="#Enum_extra">Enum_extra</a>
          <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Transcendental.html">HOL.Transcendental</a>
          <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Eisbach/Eisbach.html">HOL-Eisbach.Eisbach</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Preliminaries ›</span></span>

<span class="keyword1"><span class="command">class</span></span> unitary <span class="main">=</span> finite <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> unitary_unit_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">unit</span> <span class="main">=</span> <span class="main">(</span>undefined<span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ISQ_Dimensions-UNIV_unitary"><span class="command">lemma</span></span> UNIV_unitary<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card<span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.unitary_unit_pres<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> UNIV_I card_1_singletonE empty_iff insert_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ISQ_Dimensions-eq_unit"><span class="command">lemma</span></span> eq_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> UNIV_unitary iso_tuple_UNIV_I singletonD<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="ISQ_Dimensions-unitary_intro"><span class="command">lemma</span></span> unitary_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'s</span> set<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⟹</span> <span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span> unitary_class<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> finite.simps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> card_1_singleton_iff <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> si_def <span class="keyword2"><span class="keyword">and</span></span> si_eq

<span class="keyword1"><span class="command">instantiation</span></span> unit <span class="main">::</span> <span class="quoted">comm_monoid_add</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">zero_unit</span></span> <span class="main">=</span> <span class="main">()</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">plus_unit</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>unit<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span>unit<span class="main">)</span> <span class="main">=</span> <span class="main">()</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> unit <span class="main">::</span> <span class="quoted">comm_monoid_mult</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">one_unit</span></span> <span class="main">=</span> <span class="main">()</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">times_unit</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>unit<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span>unit<span class="main">)</span> <span class="main">=</span> <span class="main">()</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> unit <span class="main">::</span> <span class="quoted">inverse</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">inverse_unit</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>unit<span class="main">)</span> <span class="main">=</span> <span class="main">()</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">divide_unit</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>unit<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span>unit<span class="main">)</span> <span class="main">=</span> <span class="main">()</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> unit <span class="main">::</span> <span class="quoted">ab_group_mult</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Dimension Vectors ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Quantity dimensions are used to distinguish quantities of different kinds. Only quantities
  of the same kind can be compared and combined: it is a mistake to add a length to a mass, for
  example. Dimensions are often expressed in terms of seven base quantities, which can be combined 
  to form derived quantities. Consequently, a dimension associates with each of the base quantities 
  an integer that denotes the power to which it is raised. We use a special vector type to represent
  dimensions, and then specialise this to the seven major dimensions. ›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> dimvec <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> <span class="main">(</span><span class="tfree">'d</span><span class="main">::</span>enum <span class="main">⇒</span> <span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">morphisms</span></span> dim_nth dim_lambda <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">declare</span></span> dim_lambda_inject <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> dim_nth_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> dim_lambda_inverse <span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">instantiation</span></span> dimvec <span class="main">::</span> <span class="main">(</span><span class="quoted">zero</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">)</span> <span class="quoted"><span class="quoted">"one"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_dimvec</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dimvec"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_dimvec</span> <span class="main">=</span> dim_lambda <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> dimvec <span class="main">::</span> <span class="main">(</span><span class="quoted">plus</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">)</span> <span class="quoted">times</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">times_dimvec</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dimvec <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dimvec <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dimvec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">times_dimvec</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> dim_lambda <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> dim_nth <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">i</span> <span class="main">+</span> dim_nth <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> dimvec <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_monoid_add</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">)</span> <span class="quoted">comm_monoid_mult</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_dimvec_def one_dimvec_def fun_eq_iff add.assoc<span class="main">)</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We also define the inverse and division operations, and an abelian group, which will allow
  us to perform dimensional analysis. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> dimvec <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>plus<span class="main">,</span>uminus<span class="main">}</span>"</span></span><span class="main">,</span> <span class="quoted">enum</span><span class="main">)</span> <span class="quoted">inverse</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">inverse_dimvec</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dimvec <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dimvec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">inverse_dimvec</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> dim_lambda <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">-</span> dim_nth <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">divide_dimvec</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dimvec <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dimvec <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dimvec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">divide_dimvec</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="main">(</span>inverse <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> dimvec <span class="main">::</span> <span class="main">(</span><span class="quoted">ab_group_add</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">)</span> <span class="quoted">ab_group_mult</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_dimvec_def one_dimvec_def times_dimvec_def divide_dimvec_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Code Generation ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Dimension vectors can be represented using lists, which enables code generation and thus
  efficient proof. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_dimvec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'n</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span>enum<span class="main">)</span> dimvec"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mk_dimvec</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'d</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> dim_lambda <span class="main">(</span><span class="main">λ</span> <span class="bound">d</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="main">!</span> enum_ind <span class="bound">d</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">code_datatype</span></span> <span class="quoted">mk_dimvec</span>

<span class="keyword1" id="ISQ_Dimensions-mk_dimvec_inj"><span class="command">lemma</span></span> mk_dimvec_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>mk_dimvec <span class="main">::</span> <span class="tfree">'n</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span>enum<span class="main">)</span> dimvec<span class="main">)</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'d</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'n</span> list"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mk_dimvec <span class="skolem">x</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> dimvec<span class="main">)</span> <span class="main">=</span> mk_dimvec <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'d</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">y</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enum_ind <span class="main">(</span><span class="keyword1">ENUM(</span><span class="tfree">'d</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_dimvec_def fun_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> a<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nth_equalityI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ISQ_Dimensions-mk_dimvec_eq_iff"><span class="command">lemma</span></span> mk_dimvec_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'d</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'d</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>mk_dimvec <span class="free">x</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span>enum<span class="main">)</span> dimvec<span class="main">)</span> <span class="main">=</span> mk_dimvec <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_eq_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mk_dimvec_inj<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1" id="ISQ_Dimensions-one_mk_dimvec"><span class="command">lemma</span></span> one_mk_dimvec <span class="main">[</span><span class="operator">code</span><span class="main">,</span> <span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>enum<span class="main">)</span> dimvec<span class="main">)</span> <span class="main">=</span> mk_dimvec <span class="main">(</span>replicate <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_dimvec_def one_dimvec_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Dimensions-times_mk_dimvec"><span class="command">lemma</span></span> times_mk_dimvec <span class="main">[</span><span class="operator">code</span><span class="main">,</span> <span class="operator">si_def</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>mk_dimvec <span class="free">xs</span> <span class="main">*</span> mk_dimvec <span class="free">ys</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>enum<span class="main">)</span> dimvec<span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="free">xs</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">ys</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">then</span> mk_dimvec <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> length <span class="free">xs</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">then</span> mk_dimvec <span class="free">xs</span> <span class="keyword1">else</span> mk_dimvec <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_dimvec_def mk_dimvec_def fun_eq_iff one_dimvec_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Dimensions-power_mk_dimvec"><span class="command">lemma</span></span> power_mk_dimvec <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>power <span class="main">(</span>mk_dimvec <span class="free">xs</span><span class="main">)</span> <span class="free">n</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>enum<span class="main">)</span> dimvec<span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="free">xs</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> mk_dimvec <span class="main">(</span>map <span class="main">(</span><span class="main">(*)</span> <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">else</span> mk_dimvec <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_dimvec_def mk_dimvec_def<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_mk_dimvec zip_map_map<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"id"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> comp_def split_beta' zip_same_conv_map distrib_right mult.commute<span class="main">)</span>

<span class="keyword1" id="ISQ_Dimensions-inverse_mk_dimvec"><span class="command">lemma</span></span> inverse_mk_dimvec <span class="main">[</span><span class="operator">code</span><span class="main">,</span> <span class="operator">si_def</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>inverse <span class="main">(</span>mk_dimvec <span class="free">xs</span><span class="main">)</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>enum<span class="main">)</span> dimvec<span class="main">)</span> <span class="main">=</span> 
   <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="free">xs</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> mk_dimvec <span class="main">(</span>map uminus <span class="free">xs</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_dimvec_def one_dimvec_def mk_dimvec_def fun_eq_iff<span class="main">)</span>  

<span class="keyword1" id="ISQ_Dimensions-divide_mk_dimvec"><span class="command">lemma</span></span> divide_mk_dimvec <span class="main">[</span><span class="operator">code</span><span class="main">,</span> <span class="operator">si_def</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>mk_dimvec <span class="free">xs</span> <span class="main">/</span> mk_dimvec <span class="free">ys</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>ring_1<span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>enum<span class="main">)</span> dimvec<span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="free">xs</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">ys</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">then</span> mk_dimvec <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> length <span class="free">ys</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">then</span> mk_dimvec <span class="main">(</span>map uminus <span class="free">ys</span><span class="main">)</span> <span class="keyword1">else</span> mk_dimvec <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_dimvec_def inverse_mk_dimvec times_mk_dimvec zip_map_map<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"id"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> comp_def split_beta'<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A base dimension is a dimension where precisely one component has power 1: it is the 
  dimension of a base quantity. Here we define the seven base dimensions. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_BaseDim</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span><span class="main">::</span>enum <span class="main">⇒</span> <span class="main">(</span>int<span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> dimvec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">mk_BaseDim</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> dim_lambda <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ISQ_Dimensions-mk_BaseDim_neq"><span class="command">lemma</span></span> mk_BaseDim_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> mk_BaseDim <span class="free">x</span> <span class="main">≠</span> mk_BaseDim <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_BaseDim_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="ISQ_Dimensions-mk_BaseDim_code"><span class="command">lemma</span></span> mk_BaseDim_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mk_BaseDim <span class="main">(</span><span class="free">d</span><span class="main">::</span><span class="tfree">'d</span><span class="main">::</span>enum<span class="main">)</span> <span class="main">=</span> mk_dimvec <span class="main">(</span>list_update <span class="main">(</span>replicate <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'d</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>enum_ind <span class="free">d</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_BaseDim_def mk_dimvec_def fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_BaseDim</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int<span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span>enum<span class="main">)</span> dimvec <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_BaseDim</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> dim_lambda <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ISQ_Dimensions-is_BaseDim_mk"><span class="command">lemma</span></span> is_BaseDim_mk <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_BaseDim <span class="main">(</span>mk_BaseDim <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_BaseDim_def is_BaseDim_def fun_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Dimension Semantic Domain ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We next specialise dimension vectors to the usual seven place vector. ›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> sdim <span class="main">=</span> Length <span class="main">|</span> Mass <span class="main">|</span> Time <span class="main">|</span> Current <span class="main">|</span> Temperature <span class="main">|</span> Amount <span class="main">|</span> Intensity

<span class="keyword1" id="ISQ_Dimensions-sdim_UNIV"><span class="command">lemma</span></span> sdim_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV <span class="main">::</span> sdim set<span class="main">)</span> <span class="main">=</span> <span class="main">{</span>Length<span class="main">,</span> Mass<span class="main">,</span> Time<span class="main">,</span> Current<span class="main">,</span> Temperature<span class="main">,</span> Amount<span class="main">,</span> Intensity<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sdim.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ISQ_Dimensions-CARD_sdim"><span class="command">lemma</span></span> CARD_sdim <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span>sdim<span class="main">)</span> <span class="main">=</span> <span class="numeral">7</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sdim_UNIV<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> sdim <span class="main">::</span> <span class="quoted">enum</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">enum_sdim</span></span> <span class="main">=</span> <span class="main">[</span>Length<span class="main">,</span> Mass<span class="main">,</span> Time<span class="main">,</span> Current<span class="main">,</span> Temperature<span class="main">,</span> Amount<span class="main">,</span> Intensity<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">enum_all_sdim</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Length <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Mass <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Time <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Current <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Temperature <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Amount <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Intensity"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">enum_ex_sdim</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Length <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Mass <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Time <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Current <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Temperature <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Amount <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> Intensity"</span></span>
  <span class="keyword1"><span class="command">instance</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sdim_UNIV enum_sdim_def enum_all_sdim_def enum_ex_sdim_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> sdim <span class="main">::</span> <span class="quoted">card_UNIV</span> 
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"finite_UNIV <span class="main">=</span> <span class="keyword1">Phantom</span><span class="main">(</span>sdim<span class="main">)</span> True"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"card_UNIV <span class="main">=</span> <span class="keyword1">Phantom</span><span class="main">(</span>sdim<span class="main">)</span> <span class="numeral">7</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_UNIV_sdim_def card_UNIV_sdim_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="ISQ_Dimensions-sdim_enum"><span class="command">lemma</span></span> sdim_enum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"enum_ind Length <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"enum_ind Mass <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"enum_ind Time <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"enum_ind Current <span class="main">=</span> <span class="numeral">3</span>"</span></span>
  <span class="quoted"><span class="quoted">"enum_ind Temperature <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="quoted"><span class="quoted">"enum_ind Amount <span class="main">=</span> <span class="numeral">5</span>"</span></span> <span class="quoted"><span class="quoted">"enum_ind Intensity <span class="main">=</span> <span class="numeral">6</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_ind_def enum_sdim_def<span class="main">)</span>

<span class="keyword1"><span class="command">type_synonym</span></span> Dimension <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int<span class="main">,</span> sdim<span class="main">)</span> dimvec"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">LengthBD</span>      <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>L</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>L</b></span></span> <span class="main">≡</span> mk_BaseDim Length"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">MassBD</span>        <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>M</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>M</b></span></span> <span class="main">≡</span> mk_BaseDim Mass"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">TimeBD</span>        <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>T</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>T</b></span></span> <span class="main">≡</span> mk_BaseDim Time"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">CurrentBD</span>     <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>I</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>I</b></span></span> <span class="main">≡</span> mk_BaseDim Current"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">TemperatureBD</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>Θ</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>Θ</b></span></span> <span class="main">≡</span> mk_BaseDim Temperature"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">AmountBD</span>      <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>N</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>N</b></span></span> <span class="main">≡</span> mk_BaseDim Amount"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">IntensityBD</span>   <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>J</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>J</b></span></span> <span class="main">≡</span> mk_BaseDim Intensity"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">BaseDimensions</span> <span class="main">≡</span> <span class="main">{</span><span class="keyword1"><span class="hidden">❙</span><b>L</b></span><span class="main">,</span> <span class="keyword1"><span class="hidden">❙</span><b>M</b></span><span class="main">,</span> <span class="keyword1"><span class="hidden">❙</span><b>T</b></span><span class="main">,</span> <span class="keyword1"><span class="hidden">❙</span><b>I</b></span><span class="main">,</span> <span class="keyword1"><span class="hidden">❙</span><b>Θ</b></span><span class="main">,</span> <span class="keyword1"><span class="hidden">❙</span><b>N</b></span><span class="main">,</span> <span class="keyword1"><span class="hidden">❙</span><b>J</b></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="ISQ_Dimensions-BD_mk_dimvec"><span class="command">lemma</span></span> BD_mk_dimvec <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>L</b></span> <span class="main">=</span> mk_dimvec <span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>M</b></span> <span class="main">=</span> mk_dimvec <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>T</b></span> <span class="main">=</span> mk_dimvec <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>I</b></span> <span class="main">=</span> mk_dimvec <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>Θ</b></span> <span class="main">=</span> mk_dimvec <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>N</b></span> <span class="main">=</span> mk_dimvec <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>J</b></span> <span class="main">=</span> mk_dimvec <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_BaseDim_code eval_nat_numeral<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following lemma confirms that there are indeed seven unique base dimensions. ›</span></span>

<span class="keyword1" id="ISQ_Dimensions-seven_BaseDimensions"><span class="command">lemma</span></span> seven_BaseDimensions<span class="main">:</span> <span class="quoted"><span class="quoted">"card BaseDimensions <span class="main">=</span> <span class="numeral">7</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can use the base dimensions and algebra to form dimension expressions. Some examples
  are shown below. ›</span></span>

<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>L</b></span><span class="main">⋅</span><span class="keyword1"><span class="hidden">❙</span><b>M</b></span><span class="main">⋅</span><span class="keyword1"><span class="hidden">❙</span><b>T</b></span><span class="main"><span class="hidden">⇧</span><sup>-</sup>⇧</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>M</b></span><span class="main">⋅</span><span class="keyword1"><span class="hidden">❙</span><b>L</b></span><span class="main"><span class="hidden">⇧</span><sup>-</sup>⇧</span><span class="numeral">3</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>L</b></span><span class="main">⋅</span><span class="keyword1"><span class="hidden">❙</span><b>M</b></span><span class="main">⋅</span><span class="keyword1"><span class="hidden">❙</span><b>T</b></span><span class="main"><span class="hidden">⇧</span><sup>-</sup>⇧</span><span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>L</b></span><span class="main">⋅</span><span class="keyword1"><span class="hidden">❙</span><b>M</b></span><span class="main">⋅</span><span class="keyword1"><span class="hidden">❙</span><b>T</b></span><span class="main"><span class="hidden">⇧</span><sup>-</sup>⇧</span><span class="numeral">2</span> <span class="main">=</span> mk_dimvec <span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">si_def</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Dimension Type Expressions ›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ Classification ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We provide a syntax for dimension type expressions, which allows representation of 
  dimensions as types in Isabelle. This will allow us to represent quantities that are parametrised 
  by a particular dimension type. We first must characterise the subclass of types that represent a 
  dimension.

  The mechanism in Isabelle to characterize a certain subclass of Isabelle type expressions
  are <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹type classes›</span></span>. The following type class is used to link particular Isabelle types
  to an instance of the type <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹Dimension›</span></span></span></span>. It requires that any such type has the cardinality
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">1</span></span>›</span></span></span></span>, since a dimension type is used only to mark a quantity.
  ›</span></span>

<span class="keyword1"><span class="command">class</span></span> dim_type <span class="main">=</span> unitary <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free"><span class="free"><span class="free">dim_ty_sem</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> itself <span class="main">⇒</span> Dimension"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_QD"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">QD'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">QD(</span><span class="tfree"><span class="free">'a</span></span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> dim_ty_sem <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree"><span class="free">'a</span></span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The notation <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="keyword1">QD(</span></span><span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">::</span></span>dim_type<span class="main"><span class="main">)</span></span>›</span></span></span></span> allows to obtain the dimension of a dimension type
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'a</span></span>›</span></span></span></span>. 

  The subset of basic dimension types can be characterized by the following type class: ›</span></span>

<span class="keyword1"><span class="command">class</span></span> basedim_type <span class="main">=</span> dim_type <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_BaseDim<span class="main">:</span> <span class="quoted"><span class="quoted">"is_BaseDim <span class="keyword1">QD(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ Base Dimension Type Expressions ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The definition of the basic dimension type constructors is straightforward via a
  one-elementary set, <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹unit set›</span></span></span></span>. The latter is adequate since we need just an abstract syntax 
  for type expressions, so just one value for the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹dimension›</span></span></span></span>-type symbols. We define types for
  each of the seven base dimensions, and also for dimensionless quantities. ›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> Length      <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_Length
<span class="keyword1"><span class="command">typedef</span></span> Mass        <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_Mass
<span class="keyword1"><span class="command">typedef</span></span> Time        <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_Time
<span class="keyword1"><span class="command">typedef</span></span> Current     <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_Current
<span class="keyword1"><span class="command">typedef</span></span> Temperature <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_Temperature
<span class="keyword1"><span class="command">typedef</span></span> Amount      <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_Amount
<span class="keyword1"><span class="command">typedef</span></span> Intensity   <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_Intensity
<span class="keyword1"><span class="command">typedef</span></span> NoDimension <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_NoDimension

<span class="keyword1"><span class="command">type_synonym</span></span> M <span class="main">=</span> <span class="quoted">Mass</span>
<span class="keyword1"><span class="command">type_synonym</span></span> L <span class="main">=</span> <span class="quoted">Length</span>
<span class="keyword1"><span class="command">type_synonym</span></span> T <span class="main">=</span> <span class="quoted">Time</span>
<span class="keyword1"><span class="command">type_synonym</span></span> I <span class="main">=</span> <span class="quoted">Current</span>
<span class="keyword1"><span class="command">type_synonym</span></span> Θ <span class="main">=</span> <span class="quoted">Temperature</span>
<span class="keyword1"><span class="command">type_synonym</span></span> N <span class="main">=</span> <span class="quoted">Amount</span>
<span class="keyword1"><span class="command">type_synonym</span></span> J <span class="main">=</span> <span class="quoted">Intensity</span>
<span class="keyword1"><span class="command">type_notation</span></span> NoDimension <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"M"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"Mass"</span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"L"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"Length"</span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"T"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"Time"</span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"I"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"Current"</span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"Θ"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"Temperature"</span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"N"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"Amount"</span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"J"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"Intensity"</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ Next, we embed the base dimensions into the dimension type expressions by instantiating the 
  class <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">class</span><span class="hidden">&gt;</span></span></span>‹basedim_type›</span></span> with each of the base dimension types. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Length <span class="main">::</span> <span class="quoted">basedim_type</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">dim_ty_sem_Length</span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">::</span>Length itself<span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="hidden">❙</span><b>L</b></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_ty_sem_Length_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Mass <span class="main">::</span> <span class="quoted">basedim_type</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">dim_ty_sem_Mass</span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">::</span>Mass itself<span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="hidden">❙</span><b>M</b></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_ty_sem_Mass_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Time <span class="main">::</span> <span class="quoted">basedim_type</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">dim_ty_sem_Time</span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">::</span>Time itself<span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="hidden">❙</span><b>T</b></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_ty_sem_Time_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Current <span class="main">::</span> <span class="quoted">basedim_type</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">dim_ty_sem_Current</span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">::</span>Current itself<span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="hidden">❙</span><b>I</b></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_ty_sem_Current_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Temperature <span class="main">::</span> <span class="quoted">basedim_type</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">dim_ty_sem_Temperature</span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">::</span>Temperature itself<span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="hidden">❙</span><b>Θ</b></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_ty_sem_Temperature_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Amount <span class="main">::</span> <span class="quoted">basedim_type</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">dim_ty_sem_Amount</span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">::</span>Amount itself<span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="hidden">❙</span><b>N</b></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_ty_sem_Amount_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>   

<span class="keyword1"><span class="command">instantiation</span></span> Intensity <span class="main">::</span> <span class="quoted">basedim_type</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">dim_ty_sem_Intensity</span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">::</span>Intensity itself<span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="hidden">❙</span><b>J</b></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_ty_sem_Intensity_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> NoDimension <span class="main">::</span> <span class="quoted">dim_type</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">dim_ty_sem_NoDimension</span></span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">::</span>NoDimension itself<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>Dimension<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_ty_sem_NoDimension_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="ISQ_Dimensions-base_dimension_types"><span class="command">lemma</span></span> base_dimension_types <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"is_BaseDim <span class="keyword1">QD(</span>Length<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_BaseDim <span class="keyword1">QD(</span>Mass<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_BaseDim <span class="keyword1">QD(</span>Time<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_BaseDim <span class="keyword1">QD(</span>Current<span class="main">)</span>"</span></span> 
  <span class="quoted"><span class="quoted">"is_BaseDim <span class="keyword1">QD(</span>Temperature<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_BaseDim <span class="keyword1">QD(</span>Amount<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_BaseDim <span class="keyword1">QD(</span>Intensity<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_BaseDim<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ Dimension Type Constructors: Inner Product and Inverse ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ Dimension type expressions can be constructed by multiplication and division of the base
  dimension types above. Consequently, we need to define multiplication and inverse operators
  at the type level as well. On the class of dimension types (in which we have already inserted 
  the base dimension types), the definitions of the type constructors for inner product and inverse is 
  straightforward. ›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="quoted">dim_type</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span><span class="quoted">dim_type</span><span class="main">)</span> DimTimes <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 69<span class="main">)</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_DimTimes

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The type <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">,</span></span><span class="tfree"><span class="tfree">'b</span></span><span class="main"><span class="main">)</span></span> DimTimes›</span></span></span></span> is parameterised by two types, <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'a</span></span>›</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'b</span></span>›</span></span></span></span> that must
  both be elements of the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">class</span><span class="hidden">&gt;</span></span></span>‹dim_type›</span></span> class. As with the base dimensions, it is a unitary type
  as its purpose is to represent dimension type expressions. We instantiate <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">class</span><span class="hidden">&gt;</span></span></span>‹dim_type›</span></span> with
  this type, where the semantics of a product dimension expression is the product of the underlying
  dimensions. This means that multiplication of two dimension types yields a dimension type. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> DimTimes <span class="main">::</span> <span class="main">(</span><span class="quoted">dim_type</span><span class="main">,</span> <span class="quoted">dim_type</span><span class="main">)</span> <span class="quoted">dim_type</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">dim_ty_sem_DimTimes</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⋅</span> <span class="tfree">'b</span><span class="main">)</span> itself <span class="main">⇒</span> Dimension"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dim_ty_sem_DimTimes</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">QD(</span><span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_ty_sem_DimTimes_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Similarly, we define inversion of dimension types and prove that dimension types are 
  closed under this. ›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'a</span> DimInv <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_DimInv
<span class="keyword1"><span class="command">instantiation</span></span> DimInv <span class="main">::</span> <span class="main">(</span><span class="quoted">dim_type</span><span class="main">)</span> <span class="quoted">dim_type</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">dim_ty_sem_DimInv</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">)</span> itself <span class="main">⇒</span> Dimension"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dim_ty_sem_DimInv</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> inverse <span class="keyword1">QD(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_ty_sem_DimInv_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ Dimension Type Syntax ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A division is expressed, as usual, by multiplication with an inverted dimension. ›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> DimDiv <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⋅</span> <span class="main">(</span><span class="tfree">'b</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/</span>"</span> 69<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A number of further type synonyms allow for more compact notation: ›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> DimSquare <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⋅</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>2</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> DimCube <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⋅</span> <span class="tfree">'a</span> <span class="main">⋅</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>3</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> DimQuart <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⋅</span> <span class="tfree">'a</span> <span class="main">⋅</span> <span class="tfree">'a</span> <span class="main">⋅</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>4</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> DimInvSquare <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> DimInvCube <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main"><span class="hidden">⇧</span><sup>3</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>3</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> DimInvQuart <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main"><span class="hidden">⇧</span><sup>4</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>4</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="tfree"><span class="free">'a</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span>"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="main">(</span><span class="tfree"><span class="free">'a</span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span>"</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="tfree"><span class="free">'a</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>3</sup></span>"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="main">(</span><span class="tfree"><span class="free">'a</span></span><span class="main"><span class="hidden">⇧</span><sup>3</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span>"</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="tfree"><span class="free">'a</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>4</sup></span>"</span> <span class="main">&lt;=</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="main">(</span><span class="tfree"><span class="free">'a</span></span><span class="main"><span class="hidden">⇧</span><sup>4</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span>"</span>

<span class="keyword1"><span class="command">print_translation</span></span> <span class="quoted">‹
  <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> DimTimes<span class="antiquote">}</span></span><span class="main">,</span> 
    <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctx</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">[</span><span class="entity">a</span><span class="main">,</span> <span class="entity">b</span><span class="main">]</span> <span class="main">=&gt;</span> 
      <span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span><span class="entity">a</span> <span class="main">=</span> <span class="entity">b</span><span class="main">)</span> 
          <span class="keyword2"><span class="keyword">then</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> DimSquare<span class="antiquote">}</span></span><span class="main">,</span> dummyT<span class="main">)</span> $ <span class="entity">a</span>
          <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">a</span> <span class="keyword2"><span class="keyword">of</span></span>
            Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> DimTimes<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">a1</span> $ <span class="entity">a2</span> <span class="main">=&gt;</span>
              <span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span><span class="entity">a1</span> <span class="main">=</span> <span class="entity">a2</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">a2</span> <span class="main">=</span> <span class="entity">b</span><span class="main">)</span> 
                <span class="keyword2"><span class="keyword">then</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> DimCube<span class="antiquote">}</span></span><span class="main">,</span> dummyT<span class="main">)</span> $ <span class="entity">a1</span> 
                <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">a1</span> <span class="keyword2"><span class="keyword">of</span></span>
                  Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> DimTimes<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">a11</span> $ <span class="entity">a12</span> <span class="main">=&gt;</span>
                    <span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span><span class="entity">a11</span> <span class="main">=</span> <span class="entity">a12</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">a12</span> <span class="main">=</span> <span class="entity">a2</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">a2</span> <span class="main">=</span> <span class="entity">b</span><span class="main">)</span>
                      <span class="keyword2"><span class="keyword">then</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> DimQuart<span class="antiquote">}</span></span><span class="main">,</span> dummyT<span class="main">)</span> $ <span class="entity">a11</span>
                      <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword3"><span class="keyword">raise</span></span> Match <span class="main">|</span>
            <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> Match<span class="main">)</span><span class="main">]</span>
›</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ Derived Dimension Types ›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> Area <span class="main">=</span> <span class="quoted"><span class="quoted">"L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Volume <span class="main">=</span> <span class="quoted"><span class="quoted">"L<span class="main"><span class="hidden">⇧</span><sup>3</sup></span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Acceleration <span class="main">=</span> <span class="quoted"><span class="quoted">"L<span class="main">⋅</span>T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Frequency <span class="main">=</span> <span class="quoted"><span class="quoted">"T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Energy <span class="main">=</span> <span class="quoted"><span class="quoted">"L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">⋅</span>M<span class="main">⋅</span>T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Power <span class="main">=</span> <span class="quoted"><span class="quoted">"L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">⋅</span>M<span class="main">⋅</span>T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>3</sup></span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Force <span class="main">=</span> <span class="quoted"><span class="quoted">"L<span class="main">⋅</span>M<span class="main">⋅</span>T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Pressure <span class="main">=</span> <span class="quoted"><span class="quoted">"L<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">⋅</span>M<span class="main">⋅</span>T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Charge <span class="main">=</span> <span class="quoted"><span class="quoted">"I<span class="main">⋅</span>T"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> PotentialDifference <span class="main">=</span> <span class="quoted"><span class="quoted">"L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">⋅</span>M<span class="main">⋅</span>T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>3</sup></span><span class="main">⋅</span>I<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> Capacitance <span class="main">=</span> <span class="quoted"><span class="quoted">"L<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">⋅</span>M<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">⋅</span>T<span class="main"><span class="hidden">⇧</span><sup>4</sup></span><span class="main">⋅</span>I<span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ ML Functions ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We define ML functions for converting a dimension to an integer vector, and vice-versa.
  These are useful for normalising dimension types. ›</span></span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹ 
<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">DIMENSION_TYPE</span> <span class="main">=</span> 
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> dim_to_typ<span class="main">:</span> int list <span class="main">-&gt;</span> typ
  <span class="keyword1"><span class="keyword">val</span></span> typ_to_dim<span class="main">:</span> typ <span class="main">-&gt;</span> int list
  <span class="keyword1"><span class="keyword">val</span></span> normalise<span class="main">:</span> typ <span class="main">-&gt;</span> typ
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Dimension_Type</span> <span class="main">:</span> <span class="entity">DIMENSION_TYPE</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>
  
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">dims</span> <span class="main">=</span> <span class="main">[</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">L</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">M</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">T</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">I</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">Θ</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">N</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">J</span><span class="antiquote">}</span></span><span class="main">]</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">typ_to_dim</span> <span class="main">(</span>Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> Length<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="inner_numeral">1</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">]</span> <span class="main">|</span>
      <span class="entity">typ_to_dim</span> <span class="main">(</span>Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> Mass<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span> <span class="main">[</span><span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">1</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">]</span> <span class="main">|</span>
      <span class="entity">typ_to_dim</span> <span class="main">(</span>Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> Time<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span> <span class="main">[</span><span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">1</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">]</span> <span class="main">|</span>
      <span class="entity">typ_to_dim</span> <span class="main">(</span>Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> Current<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span> <span class="main">[</span><span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">1</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">]</span> <span class="main">|</span>
      <span class="entity">typ_to_dim</span> <span class="main">(</span>Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> Temperature<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span> <span class="main">[</span><span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">1</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">]</span> <span class="main">|</span>
      <span class="entity">typ_to_dim</span> <span class="main">(</span>Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> Amount<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span> <span class="main">[</span><span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">1</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">]</span> <span class="main">|</span>
      <span class="entity">typ_to_dim</span> <span class="main">(</span>Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> Intensity<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span> <span class="main">[</span><span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">1</span><span class="main">]</span> <span class="main">|</span>
      <span class="entity">typ_to_dim</span> <span class="main">(</span>Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> NoDimension<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>   <span class="main">=</span> <span class="main">[</span><span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">]</span> <span class="main">|</span>
      <span class="entity">typ_to_dim</span> <span class="main">(</span>Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> DimInv<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="entity">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="inner_numeral">0</span> - <span class="entity">x</span><span class="main">)</span> <span class="main">(</span><span class="entity">typ_to_dim</span> <span class="entity">x</span><span class="main">)</span> <span class="main">|</span>
      <span class="entity">typ_to_dim</span> <span class="main">(</span>Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> DimTimes<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="entity">x</span><span class="main">,</span> <span class="entity">y</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">y</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">x</span> + <span class="entity">y</span><span class="main">)</span> <span class="main">(</span>ListPair.zip <span class="main">(</span><span class="entity">typ_to_dim</span> <span class="entity">x</span><span class="main">,</span> <span class="entity">typ_to_dim</span> <span class="entity">y</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span>
      <span class="entity">typ_to_dim</span> <span class="main">_</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> Match<span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">DimPow</span> <span class="inner_numeral">0</span> <span class="main">_</span> <span class="main">=</span> Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> NoDimension<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="main">|</span>
      <span class="entity">DimPow</span> <span class="inner_numeral">1</span> <span class="entity">t</span> <span class="main">=</span> <span class="entity">t</span> <span class="main">|</span>
      <span class="entity">DimPow</span> <span class="entity">n</span> <span class="entity">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span><span class="entity">n</span> &gt; <span class="inner_numeral">0</span><span class="main">)</span> <span class="keyword2"><span class="keyword">then</span></span> Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> DimTimes<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="entity">DimPow</span> <span class="main">(</span><span class="entity">n</span> - <span class="inner_numeral">1</span><span class="main">)</span> <span class="entity">t</span><span class="main">,</span> <span class="entity">t</span><span class="main">]</span><span class="main">)</span> 
                               <span class="keyword2"><span class="keyword">else</span></span> Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> DimInv<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="entity">DimPow</span> <span class="main">(</span><span class="inner_numeral">0</span> - <span class="entity">n</span><span class="main">)</span> <span class="entity">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">dim_to_typ</span> <span class="entity">ds</span> <span class="main">=</span> 
    <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">dts</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">n</span><span class="main">,</span> <span class="entity">d</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">DimPow</span> <span class="entity">n</span> <span class="entity">d</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">n</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">n</span> &lt;&gt; <span class="inner_numeral">0</span><span class="main">)</span> <span class="main">(</span>ListPair.zip <span class="main">(</span><span class="entity">ds</span><span class="main">,</span> <span class="entity">dims</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">in</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span><span class="entity">dts</span> <span class="main">=</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">NoDimension</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">else</span></span>
          foldl1 <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">y</span><span class="main">)</span> <span class="main">=&gt;</span> Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> DimTimes<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="entity">x</span><span class="main">,</span> <span class="entity">y</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="entity">dts</span> 
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">normalise</span> <span class="main">=</span> <span class="entity">dim_to_typ</span> o <span class="entity">typ_to_dim</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="entity">Dimension_Type.typ_to_dim</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"L<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">⋅</span>M<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">⋅</span>T<span class="main"><span class="hidden">⇧</span><sup>4</sup></span><span class="main">⋅</span>I<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">⋅</span>M"</span><span class="antiquote">}</span></span><span class="main">;</span>
<span class="entity">Dimension_Type.normalise</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"L<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">⋅</span>M<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">⋅</span>T<span class="main"><span class="hidden">⇧</span><sup>4</sup></span><span class="main">⋅</span>I<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">⋅</span>M"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="ISQ_Quantities">
<div class="head">
<h1>Theory ISQ_Quantities</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Quantities ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ISQ_Quantities
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#ISQ_Dimensions">ISQ_Dimensions</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Quantity Semantic Domain ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Here, we give a semantic domain for particular values of physical quantities. A quantity 
  is usually expressed as a number and a measurement unit, and the goal is to support this. First,
  though, we give a more general semantic domain where a quantity has a magnitude and a dimension. ›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span><span class="quoted">enum</span><span class="main">)</span> Quantity <span class="main">=</span>
  mag  <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>                 <span class="comment1">― ‹ Magnitude of the quantity. ›</span>
  dim  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int<span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> dimvec"</span></span> <span class="comment1">― ‹ Dimension of the quantity -- denotes the kind of quantity. ›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The quantity type is parametric as we permit the magnitude to be represented using any kind
  of numeric type, such as <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹int›</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹rat›</span></span></span></span>, or <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹real›</span></span></span></span>, though we usually minimally expect
  a field. ›</span></span>

<span class="keyword1" id="ISQ_Quantities-Quantity_eq_intro"><span class="command">lemma</span></span> Quantity_eq_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mag <span class="free">x</span> <span class="main">=</span> mag <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"dim <span class="free">x</span> <span class="main">=</span> dim <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"more <span class="free">x</span> <span class="main">=</span> more <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms eq_unit<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can define several arithmetic operators on quantities. Multiplication takes multiplies
  both the magnitudes and the dimensions. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Quantity_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">times</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">,</span> <span class="quoted">times</span><span class="main">)</span> <span class="quoted">times</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">times_Quantity_ext</span></span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme"</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span>  <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">times_Quantity_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">⦇</span> mag <span class="main">=</span> mag <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> mag <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> dim <span class="main">=</span> dim <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> dim <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> 
                                                 <span class="main">…</span> <span class="main">=</span> more <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> more <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="ISQ_Quantities-mag_times"><span class="command">lemma</span></span> mag_times  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mag <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> mag <span class="free">x</span> <span class="main">⋅</span> mag <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_Quantity_ext_def<span class="main">)</span>
<span class="keyword1" id="ISQ_Quantities-dim_times"><span class="command">lemma</span></span> dim_times  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> dim <span class="free">x</span> <span class="main">⋅</span> dim <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_Quantity_ext_def<span class="main">)</span>
<span class="keyword1" id="ISQ_Quantities-more_times"><span class="command">lemma</span></span> more_times <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"more <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> more <span class="free">x</span> <span class="main">⋅</span> more <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_Quantity_ext_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The zero and one quantities are both dimensionless quantities with magnitude of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">0</span></span>›</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">1</span></span>›</span></span></span></span>, respectively. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Quantity_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">zero</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">,</span> <span class="quoted">zero</span><span class="main">)</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">zero_Quantity_ext</span></span> <span class="main">=</span> <span class="main">⦇</span> mag <span class="main">=</span> <span class="main">0</span><span class="main">,</span> dim <span class="main">=</span> <span class="main">1</span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="ISQ_Quantities-mag_zero"><span class="command">lemma</span></span> mag_zero  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"mag <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Quantity_ext_def<span class="main">)</span>
<span class="keyword1" id="ISQ_Quantities-dim_zero"><span class="command">lemma</span></span> dim_zero  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"dim <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Quantity_ext_def<span class="main">)</span>
<span class="keyword1" id="ISQ_Quantities-more_zero"><span class="command">lemma</span></span> more_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"more <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_Quantity_ext_def<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> Quantity_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">one</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">,</span> <span class="quoted">one</span><span class="main">)</span> <span class="quoted">one</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span>    <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">one_Quantity_ext</span></span> <span class="main">=</span> <span class="main">⦇</span> mag <span class="main">=</span> <span class="main">1</span><span class="main">,</span> dim <span class="main">=</span> <span class="main">1</span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="ISQ_Quantities-mag_one"><span class="command">lemma</span></span> mag_one  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mag <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Quantity_ext_def<span class="main">)</span>
<span class="keyword1" id="ISQ_Quantities-dim_one"><span class="command">lemma</span></span> dim_one  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Quantity_ext_def<span class="main">)</span>
<span class="keyword1" id="ISQ_Quantities-more_one"><span class="command">lemma</span></span> more_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"more <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_Quantity_ext_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Quantity inversion inverts both the magnitude and the dimension. Similarly, division of
  one quantity by another, divides both the magnitudes and the dimensions. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Quantity_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">inverse</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">,</span> <span class="quoted">inverse</span><span class="main">)</span> <span class="quoted">inverse</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">inverse_Quantity_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">inverse_Quantity_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⦇</span> mag <span class="main">=</span> inverse <span class="main">(</span>mag <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">,</span> dim <span class="main">=</span> inverse <span class="main">(</span>dim <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> inverse <span class="main">(</span>more <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">divide_Quantity_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">divide_Quantity_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">⦇</span> mag <span class="main">=</span> mag <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">/</span> mag <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> dim <span class="main">=</span> dim <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">/</span> dim <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> more <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">/</span> more <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="ISQ_Quantities-mag_inverse"><span class="command">lemma</span></span> mag_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mag <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>mag <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_Quantity_ext_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Quantities-dim_inverse"><span class="command">lemma</span></span> dim_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>dim <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_Quantity_ext_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Quantities-more_inverse"><span class="command">lemma</span></span> more_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"more <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>more <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_Quantity_ext_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Quantities-mag_divide"><span class="command">lemma</span></span> mag_divide <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mag <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> mag <span class="free">x</span> <span class="main">/</span> mag <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_Quantity_ext_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Quantities-dim_divide"><span class="command">lemma</span></span> dim_divide <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> dim <span class="free">x</span> <span class="main">/</span> dim <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_Quantity_ext_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Quantities-more_divide"><span class="command">lemma</span></span> more_divide <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"more <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> more <span class="free">x</span> <span class="main">/</span> more <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_Quantity_ext_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ As for dimensions, quantities form a commutative monoid and an abelian group. ›</span></span>

<span class="keyword1"><span class="command">instance</span></span> Quantity_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_monoid_mult</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">,</span> <span class="quoted">comm_monoid_mult</span><span class="main">)</span> <span class="quoted">comm_monoid_mult</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_unit one_Quantity_ext_def times_Quantity_ext_def mult.assoc
     <span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> Quantity_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">ab_group_mult</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">,</span> <span class="quoted">ab_group_mult</span><span class="main">)</span> <span class="quoted">ab_group_mult</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Quantity_eq_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_unit<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can also define a partial order on quantities. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Quantity_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">ord</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">,</span> <span class="quoted">ord</span><span class="main">)</span> <span class="quoted">ord</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_eq_Quantity_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_Quantity_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span>mag <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> mag <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> dim <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> dim <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> more <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> more <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_Quantity_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_Quantity_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> Quantity_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">order</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">,</span> <span class="quoted">order</span><span class="main">)</span> <span class="quoted">order</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_Quantity_ext_def less_eq_Quantity_ext_def eq_unit<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can define plus and minus as well, but these are partial operators as they are defined
  only when the quantities have the same dimension. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Quantity_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">plus</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">,</span> <span class="quoted">plus</span><span class="main">)</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">plus_Quantity_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme"</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"dim <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> dim <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟹</span> 
     <span class="free">plus_Quantity_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">⦇</span> mag <span class="main">=</span> mag <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> mag <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> dim <span class="main">=</span> dim <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> more <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> more <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Quantity_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">uminus</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">,</span> <span class="quoted">uminus</span><span class="main">)</span> <span class="quoted">uminus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">uminus_Quantity_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_Quantity_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⦇</span> mag <span class="main">=</span> <span class="main">-</span> mag <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">,</span> dim <span class="main">=</span> dim <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> <span class="main">-</span> more <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Quantity_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">minus</span><span class="main">,</span> <span class="quoted">enum</span><span class="main">,</span> <span class="quoted">minus</span><span class="main">)</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">minus_Quantity_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> Quantity_scheme"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"dim <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> dim <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟹</span> 
      <span class="free">minus_Quantity_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">⦇</span> mag <span class="main">=</span> mag <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> mag <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> dim <span class="main">=</span> dim <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> more <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> more <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Measurement Systems ›</span></span>

<span class="keyword1"><span class="command">class</span></span> unit_system <span class="main">=</span> unitary

<span class="keyword1" id="ISQ_Quantities-unit_system_intro"><span class="command">lemma</span></span> unit_system_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'s</span> set<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⟹</span> <span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'s</span><span class="main">,</span> unit_system_class<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_system_class_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> unitary_intro<span class="main">)</span>

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span><span class="quoted">enum</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span><span class="quoted">unit_system</span><span class="main">)</span> Measurement_System <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span>enum<span class="main">)</span> Quantity"</span></span> <span class="main">+</span>
  unit_sys  <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'s</span></span></span> <span class="comment1">― ‹ The system of units being employed ›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mmore</span> <span class="main">=</span> Record.iso_tuple_snd Measurement_System_ext_Tuple_Iso"</span></span>

<span class="keyword1" id="ISQ_Quantities-mmore"><span class="command">lemma</span></span> mmore <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mmore <span class="main">⦇</span> unit_sys <span class="main">=</span> <span class="free">x</span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⦈</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Measurement_System.ext_inject Measurement_System.ext_surjective comp_id mmore_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Quantities-mmore_ext"><span class="command">lemma</span></span> mmore_ext <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>unit_sys <span class="main">=</span> unit<span class="main">,</span> <span class="main">…</span> <span class="main">=</span> mmore <span class="free">a</span><span class="main">⦈</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> b<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Measurement_System_ext_def mmore_def Measurement_System_ext_Tuple_Iso_def Record.iso_tuple_snd_def Record.iso_tuple_cons_def Abs_Measurement_System_ext_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x y z<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"unit <span class="main">=</span> <span class="improper">y</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_unit<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="ISQ_Quantities-Measurement_System_eq_intro"><span class="command">lemma</span></span> Measurement_System_eq_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mag <span class="free">x</span> <span class="main">=</span> mag <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"dim <span class="free">x</span> <span class="main">=</span> dim <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"more <span class="free">x</span> <span class="main">=</span> more <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Quantity_eq_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> Measurement_System.surjective Quantity.select_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mmore mmore_ext<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> Measurement_System_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="quoted"><span class="quoted">"zero"</span></span><span class="main">)</span> <span class="quoted"><span class="quoted">"zero"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">zero_Measurement_System_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext"</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span>  <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zero_Measurement_System_ext</span> <span class="main">=</span> <span class="main">⦇</span> unit_sys <span class="main">=</span> unit<span class="main">,</span> <span class="main">…</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Measurement_System_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="quoted"><span class="quoted">"one"</span></span><span class="main">)</span> <span class="quoted"><span class="quoted">"one"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_Measurement_System_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span>  <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">one_Measurement_System_ext</span> <span class="main">=</span> <span class="main">⦇</span> unit_sys <span class="main">=</span> unit<span class="main">,</span> <span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Measurement_System_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="quoted">times</span><span class="main">)</span> <span class="quoted">times</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">times_Measurement_System_ext</span></span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext"</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span>  <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">times_Measurement_System_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">⦇</span> unit_sys <span class="main">=</span> unit<span class="main">,</span> <span class="main">…</span> <span class="main">=</span> mmore <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> mmore <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Measurement_System_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="quoted">inverse</span><span class="main">)</span> <span class="quoted">inverse</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">inverse_Measurement_System_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">inverse_Measurement_System_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⦇</span> unit_sys <span class="main">=</span> unit<span class="main">,</span> <span class="main">…</span> <span class="main">=</span> inverse <span class="main">(</span>mmore <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">divide_Measurement_System_ext</span></span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">divide_Measurement_System_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">⦇</span> unit_sys <span class="main">=</span> unit<span class="main">,</span> <span class="main">…</span> <span class="main">=</span> mmore <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">/</span> mmore <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> Measurement_System_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="quoted">comm_monoid_mult</span><span class="main">)</span> <span class="quoted">comm_monoid_mult</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_unit one_Measurement_System_ext_def times_Measurement_System_ext_def mult.assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> Measurement_System_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="quoted">ab_group_mult</span><span class="main">)</span> <span class="quoted">ab_group_mult</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">si_def</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> Measurement_System_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="quoted">ord</span><span class="main">)</span> <span class="quoted">ord</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_eq_Measurement_System_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_Measurement_System_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span>mmore <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> mmore <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_Measurement_System_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_Measurement_System_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> Measurement_System_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="quoted">order</span><span class="main">)</span> <span class="quoted">order</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_Measurement_System_ext_def less_Measurement_System_ext_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> mmore_ext<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> Measurement_System_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="quoted">plus</span><span class="main">)</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">plus_Measurement_System_ext</span></span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext"</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">plus_Measurement_System_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">⦇</span> unit_sys <span class="main">=</span> unit<span class="main">,</span> <span class="main">…</span> <span class="main">=</span> mmore <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> mmore <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Measurement_System_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="quoted">uminus</span><span class="main">)</span> <span class="quoted">uminus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">uminus_Measurement_System_ext</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_Measurement_System_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⦇</span> unit_sys <span class="main">=</span> unit<span class="main">,</span> <span class="main">…</span> <span class="main">=</span> <span class="main">-</span> mmore <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> Measurement_System_ext <span class="main">::</span> <span class="main">(</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="quoted">minus</span><span class="main">)</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">minus_Measurement_System_ext</span></span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Measurement_System_ext"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">minus_Measurement_System_ext</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">⦇</span> unit_sys <span class="main">=</span> unit<span class="main">,</span> <span class="main">…</span> <span class="main">=</span> mmore <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> mmore <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Dimension Typed Quantities ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can now define the type of quantities with parametrised dimension types. ›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span><span class="quoted">dim_type</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span><span class="quoted">unit_system</span><span class="main">)</span> QuantT <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">,</span> _<span class="keyword1">]</span>"</span> <span class="main">[</span>999<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 999<span class="main">)</span> 
                     <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> sdim<span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> Measurement_System<span class="main">.</span> dim <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'d</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">morphisms</span></span> fromQ toQ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> mag <span class="main">=</span> undefined<span class="main">,</span> dim <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'d</span><span class="main">)</span><span class="main">,</span> unit_sys <span class="main">=</span> unit <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_QuantT

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A dimension typed quantity is parameterised by two types: <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'a</span></span>›</span></span></span></span>, the numeric type for the
  magntitude, and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'d</span></span>›</span></span></span></span> for the dimension expression, which is an element of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">class</span><span class="hidden">&gt;</span></span></span>‹dim_type›</span></span>. 
  The type <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'n</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'d</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'s</span></span><span class="main"><span class="main">)</span></span> QuantT›</span></span></span></span> is to <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'n</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'d</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'s</span></span><span class="main"><span class="main">)</span></span> Measurement_System›</span></span></span></span> as dimension types 
  are to <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹Dimension›</span></span></span></span>. Specifically, an element of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'n'</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'d</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'s</span></span><span class="main"><span class="main">)</span></span> QuantT›</span></span></span></span> is a quantity whose 
  dimension is <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'d</span></span>›</span></span></span></span>.

  Intuitively, the formula <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">::</span></span> <span class="tfree"><span class="tfree">'n</span></span><span class="main"><span class="main">[</span></span><span class="tfree"><span class="tfree">'d</span></span><span class="main"><span class="main">,</span></span> <span class="tfree"><span class="tfree">'s</span></span><span class="main"><span class="main">]</span></span>›</span></span></span></span> can be read as ``$x$ is a quantity of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'d</span></span>›</span></span></span></span>'',
  for example it might be a quantity of length, or a quantity of mass. ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Since quantities can have dimension type expressions that are distinct, but denote the same
  dimension, it is necessary to define the following function for coercion between two dimension
  expressions. This requires that the underlying dimensions are the same. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">coerceQuantT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span> itself <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="free">coerceQuantT</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>toQ <span class="main">(</span>fromQ <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_QCOERCE"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> logic <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">QCOERCE[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">QCOERCE[</span><span class="tfree"><span class="free">'t</span></span><span class="main">]</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> coerceQuantT <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree"><span class="free">'t</span></span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Predicates on Typed Quantities ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The standard HOL order <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(≤)</span></span>›</span></span></span></span> and equality <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(=)</span></span>›</span></span></span></span> have the homogeneous type
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">⇒</span></span> <span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">⇒</span></span> bool›</span></span></span></span> and so they cannot compare values of different types. Consequently,
  we define a heterogeneous order and equivalence on typed quantities. ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> qless_eq <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'n</span><span class="main">::</span>order<span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'n</span><span class="main">[</span><span class="tfree">'b</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≲<span class="hidden">⇩</span><sub>Q</sub></span>"</span> 50<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> qequiv <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'n</span><span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'n</span><span class="main">[</span><span class="tfree">'b</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span>"</span> 50<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(=)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ These are both fundamentally the same as the usual order and equality relations, but they
  permit potentially different dimension types, <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'a</span></span>›</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'b</span></span>›</span></span></span></span>. Two typed quantities are
  comparable only when the two dimension types have the same semantic dimension.
›</span></span>

<span class="keyword1" id="ISQ_Quantities-qequiv_refl"><span class="command">lemma</span></span> qequiv_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qequiv_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Quantities-qequiv_sym"><span class="command">lemma</span></span> qequiv_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">b</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qequiv_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Quantities-qequiv_trans"><span class="command">lemma</span></span> qequiv_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">b</span><span class="main">;</span> <span class="free">b</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qequiv_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> qeq_iff_same_dim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Quantities-coerceQuant_eq_iff"><span class="command">lemma</span></span> coerceQuant_eq_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>dim_type<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>coerceQuantT <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> qequiv.rep_eq assms coerceQuantT_def toQ_cases toQ_inverse<span class="main">)</span>

<span class="keyword1" id="ISQ_Quantities-coerceQuant_eq_iff2"><span class="command">lemma</span></span> coerceQuant_eq_iff2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>dim_type<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span>coerceQuantT <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> qequiv_sym assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> coerceQuant_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 
<span class="keyword1" id="ISQ_Quantities-updown_eq_iff"><span class="command">lemma</span></span> updown_eq_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>dim_type<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span>toQ <span class="main">(</span>fromQ <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> coerceQuant_eq_iff2 coerceQuantT_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is more general that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y = x ⟹ x ≅<span class="hidden">⇩</span><sub>Q</sub> y›</span></span></span></span>, since x and y may have different type.›</span></span>

<span class="keyword1" id="ISQ_Quantities-qeq"><span class="command">lemma</span></span> qeq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> qequiv.rep_eq assms fromQ mem_Collect_eq<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Operators on Typed Quantities ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We define several operators on typed quantities. These variously compose the dimension types
  as well. Multiplication composes the two dimension types. Inverse constructs and inverted 
  dimension type. Division is defined in terms of multiplication and inverse. ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> 
  qtimes <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>comm_ring_1<span class="main">)</span><span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'n</span><span class="main">[</span><span class="tfree">'b</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'n</span><span class="main">[</span><span class="tfree">'a</span> <span class="main">⋅</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⋅</b></span>"</span> 69<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dim_ty_sem_DimTimes_def times_Quantity_ext_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> 
  qinverse <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>field<span class="main">)</span><span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'n</span><span class="main">[</span><span class="tfree">'a</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"inverse"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_Quantity_ext_def dim_ty_sem_DimInv_def<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span>
  <span class="entity">qdivide</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>field<span class="main">)</span><span class="main">[</span><span class="tfree">'a</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'n</span><span class="main">[</span><span class="tfree">'b</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'n</span><span class="main">[</span><span class="tfree">'a</span><span class="main">/</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>'</b>/</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qdivide</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We also provide some helpful notations for expressing heterogeneous powers. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">qsq</span>         <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span>  <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>𝟮</sup></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="hidden">❙</span><b>⋅</b></span><span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">qcube</span>       <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>𝟯</sup></span>"</span>  <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>𝟯</sup></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="hidden">❙</span><b>⋅</b></span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="hidden">❙</span><b>⋅</b></span><span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">qquart</span>      <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>𝟰</sup></span>"</span>  <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>𝟰</sup></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="hidden">❙</span><b>⋅</b></span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="hidden">❙</span><b>⋅</b></span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="hidden">❙</span><b>⋅</b></span><span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">qneq_sq</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">qneq_cube</span>   <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟯</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟯</sup></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="hidden">⇧</span><sup>𝟯</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">qneq_quart</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟰</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟰</sup></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="hidden">⇧</span><sup>𝟯</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Analogous to the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span>‹scaleR›</span></span> operator for vectors, we define the following scalar
  multiplication that scales an existing quantity by a numeric value. This operator is
  especially important for the representation of quantity values, which consist of a numeric
  value and a unit. ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> scaleQ <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">[</span><span class="tfree">'d</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span>"</span> 63<span class="main">)</span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">r</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⦇</span> mag <span class="main">=</span> <span class="bound">r</span> <span class="main">*</span> mag <span class="bound">x</span><span class="main">,</span> dim <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'d</span><span class="main">)</span><span class="main">,</span> unit_sys <span class="main">=</span> unit <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Finally, we instantiate the arithmetic types classes where possible. We do not instantiate
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">class</span><span class="hidden">&gt;</span></span></span>‹times›</span></span> because this results in a nonsensical homogeneous product on quantities. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">zero</span><span class="main">,</span> <span class="quoted">dim_type</span><span class="main">,</span> <span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">zero_QuantT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> QuantT"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span> mag <span class="main">=</span> <span class="main">0</span><span class="main">,</span> dim <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">,</span> unit_sys <span class="main">=</span> unit <span class="main">⦈</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">one</span><span class="main">,</span> <span class="quoted">dim_type</span><span class="main">,</span> <span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">one</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">one_QuantT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> QuantT"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span> mag <span class="main">=</span> <span class="main">1</span><span class="main">,</span> dim <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">,</span> unit_sys <span class="main">=</span> unit <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following specialised one element has both magnitude and dimension 1: it is a 
  dimensionless quantity. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">qone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'n</span><span class="main">::</span>one<span class="main">[</span><span class="main">𝟭</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">qone</span> <span class="main">≡</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Unlike for semantic quantities, the plus operator on typed quantities is total, since the
  type system ensures that the dimensions (and the dimension types) must be the same. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">plus</span><span class="main">,</span> <span class="quoted">dim_type</span><span class="main">,</span> <span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">plus_QuantT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⦇</span> mag <span class="main">=</span> mag <span class="bound">x</span> <span class="main">+</span> mag <span class="bound">y</span><span class="main">,</span> dim <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">,</span> unit_sys <span class="main">=</span> unit <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can also show that typed quantities are commutative <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹additive›</span></span> monoids. Indeed, addition
  is a much easier operator to deal with in typed quantities, unlike product. ›</span></span>

<span class="keyword1"><span class="command">instance</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">semigroup_add</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">semigroup_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">ab_semigroup_add</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">ab_semigroup_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_add</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">monoid_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_unit<span class="main">)</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">instance</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_monoid_add</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">comm_monoid_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">uminus</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">uminus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_QuantT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⦇</span> mag <span class="main">=</span> <span class="main">-</span> mag <span class="bound">x</span><span class="main">,</span> dim <span class="main">=</span> dim <span class="bound">x</span><span class="main">,</span> unit_sys <span class="main">=</span> unit <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">minus</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">minus_QuantT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⦇</span> mag <span class="main">=</span> mag <span class="bound">x</span> <span class="main">-</span> mag <span class="bound">y</span><span class="main">,</span> dim <span class="main">=</span> dim <span class="bound">x</span><span class="main">,</span> unit_sys <span class="main">=</span> unit <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">numeral</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">numeral</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Moreover, types quantities also form an additive group. ›</span></span>

<span class="keyword1"><span class="command">instance</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">ab_group_add</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">ab_group_add</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Typed quantities helpfully can be both partially and a linearly ordered. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">order</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_QuantT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> mag <span class="bound">x</span> <span class="main">≤</span> mag <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_QuantT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> mag <span class="bound">x</span> <span class="main">&lt;</span> mag <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_eq less_le_not_le Measurement_System_eq_intro<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">linorder</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">linorder</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">scaleR</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">scaleR</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">scaleR_QuantT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="bound">q</span><span class="main">.</span> <span class="main">⦇</span> mag <span class="main">=</span> <span class="bound">n</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> mag <span class="bound">q</span><span class="main">,</span> dim <span class="main">=</span> dim <span class="bound">q</span><span class="main">,</span> unit_sys <span class="main">=</span> unit <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">real_vector</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">real_vector</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_unit scaleR_add_left scaleR_add_right<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">norm</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">norm</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">norm_QuantT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> real"</span></span> 
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span>mag <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">sgn_div_norm</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">sgn_div_norm</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">sgn_QuantT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sgn_QuantT</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> norm <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_QuantT_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">dist_norm</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">dist_norm</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">dist_QuantT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">dist_QuantT</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> norm <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_QuantT_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>uniformity_dist<span class="main">,</span>dist_norm<span class="main">}</span>"</span></span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">uniformity_dist</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">uniformity_QuantT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span><span class="main">)</span> filter"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">uniformity_QuantT</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">&lt;..}</span><span class="main">.</span> principal <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uniformity_QuantT_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>dist_norm<span class="main">,</span>open_uniformity<span class="main">,</span>uniformity_dist<span class="main">}</span>"</span></span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> 
                        <span class="quoted">open_uniformity</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">open_QuantT</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">[</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">]</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">open_QuantT</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> uniformity<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> open_QuantT_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Quantities form a real normed vector space. ›</span></span>

<span class="keyword1"><span class="command">instance</span></span> QuantT <span class="main">::</span> <span class="main">(</span><span class="quoted">real_normed_vector</span><span class="main">,</span><span class="quoted">dim_type</span><span class="main">,</span><span class="quoted">unit_system</span><span class="main">)</span> <span class="quoted">real_normed_vector</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_unit norm_triangle_ineq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="ISQ_Proof">
<div class="head">
<h1>Theory ISQ_Proof</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Proof Support for Quantities ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ISQ_Proof
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#ISQ_Quantities">ISQ_Quantities</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> si_transfer

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">magQ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'u</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟦</span>_<span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">magQ</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> mag <span class="main">(</span>fromQ <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dimQ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'u</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span> <span class="main">⇒</span> Dimension"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dimQ</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> dim <span class="main">(</span>fromQ <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ISQ_Proof-quant_eq_iff_mag_eq"><span class="command">lemma</span></span> quant_eq_iff_mag_eq <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_unit<span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-quant_eqI"><span class="command">lemma</span></span> quant_eqI <span class="main">[</span><span class="operator">si_transfer</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quant_eq_iff_mag_eq<span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-quant_equiv_iff"><span class="command">lemma</span></span> quant_equiv_iff <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'u<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">∧</span> <span class="keyword1">QD(</span><span class="tfree">'u<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="bound">ta</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">::</span><span class="tfree">'a</span><span class="main">[</span><span class="tfree">'u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="tfree">'s</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">∨</span> mag <span class="main">(</span>fromQ <span class="bound">ta</span><span class="main">)</span> <span class="main">≠</span> mag <span class="main">(</span>fromQ <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def quant_eq_iff_mag_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> qequiv.rep_eq coerceQuant_eq_iff2 qeq magQ_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ISQ_Proof-quant_equivI"><span class="command">lemma</span></span> quant_equivI <span class="main">[</span><span class="operator">si_transfer</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'u<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">QD(</span><span class="tfree">'u<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">QD(</span><span class="tfree">'u<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms quant_equiv_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword1" id="ISQ_Proof-quant_le_iff_magn_le"><span class="command">lemma</span></span> quant_le_iff_magn_le <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">≤</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-quant_leI"><span class="command">lemma</span></span> quant_leI <span class="main">[</span><span class="operator">si_transfer</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">≤</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quant_le_iff_magn_le<span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-quant_less_iff_magn_less"><span class="command">lemma</span></span> quant_less_iff_magn_less <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">&lt;</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-quant_lessI"><span class="command">lemma</span></span> quant_lessI <span class="main">[</span><span class="operator">si_transfer</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">&lt;</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quant_less_iff_magn_less<span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-magQ_zero"><span class="command">lemma</span></span> magQ_zero <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-magQ_one"><span class="command">lemma</span></span> magQ_one <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">1</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-magQ_plus"><span class="command">lemma</span></span> magQ_plus <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">+</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-magQ_minus"><span class="command">lemma</span></span> magQ_minus <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">-</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-magQ_uminus"><span class="command">lemma</span></span> magQ_uminus <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">-</span> <span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">-</span> <span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-magQ_scaleQ"><span class="command">lemma</span></span> magQ_scaleQ <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-magQ_qtimes"><span class="command">lemma</span></span> magQ_qtimes <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">⋅</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-magQ_qinverse"><span class="command">lemma</span></span> magQ_qinverse <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> inverse <span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-magQ_qdivivide"><span class="command">lemma</span></span> magQ_qdivivide <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span><span class="main">[</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">]</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>/</b></span> <span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">⟦</span><span class="free">x</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">/</span> <span class="main">⟦</span><span class="free">y</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> magQ_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> field_class.field_divide_inverse<span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-magQ_numeral"><span class="command">lemma</span></span> magQ_numeral <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>numeral <span class="free">n</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> numeral <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">si_def</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> magQ_def magQ_one<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> magQ_def magQ_plus numeral_code<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> magQ_def magQ_one magQ_plus numeral_code<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="ISQ_Proof-magQ_coerce"><span class="command">lemma</span></span> magQ_coerce <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>dim_type itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'d<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>coerceQuantT <span class="free">t</span> <span class="free">q</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">⟦</span><span class="free">q</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coerceQuantT_def magQ_def assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms qequiv.rep_eq updown_eq_iff<span class="main">)</span>

<span class="keyword1" id="ISQ_Proof-dimQ"><span class="command">lemma</span></span> dimQ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dimQ<span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">QD(</span><span class="tfree">'d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dimQ_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following tactic breaks an SI conjecture down to numeric and unit properties ›</span></span>

<span class="keyword1"><span class="command">method</span></span> si_simp <span class="keyword2"><span class="keyword">uses</span></span> add <span class="main">=</span>
  <span class="main">(</span><span class="operator">rule_tac</span> <span class="dynamic"><span class="dynamic">si_transfer</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">add</span></span> <span class="dynamic"><span class="dynamic">si_eq</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The next tactic additionally compiles the semantics of the underlying units ›</span></span>

<span class="keyword1"><span class="command">method</span></span> si_calc <span class="keyword2"><span class="keyword">uses</span></span> add <span class="main">=</span> 
  <span class="main">(</span><span class="operator">si_simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">add</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">si_def</span></span> <span class="dynamic"><span class="dynamic">add</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">QD(</span>N <span class="main">⋅</span> Θ <span class="main">⋅</span> N<span class="main">)</span> <span class="main">=</span> <span class="keyword1">QD(</span>Θ <span class="main">⋅</span> N<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">si_eq</span></span> <span class="dynamic"><span class="dynamic">si_def</span></span><span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="ISQ_Algebra">
<div class="head">
<h1>Theory ISQ_Algebra</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Algebraic Laws ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ISQ_Algebra
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#ISQ_Proof">ISQ_Proof</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Quantity Scale ›</span></span>

<span class="keyword1" id="ISQ_Algebra-scaleQ_add_right"><span class="command">lemma</span></span> scaleQ_add_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>

<span class="keyword1" id="ISQ_Algebra-scaleQ_add_left"><span class="command">lemma</span></span> scaleQ_add_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>

<span class="keyword1" id="ISQ_Algebra-scaleQ_scaleQ"><span class="command">lemma</span></span> scaleQ_scaleQ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">b</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅</span> <span class="free">b</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_simp</span>

<span class="keyword1" id="ISQ_Algebra-scaleQ_one"><span class="command">lemma</span></span> scaleQ_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_simp</span>

<span class="keyword1" id="ISQ_Algebra-scaleQ_zero"><span class="command">lemma</span></span> scaleQ_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_simp</span>

<span class="keyword1" id="ISQ_Algebra-scaleQ_inv"><span class="command">lemma</span></span> scaleQ_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="ISQ_Algebra-scaleQ_as_qprod"><span class="command">lemma</span></span> scaleQ_as_qprod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">𝟭</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_simp</span>

<span class="keyword1" id="ISQ_Algebra-mult_scaleQ_left"><span class="command">lemma</span></span> mult_scaleQ_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">y</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_simp</span>

<span class="keyword1" id="ISQ_Algebra-mult_scaleQ_right"><span class="command">lemma</span></span> mult_scaleQ_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Field Laws ›</span></span>

<span class="keyword1" id="ISQ_Algebra-qtimes_commute"><span class="command">lemma</span></span> qtimes_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">y</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="ISQ_Algebra-qtimes_assoc"><span class="command">lemma</span></span> qtimes_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">y</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">z</span>  <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span>  <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="main">(</span><span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_calc</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Algebra-qtimes_left_unit"><span class="command">lemma</span></span> qtimes_left_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_calc</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Algebra-qtimes_right_unit"><span class="command">lemma</span></span> qtimes_right_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="main">𝟭</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_calc</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following weak congruences will allow for replacing equivalences in contexts
     built from product and inverse. ›</span></span>

<span class="keyword1" id="ISQ_Algebra-qtimes_weak_cong_left"><span class="command">lemma</span></span> qtimes_weak_cong_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">❙</span><b>⋅</b></span><span class="free">z</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span><span class="main"><span class="hidden">❙</span><b>⋅</b></span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_simp</span>

<span class="keyword1" id="ISQ_Algebra-qtimes_weak_cong_right"><span class="command">lemma</span></span> qtimes_weak_cong_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">❙</span><b>⋅</b></span><span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">z</span><span class="main"><span class="hidden">❙</span><b>⋅</b></span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="ISQ_Algebra-qinverse_weak_cong"><span class="command">lemma</span></span> qinverse_weak_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="ISQ_Algebra-scaleQ_cong"><span class="command">lemma</span></span> scaleQ_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="ISQ_Algebra-qinverse_qinverse"><span class="command">lemma</span></span> qinverse_qinverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="ISQ_Algebra-qinverse_nonzero_iff_nonzero"><span class="command">lemma</span></span> qinverse_nonzero_iff_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">si_calc</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="ISQ_Algebra-qinverse_qtimes"><span class="command">lemma</span></span> qinverse_qtimes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_distrib<span class="main">)</span>

<span class="keyword1" id="ISQ_Algebra-qinverse_qdivide"><span class="command">lemma</span></span> qinverse_qdivide<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>/</b></span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>/</b></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_simp</span>

<span class="keyword1" id="ISQ_Algebra-qtimes_cancel"><span class="command">lemma</span></span> qtimes_cancel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>/</b></span> <span class="free">x</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ISQ_Units">
<div class="head">
<h1>Theory ISQ_Units</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Units ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ISQ_Units
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#ISQ_Proof">ISQ_Proof</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Parallel to the base quantities, there are base units. In the implementation of
  the SI unit system, we fix these to be precisely those quantities that have a base dimension
  and a magnitude of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">1</span></span>›</span></span></span></span>. Consequently, a base unit corresponds to a unit in the algebraic
  sense. ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> is_base_unit <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>one<span class="main">[</span><span class="tfree">'d</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span> <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> mag <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> is_BaseDim <span class="main">(</span>dim <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_base_unit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'u</span> itself <span class="main">⇒</span> <span class="tfree">'s</span> itself <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>one<span class="main">)</span><span class="main">[</span><span class="tfree">'u</span><span class="main">::</span>basedim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mk_base_unit</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_mk_base_unit"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> type <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">BUNIT'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="quoted">"<span class="keyword1">BUNIT(</span><span class="tfree"><span class="free">'a</span></span><span class="main">,</span> <span class="tfree"><span class="free">'s</span></span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> mk_base_unit <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree"><span class="free">'a</span></span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree"><span class="free">'s</span></span><span class="main">)</span>"</span>

<span class="keyword1" id="ISQ_Units-mk_base_unit"><span class="command">lemma</span></span> mk_base_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"is_base_unit <span class="main">(</span>mk_base_unit <span class="free">a</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_base_unit_def <span class="dynamic"><span class="dynamic">si_eq</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_BaseDim<span class="main">)</span>

<span class="keyword1" id="ISQ_Units-magQ_mk"><span class="command">lemma</span></span> magQ_mk <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">BUNIT(</span><span class="tfree">'u</span><span class="main">::</span>basedim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>unit_system<span class="main">)</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_base_unit_def magQ_def <span class="dynamic"><span class="dynamic">si_eq</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="ISQ_Conversion">
<div class="head">
<h1>Theory ISQ_Conversion</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Conversion Between Unit Systems ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ISQ_Conversion
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#ISQ_Units">ISQ_Units</a>
<span class="keyword2"><span class="keyword">begin</span></span>
                                          
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conversion Schemas ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹  A conversion schema provides factors for each of the base units for converting between
  two systems of units. We currently only support conversion between systems that can meaningfully
  characterise a subset of the seven SI dimensions. ›</span></span>

<span class="keyword1"><span class="command">record</span></span> ConvSchema <span class="main">=</span>
  cLengthF      <span class="main">::</span> <span class="quoted">rat</span>
  cMassF        <span class="main">::</span> <span class="quoted">rat</span>
  cTimeF        <span class="main">::</span> <span class="quoted">rat</span>
  cCurrentF     <span class="main">::</span> <span class="quoted">rat</span> 
  cTemperatureF <span class="main">::</span> <span class="quoted">rat</span>
  cAmountF      <span class="main">::</span> <span class="quoted">rat</span>
  cIntensityF   <span class="main">::</span> <span class="quoted">rat</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We require that all the factors of greater than zero. ›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span><span class="quoted">unit_system</span><span class="main">,</span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span><span class="quoted">unit_system</span><span class="main">)</span> Conversion <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>1<span class="main">,</span> 0<span class="main">]</span> 0<span class="main">)</span> <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">c</span> <span class="main">::</span> ConvSchema<span class="main">.</span> cLengthF <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> cMassF <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> cTimeF <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> cCurrentF <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span>
         <span class="main">∧</span> cTemperatureF <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> cAmountF <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> cIntensityF <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> cLengthF <span class="main">=</span> <span class="main">1</span><span class="main">,</span> cMassF <span class="main">=</span> <span class="main">1</span><span class="main">,</span> cTimeF <span class="main">=</span> <span class="main">1</span><span class="main">,</span> cCurrentF <span class="main">=</span> <span class="main">1</span>
                  <span class="main">,</span> cTemperatureF <span class="main">=</span> <span class="main">1</span><span class="main">,</span> cAmountF <span class="main">=</span> <span class="main">1</span><span class="main">,</span> cIntensityF <span class="main">=</span> <span class="main">1</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_Conversion

<span class="keyword1"><span class="command">lift_definition</span></span> LengthF      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>unit_system <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>unit_system<span class="main">)</span> <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">cLengthF</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> MassF        <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>unit_system <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>unit_system<span class="main">)</span> <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">cMassF</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> TimeF        <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>unit_system <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>unit_system<span class="main">)</span> <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">cTimeF</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> CurrentF     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>unit_system <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>unit_system<span class="main">)</span> <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">cCurrentF</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> TemperatureF <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>unit_system <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>unit_system<span class="main">)</span> <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">cTemperatureF</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> AmountF      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>unit_system <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>unit_system<span class="main">)</span> <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">cAmountF</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> IntensityF   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>unit_system <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>unit_system<span class="main">)</span> <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">cIntensityF</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="ISQ_Conversion-Conversion_props"><span class="command">lemma</span></span> Conversion_props <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LengthF <span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"MassF <span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"TimeF <span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"CurrentF <span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"TemperatureF <span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"AmountF <span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"IntensityF <span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conversion Algebra ›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> convid <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">::</span>unit_system <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">id<span class="hidden">⇩</span><sub>C</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"
  <span class="main">⦇</span> cLengthF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cMassF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cTimeF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cCurrentF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cTemperatureF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cAmountF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cIntensityF <span class="main">=</span> <span class="main">1</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> convcomp <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>3</sub></span><span class="main">::</span>unit_system<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>unit_system <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>unit_system<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="main">⦇</span> cLengthF <span class="main">=</span> cLengthF <span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> cLengthF <span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> cMassF <span class="main">=</span> cMassF <span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> cMassF <span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span>
         <span class="main">,</span> cTimeF <span class="main">=</span> cTimeF <span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> cTimeF <span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> cCurrentF <span class="main">=</span> cCurrentF <span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> cCurrentF <span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span>
         <span class="main">,</span> cTemperatureF <span class="main">=</span> cTemperatureF <span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> cTemperatureF <span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span>
         <span class="main">,</span> cAmountF <span class="main">=</span> cAmountF <span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> cAmountF <span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> cIntensityF <span class="main">=</span> cIntensityF <span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> cIntensityF <span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> convinv <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>unit_system <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>unit_system<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">inv<span class="hidden">⇩</span><sub>C</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">c</span><span class="main">.</span> <span class="main">⦇</span> cLengthF <span class="main">=</span> inverse <span class="main">(</span>cLengthF <span class="bound">c</span><span class="main">)</span><span class="main">,</span> cMassF <span class="main">=</span> inverse <span class="main">(</span>cMassF <span class="bound">c</span><span class="main">)</span><span class="main">,</span> cTimeF <span class="main">=</span> inverse <span class="main">(</span>cTimeF <span class="bound">c</span><span class="main">)</span>
      <span class="main">,</span> cCurrentF <span class="main">=</span> inverse <span class="main">(</span>cCurrentF <span class="bound">c</span><span class="main">)</span><span class="main">,</span> cTemperatureF <span class="main">=</span> inverse <span class="main">(</span>cTemperatureF <span class="bound">c</span><span class="main">)</span>
      <span class="main">,</span> cAmountF <span class="main">=</span> inverse <span class="main">(</span>cAmountF <span class="bound">c</span><span class="main">)</span><span class="main">,</span> cIntensityF <span class="main">=</span> inverse <span class="main">(</span>cIntensityF <span class="bound">c</span><span class="main">)</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ISQ_Conversion-convinv_inverse"><span class="command">lemma</span></span> convinv_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"convinv <span class="main">(</span>convinv <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-convcomp_inv"><span class="command">lemma</span></span> convcomp_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">inv<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">id<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-inv_convcomp"><span class="command">lemma</span></span> inv_convcomp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">id<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-Conversion_invs"><span class="command">lemma</span></span> Conversion_invs <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LengthF <span class="main">(</span><span class="keyword1">inv<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>LengthF <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"MassF <span class="main">(</span><span class="keyword1">inv<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>MassF <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"TimeF <span class="main">(</span><span class="keyword1">inv<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>TimeF <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"CurrentF <span class="main">(</span><span class="keyword1">inv<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>CurrentF <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"TemperatureF <span class="main">(</span><span class="keyword1">inv<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>TemperatureF <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"AmountF <span class="main">(</span><span class="keyword1">inv<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>AmountF <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"IntensityF <span class="main">(</span><span class="keyword1">inv<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>IntensityF <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="ISQ_Conversion-Conversion_comps"><span class="command">lemma</span></span> Conversion_comps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LengthF <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> LengthF <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> LengthF <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"MassF <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> MassF <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> MassF <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"TimeF <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> TimeF <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> TimeF <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"CurrentF <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> CurrentF <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> CurrentF <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"TemperatureF <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> TemperatureF <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> TemperatureF <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"AmountF <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> AmountF <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> AmountF <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"IntensityF <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> IntensityF <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> IntensityF <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conversion Functions ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dconvfactor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>unit_system <span class="keyword1">⇒<span class="hidden">⇩</span><sub>U</sub></span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>unit_system<span class="main">)</span> <span class="main">⇒</span> Dimension <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">dconvfactor</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> 
  LengthF <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> dim_nth <span class="free"><span class="bound"><span class="entity">d</span></span></span> Length
  <span class="main">*</span> MassF <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> dim_nth <span class="free"><span class="bound"><span class="entity">d</span></span></span> Mass 
  <span class="main">*</span> TimeF <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> dim_nth <span class="free"><span class="bound"><span class="entity">d</span></span></span> Time 
  <span class="main">*</span> CurrentF <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> dim_nth <span class="free"><span class="bound"><span class="entity">d</span></span></span> Current 
  <span class="main">*</span> TemperatureF <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> dim_nth <span class="free"><span class="bound"><span class="entity">d</span></span></span> Temperature
  <span class="main">*</span> AmountF <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> dim_nth <span class="free"><span class="bound"><span class="entity">d</span></span></span> Amount
  <span class="main">*</span> IntensityF <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">^<span class="hidden">⇩</span><sub>Z</sub></span> dim_nth <span class="free"><span class="bound"><span class="entity">d</span></span></span> Intensity"</span></span>

<span class="keyword1" id="ISQ_Conversion-dconvfactor_pos"><span class="command">lemma</span></span> dconvfactor_pos <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dconvfactor <span class="free">c</span> <span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-dconvfactor_nz"><span class="command">lemma</span></span> dconvfactor_nz <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dconvfactor <span class="free">c</span> <span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dconvfactor_pos less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  
<span class="keyword1" id="ISQ_Conversion-dconvfactor_convinv"><span class="command">lemma</span></span> dconvfactor_convinv<span class="main">:</span> <span class="quoted"><span class="quoted">"dconvfactor <span class="main">(</span>convinv <span class="free">c</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> inverse <span class="main">(</span>dconvfactor <span class="free">c</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def intpow_inverse<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-dconvfactor_id"><span class="command">lemma</span></span> dconvfactor_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dconvfactor <span class="keyword1">id<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">d</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-dconvfactor_compose"><span class="command">lemma</span></span> dconvfactor_compose<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dconvfactor <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> dconvfactor <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">d</span> <span class="main">*</span> dconvfactor <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac intpow_mult_distrib<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-dconvfactor_inverse"><span class="command">lemma</span></span> dconvfactor_inverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dconvfactor <span class="free">c</span> <span class="main">(</span>inverse <span class="free">d</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>dconvfactor <span class="free">c</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def inverse_dimvec_def intpow_uminus<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-dconvfactor_times"><span class="command">lemma</span></span> dconvfactor_times<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dconvfactor <span class="free">c</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> dconvfactor <span class="free">c</span> <span class="free">x</span> <span class="main">⋅</span> dconvfactor <span class="free">c</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def  mult_ac intpow_mult_combine times_dimvec_def<span class="main">)</span>
                                                                                                                                           
<span class="keyword1"><span class="command">lift_definition</span></span> qconv <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> Conversion <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>field_char_0<span class="main">)</span><span class="main">[</span><span class="tfree">'d</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>unit_system<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>unit_system<span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">c</span> <span class="bound">q</span><span class="main">.</span> <span class="main">⦇</span> mag <span class="main">=</span> of_rat <span class="main">(</span>dconvfactor <span class="bound">c</span> <span class="main">(</span>dim <span class="bound">q</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> mag <span class="bound">q</span><span class="main">,</span> dim <span class="main">=</span> dim <span class="bound">q</span><span class="main">,</span> unit_sys <span class="main">=</span> unit <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ISQ_Conversion-magQ_qconv"><span class="command">lemma</span></span> magQ_qconv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>qconv <span class="free">c</span> <span class="free">q</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> of_rat <span class="main">(</span>dconvfactor <span class="free">c</span> <span class="main">(</span>dimQ <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟦</span><span class="free">q</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">si_def</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_id"><span class="command">lemma</span></span> qconv_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="keyword1">id<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Measurement_System_eq_intro<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_comp"><span class="command">lemma</span></span> qconv_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> qconv <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>qconv <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_compose of_rat_mult<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_convinv"><span class="command">lemma</span></span> qconv_convinv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="main">(</span>convinv <span class="free">c</span><span class="main">)</span> <span class="main">(</span>qconv <span class="free">c</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_convinv mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> of_rat_mult<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> Measurement_System_eq_intro<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_scaleQ"><span class="command">lemma</span></span> qconv_scaleQ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="main">(</span><span class="free">d</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> qconv <span class="free">c</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_plus"><span class="command">lemma</span></span> qconv_plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> qconv <span class="free">c</span> <span class="free">x</span> <span class="main">+</span> qconv <span class="free">c</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_Quantity_ext_def mult.commute ring_class.ring_distribs<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_minus"><span class="command">lemma</span></span> qconv_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> qconv <span class="free">c</span> <span class="free">x</span> <span class="main">-</span> qconv <span class="free">c</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_Quantity_ext_def mult.commute ring_class.ring_distribs<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_qmult"><span class="command">lemma</span></span> qconv_qmult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> qconv <span class="free">c</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> qconv <span class="free">c</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_Quantity_ext_def times_Measurement_System_ext_def dconvfactor_times of_rat_mult<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_qinverse"><span class="command">lemma</span></span> qconv_qinverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>qconv <span class="free">c</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_Quantity_ext_def inverse_Measurement_System_ext_def dconvfactor_inverse of_rat_inverse<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_Length"><span class="command">lemma</span></span> qconv_Length <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="keyword1">BUNIT(</span>L<span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> LengthF <span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="keyword1">BUNIT(</span>L<span class="main">,</span> <span class="main">_</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def magQ_qconv <span class="dynamic"><span class="dynamic">si_eq</span></span> mk_BaseDim_def one_dimvec_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_Mass"><span class="command">lemma</span></span> qconv_Mass <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="keyword1">BUNIT(</span>M<span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> MassF <span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="keyword1">BUNIT(</span>M<span class="main">,</span> <span class="main">_</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def magQ_qconv <span class="dynamic"><span class="dynamic">si_eq</span></span> mk_BaseDim_def one_dimvec_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_Time"><span class="command">lemma</span></span> qconv_Time <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="keyword1">BUNIT(</span>T<span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> TimeF <span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="keyword1">BUNIT(</span>T<span class="main">,</span> <span class="main">_</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def magQ_qconv <span class="dynamic"><span class="dynamic">si_eq</span></span> mk_BaseDim_def one_dimvec_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_Current"><span class="command">lemma</span></span> qconv_Current <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="keyword1">BUNIT(</span>I<span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> CurrentF <span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="keyword1">BUNIT(</span>I<span class="main">,</span> <span class="main">_</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def magQ_qconv <span class="dynamic"><span class="dynamic">si_eq</span></span> mk_BaseDim_def one_dimvec_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_Temperature"><span class="command">lemma</span></span> qconv_Temperature <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="keyword1">BUNIT(</span>Θ<span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> TemperatureF <span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="keyword1">BUNIT(</span>Θ<span class="main">,</span> <span class="main">_</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def magQ_qconv <span class="dynamic"><span class="dynamic">si_eq</span></span> mk_BaseDim_def one_dimvec_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_Amount"><span class="command">lemma</span></span> qconv_Amount <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="keyword1">BUNIT(</span>N<span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> AmountF <span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="keyword1">BUNIT(</span>N<span class="main">,</span> <span class="main">_</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def magQ_qconv <span class="dynamic"><span class="dynamic">si_eq</span></span> mk_BaseDim_def one_dimvec_def<span class="main">)</span>

<span class="keyword1" id="ISQ_Conversion-qconv_Intensity"><span class="command">lemma</span></span> qconv_Intensity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qconv <span class="free">c</span> <span class="keyword1">BUNIT(</span>J<span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> IntensityF <span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="keyword1">BUNIT(</span>J<span class="main">,</span> <span class="main">_</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dconvfactor_def magQ_qconv <span class="dynamic"><span class="dynamic">si_eq</span></span> mk_BaseDim_def one_dimvec_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="ISQ">
<div class="head">
<h1>Theory ISQ</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Meta-Theory for ISQ ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ISQ
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#ISQ_Dimensions">ISQ_Dimensions</a> <a href="#ISQ_Quantities">ISQ_Quantities</a> <a href="#ISQ_Proof">ISQ_Proof</a> <a href="#ISQ_Algebra">ISQ_Algebra</a> <a href="#ISQ_Units">ISQ_Units</a> <a href="#ISQ_Conversion">ISQ_Conversion</a>
<span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SI_Units">
<div class="head">
<h1>Theory SI_Units</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹ International System of Units ›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ SI Units Semantics ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SI_Units
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#ISQ">ISQ</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ An SI unit is simply a particular kind of quantity with an SI tag. ›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> SI <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span> SI <span class="main">::</span> <span class="quoted">unit_system</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> unit_system_intro<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Abs_SI <span class="main">()</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Abs_SI_cases UNIV_eq_I insert_iff old.unit.exhaust<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">SI</span> <span class="main">≡</span> unit <span class="main">::</span> SI"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> SIUnitT <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'n</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">,</span> SI<span class="main">)</span> QuantT"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>999<span class="main">,</span>0<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We now define the seven base units. Effectively, these definitions axiomatise given names
  for the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">1</span></span>›</span></span></span></span> elements of the base quantities. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">metre</span>    <span class="main">≡</span> <span class="keyword1">BUNIT(</span>L<span class="main">,</span> SI<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">kilogram</span> <span class="main">≡</span> <span class="keyword1">BUNIT(</span>M<span class="main">,</span> SI<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ampere</span>   <span class="main">≡</span> <span class="keyword1">BUNIT(</span>I<span class="main">,</span> SI<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">kelvin</span>   <span class="main">≡</span> <span class="keyword1">BUNIT(</span>Θ<span class="main">,</span> SI<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">mole</span>     <span class="main">≡</span> <span class="keyword1">BUNIT(</span>N<span class="main">,</span> SI<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">candela</span>  <span class="main">≡</span> <span class="keyword1">BUNIT(</span>J<span class="main">,</span> SI<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The second is commonly used in unit systems other than SI. Consequently, we define it 
  polymorphically, and require that the system type instantiate a type class to use it. ›</span></span>

<span class="keyword1"><span class="command">class</span></span> time_second <span class="main">=</span> unit_system

<span class="keyword1"><span class="command">instance</span></span> SI <span class="main">::</span> <span class="quoted">time_second</span> <span class="keyword1"><span class="command">..</span></span>
              
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">second</span>  <span class="main">≡</span> <span class="keyword1">BUNIT(</span>T<span class="main">,</span> <span class="tfree">'a</span><span class="main">::</span>time_second<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note that as a consequence of our construction, the term <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹metre›</span></span></span></span> is a SI Unit constant of 
SI-type <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">[</span></span>L<span class="main"><span class="main">,</span></span> SI<span class="main"><span class="main">]</span></span>›</span></span></span></span>, so a unit of dimension <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹Length›</span></span></span></span> with the magnitude of type <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'a</span></span>›</span></span></span></span>.
A magnitude instantiation can be, e.g., an integer, a rational number, a real number, or a vector of 
type <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹real<span class="main"><span class="main"><span class="hidden">⇧</span><sup>3</sup></span></span>›</span></span></span></span>. Note than when considering vectors, dimensions refer to the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹norm›</span></span> of the vector,
not to its components. ›</span></span>

<span class="keyword1" id="SI_Units-BaseUnits"><span class="command">lemma</span></span> BaseUnits<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"is_base_unit metre"</span></span> <span class="quoted"><span class="quoted">"is_base_unit second"</span></span> <span class="quoted"><span class="quoted">"is_base_unit kilogram"</span></span> <span class="quoted"><span class="quoted">"is_base_unit ampere"</span></span>
  <span class="quoted"><span class="quoted">"is_base_unit kelvin"</span></span> <span class="quoted"><span class="quoted">"is_base_unit mole"</span></span> <span class="quoted"><span class="quoted">"is_base_unit candela"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_base_unit<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The effect of the above encoding is that we can use the SI base units as synonyms for their
  corresponding dimensions at the type level. ›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> metre    <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>Length<span class="main">,</span> SI<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> second   <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>Time<span class="main">,</span> SI<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> kilogram <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>Mass<span class="main">,</span> SI<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> ampere   <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>Current<span class="main">,</span> SI<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> kelvin   <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>Temperature<span class="main">,</span> SI<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> mole     <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>Amount<span class="main">,</span> SI<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> candela  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>Intensity<span class="main">,</span> SI<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We can therefore construct a quantity such as <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="numeral"><span class="numeral">5</span></span> <span class="main"><span class="main">::</span></span> rat metre›</span></span></span></span>, which unambiguously 
  identifies that the unit of $5$ is metres using the type system. This works because each base
  unit it the one element. ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Example Unit Equations ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>metre <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> metre"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_calc</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Metrification ›</span></span>

<span class="keyword1"><span class="command">class</span></span> metrifiable <span class="main">=</span> unit_system <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">convschema</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> itself <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> SI<span class="main">)</span> Conversion"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">schema<span class="hidden">⇩</span><sub>C</sub></span></span></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> SI <span class="main">::</span> <span class="quoted">metrifiable</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">convschema_SI</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"SI itself <span class="main">⇒</span> <span class="main">(</span>SI<span class="main">,</span> SI<span class="main">)</span> Conversion"</span></span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> 
  <span class="main">⦇</span> cLengthF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cMassF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cTimeF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cCurrentF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cTemperatureF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cAmountF <span class="main">=</span> <span class="main">1</span>
  <span class="main">,</span> cIntensityF <span class="main">=</span> <span class="main">1</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">metrify</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>field_char_0<span class="main">)</span><span class="main">[</span><span class="tfree">'d</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s</span><span class="main">::</span>metrifiable<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d</span><span class="main">::</span>dim_type<span class="main">,</span> SI<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">metrify</span> <span class="main">≡</span> qconv <span class="main">(</span>convschema <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Conversion via SI units ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">qmconv</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span> itself <span class="main">⇒</span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span> itself
   <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>field_char_0<span class="main">)</span><span class="main">[</span><span class="tfree">'d</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span>metrifiable<span class="main">]</span> 
   <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span><span class="tfree">'d</span><span class="main">::</span>dim_type<span class="main">,</span> <span class="tfree">'s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span>metrifiable<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qmconv</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> qconv <span class="main">(</span><span class="keyword1">inv<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="keyword1">schema<span class="hidden">⇩</span><sub>C</sub></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">schema<span class="hidden">⇩</span><sub>C</sub></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_qmconv"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> type <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">QMC'(</span>_ <span class="keyword1">→</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">QMC(</span><span class="tfree"><span class="free">'s<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">→</span> <span class="tfree"><span class="free">'s<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> qmconv <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree"><span class="free">'s<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree"><span class="free">'s<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>"</span>

<span class="keyword1" id="SI_Units-qmconv_self"><span class="command">lemma</span></span> qmconv_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">QMC(</span><span class="tfree">'s</span><span class="main">::</span>metrifiable <span class="main">→</span> <span class="tfree">'s</span><span class="main">)</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="CGS">
<div class="head">
<h1>Theory CGS</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Centimetre-Gram-Second System ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> CGS
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#SI_Units">SI_Units</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Preliminaries ›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> CGS <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> CGS <span class="main">::</span> <span class="quoted">unit_system</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> unit_system_intro<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Abs_CGS <span class="main">()</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> 
           Abs_CGS_cases UNIV_eq_I insert_iff old.unit.exhaust<span class="main">)</span>
<span class="keyword1"><span class="command">instance</span></span> CGS <span class="main">::</span> <span class="quoted">time_second</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">CGS</span> <span class="main">≡</span> unit <span class="main">::</span> CGS"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Base Units ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">centimetre</span>  <span class="main">≡</span> <span class="keyword1">BUNIT(</span>L<span class="main">,</span> CGS<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">gram</span>        <span class="main">≡</span> <span class="keyword1">BUNIT(</span>M<span class="main">,</span> CGS<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conversion to SI ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> CGS <span class="main">::</span> <span class="quoted">metrifiable</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">convschema_CGS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"CGS itself <span class="main">⇒</span> <span class="main">(</span>CGS<span class="main">,</span> SI<span class="main">)</span> Conversion"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⦇</span> cLengthF <span class="main">=</span> <span class="numeral">0.01</span><span class="main">,</span> cMassF <span class="main">=</span> <span class="numeral">0.001</span><span class="main">,</span> cTimeF <span class="main">=</span> <span class="main">1</span>
      <span class="main">,</span> cCurrentF <span class="main">=</span> <span class="main">1</span><span class="main">,</span> cTemperatureF <span class="main">=</span> <span class="main">1</span><span class="main">,</span> cAmountF <span class="main">=</span> <span class="main">1</span><span class="main">,</span> cIntensityF <span class="main">=</span> <span class="main">1</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="CGS-CGS_SI_simps"><span class="command">lemma</span></span> CGS_SI_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LengthF <span class="main">(</span>convschema <span class="main">(</span><span class="free">a</span><span class="main">::</span>CGS itself<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0.01</span>"</span></span> <span class="quoted"><span class="quoted">"MassF <span class="main">(</span>convschema <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0.001</span>"</span></span>
  <span class="quoted"><span class="quoted">"TimeF <span class="main">(</span>convschema <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"CurrentF <span class="main">(</span>convschema <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"TemperatureF <span class="main">(</span>convschema <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conversion Examples ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"metrify <span class="main">(</span><span class="main">(</span><span class="numeral">100</span><span class="main">::</span>rat<span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> centimetre<span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SI_Constants">
<div class="head">
<h1>Theory SI_Constants</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Physical Constants ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SI_Constants
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#SI_Units">SI_Units</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Core Derived Units ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">hertz</span> <span class="main">≡</span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">radian</span> <span class="main">≡</span> metre <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">steradian</span> <span class="main">≡</span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">joule</span> <span class="main">≡</span> kilogram <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span>  second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> joule <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M <span class="main">⋅</span> L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> SI<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">watt</span> <span class="main">≡</span> kilogram <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟯</sup></span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> watt <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M <span class="main">⋅</span> L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>3</sup></span><span class="main">,</span> SI<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">coulomb</span> <span class="main">≡</span> ampere <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> coulomb <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>I <span class="main">⋅</span> T<span class="main">,</span> SI<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">lumen</span> <span class="main">≡</span> candela <span class="main"><span class="hidden">❙</span><b>⋅</b></span> steradian"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> lumen <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>J <span class="main">⋅</span> <span class="main">(</span>L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> L<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">,</span> SI<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Constants ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The most general types we support must form a field into which the natural numbers can 
  be injected. ›</span></span>

<span class="keyword1"><span class="command">default_sort</span></span> <span class="quoted">field_char_0</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Hyperfine transition frequency of frequency of Cs ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">caesium_frequency</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">,</span>SI<span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Δv<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>s</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">caesium_frequency</span> <span class="main">≡</span> <span class="numeral">9192631770</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> hertz"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Speed of light in vacuum ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">speed_of_light</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>L <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">,</span>SI<span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>c</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">speed_of_light</span> <span class="main">≡</span> <span class="numeral">299792458</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span>metre<span class="main"><span class="hidden">❙</span><b>⋅</b></span>second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Planck constant ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Planck</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M <span class="main">⋅</span> L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> T<span class="main">,</span>SI<span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>h</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Planck</span> <span class="main">≡</span> <span class="main">(</span><span class="numeral">6.62607015</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">34</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span>joule<span class="main"><span class="hidden">❙</span><b>⋅</b></span>second<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Elementary charge ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">elementary_charge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>I <span class="main">⋅</span> T<span class="main">,</span>SI<span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>e</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">elementary_charge</span> <span class="main">≡</span> <span class="main">(</span><span class="numeral">1.602176634</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">19</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> coulomb"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The Boltzmann constant ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Boltzmann</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M <span class="main">⋅</span> L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> Θ<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">,</span>SI<span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>k</b></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Boltzmann</span> <span class="main">≡</span> <span class="main">(</span><span class="numeral">1.380649</span><span class="main">⋅</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">23</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span>joule <span class="main"><span class="hidden">❙</span><b>/</b></span> kelvin<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The Avogadro number ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Avogadro</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>N<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">,</span>SI<span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">N<span class="hidden">⇩</span><sub>A</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Avogadro</span> <span class="main">≡</span> <span class="numeral">6.02214076</span><span class="main">⋅</span><span class="main">(</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">23</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span>mole<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">max_luminous_frequency</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">,</span>SI<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">max_luminous_frequency</span> <span class="main">≡</span> <span class="main">(</span><span class="numeral">540</span><span class="main">⋅</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">12</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> hertz"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The luminous efficacy of monochromatic radiation of frequency <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span>‹max_luminous_frequency›</span></span>. ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">luminous_efficacy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>J <span class="main">⋅</span> <span class="main">(</span>L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> L<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>M <span class="main">⋅</span> L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>3</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">,</span>SI<span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">K<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>d</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">luminous_efficacy</span> <span class="main">≡</span> <span class="numeral">683</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span>lumen<span class="main"><span class="hidden">❙</span><b>/</b></span>watt<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Checking Foundational Equations of the SI System ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> second_definition<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> second <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="numeral">9192631770</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">𝟭</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>/</b></span> <span class="keyword1">Δv<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>s</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1"><span class="command">theorem</span></span> metre_definition<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>c</b></span> <span class="main"><span class="hidden">❙</span><b>/</b></span> <span class="main">(</span><span class="numeral">299792458</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">𝟭</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⋅</b></span>second"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="numeral">9192631770</span> <span class="main">/</span> <span class="numeral">299792458</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>c</b></span> <span class="main"><span class="hidden">❙</span><b>/</b></span> <span class="keyword1">Δv<span class="hidden">⇩</span><sub>C</sub><span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">theorem</span></span> kilogram_definition<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> kilogram<span class="main">)</span><span class="main">::</span><span class="tfree">'a</span> kilogram<span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>h</b></span> <span class="main"><span class="hidden">❙</span><b>/</b></span> <span class="main">(</span><span class="numeral">6.62607015</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">34</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">𝟭</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⋅</b></span>metre<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span><span class="main"><span class="hidden">❙</span><b>⋅</b></span>second"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">approx_ice_point</span> <span class="main">≡</span> <span class="numeral">273.15</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> kelvin"</span></span>

<span class="keyword1"><span class="command">default_sort</span></span> <span class="quoted">type</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SI_Prefix">
<div class="head">
<h1>Theory SI_Prefix</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ SI Prefixes ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SI_Prefix
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#SI_Constants">SI_Constants</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Definitions ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Prefixes are simply numbers that can be composed with units using the scalar 
  multiplication operator <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span>‹scaleQ›</span></span>. ›</span></span>

<span class="keyword1"><span class="command">default_sort</span></span> <span class="quoted">ring_char_0</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deca</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">deca</span> <span class="main">=</span> <span class="numeral">10</span><span class="main">^</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hecto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hecto</span> <span class="main">=</span> <span class="numeral">10</span><span class="main">^</span><span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">kilo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">kilo</span> <span class="main">=</span> <span class="numeral">10</span><span class="main">^</span><span class="numeral">3</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mega</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mega</span> <span class="main">=</span> <span class="numeral">10</span><span class="main">^</span><span class="numeral">6</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">giga</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">giga</span> <span class="main">=</span> <span class="numeral">10</span><span class="main">^</span><span class="numeral">9</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tera</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tera</span> <span class="main">=</span> <span class="numeral">10</span><span class="main">^</span><span class="numeral">12</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">peta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">peta</span> <span class="main">=</span> <span class="numeral">10</span><span class="main">^</span><span class="numeral">15</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">exa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">exa</span> <span class="main">=</span> <span class="numeral">10</span><span class="main">^</span><span class="numeral">18</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zetta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zetta</span> <span class="main">=</span> <span class="numeral">10</span><span class="main">^</span><span class="numeral">21</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">yotta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">yotta</span> <span class="main">=</span> <span class="numeral">10</span><span class="main">^</span><span class="numeral">24</span>"</span></span>

<span class="keyword1"><span class="command">default_sort</span></span> <span class="quoted">field_char_0</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deci</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">deci</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">10</span><span class="main">^</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">centi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">centi</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">milli</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">milli</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">3</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">micro</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">micro</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">6</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nano</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nano</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">9</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pico</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pico</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">12</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">femto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">femto</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">15</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">atto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">atto</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">18</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zepto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zepto</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">21</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">yocto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">yocto</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">24</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Examples ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2.3</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span>centi <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>𝟯</sup></span> <span class="main">=</span> <span class="numeral">2.3</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">/</span><span class="numeral">10</span><span class="main">^</span><span class="numeral">6</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟯</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span>centi <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span> <span class="main">=</span> <span class="numeral">100</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Binary Prefixes ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Although not in general applicable to physical quantities, we include these prefixes
  for completeness. ›</span></span>

<span class="keyword1"><span class="command">default_sort</span></span> <span class="quoted">ring_char_0</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">kibi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">kibi</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">10</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mebi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mebi</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">20</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gibi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gibi</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">30</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tebi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tebi</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">40</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pebi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pebi</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">50</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">exbi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">exbi</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">60</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zebi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zebi</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">70</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">yobi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">yobi</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">80</span>"</span></span>

<span class="keyword1"><span class="command">default_sort</span></span> <span class="quoted">type</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SI_Derived">
<div class="head">
<h1>Theory SI_Derived</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Derived SI-Units›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SI_Derived
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#SI_Prefix">SI_Prefix</a>
<span class="keyword2"><span class="keyword">begin</span></span>                                  

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Definitions ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">newton</span> <span class="main">≡</span> kilogram <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> newton <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M <span class="main">⋅</span> L <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> SI<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">pascal</span> <span class="main">≡</span> kilogram <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> pascal <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M <span class="main">⋅</span> L<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span> <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> SI<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">volt</span> <span class="main">≡</span> kilogram <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟯</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> ampere<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> volt <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M <span class="main">⋅</span> L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>3</sup></span> <span class="main">⋅</span> I<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">,</span> SI<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">farad</span> <span class="main">≡</span> kilogram<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>𝟰</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> ampere<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> farad <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span> <span class="main">⋅</span> L<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>4</sup></span> <span class="main">⋅</span> I<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> SI<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ohm</span> <span class="main">≡</span> kilogram <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟯</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> ampere<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> ohm <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M <span class="main">⋅</span> L<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>3</sup></span> <span class="main">⋅</span> I<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> SI<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">siemens</span> <span class="main">≡</span> kilogram<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>𝟯</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> ampere<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">weber</span> <span class="main">≡</span> kilogram <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> ampere<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">tesla</span> <span class="main">≡</span> kilogram <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> ampere<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">henry</span> <span class="main">≡</span> kilogram <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> ampere<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">lux</span> <span class="main">≡</span> candela <span class="main"><span class="hidden">❙</span><b>⋅</b></span> steradian <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">becquerel</span> <span class="main">≡</span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">gray</span> <span class="main">≡</span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">sievert</span> <span class="main">≡</span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">katal</span> <span class="main">≡</span> mole <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">degrees_celcius</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field_char_0 <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span>Θ<span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">°C</span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">degrees_celcius</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> kelvin<span class="main">)</span> <span class="main">+</span> approx_ice_point"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gram</span> <span class="main">=</span> milli <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> kilogram"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Equivalences ›</span></span>

<span class="keyword1" id="SI_Derived-joule_alt_def"><span class="command">lemma</span></span> joule_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"joule <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> newton <span class="main"><span class="hidden">❙</span><b>⋅</b></span> metre"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="SI_Derived-watt_alt_def"><span class="command">lemma</span></span> watt_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"watt <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> joule <span class="main"><span class="hidden">❙</span><b>/</b></span> second"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="SI_Derived-volt_alt_def"><span class="command">lemma</span></span> volt_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"volt <span class="main">=</span> watt <span class="main"><span class="hidden">❙</span><b>/</b></span> ampere"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
<span class="keyword1" id="SI_Derived-farad_alt_def"><span class="command">lemma</span></span> farad_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"farad <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> coulomb <span class="main"><span class="hidden">❙</span><b>/</b></span> volt"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="SI_Derived-ohm_alt_def"><span class="command">lemma</span></span> ohm_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"ohm <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> volt <span class="main"><span class="hidden">❙</span><b>/</b></span> ampere"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="SI_Derived-siemens_alt_def"><span class="command">lemma</span></span> siemens_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"siemens <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> ampere <span class="main"><span class="hidden">❙</span><b>/</b></span> volt"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="SI_Derived-weber_alt_def"><span class="command">lemma</span></span> weber_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"weber <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> volt <span class="main"><span class="hidden">❙</span><b>⋅</b></span> second"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="SI_Derived-tesla_alt_def"><span class="command">lemma</span></span> tesla_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"tesla <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> weber <span class="main"><span class="hidden">❙</span><b>/</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="SI_Derived-henry_alt_def"><span class="command">lemma</span></span> henry_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"henry <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> weber <span class="main"><span class="hidden">❙</span><b>/</b></span> ampere"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="SI_Derived-lux_alt_def"><span class="command">lemma</span></span> lux_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"lux <span class="main">=</span> lumen <span class="main"><span class="hidden">❙</span><b>/</b></span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SI_Derived-gray_alt_def"><span class="command">lemma</span></span> gray_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"gray <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> joule <span class="main"><span class="hidden">❙</span><b>/</b></span> kilogram"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1" id="SI_Derived-sievert_alt_def"><span class="command">lemma</span></span> sievert_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"sievert <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> joule <span class="main"><span class="hidden">❙</span><b>/</b></span> kilogram"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_calc</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Properties ›</span></span>

<span class="keyword1" id="SI_Derived-kilogram"><span class="command">lemma</span></span> kilogram<span class="main">:</span> <span class="quoted"><span class="quoted">"kilo <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> gram <span class="main">=</span> kilogram"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main">)</span>

<span class="keyword1" id="SI_Derived-celcius_to_kelvin"><span class="command">lemma</span></span> celcius_to_kelvin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="keyword1">°C</span> <span class="main">=</span> <span class="main">(</span><span class="free">T</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> kelvin<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">273.15</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> kelvin<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SI_Accepted">
<div class="head">
<h1>Theory SI_Accepted</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Non-SI Units Accepted for SI use ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SI_Accepted
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#SI_Derived">SI_Derived</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_def</span><span class="main">,</span> <span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">minute</span> <span class="main">=</span> <span class="numeral">60</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> second"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_def</span><span class="main">,</span> <span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hour</span> <span class="main">=</span> <span class="numeral">60</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> minute"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_def</span><span class="main">,</span> <span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">day</span> <span class="main">=</span> <span class="numeral">24</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> hour"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_def</span><span class="main">,</span> <span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">astronomical_unit</span> <span class="main">=</span> <span class="numeral">149597870700</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">degree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_field<span class="main">[</span>L<span class="main">/</span>L<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_def</span><span class="main">,</span> <span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">degree</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">⋅</span><span class="main">(</span>of_real pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">180</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> radian"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">degrees</span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">°</span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">°</span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> degree"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_def</span><span class="main">,</span> <span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">litre</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">1000</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre<span class="main"><span class="hidden">⇧</span><sup>𝟯</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_def</span><span class="main">,</span> <span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tonne</span> <span class="main">=</span> <span class="numeral">10</span><span class="main">^</span><span class="numeral">3</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> kilogram"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_def</span><span class="main">,</span> <span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dalton</span> <span class="main">=</span> <span class="numeral">1.66053906660</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">10</span><span class="main">^</span><span class="numeral">27</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> kilogram"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Example Unit Equations ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> hour <span class="main">=</span> <span class="numeral">3600</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> second"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"watt <span class="main"><span class="hidden">❙</span><b>⋅</b></span> hour <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="numeral">3600</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> joule"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_calc</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">25</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre <span class="main"><span class="hidden">❙</span><b>/</b></span> second <span class="main">=</span> <span class="numeral">90</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span>kilo <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre<span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>/</b></span> hour"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_calc</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SI_Imperial">
<div class="head">
<h1>Theory SI_Imperial</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Imperial Units via SI Units ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SI_Imperial
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#SI_Accepted">SI_Accepted</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Units of Length ›</span></span>

<span class="keyword1"><span class="command">default_sort</span></span> <span class="quoted">field_char_0</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The units of length are defined in terms of the international yard, as standardised in 1959. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">yard</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>L<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">yard</span> <span class="main">=</span> <span class="numeral">0.9144</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">foot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>L<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">foot</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">3</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> yard"</span></span>

<span class="keyword1" id="SI_Imperial-foot_alt_def"><span class="command">lemma</span></span> foot_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"foot <span class="main">=</span> <span class="numeral">0.3048</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>L<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">inch</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">36</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> yard"</span></span>

<span class="keyword1" id="SI_Imperial-inch_alt_def"><span class="command">lemma</span></span> inch_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"inch <span class="main">=</span> <span class="numeral">25.4</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> milli <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mile</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>L<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mile</span> <span class="main">=</span> <span class="numeral">1760</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> yard"</span></span>

<span class="keyword1" id="SI_Imperial-mile_alt_def"><span class="command">lemma</span></span> mile_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"mile <span class="main">=</span> <span class="numeral">1609.344</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nautical_mile</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>L<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nautical_mile</span> <span class="main">=</span> <span class="numeral">1852</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Units of Mass ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The units of mass are defined in terms of the international yard, as standardised in 1959. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pound</span> <span class="main">=</span> <span class="numeral">0.45359237</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> kilogram"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ounce</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ounce</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">16</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> pound"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>M<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">stone</span> <span class="main">=</span> <span class="numeral">14</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> pound"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Other Units ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">knot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>L <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">knot</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span>nautical_mile <span class="main"><span class="hidden">❙</span><b>/</b></span> hour<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pint</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>Volume<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pint</span> <span class="main">=</span> <span class="numeral">0.56826125</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> litre"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gallon</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">[</span>Volume<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gallon</span> <span class="main">=</span> <span class="numeral">8</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> pint"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">degrees_farenheit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">[</span>Θ<span class="main">]</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">°F</span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">degrees_farenheit</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="numeral">459.67</span><span class="main">)</span><span class="main">⋅</span><span class="numeral">5</span><span class="main">/</span><span class="numeral">9</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> kelvin"</span></span>

<span class="keyword1"><span class="command">default_sort</span></span> <span class="quoted">type</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Unit Equations ›</span></span>
  
<span class="keyword1" id="SI_Imperial-miles_to_feet"><span class="command">lemma</span></span> miles_to_feet<span class="main">:</span> <span class="quoted"><span class="quoted">"mile <span class="main">=</span> <span class="numeral">5280</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> foot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_simp</span>

<span class="keyword1" id="SI_Imperial-mph_to_kmh"><span class="command">lemma</span></span> mph_to_kmh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span>mile <span class="main"><span class="hidden">❙</span><b>/</b></span> hour<span class="main">)</span> <span class="main">=</span> <span class="numeral">1.609344</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="main">(</span>kilo <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre<span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>/</b></span> hour<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_simp</span>

<span class="keyword1" id="SI_Imperial-farenheit_to_celcius"><span class="command">lemma</span></span> farenheit_to_celcius<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="keyword1">°F</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">T</span> <span class="main">-</span> <span class="numeral">32</span><span class="main">)</span> <span class="main">⋅</span> <span class="numeral">5</span><span class="main">/</span><span class="numeral">9</span><span class="main">)</span><span class="keyword1">°C</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">si_simp</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SI">
<div class="head">
<h1>Theory SI</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Meta-Theory for SI Units ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SI
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#SI_Units">SI_Units</a> <a href="#SI_Constants">SI_Constants</a> <a href="#SI_Prefix">SI_Prefix</a> <a href="#SI_Derived">SI_Derived</a> <a href="#SI_Accepted">SI_Accepted</a> <a href="#SI_Imperial">SI_Imperial</a>
<span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SI_Astronomical">
<div class="head">
<h1>Theory SI_Astronomical</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Astronomical Constants ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SI_Astronomical
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#SI">SI</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Decision_Procs/Approximation.html">HOL-Decision_Procs.Approximation</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We create a number of astronomical constants and prove relationships between some of them.
  For this, we use the approximation method that can compute bounds on transcendental functions. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">julian_year</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field<span class="main">[</span>T<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">julian_year</span> <span class="main">=</span> <span class="numeral">365.25</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> day"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">light_year</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field_char_0<span class="main">[</span>L<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">light_year</span> <span class="main">=</span> <span class="keyword1">QCOERCE[</span>L<span class="main">]</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>c</b></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> julian_year<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We need to apply a coercion in the definition of light year to convert the dimension type
  from <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹L <span class="main"><span class="main">⋅</span></span> T<span class="main"><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span></span> <span class="main"><span class="main">⋅</span></span> T›</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹L›</span></span></span></span>. The correctness of this coercion is confirmed by the following
  equivalence theorem. ›</span></span>

<span class="keyword1" id="SI_Astronomical-light_year"><span class="command">lemma</span></span> light_year<span class="main">:</span> <span class="quoted"><span class="quoted">"light_year <span class="keyword1">≅<span class="hidden">⇩</span><sub>Q</sub></span> <span class="keyword1"><span class="hidden">❙</span><b>c</b></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> julian_year"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> light_year_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_calc</span><span class="main">)</span>

<span class="keyword1" id="SI_Astronomical-light_year_eq"><span class="command">lemma</span></span> light_year_eq <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>light_year<span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">=</span> <span class="main">⟦</span><span class="keyword1"><span class="hidden">❙</span><b>c</b></span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> julian_year<span class="keyword1">⟧<span class="hidden">⇩</span><sub>Q</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> light_year quant_equiv_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ HOL can characterise <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span>‹pi›</span></span> exactly and so we also give an exact value for the parsec. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">parsec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">[</span>L<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">parsec</span> <span class="main">=</span> <span class="numeral">648000</span> <span class="main">/</span> pi <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> astronomical_unit"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We calculate some conservative bounds on the parsec: it is somewhere between 3.26 and 3.27
  light-years. ›</span></span>

<span class="keyword1" id="SI_Astronomical-parsec_lb"><span class="command">lemma</span></span> parsec_lb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3.26</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> light_year <span class="main">&lt;</span> parsec"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">approximation</span> 12<span class="main">)</span>

<span class="keyword1" id="SI_Astronomical-parsec_ub"><span class="command">lemma</span></span> parsec_ub<span class="main">:</span> <span class="quoted"><span class="quoted">"parsec <span class="main">&lt;</span> <span class="numeral">3.27</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> light_year"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">approximation</span> 12<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ The full beauty of the approach is perhaps revealed here, with the 
      type of a classical three-dimensional gravitation field:›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> gravitation_field <span class="main">=</span> <span class="quoted"><span class="quoted">"real<span class="main"><span class="hidden">⇧</span><sup>3</sup></span><span class="main">[</span>L<span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span>real<span class="main"><span class="hidden">⇧</span><sup>3</sup></span><span class="main">[</span>L <span class="main">⋅</span> T<span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SI_Pretty">
<div class="head">
<h1>Theory SI_Pretty</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Parsing and Pretty Printing of SI Units ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SI_Pretty
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#SI">SI</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Syntactic SI Units ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The following syntactic representation can apply at both the type and value level. ›</span></span>

<span class="keyword1"><span class="command">nonterminal</span></span> si

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_si_metre"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">m</span>"</span><span class="main">)</span>
  <span class="quoted">"_si_kilogram"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">kg</span>"</span><span class="main">)</span>
  <span class="quoted">"_si_second"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">s</span>"</span><span class="main">)</span>
  <span class="quoted">"_si_ampere"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">A</span>"</span><span class="main">)</span>
  <span class="quoted">"_si_kelvin"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">K</span>"</span><span class="main">)</span>
  <span class="quoted">"_si_mole"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">mol</span>"</span><span class="main">)</span>
  <span class="quoted">"_si_candela"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">cd</span>"</span><span class="main">)</span>

  <span class="quoted">"_si_square"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"si <span class="main">⇒</span> si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>2</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_si_cube"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"si <span class="main">⇒</span> si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>3</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_si_quart"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"si <span class="main">⇒</span> si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>4</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>

  <span class="quoted">"_si_inverse"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"si <span class="main">⇒</span> si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_si_invsquare"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"si <span class="main">⇒</span> si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_si_invcube"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"si <span class="main">⇒</span> si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>3</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_si_invquart"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"si <span class="main">⇒</span> si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>4</sup></span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>

  <span class="quoted">"_si_times"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"si <span class="main">⇒</span> si <span class="main">⇒</span> si"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Type Notation ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Pretty notation for SI units at the type level. ›</span></span>

<span class="keyword1"><span class="command">no_type_notation</span></span> SIUnitT <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>999<span class="main">,</span>0<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_si_unit"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> si <span class="main">⇒</span> type"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>999<span class="main">,</span>0<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_si_print"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> si"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">SIPRINT'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="tfree"><span class="free">'a</span></span><span class="main">[</span><span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main">)</span><span class="main">]</span>"</span> <span class="main">==</span> <span class="main">(</span>type<span class="main">)</span> <span class="quoted">"<span class="tfree"><span class="free">'a</span></span><span class="main">[</span><span class="tfree"><span class="free">'d</span></span><span class="main">,</span> SI<span class="main">]</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span> <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>3</sup></span>"</span> <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main"><span class="hidden">⇧</span><sup>3</sup></span><span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>4</sup></span>"</span> <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main"><span class="hidden">⇧</span><sup>4</sup></span><span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span>"</span> <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span>"</span> <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>3</sup></span>"</span> <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>3</sup></span><span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>4</sup></span>"</span> <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d</span></span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>4</sup></span><span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>"</span> <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span><span class="tfree"><span class="free">'d<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">⋅</span> <span class="tfree"><span class="free">'d<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">m</span>"</span>   <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span>L<span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">kg</span>"</span>  <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span>M<span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">s</span>"</span>   <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span>T<span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">A</span>"</span>   <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span>I<span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">K</span>"</span>   <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span>Θ<span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">mol</span>"</span> <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span>N<span class="main">)</span>"</span>
  <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">cd</span>"</span>  <span class="main">==</span> <span class="main">(</span>si<span class="main">)</span> <span class="quoted">"<span class="keyword1">SIPRINT(</span>J<span class="main">)</span>"</span>

  <span class="quoted">"_si_invsquare <span class="free">x</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_si_inverse <span class="main">(</span>_si_square <span class="free">x</span><span class="main">)</span>"</span>
  <span class="quoted">"_si_invcube <span class="free">x</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_si_inverse <span class="main">(</span>_si_cube <span class="free">x</span><span class="main">)</span>"</span>
  <span class="quoted">"_si_invquart <span class="free">x</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_si_inverse <span class="main">(</span>_si_quart <span class="free">x</span><span class="main">)</span>"</span>

  <span class="quoted">"_si_invsquare <span class="free">x</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_si_square <span class="main">(</span>_si_inverse <span class="free">x</span><span class="main">)</span>"</span>
  <span class="quoted">"_si_invcube <span class="free">x</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_si_cube <span class="main">(</span>_si_inverse  <span class="free">x</span><span class="main">)</span>"</span>
  <span class="quoted">"_si_invquart <span class="free">x</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_si_quart <span class="main">(</span>_si_inverse <span class="free">x</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">typ</span></span> <span class="quoted"><span class="quoted">"real<span class="main">[</span><span class="keyword1">m</span><span class="main">⋅</span><span class="keyword1">s</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">typ</span></span> <span class="quoted"><span class="quoted">"real<span class="main">[</span><span class="keyword1">m</span><span class="main">⋅</span><span class="keyword1">s</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>2</sup></span><span class="main">⋅</span><span class="keyword1">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">5</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> joule"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Value Notations ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Pretty notation for SI units at the type level. Currently, it is not possible to support
  prefixes, as this would require a more sophisticated cartouche parser. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SIQ</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_si_term"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"si <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">SI'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_siq_term"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> si <span class="main">⇒</span> logic"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">SI[</span>_<span class="keyword1">,</span> _<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="quoted">"_siq_print"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"logic <span class="main">⇒</span> si"</span></span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_siq_term <span class="free">n</span> <span class="free">u</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> SIQ <span class="free">n</span> <span class="main">(</span>_si_term <span class="free">u</span><span class="main">)</span>"</span>
  <span class="quoted">"_siq_term <span class="free">n</span> <span class="main">(</span>_siq_print <span class="free">u</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"<span class="keyword1">CONST</span> SIQ <span class="free">n</span> <span class="free">u</span>"</span>
  <span class="quoted">"_si_term <span class="main">(</span>_si_times <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="main">(</span>_si_term <span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="main">(</span>_si_term <span class="free">y</span><span class="main">)</span>"</span>
  <span class="quoted">"_si_term <span class="main">(</span>_si_inverse <span class="free">x</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="main">(</span>_si_term <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span>"</span>
  <span class="quoted">"_si_term <span class="main">(</span>_si_square <span class="free">x</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="main">(</span>_si_term <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span>
  <span class="quoted">"_si_term <span class="main">(</span>_si_cube <span class="free">x</span><span class="main">)</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="main">(</span>_si_term <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span>"</span>
  <span class="quoted">"<span class="keyword1">SI(</span><span class="keyword1">m</span><span class="main">)</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> metre"</span>
  <span class="quoted">"<span class="keyword1">SI(</span><span class="keyword1">kg</span><span class="main">)</span>"</span>  <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> kilogram"</span>
  <span class="quoted">"<span class="keyword1">SI(</span><span class="keyword1">s</span><span class="main">)</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> second"</span>
  <span class="quoted">"<span class="keyword1">SI(</span><span class="keyword1">A</span><span class="main">)</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> ampere"</span>
  <span class="quoted">"<span class="keyword1">SI(</span><span class="keyword1">K</span><span class="main">)</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> kelvin"</span>
  <span class="quoted">"<span class="keyword1">SI(</span><span class="keyword1">mol</span><span class="main">)</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> mole"</span>
  <span class="quoted">"<span class="keyword1">SI(</span><span class="keyword1">cd</span><span class="main">)</span>"</span>  <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> candela"</span>

  <span class="quoted">"_si_inverse <span class="main">(</span>_siq_print <span class="free">x</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟭</sup></span><span class="main">)</span>"</span>
  <span class="quoted">"_si_invsquare <span class="main">(</span>_siq_print <span class="free">x</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟮</sup></span><span class="main">)</span>"</span>
  <span class="quoted">"_si_invcube <span class="main">(</span>_siq_print <span class="free">x</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟯</sup></span><span class="main">)</span>"</span>
  <span class="quoted">"_si_invquart <span class="main">(</span>_siq_print <span class="free">x</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>𝟰</sup></span><span class="main">)</span>"</span>

  <span class="quoted">"_si_square <span class="main">(</span>_siq_print <span class="free">x</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>𝟮</sup></span><span class="main">)</span>"</span>
  <span class="quoted">"_si_cube <span class="main">(</span>_siq_print <span class="free">x</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>𝟯</sup></span><span class="main">)</span>"</span>
  <span class="quoted">"_si_quart <span class="main">(</span>_siq_print <span class="free">x</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>𝟰</sup></span><span class="main">)</span>"</span>
  <span class="quoted">"_si_times <span class="main">(</span>_siq_print <span class="free">x</span><span class="main">)</span> <span class="main">(</span>_siq_print <span class="free">y</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>⋅</b></span> <span class="free">y</span><span class="main">)</span>"</span>

  <span class="quoted">"_si_metre"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="keyword1">CONST</span> metre<span class="main">)</span>"</span>
  <span class="quoted">"_si_kilogram"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="keyword1">CONST</span> kilogram<span class="main">)</span>"</span>
  <span class="quoted">"_si_second"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="keyword1">CONST</span> second<span class="main">)</span>"</span>
  <span class="quoted">"_si_ampere"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="keyword1">CONST</span> ampere<span class="main">)</span>"</span>
  <span class="quoted">"_si_kelvin"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="keyword1">CONST</span> kelvin<span class="main">)</span>"</span>
  <span class="quoted">"_si_mole"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="keyword1">CONST</span> mole<span class="main">)</span>"</span>
  <span class="quoted">"_si_candela"</span> <span class="main">&lt;=</span> <span class="quoted">"_siq_print <span class="main">(</span><span class="keyword1">CONST</span> candela<span class="main">)</span>"</span>

<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">SI[</span><span class="numeral">5</span><span class="main">,</span> <span class="keyword1">m</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">SI[</span><span class="numeral">22</span><span class="main">,</span> <span class="keyword1">m</span><span class="main">⋅</span><span class="keyword1">s</span><span class="main"><span class="hidden">⇧</span><sup>-</sup><span class="hidden">⇧</span><sup>1</sup></span><span class="main">]</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="BIS">
<div class="head">
<h1>Theory BIS</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ British Imperial System (1824/1897) ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> BIS
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#ISQ">ISQ</a> <a href="#SI_Units">SI_Units</a> <a href="#CGS">CGS</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The values in the British Imperial System (BIS) are derived from the UK Weights and Measures 
  Act 1824. ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Preliminaries ›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> BIS <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> unit set"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> BIS <span class="main">::</span> <span class="quoted">unit_system</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> unit_system_intro<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Abs_BIS <span class="main">()</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Abs_BIS_cases UNIV_eq_I insert_iff old.unit.exhaust<span class="main">)</span>
<span class="keyword1"><span class="command">instance</span></span> BIS <span class="main">::</span> <span class="quoted">time_second</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">BIS</span> <span class="main">≡</span> unit <span class="main">::</span> BIS"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Base Units ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">yard</span>     <span class="main">≡</span> <span class="keyword1">BUNIT(</span>L<span class="main">,</span> BIS<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">pound</span>    <span class="main">≡</span> <span class="keyword1">BUNIT(</span>M<span class="main">,</span> BIS<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">rankine</span>  <span class="main">≡</span> <span class="keyword1">BUNIT(</span>Θ<span class="main">,</span> BIS<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We chose Rankine rather than Farenheit as this is more compatible with the SI system and 
  avoids the need for having an offset in conversion functions. ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Derived Units ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">foot</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">3</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> yard"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">inch</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">12</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> foot"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">furlong</span> <span class="main">=</span> <span class="numeral">220</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> yard"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mile</span> <span class="main">=</span> <span class="numeral">1760</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> yard"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">acre</span> <span class="main">=</span> <span class="numeral">4840</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> yard<span class="main"><span class="hidden">⇧</span><sup>𝟯</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ounce</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">12</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> pound"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gallon</span> <span class="main">=</span> <span class="numeral">277.421</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> inch<span class="main"><span class="hidden">⇧</span><sup>𝟯</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">quart</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> gallon"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pint</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">8</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> gallon"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">peck</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> gallon"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bushel</span> <span class="main">=</span> <span class="numeral">8</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> gallon"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">minute</span> <span class="main">=</span> <span class="numeral">60</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> second"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">si_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hour</span> <span class="main">=</span> <span class="numeral">60</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> minute"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conversion to SI ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> BIS <span class="main">::</span> <span class="quoted">metrifiable</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">convschema_BIS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"BIS itself <span class="main">⇒</span> <span class="main">(</span>BIS<span class="main">,</span> SI<span class="main">)</span> Conversion"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⦇</span> cLengthF <span class="main">=</span> <span class="numeral">0.9143993</span><span class="main">,</span> cMassF <span class="main">=</span> <span class="numeral">0.453592338</span><span class="main">,</span> cTimeF <span class="main">=</span> <span class="main">1</span>
      <span class="main">,</span> cCurrentF <span class="main">=</span> <span class="main">1</span><span class="main">,</span> cTemperatureF <span class="main">=</span> <span class="numeral">5</span><span class="main">/</span><span class="numeral">9</span><span class="main">,</span> cAmountF <span class="main">=</span> <span class="main">1</span><span class="main">,</span> cIntensityF <span class="main">=</span> <span class="main">1</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="BIS-BIS_SI_simps"><span class="command">lemma</span></span> BIS_SI_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LengthF <span class="main">(</span>convschema <span class="main">(</span><span class="free">a</span><span class="main">::</span>BIS itself<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0.9143993</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"MassF <span class="main">(</span>convschema <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0.453592338</span>"</span></span>
                           <span class="quoted"><span class="quoted">"TimeF <span class="main">(</span>convschema <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"CurrentF <span class="main">(</span>convschema <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"TemperatureF <span class="main">(</span>convschema <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">5</span><span class="main">/</span><span class="numeral">9</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conversion Examples ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"metrify <span class="main">(</span>foot <span class="main">::</span> rat<span class="main">[</span>L<span class="main">,</span> BIS<span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">0.9143993</span> <span class="main">/</span> <span class="numeral">3</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> metre"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foot_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"metrify <span class="main">(</span><span class="main">(</span><span class="numeral">70</span><span class="main">::</span>rat<span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> mile <span class="main"><span class="hidden">❙</span><b>/</b></span> hour<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">704087461</span> <span class="main">/</span> <span class="numeral">22500000</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span>metre <span class="main"><span class="hidden">❙</span><b>/</b></span> second<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">si_simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">QMC(</span>CGS <span class="main">→</span> BIS<span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>rat<span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> centimetre<span class="main">)</span> <span class="main">=</span> <span class="numeral">100000</span> <span class="main">/</span> <span class="numeral">9143993</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>Q</sub></span> yard"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>