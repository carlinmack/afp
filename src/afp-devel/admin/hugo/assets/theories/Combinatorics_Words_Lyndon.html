<div id="Lyndon">
<div class="head">
<h1>Theory Lyndon</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      CoW_Lyndon.Lyndon
    Author:     Štěpán Holub, Charles University
    Author:     Štěpán Starosta, CTU in Prague
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Lyndon
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../combinatorics_words/theories/#CoWBasic">Combinatorics_Words.CoWBasic</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">"Lyndon words"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A Lyndon word is a non-empty word that is lexicographically 
strictly smaller than any other word in its conjugacy class, i.e., than any its rotations.
They are named after R. Lyndon who introduced them in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> Lyndon54<span class="antiquote"><span class="antiquote">}</span></span></span></span> as ``standard'' sequences.

We present elementary results on Lyndon words, mostly covered by results in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> ‹Chapter 5› Lo83
<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> Duval80 <span class="quasi_keyword"><span class="quasi_keyword">and</span></span> Duval83<span class="antiquote"><span class="antiquote">}</span></span></span></span>.

This definition assumes a linear order on letters given by the context.
›</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Definition and elementary properties"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Underlying order"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> linorder<span class="main">)</span> lexordp_mid_pref<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_class.lexordp <span class="free">u</span> <span class="free">v</span> <span class="main">⟹</span> ord_class.lexordp <span class="free">v</span> <span class="main">(</span><span class="free">u</span><span class="main">⋅</span><span class="free">s</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free">u</span> <span class="keyword1">≤p</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lexordp_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> linorder<span class="main">)</span> lexordp_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_class.lexordp <span class="free">u</span> <span class="free">v</span> <span class="main">⟹</span>  <span class="main">¬</span> <span class="free">u</span> <span class="keyword1">≤p</span> <span class="free">v</span> <span class="main">⟹</span> 
  ord_class.lexordp <span class="main">(</span><span class="free">u</span><span class="main">⋅</span><span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span><span class="main">⋅</span><span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lexordp_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>                         

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span> <span class="main">=</span> lexordp_simps

<span class="keyword1"><span class="command">context</span></span> linorder
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Lyndon_less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">&lt;lex</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Lyndon_less</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≡</span> ord_class.lexordp <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Lyndon_le</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≤lex</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Lyndon_le</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≡</span> ord_class.lexordp_eq <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rlex<span class="main">:</span> linorder <span class="quoted"><span class="quoted">"<span class="keyword1">(≤lex)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(&lt;lex)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> lexordp_linorder<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> dual_rlex<span class="main">:</span> linorder <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="keyword1">≤lex</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="keyword1">&lt;lex</span> <span class="bound">x</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> rlex.dual_linorder<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Lyndon-sorted_dual_rev_iff"><span class="command">lemma</span></span> sorted_dual_rev_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"dual_rlex.sorted <span class="free">ws</span> <span class="main">⟷</span> rlex.sorted <span class="main">(</span>rev <span class="free">ws</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rlex.sorted_rev_iff_nth_mono dual_rlex.sorted_iff_nth_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Several useful lemmas that are formulated for relations, interpreted for the default linear order.›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> lexord_suf_linorder <span class="main">=</span> lexord_sufE<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> lexordp_conv_lexord<span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> lexord_append_leftI_linorder <span class="main">=</span> lexord_append_leftI<span class="main">[</span><span class="operator">of</span>  <span class="main">_</span> <span class="main">_</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="main">_</span><span class="main">,</span> <span class="operator">folded</span> lexordp_conv_lexord<span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> lexord_app_right_linorder <span class="main">=</span> lexord_sufI<span class="main">[</span><span class="operator">of</span>  <span class="main">_</span> <span class="main">_</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="main">_</span><span class="main">,</span> <span class="operator">folded</span> lexordp_conv_lexord<span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> lexord_take_index_conv_linorder <span class="main">=</span> lexord_take_index_conv<span class="main">[</span><span class="operator">of</span>  <span class="main">_</span> <span class="main">_</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> lexordp_conv_lexord<span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> mismatch_lexord_linorder <span class="main">=</span> mismatch_lexord<span class="main">[</span><span class="operator">of</span>  <span class="main">_</span> <span class="main">_</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> lexordp_conv_lexord<span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> lexord_cancel_right_linorder <span class="main">=</span> lexord_cancel_right<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> lexordp_conv_lexord<span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Lyndon word definition"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Lyndon</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Lyndon</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">&lt;lex</span> rotate <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Lyndon-LyndonD"><span class="command">lemma</span></span> LyndonD<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">&lt;lex</span> rotate <span class="free">n</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Lyndon.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lyndon-LyndonD_nemp"><span class="command">lemma</span></span> LyndonD_nemp<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Lyndon.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lyndon-LyndonI"><span class="command">lemma</span></span> LyndonI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">⟶</span> <span class="free">w</span> <span class="keyword1">&lt;lex</span> rotate <span class="bound">n</span> <span class="free">w</span> <span class="main">⟹</span>  Lyndon <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Lyndon.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lyndon-Lyndon_sing"><span class="command">lemma</span></span> Lyndon_sing<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> Lyndon.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Lyndon-Lyndon_prim"><span class="command">lemma</span></span> Lyndon_prim<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"primitive <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">⟹</span> rotate <span class="skolem">n</span> <span class="free">w</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> LyndonD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> rlex.less_irrefl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">from</span></span> no_rotate_prim<span class="main">[</span><span class="operator">OF</span> LyndonD_nemp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lyndon-Lyndon_conj_greater"><span class="command">lemma</span></span> Lyndon_conj_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span><span class="free">u</span><span class="main">⋅</span><span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> <span class="free">u</span><span class="main">⋅</span><span class="free">v</span> <span class="keyword1">&lt;lex</span> <span class="free">v</span><span class="main">⋅</span><span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> LyndonD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">⋅</span><span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">u</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> rotate_append<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Code equations for Lyndon words"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">Lyndon_rec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Lyndon_rec</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">0</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">Lyndon_rec</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">&lt;lex</span> rotate <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">then</span> <span class="free">Lyndon_rec</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> False<span class="main">)</span>"</span></span>

<span class="keyword1" id="Lyndon-Lyndon_rec_all"><span class="command">lemma</span></span> Lyndon_rec_all<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lyndon_rec <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">a</span><span class="main">#</span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> Lyndon_rec <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">w</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> strict_inc_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Lyndon_rec.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lyndon-Lyndon_Lyndon_rec"><span class="command">lemma</span></span> Lyndon_Lyndon_rec<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">⟹</span> Lyndon_rec <span class="free">w</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> rotate <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LyndonD Suc.prems<span class="main">(</span>2<span class="main">)</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.IH<span class="main">[</span><span class="operator">OF</span> _ Suc_lessD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">folded</span> neq0_conv<span class="main">]</span> Lyndon_rec.simps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_rec.simps<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lyndon-Lyndon_code"><span class="command">lemma</span></span> Lyndon_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"Lyndon Nil <span class="main">=</span> False"</span></span> 
    <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> Lyndon_rec <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Lyndon Nil <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">#</span> <span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟹</span> Lyndon_rec <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">w</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">w</span><span class="main">)</span> <span class="keyword1">&lt;lex</span> rotate <span class="skolem">n</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_rec.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">#</span><span class="free">w</span>"</span></span><span class="main">]</span> gr0_implies_Suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> bx<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon_rec <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">a</span><span class="main">#</span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">⟶</span> Lyndon_rec <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">w</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="keyword1">ε</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">folded</span> length_greater_0_conv<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Lyndon_rec_all<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> length_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> lessI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> Lyndon_rec <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">w</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bx Lyndon.simps
    <span class="keyword1"><span class="command">using</span></span> ax  LyndonI<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">#</span> <span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span>Lyndon_Lyndon_rec <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Properties of Lyndon words"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Lyndon words are unbordered"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Lyndon_unbordered<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bordered <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bordered <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> bordered_dec<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">⋅</span><span class="skolem">v</span><span class="main">⋅</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span><span class="keyword1"><span class="command">.</span></span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">⋅</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">⋅</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">note</span></span> lyn <span class="main">=</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span><span class="main">[</span><span class="operator">folded</span>  <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">⋅</span><span class="skolem">v</span><span class="main">⋅</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">w</span>›</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">⋅</span><span class="skolem">v</span><span class="main">⋅</span><span class="skolem">u</span> <span class="keyword1">&lt;lex</span> <span class="skolem">v</span><span class="main">⋅</span><span class="skolem">u</span><span class="main">⋅</span><span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_conj_greater<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">⋅</span><span class="skolem">u</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> lyn <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">⋅</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">,</span> <span class="operator">unfolded</span> rassoc<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> lassoc<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">⋅</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">v</span> <span class="main">⋅</span> <span class="skolem">u</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> lexord_suf_linorder<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">⋅</span><span class="skolem">v</span> <span class="keyword1">&lt;lex</span> <span class="skolem">v</span><span class="main">⋅</span><span class="skolem">u</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">⋅</span><span class="skolem">v</span><span class="main">⋅</span><span class="skolem">u</span> <span class="keyword1">&lt;lex</span> <span class="skolem">v</span><span class="main">⋅</span><span class="skolem">u</span><span class="main">⋅</span><span class="skolem">u</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> lexord_append_leftI_linorder<span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">⋅</span><span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">⋅</span><span class="skolem">u</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> lassoc<span class="main">,</span> <span class="operator">OF</span> this<span class="main">,</span> <span class="operator">unfolded</span> rassoc<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">⋅</span><span class="skolem">u</span><span class="main">⋅</span><span class="skolem">v</span> <span class="keyword1">&lt;lex</span> <span class="skolem">u</span><span class="main">⋅</span><span class="skolem">v</span><span class="main">⋅</span><span class="skolem">u</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> this Lyndon_conj_greater<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">⋅</span><span class="skolem">v</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">,</span> <span class="operator">unfolded</span> rassoc<span class="main">,</span> <span class="operator">OF</span> lyn <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">⋅</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Each conjugacy class contains a Lyndon word"</span></span>

<span class="keyword1" id="Lyndon-conjug_Lyndon_ex"><span class="command">lemma</span></span> conjug_Lyndon_ex<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"primitive <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span>rotate <span class="free">n</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  prim_nemp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹primitive <span class="free">w</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ConClass</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>rotate <span class="bound">n</span> <span class="free">w</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ConClass</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="var">?ConClass</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> id_apply<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">,</span> <span class="operator">folded</span> rotate0<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?ConClass</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> all_rot<span class="main">:</span> <span class="quoted"><span class="quoted">"rotate <span class="skolem">m</span> <span class="free">w</span> <span class="main">∈</span> <span class="var">?ConClass</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">using</span></span> rotate_conv_mod<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> mod_less_divisor<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">∈</span> <span class="var">?ConClass</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> all_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">b</span> <span class="main">∈</span> <span class="var">?ConClass</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">≤lex</span> <span class="skolem">w'</span> <span class="main">⟶</span> <span class="skolem">w'</span> <span class="main">=</span> <span class="bound">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">=</span> rotate <span class="skolem">n</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rlex.finite_has_minimal<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="var">?ConClass</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ConClass</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rotate <span class="skolem">n</span> <span class="free">w</span> <span class="keyword1">&lt;lex</span> rotate <span class="skolem">na</span> <span class="main">(</span>rotate <span class="skolem">n</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span>  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">na</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">na</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">na</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> prim_no_rotate<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> prim_rotate_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">na</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">na</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">na</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rotate <span class="skolem">na</span> <span class="main">(</span>rotate <span class="skolem">n</span> <span class="free">w</span><span class="main">)</span> <span class="main">≠</span> rotate <span class="skolem">n</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rotate <span class="skolem">na</span> <span class="main">(</span>rotate <span class="skolem">n</span> <span class="free">w</span><span class="main">)</span> <span class="keyword1">≤lex</span> rotate <span class="skolem">n</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_b<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> all_rot<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">na</span> <span class="main">+</span> <span class="skolem">n</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">folded</span> rotate_rotate<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">na</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">w</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> w'
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> rlex.not_le_imp_less<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rotate <span class="skolem">n</span> <span class="free">w</span> <span class="keyword1">&lt;lex</span> rotate <span class="skolem">na</span> <span class="main">(</span>rotate <span class="skolem">n</span> <span class="free">w</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span>rotate <span class="skolem">n</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> that<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lyndon-conjug_Lyndon_ex'"><span class="command">lemma</span></span> conjug_Lyndon_ex'<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"primitive <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">v</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∼</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conjug_rotate_iff
  <span class="keyword1"><span class="command">using</span></span> conjug_Lyndon_ex<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹primitive <span class="free">w</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Characterization by suffixes"</span></span>

<span class="keyword1" id="Lyndon-Lyndon_suf_less"><span class="command">lemma</span></span> Lyndon_suf_less<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">≤ns</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> take <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">s</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="free">w</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">s</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">≤</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nsD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="keyword1">≤ns</span> <span class="free">w</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">≤p</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>|</b></span><span class="skolem">p</span><span class="main"><span class="hidden">❙</span><b>|</b></span>  <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">s</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_def
    <span class="keyword1"><span class="command">using</span></span> take_is_prefix <span class="quoted"><span class="quoted">‹<span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">s</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">≤</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span> take_len <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="free">s</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Lyndon_unbordered<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="keyword1">≤ns</span> <span class="free">w</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> drop <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">s</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> take <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="skolem">p'</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">⋅</span><span class="skolem">p'</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">⋅</span><span class="free">s</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p'_def p_def s'_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="keyword1">≤ns</span> <span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>|</b></span><span class="skolem">p'</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="skolem">s'</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s'_def <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">⋅</span><span class="skolem">p'</span> <span class="main">=</span> <span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> <span class="free">s</span><span class="main">⋅</span><span class="skolem">s'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_conj_greater<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s'</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">,</span> <span class="operator">unfolded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">⋅</span> <span class="free">s</span> <span class="main">=</span> <span class="free">w</span>›</span></span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="free">s</span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">⋅</span> <span class="free">s</span> <span class="main">=</span> <span class="free">w</span>›</span></span> p_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">⋅</span> <span class="free">s</span> <span class="main">=</span> <span class="free">w</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> lexord_suf_linorder<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="hidden">❙</span><b>|</b></span><span class="skolem">p</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">s</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="hidden">❙</span><b>|</b></span><span class="skolem">p'</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="skolem">s'</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span><span class="main">,</span> <span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">⋅</span> <span class="skolem">p'</span> <span class="main">=</span> <span class="free">w</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">&lt;lex</span> <span class="free">s</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> lexord_app_right_linorder<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="keyword1">ε</span></span><span class="main">,</span> <span class="operator">unfolded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">⋅</span> <span class="skolem">p'</span> <span class="main">=</span> <span class="free">w</span>›</span></span><span class="main">]</span>  <span class="quoted"><span class="quoted">‹<span class="main"><span class="hidden">❙</span><b>|</b></span><span class="skolem">p</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">=</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">s</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO zkusit pouzit jinde *)</span>
<span class="keyword1" id="Lyndon-Lyndon_pref_suf_less"><span class="command">lemma</span></span> Lyndon_pref_suf_less<span class="main">:</span>  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">≤p</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">≤ns</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">&lt;lex</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">w</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lyndon_suf_less<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">&lt;lex</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> rlex.less_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">&lt;lex</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> lexordp_append_rightI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lyndon_suf_less assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lyndon-suf_less_Lyndon"><span class="command">lemma</span></span> suf_less_Lyndon<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">≤ns</span> <span class="free">w</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">≠</span> <span class="free">w</span> <span class="main">⟶</span> <span class="free">w</span> <span class="keyword1">&lt;lex</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"primitive <span class="free">w</span>"</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> primitive <span class="free">w</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">k</span><span class="main">=</span><span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main">≠</span><span class="skolem">q</span>"</span></span> <span class="comment1">― ‹the exact match of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> non_prim<span class="antiquote">}</span></span> fastens the proof considerably›</span>
    <span class="keyword1"><span class="command">using</span></span> non_prim<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> primitive <span class="free">w</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">≤ns</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nonempty_suffix_def pow_eq_if_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> pow_commutes_list<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> sufI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main"><span class="hidden">⇧</span><sup>@</sup></span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">&lt;p</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main"><span class="hidden">⇧</span><sup>@</sup></span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">w</span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> pow_eq_if_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> pow_eq_if_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> lexordp_append_rightI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">¯<span class="hidden">⇧</span><sup>&gt;</sup></span><span class="free">w</span>"</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">,</span> 
      <span class="operator">unfolded</span> lq_pref<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sprefD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> this<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">OF</span> lq_spref<span class="main"><span class="main">[</span></span><span class="operator">OF</span> this<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">&lt;lex</span> <span class="free">w</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Lyndon.simps <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="keyword1">≤ns</span> <span class="free">w</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> rlex.order.strict_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"primitive <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> rotate <span class="skolem">l</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> assms_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span>  
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">l</span> <span class="free">w</span> <span class="keyword1">≤np</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>|</b></span>take <span class="skolem">l</span> <span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">=</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms_l take_is_prefix  <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="skolem">l</span> <span class="free">w</span> <span class="keyword1">≤ns</span> <span class="free">w</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span> suffix_drop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="skolem">l</span> <span class="free">w</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> append_take_drop_id<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> npD'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹take <span class="skolem">l</span> <span class="free">w</span> <span class="keyword1">≤np</span> <span class="free">w</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"drop <span class="skolem">l</span> <span class="free">w</span> <span class="main">⋅</span> take <span class="skolem">l</span> <span class="free">w</span> <span class="main">=</span> rotate <span class="skolem">l</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rotate_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"take <span class="skolem">l</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"drop <span class="skolem">l</span> <span class="free">w</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">,</span> <span class="operator">unfolded</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="hidden">❙</span><b>|</b></span>take <span class="skolem">l</span> <span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">=</span> <span class="skolem">l</span>›</span></span><span class="main">,</span> 
          <span class="operator">unfolded</span> append_take_drop_id<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> drop <span class="skolem">l</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹drop <span class="skolem">l</span> <span class="free">w</span> <span class="keyword1">≤ns</span> <span class="free">w</span>›</span></span> <span class="quoted"><span class="quoted">‹drop <span class="skolem">l</span> <span class="free">w</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> lexord_app_right_linorder<span class="main">[</span><span class="operator">OF</span> this suffix_length_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conjunct2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹drop <span class="skolem">l</span> <span class="free">w</span> <span class="keyword1">≤ns</span> <span class="free">w</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nonempty_suffix_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="keyword1">ε</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">l</span> <span class="free">w</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span>  append.right_neutral<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> drop <span class="skolem">l</span> <span class="free">w</span> <span class="main">⋅</span> take <span class="skolem">l</span> <span class="free">w</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> rotate <span class="skolem">l</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹drop <span class="skolem">l</span> <span class="free">w</span> <span class="main">⋅</span> take <span class="skolem">l</span> <span class="free">w</span> <span class="main">=</span> rotate <span class="skolem">l</span> <span class="free">w</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> local.LyndonI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Lyndon_suf_char<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> Lyndon <span class="free">w</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">≤ns</span> <span class="free">w</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">≠</span> <span class="free">w</span> <span class="main">⟶</span> <span class="free">w</span> <span class="keyword1">&lt;lex</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Lyndon_suf_less suf_less_Lyndon <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lyndon-Lyndon_suf_le"><span class="command">lemma</span></span> Lyndon_suf_le<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span> <span class="main">⟹</span> <span class="free">s</span> <span class="keyword1">≤ns</span> <span class="free">w</span> <span class="main">⟹</span> <span class="free">w</span> <span class="keyword1">≤lex</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Lyndon_suf_less rlex.not_less rlex.order.asym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Unbordered prefix of a Lyndon word is Lyndon"</span></span>

<span class="keyword1" id="Lyndon-unbordered_pref_Lyndon"><span class="command">lemma</span></span> unbordered_pref_Lyndon<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span><span class="free">u</span><span class="main">⋅</span><span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> <span class="main">¬</span> bordered <span class="free">u</span> <span class="main">⟹</span> Lyndon <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_suf_char
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span><span class="free">u</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bordered <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">≤ns</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">⋅</span> <span class="free">v</span> <span class="keyword1">&lt;lex</span> <span class="skolem">s</span> <span class="main">⋅</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  Lyndon_suf_less<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="main">(</span><span class="free">u</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">)</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⋅</span> <span class="free">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">s</span> <span class="keyword1">≤p</span> <span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> bordered <span class="free">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">≤ns</span> <span class="free">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">u</span> <span class="keyword1">≤p</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> suf_pref_eq<span class="main">[</span><span class="operator">OF</span> nsD<span class="main"><span class="main">[</span></span><span class="operator">OF</span><span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">≤ns</span> <span class="free">u</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">&lt;lex</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lexord_cancel_right_linorder<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">⋅</span> <span class="free">v</span> <span class="keyword1">&lt;lex</span> <span class="skolem">s</span> <span class="main">⋅</span> <span class="free">v</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Concatenation of Lyndon words"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Lyndon_concat<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"Lyndon <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">&lt;lex</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span><span class="free">u</span><span class="main">⋅</span><span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">⋅</span><span class="free">v</span> <span class="keyword1">&lt;lex</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">≤p</span> <span class="free">v</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">≤p</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">≤ns</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> dual_rlex.less_imp_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Lyndon_suf_less<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">v</span>›</span></span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">THEN</span> lexord_append_leftI_linorder<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
      LyndonD_nemp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">u</span>›</span></span><span class="main">]</span> this<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">u</span> <span class="keyword1">≤p</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> local.lexordp_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">⋅</span><span class="free">v</span>"</span></span><span class="main">]</span> 
        local.lexordp_mid_pref<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="keyword1">&lt;lex</span> <span class="free">v</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
        prefixI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">≤ns</span> <span class="main">(</span><span class="free">u</span><span class="main">⋅</span><span class="free">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="free">u</span><span class="main">⋅</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">⋅</span><span class="free">v</span> <span class="keyword1">&lt;lex</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">≤ns</span> <span class="free">v</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">≤ns</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> Lyndon_suf_less<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">v</span>›</span></span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">v</span> <span class="keyword1">&lt;lex</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">⋅</span><span class="free">v</span> <span class="keyword1">&lt;lex</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">⋅</span> <span class="free">v</span> <span class="keyword1">&lt;lex</span> <span class="free">v</span>›</span></span> rlex.less_trans
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">z</span> <span class="keyword1">≤ns</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="keyword1">≤ns</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span><span class="main">⋅</span><span class="free">v</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="keyword1">≤ns</span> <span class="free">u</span> <span class="main">⋅</span> <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="free">u</span> <span class="main">⋅</span> <span class="free">v</span>›</span></span> suffix_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> nonempty_suffix_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> Lyndon_suf_less<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">u</span>›</span></span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">&lt;lex</span> <span class="skolem">z'</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">⋅</span><span class="free">v</span> <span class="keyword1">&lt;lex</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="keyword1">≤ns</span> <span class="free">u</span>›</span></span> lexord_app_right_linorder<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="skolem">z'</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> suffix_length_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z'</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> nonempty_suffix_def <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">⋅</span> <span class="free">v</span> <span class="main">=</span> <span class="skolem">z</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> suf_nemp<span class="main">[</span><span class="operator">OF</span> LyndonD_nemp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">v</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">,</span> <span class="operator">THEN</span> suf_less_Lyndon<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Longest Lyndon suffix"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">longest_Lyndon_suffix</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">LynSuf</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">longest_Lyndon_suffix</span> <span class="keyword1">ε</span> <span class="main">=</span> <span class="keyword1">ε</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">longest_Lyndon_suffix</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> Lyndon <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">else</span> <span class="free">longest_Lyndon_suffix</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Lyndon-longest_Lyndon_suf_ext"><span class="command">lemma</span></span> longest_Lyndon_suf_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Lyndon <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">w</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">LynSuf</span> <span class="free">w</span> <span class="main">=</span> <span class="keyword1">LynSuf</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> longest_Lyndon_suffix.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="Lyndon-longest_Lyndon_suf_suf"><span class="command">lemma</span></span> longest_Lyndon_suf_suf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> <span class="keyword1">LynSuf</span> <span class="free">w</span> <span class="keyword1">≤s</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> longest_Lyndon_suffix.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">w</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"2.IH"</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">unfolded</span> longest_Lyndon_suf_ext<span class="main"><span class="main">[</span></span><span class="operator">OF</span> this<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">THEN</span> suffix_ConsI<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
      Lyndon_sing False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lyndon-longest_Lyndon_suf_max"><span class="command">lemma</span></span> longest_Lyndon_suf_max<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">≤s</span> <span class="free">w</span>  <span class="main">⟹</span> Lyndon <span class="free">v</span> <span class="main">⟹</span> <span class="free">v</span> <span class="keyword1">≤s</span> <span class="main">(</span><span class="keyword1">LynSuf</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> longest_Lyndon_suffix.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> longest_Lyndon_suffix.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">w</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2.prems"</span><span class="main">(</span>1<span class="main">)</span> longest_Lyndon_suffix.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2.prems"</span><span class="main">(</span>2<span class="main">)</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"2.IH"</span><span class="main">[</span><span class="operator">OF</span> False _ <span class="quoted">"2.prems"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">unfolded</span> longest_Lyndon_suf_ext<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">]</span>
       <span class="quoted">"2.prems"</span><span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> suffix_Cons<span class="main">]</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lyndon-longest_Lyndon_suf_Lyndon_id"><span class="command">lemma</span></span> longest_Lyndon_suf_Lyndon_id<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynSuf</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="keyword1">ε</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> longest_Lyndon_suf_suf<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    suffix_order.order_refl<span class="main">[</span><span class="operator">THEN</span> longest_Lyndon_suf_max<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">]</span></span><span class="main">]</span>
    suffix_order.order.antisym 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lyndon-longest_Lyndon_suf_longest"><span class="command">lemma</span></span> longest_Lyndon_suf_longest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> <span class="free">v'</span> <span class="keyword1">≤s</span> <span class="free">w</span> <span class="main">⟹</span> Lyndon <span class="free">v'</span> <span class="main">⟹</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">v'</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">≤</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="main">(</span><span class="keyword1">LynSuf</span> <span class="free">w</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> longest_Lyndon_suf_max suffix_length_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lyndon-longest_Lyndon_suf_sing"><span class="command">lemma</span></span> longest_Lyndon_suf_sing<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynSuf</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Lyndon_sing longest_Lyndon_suf_Lyndon_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lyndon-longest_Lyndon_suf_Lyndon"><span class="command">lemma</span></span> longest_Lyndon_suf_Lyndon<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> Lyndon <span class="main">(</span><span class="keyword1">LynSuf</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> longest_Lyndon_suffix.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">w</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> longest_Lyndon_suf_Lyndon_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"2.IH"</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">unfolded</span> longest_Lyndon_suf_ext<span class="main"><span class="main">[</span></span><span class="operator">OF</span> this<span class="main"><span class="main">]</span></span><span class="main">]</span> Lyndon_sing
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="Lyndon-longest_Lyndon_suf_nemp"><span class="command">lemma</span></span> longest_Lyndon_suf_nemp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> <span class="keyword1">LynSuf</span> <span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> longest_Lyndon_suf_Lyndon<span class="main">[</span><span class="operator">THEN</span> LyndonD_nemp<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Lyndon-longest_Lyndon_sufI"><span class="command">lemma</span></span> longest_Lyndon_sufI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">≤s</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> all_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">≤s</span> <span class="free">w</span> <span class="main">∧</span> Lyndon <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="keyword1">≤s</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynSuf</span> <span class="free">w</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="keyword1">ε</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> longest_Lyndon_suffix.simps<span class="main">(</span>1<span class="main">)</span> suffix_bot.bot.extremum_uniqueI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> all_s longest_Lyndon_suf_Lyndon<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> longest_Lyndon_suf_max<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    longest_Lyndon_suf_suf<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> suffix_order.eq_iff
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> longest_Lyndon_sufI'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">≤s</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> all_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">≤s</span> <span class="free">w</span> <span class="main">∧</span> Lyndon <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="bound">s</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">≤</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">q</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynSuf</span> <span class="free">w</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> longest_Lyndon_sufI<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="keyword1">≤s</span> <span class="free">w</span>›</span></span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">q</span>›</span></span><span class="main">]</span> suf_ruler_le all_s <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="keyword1">≤s</span> <span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The next lemma is fabricated to suit the upcoming definition of longest Lyndon factorization.›</span></span>

<span class="keyword1" id="Lyndon-longest_Lyndon_suf_shorter"><span class="command">lemma</span></span> longest_Lyndon_suf_shorter<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="main">(</span><span class="keyword1">LynSuf</span> <span class="free">w</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nemp_len<span class="main">[</span><span class="operator">OF</span> longest_Lyndon_suf_nemp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> arg_cong<span class="main">[</span><span class="operator">OF</span> rq_suf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> longest_Lyndon_suf_suf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">length</span><span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> length_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>  

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Lyndon factorizations"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">Lyndon_fac</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list  <span class="main">⇒</span> <span class="tfree">'a</span> list list"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">LynFac</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Lyndon_fac</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span><span class="free">Lyndon_fac</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="main">(</span><span class="keyword1">LynSuf</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">[</span><span class="keyword1">LynSuf</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">]</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">ε</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> longest_Lyndon_suffix.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">termination</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure length"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">w</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="keyword1">LynSuf</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">∈</span> measure length"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> measure_def inv_image_def <span class="keyword1"><span class="command">using</span></span> longest_Lyndon_suf_shorter <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The factorization <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Lyndon_fac <span class="free"><span class="free">w</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> obtained by taking always the longest Lyndon suffix is well defined, 
and called ``Lyndon factorization (of $w$)''.›</span></span>


<span class="keyword1" id="Lyndon-Lyndon_fac_simp"><span class="command">lemma</span></span> Lyndon_fac_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> Lyndon_fac <span class="free">w</span> <span class="main">=</span>  Lyndon_fac <span class="main">(</span><span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="keyword1">LynSuf</span> <span class="free">w</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">LynSuf</span> <span class="free">w</span> <span class="main">#</span> <span class="keyword1">ε</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Lyndon_fac.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword1" id="Lyndon-Lyndon_fac_emp"><span class="command">lemma</span></span> Lyndon_fac_emp<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon_fac <span class="keyword1">ε</span> <span class="main">=</span> <span class="keyword1">ε</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Note that the Lyndon factorization of a Lyndon word is trivial.›</span></span>

<span class="keyword1" id="Lyndon-Lyndon_fac_longest_Lyndon_id"><span class="command">lemma</span></span> Lyndon_fac_longest_Lyndon_id<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span> <span class="main">⟹</span> Lyndon_fac <span class="free">w</span> <span class="main">=</span> <span class="main">[</span><span class="free">w</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> longest_Lyndon_suf_Lyndon_id<span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lyndon factorization is composed of Lyndon words ...›</span></span>

<span class="keyword1" id="Lyndon-Lyndon_fac_set"><span class="command">lemma</span></span> Lyndon_fac_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> set <span class="main">(</span>Lyndon_fac <span class="free">w</span><span class="main">)</span> <span class="main">⟹</span> Lyndon <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>  Lyndon_fac.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="keyword1">ε</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lyndon_fac <span class="skolem">w</span>  <span class="main">=</span> <span class="main">(</span>Lyndon_fac <span class="main">(</span><span class="skolem">w</span> <span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="main">(</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">[</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lyndon_fac_simp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> set_ConsD<span class="main">[</span><span class="operator">OF</span> <span class="quoted">"1.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> rotate1.simps<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynSuf</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"Lyndon_fac <span class="main">(</span><span class="skolem">w</span> <span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="main">(</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">)</span>"</span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">folded</span> this<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">symmetric</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> set_rotate1<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="keyword1">LynSuf</span> <span class="skolem">w</span> <span class="main">∨</span> <span class="free">z</span> <span class="main">∈</span> set <span class="main">(</span>Lyndon_fac <span class="main">(</span><span class="skolem">w</span> <span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="main">(</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.IH"</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span> longest_Lyndon_suf_Lyndon<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span>
      <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_fac_emp<span class="main">[</span><span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">=</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span> list.set<span class="main">(</span>1<span class="main">)</span> empty_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹...and it indeed is a factorization of the argument.›</span></span>

<span class="keyword1" id="Lyndon-Lyndon_fac_longest_dec"><span class="command">lemma</span></span> Lyndon_fac_longest_dec<span class="main">:</span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>Lyndon_fac <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lyndon_fac.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span><span class="keyword1">LynFac</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="keyword1">ε</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>Lyndon_fac <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span> <span class="main">(</span>Lyndon_fac <span class="main">(</span><span class="skolem">w</span> <span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="main">(</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">⋅</span> concat <span class="main">(</span><span class="main">[</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_fac_simp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span> concat_morph<span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> <span class="quoted">"1.IH"</span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main"><span class="main">]</span></span> concat_sing' rq_suf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> longest_Lyndon_suf_suf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemma makes explicit the inductive character of the definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Lyndon_fac</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Lyndon-Lyndon_fac_longest_pref"><span class="command">lemma</span></span> Lyndon_fac_longest_pref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">us</span> <span class="keyword1">≤p</span> Lyndon_fac <span class="free">w</span> <span class="main">⟹</span> Lyndon_fac <span class="main">(</span>concat <span class="free">us</span><span class="main">)</span> <span class="main">=</span> <span class="free">us</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">us</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>  Lyndon_fac.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynFac</span> <span class="main">(</span>concat <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="keyword1">ε</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon_fac <span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span>Lyndon_fac <span class="main">(</span><span class="skolem">w</span> <span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="main">(</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">[</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lyndon_fac_simp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>neq<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≠</span> Lyndon_fac <span class="skolem">w</span>"</span></span> <span class="main">|</span> <span class="main">(</span>eq<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> Lyndon_fac <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> le_neq_implies_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynFac</span> <span class="main">(</span>concat <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> neq
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="keyword1">≤p</span> Lyndon_fac <span class="main">(</span><span class="skolem">w</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> last_no_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">us</span></span> <span class="quoted"><span class="quoted">"Lyndon_fac <span class="main">(</span><span class="skolem">w</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynSuf</span> <span class="skolem">w</span>"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">unfolding</span></span> step<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynFac</span> <span class="main">(</span>concat <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">us</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.IH"</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> eq
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynFac</span> <span class="main">(</span>concat <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">us</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Lyndon_fac_longest_dec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">,</span> <span class="operator">folded</span> eq<span class="main">]</span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We give name to an important predicate: monotone (nonincreasing) list of Lyndon words.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Lyndon_mono</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list list <span class="main">⇒</span>  bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Lyndon_mono</span> <span class="free"><span class="bound"><span class="entity">ws</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">u</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ws</span></span></span><span class="main">.</span> Lyndon <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>rlex.sorted <span class="main">(</span>rev <span class="free"><span class="bound"><span class="entity">ws</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Lyndon-Lyndon_mono_set"><span class="command">lemma</span></span> Lyndon_mono_set<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="free">ws</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">∈</span> set <span class="free">ws</span> <span class="main">⟹</span> Lyndon <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lyndon-Lyndon_mono_sorted"><span class="command">lemma</span></span> Lyndon_mono_sorted<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="free">ws</span> <span class="main">⟹</span> rlex.sorted <span class="main">(</span>rev <span class="free">ws</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lyndon-Lyndon_mono_nth"><span class="command">lemma</span></span> Lyndon_mono_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="free">ws</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">ws</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">⟹</span> <span class="free">ws</span><span class="main">!</span><span class="free">j</span> <span class="keyword1">≤lex</span> <span class="free">ws</span><span class="main">!</span><span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_mono_def <span class="keyword1"><span class="command">using</span></span>  rlex.sorted_rev_nth_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lyndon-Lyndon_mono_empty"><span class="command">lemma</span></span> Lyndon_mono_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="keyword1">ε</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Lyndon-Lyndon_mono_sing"><span class="command">lemma</span></span> Lyndon_mono_sing<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">u</span> <span class="main">⟹</span> Lyndon_mono <span class="main">[</span><span class="free">u</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Lyndon-Lyndon_mono_fac_Lyndon_mono"><span class="command">lemma</span></span> Lyndon_mono_fac_Lyndon_mono<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="keyword1">≤f</span> <span class="free">ws</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="free">ws</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="free">ps</span>"</span></span>  
<span class="keyword1"><span class="command">unfolding</span></span> Lyndon_mono_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">ps</span><span class="main">)</span><span class="main">.</span> Lyndon <span class="bound">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Lyndon_mono <span class="free">ws</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> Lyndon_mono_def<span class="main">]</span> set_mono_sublist<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">ps</span> <span class="keyword1">≤f</span> <span class="free">ws</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"linorder.sorted <span class="keyword1">(≤lex)</span> <span class="main">(</span>rev <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rlex.sorted_append <span class="quoted"><span class="quoted">‹Lyndon_mono <span class="free">ws</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> Lyndon_mono_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">ps</span> <span class="keyword1">≤f</span> <span class="free">ws</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> sublist_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lyndon factorization is monotone! 
Altogether, we have shown that the Lyndon factorization is a monotone factorization 
into Lyndon words.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> fac_Lyndon_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="main">(</span>Lyndon_fac <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"Lyndon_fac <span class="free">w</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_fac_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">,</span> <span class="operator">unfolded</span> in_set_conv_decomp<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">,</span> <span class="operator">folded</span> snoc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_fac_longest_dec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">,</span> <span class="operator">folded</span> snoc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="main">(</span><span class="keyword1">LynFac</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="keyword1">ε</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="main">(</span><span class="keyword1">LynFac</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_mono_def <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> <span class="keyword1">LynFac</span> <span class="skolem">w</span>›</span></span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">=</span> <span class="keyword1">ε</span>›</span></span> append.left_neutral 
                rlex.sorted1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>  
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Lyndon <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lyndon_fac_longest_dec snoc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">LynSuf</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="keyword1">LynFac</span> <span class="main">(</span><span class="skolem">w</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span> <span class="main">)</span>"</span></span>           
      <span class="keyword1"><span class="command">using</span></span> Lyndon_fac.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">,</span> <span class="operator">folded</span> snoc.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span>
        Lyndon_fac_longest_dec append1_eq_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynFac</span> <span class="main">(</span><span class="skolem">w</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span> <span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynSuf</span> <span class="skolem">w</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>       
    <span class="keyword1"><span class="command">from</span></span> Lyndon_mono_sorted<span class="main">[</span><span class="operator">OF</span> snoc.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">=</span> <span class="keyword1">LynFac</span> <span class="main">(</span><span class="skolem">w</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span> <span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">folded</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dual_rlex.sorted  <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sorted_dual_rev_iff<span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lyndon_fac_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"last <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">=</span> <span class="keyword1">LynFac</span> <span class="main">(</span><span class="skolem">w</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="keyword1">LynSuf</span> <span class="skolem">w</span><span class="main">)</span>›</span></span><span class="main">,</span> <span class="operator">OF</span> last_in_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">≤lex</span> last <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">x</span> <span class="keyword1">≤lex</span> last <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">xs</span> <span class="keyword1">&lt;lex</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> Lyndon_concat<span class="main">[</span><span class="operator">OF</span>  <span class="quoted"><span class="quoted">‹Lyndon <span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Lyndon <span class="skolem">x</span>›</span></span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span><span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="keyword1">≤s</span> concat <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> concat_last_suf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> longest_Lyndon_suf_longest<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹concat <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span>  this <span class="quoted"><span class="quoted">‹Lyndon <span class="main">(</span><span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main">)</span>›</span></span><span class="main">,</span> 
          <span class="operator">unfolded</span> <span class="quoted"><span class="quoted">‹concat <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">w</span>›</span></span><span class="main">,</span> <span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">LynSuf</span> <span class="skolem">w</span>›</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Lyndon <span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dual_rlex.sorted <span class="main">(</span>butlast <span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span>last <span class="skolem">xs</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹linorder.sorted <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="keyword1">≤lex</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="keyword1">≤lex</span> last <span class="skolem">xs</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dual_rlex.sorted <span class="main">(</span>butlast <span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span>last <span class="skolem">xs</span><span class="main">,</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dual_rlex.sorted_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> hd_word<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"last <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span> lassoc append_butlast_last_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rlex.sorted <span class="main">(</span>rev <span class="main">(</span><span class="keyword1">LynFac</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> <span class="keyword1">LynFac</span> <span class="skolem">w</span>›</span></span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> sorted_dual_rev_iff<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="main">(</span><span class="keyword1">LynFac</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_mono_def <span class="keyword1"><span class="command">using</span></span> Lyndon_fac_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Now we want to show the converse: any monotone factorization into Lyndon words is the Lyndon factorization›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The last element in the Lyndon factorization is the smallest suffix.›</span></span>

<span class="keyword1" id="Lyndon-Lyndon_mono_last_smallest"><span class="command">lemma</span></span> Lyndon_mono_last_smallest<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="free">ws</span> <span class="main">⟹</span><span class="free">s</span> <span class="keyword1">≤ns</span> <span class="main">(</span>concat <span class="free">ws</span><span class="main">)</span> <span class="main">⟹</span> last <span class="free">ws</span> <span class="keyword1">≤lex</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ws</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">a</span> <span class="skolem">ws</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span><span class="main">⋅</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="skolem">ws</span><span class="main">⋅</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> last_in_set<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ws</span><span class="main">⋅</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">,</span> <span class="operator">unfolded</span> this<span class="main">]</span> <span class="quoted"><span class="quoted">‹Lyndon_mono <span class="main">(</span><span class="skolem">ws</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> Lyndon_mono_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">≤ns</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> Lyndon_suf_le<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="skolem">a</span>›</span></span><span class="main">]</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span><span class="main">⋅</span><span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False snoc.prems<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> concat_append<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">ws</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> concat_sing'<span class="main"><span class="main">]</span></span><span class="main">]</span> suffix_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">ws</span>"</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> nonempty_suffix_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="keyword1">≤ns</span> concat <span class="skolem">ws</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False snoc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="skolem">ws</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Lyndon_mono <span class="main">(</span><span class="skolem">ws</span><span class="main">⋅</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span>›</span></span> Lyndon_mono_fac_Lyndon_mono
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> snoc.hyps<span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="keyword1">≤ns</span> concat <span class="skolem">ws</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ws</span> <span class="keyword1">≤lex</span> <span class="skolem">s'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">ws</span> <span class="keyword1">≤lex</span> <span class="skolem">s'</span><span class="main">⋅</span><span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local.lexordp_eq_trans ord.lexordp_eq_pref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">≤lex</span> last <span class="skolem">ws</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Lyndon_mono <span class="main">(</span><span class="skolem">ws</span><span class="main">⋅</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_mono_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ws</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> last_ConsL<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> dual_rlex.order_trans<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹last <span class="skolem">ws</span> <span class="keyword1">≤lex</span> <span class="skolem">s'</span> <span class="main">⋅</span> <span class="skolem">a</span>›</span></span> this<span class="main">,</span> <span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span> <span class="main">⋅</span> <span class="skolem">a</span>›</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹last <span class="main">(</span><span class="skolem">ws</span><span class="main">⋅</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A monotone list, if seen as a factorization,
must end with the longest suffix›</span></span>

<span class="keyword1" id="Lyndon-Lyndon_mono_last_longest"><span class="command">lemma</span></span> Lyndon_mono_last_longest<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="free">ws</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynSuf</span> <span class="main">(</span>concat <span class="free">ws</span><span class="main">)</span> <span class="main">=</span> last <span class="free">ws</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span>last <span class="free">ws</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_mono_set assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> last_in_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="free">ws</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LyndonD_nemp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="free">ws</span> <span class="keyword1">≤ns</span> <span class="keyword1">LynSuf</span> <span class="main">(</span>concat <span class="free">ws</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> longest_Lyndon_suf_max<span class="main">[</span><span class="operator">OF</span>  concat_last_suf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹Lyndon <span class="main">(</span>last <span class="free">ws</span><span class="main">)</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> nonempty_suffix_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="free">ws</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon.simps assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> Lyndon_mono_def<span class="main">]</span> set_nemp_concat_nemp<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> longest_Lyndon_suf_nemp<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> longest_Lyndon_suf_suf<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LynSuf</span> <span class="main">(</span>concat <span class="free">ws</span><span class="main">)</span> <span class="keyword1">≤ns</span> concat <span class="free">ws</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nonempty_suffix_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_mono_last_smallest<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon_mono <span class="free">ws</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">LynSuf</span> <span class="main">(</span>concat <span class="free">ws</span><span class="main">)</span> <span class="keyword1">≤ns</span> concat <span class="free">ws</span>›</span></span><span class="main">]</span>
      Lyndon_suf_le<span class="main">[</span><span class="operator">OF</span> longest_Lyndon_suf_Lyndon<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹concat <span class="free">ws</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹last <span class="free">ws</span> <span class="keyword1">≤ns</span> <span class="keyword1">LynSuf</span> <span class="main">(</span>concat <span class="free">ws</span><span class="main">)</span>›</span></span><span class="main">]</span>
      dual_rlex.eq_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Therefore, by construction, 
any monotone list is the Lyndon factorization of its concatenation›</span></span>

<span class="keyword1" id="Lyndon-Lyndon_mono_fac"><span class="command">lemma</span></span> Lyndon_mono_fac<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Lyndon_mono <span class="free">ws</span> <span class="main">⟹</span> <span class="free">ws</span> <span class="main">=</span> Lyndon_fac <span class="main">(</span>concat <span class="free">ws</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ws</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Lyndon_mono <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>›</span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> Lyndon_mono_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">from</span></span> snoc.hyps<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="keyword1">LynFac</span> <span class="main">(</span>concat <span class="skolem">xs</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">LynSuf</span> <span class="main">(</span>concat <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_mono_last_longest<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹Lyndon_mono <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>›</span></span><span class="main">,</span> <span class="operator">unfolded</span> last_snoc<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="skolem">x</span> <span class="main">=</span> concat <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_mono_set snoc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_fac.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">LynSuf</span> <span class="main">(</span>concat <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main">,</span>
        <span class="operator">unfolded</span> <span class="quoted"><span class="quoted">‹concat <span class="main">(</span><span class="skolem">xs</span> <span class="main">⋅</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>&lt;</sup>¯</span><span class="skolem">x</span> <span class="main">=</span> concat <span class="skolem">xs</span>›</span></span><span class="main">,</span> <span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">=</span> <span class="keyword1">LynFac</span> <span class="main">(</span>concat <span class="skolem">xs</span><span class="main">)</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This implies that the Lyndon factorization can be characterized
in two equivalent ways: as the (unique) monotone factorization (into Lyndon words) or as
the "suffix greedy" factorization (into Lyndon words).
›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Lyndon_mono_fac_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="free">ws</span> <span class="main">⟷</span> <span class="free">ws</span> <span class="main">=</span> <span class="keyword1">LynFac</span> <span class="main">(</span>concat <span class="free">ws</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Lyndon_mono_fac fac_Lyndon_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"concat <span class="free">ws</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">corollary</span></span> Lyndon_mono_unique<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="free">ws</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Lyndon_mono <span class="free">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"concat <span class="free">ws</span> <span class="main">=</span> concat <span class="free">zs</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">=</span> <span class="free">zs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Lyndon_mono_fac<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon_mono <span class="free">ws</span>›</span></span><span class="main">]</span> Lyndon_mono_fac<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon_mono <span class="free">zs</span>›</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹concat <span class="free">ws</span> <span class="main">=</span> concat <span class="free">zs</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Standard factorization"</span></span>

<span class="keyword1" id="Lyndon-Lyndon_std"><span class="command">lemma</span></span> Lyndon_std<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">l</span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="free">l</span><span class="main">⋅</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="keyword1">&lt;lex</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="quoted"><span class="quoted">"tl <span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span> long_list_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="keyword1">LynSuf</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹tl <span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> local.longest_Lyndon_suf_Lyndon <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">≤s</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> m_def 
    <span class="keyword1"><span class="command">using</span></span> suffix_order.order.trans<span class="main">[</span><span class="operator">OF</span> longest_Lyndon_suf_suf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹tl <span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main"><span class="main">]</span></span> suffix_tl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">using</span></span>  hd_word'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span> list.simps<span class="main">(</span>3<span class="main">)</span> longest_Lyndon_suf_suf<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹tl <span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span> same_suffix_nil
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">⋅</span><span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="skolem">l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> unbordered_pref_Lyndon<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">⋅</span><span class="skolem">m</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bordered <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> unbordered_border<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">unfolded</span> border_def<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">≤p</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">≤s</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bordered <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="skolem">s</span>"</span></span>       
      <span class="keyword1"><span class="command">using</span></span> unbordered_pref_Lyndon<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> bordered <span class="skolem">s</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">¯<span class="hidden">⇧</span><sup>&gt;</sup></span><span class="skolem">l</span><span class="main">⋅</span><span class="skolem">m</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> lassoc lq_pref<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">≤p</span> <span class="skolem">l</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">⋅</span> <span class="skolem">m</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">&lt;lex</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lyndon_pref_suf_less<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span> _ nsI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> LyndonD_nemp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="skolem">m</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="keyword1">≤s</span> <span class="free">w</span>›</span></span><span class="main"><span class="main">]</span></span> 
         <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="free">w</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> Lyndon.elims<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="skolem">m</span>›</span></span><span class="main">]</span>  
         <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">≤p</span> <span class="skolem">l</span>›</span></span> prefix_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">,</span> <span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">⋅</span> <span class="skolem">m</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">from</span></span> Lyndon_concat<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="skolem">s</span>›</span></span> <span class="quoted"><span class="quoted">‹Lyndon <span class="skolem">m</span>›</span></span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="main">(</span><span class="skolem">s</span><span class="main">⋅</span><span class="skolem">m</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⋅</span><span class="skolem">m</span> <span class="keyword1">≤s</span> tl <span class="free">w</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">⋅</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">l</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">≤s</span> <span class="skolem">l</span>›</span></span> list.collapse<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">,</span> <span class="operator">unfolded</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">⋅</span> <span class="skolem">m</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> m_def <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> longest_Lyndon_suf_max same_suffix_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="keyword1">&lt;lex</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_pref_suf_less<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span> prefI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">⋅</span> <span class="skolem">m</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> 
        nsI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> longest_Lyndon_suf_nemp<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹tl <span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">folded</span>  m_def<span class="main"><span class="main"><span class="main">]</span></span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="keyword1">≤s</span> <span class="free">w</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="free">w</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> that<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">⋅</span> <span class="skolem">m</span>›</span></span> <span class="quoted"><span class="quoted">‹Lyndon <span class="skolem">l</span>›</span></span>  <span class="quoted"><span class="quoted">‹Lyndon <span class="skolem">m</span>›</span></span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Lyndon_std_iff<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span> <span class="main">⟷</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">l</span> <span class="bound">m</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">l</span><span class="main">⋅</span><span class="bound">m</span> <span class="main">∧</span> Lyndon <span class="bound">l</span> <span class="main">∧</span> Lyndon <span class="bound">m</span> <span class="main">∧</span> <span class="bound">l</span> <span class="keyword1">&lt;lex</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_std<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span><span class="main">]</span> 
      nemp_pos_len<span class="main">[</span><span class="operator">OF</span> LyndonD_nemp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">unfolded</span> le_eq_less_or_eq<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">l</span> <span class="bound">m</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">⋅</span> <span class="bound">m</span> <span class="main">∧</span> Lyndon <span class="bound">l</span> <span class="main">∧</span> Lyndon <span class="bound">m</span> <span class="main">∧</span> <span class="bound">l</span> <span class="keyword1">&lt;lex</span> <span class="bound">m</span> <span class="main">⟹</span> Lyndon <span class="free">w</span>›</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Lyndon_concat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>  <span class="comment1">― ‹end context linorder›</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Lyndon_Addition">
<div class="head">
<h1>Theory Lyndon_Addition</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      CoW_Lyndon.Lyndon_Addition
    Author:     Štěpán Holub, Charles University
    Author:     Štěpán Starosta, CTU in Prague
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Lyndon_Addition
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Lyndon">Lyndon</a> <a href="../../szpilrajn/theories/#Szpilrajn">Szpilrajn.Szpilrajn</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"The minimal relation"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the minimal relation which guarantees the lexicographic minimality of w compared to its 
nontrivial conjugates.›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">rotate_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">w</span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">⟹</span> <span class="main">(</span>mismatch_pair <span class="free">w</span> <span class="main">(</span>rotate <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rotate_rel</span> <span class="free">w</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A word is Lyndon iff the corresponding order of letters is compatible with  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"rotate_rel <span class="free"><span class="free">w</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> linorder<span class="main">)</span> rotate_rel_iff<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span> <span class="main">⟷</span> rotate_rel <span class="free">w</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Lyndon <span class="free">w</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rotate_rel <span class="free">w</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span>  <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> rotate_rel <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> mismatch_pair <span class="free">w</span> <span class="main">(</span>rotate <span class="skolem">n</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rotate_rel.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> rotate <span class="skolem">n</span> <span class="free">w</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> LyndonD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> lexordp_conv_lexord<span class="main">]</span> 
      prim_no_rotate<span class="main">[</span><span class="operator">OF</span> Lyndon_prim<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Lyndon <span class="free">w</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lexord_mismatch<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="quoted">"rotate <span class="skolem">n</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> mismatch_pair <span class="free">w</span> <span class="main">(</span>rotate <span class="skolem">n</span> <span class="free">w</span><span class="main">)</span>›</span></span><span class="main">]</span>
        <span class="quoted"><span class="quoted">‹rotate <span class="skolem">n</span> <span class="free">w</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> rotate_comp_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Lyndon.simps
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> rotate <span class="skolem">n</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">w</span> <span class="main">⨝</span> rotate <span class="skolem">n</span> <span class="free">w</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> rotate_comp_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> subsetD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span>›</span></span><span class="main">,</span> <span class="operator">OF</span> rotate_rel.intros<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
          mismatch_pair_lcp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="quoted">"rotate <span class="skolem">n</span> <span class="free">w</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> mismatch_lexord_linorder<span class="main">[</span><span class="operator">OF</span> this subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> rotate_rel.intros<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">&lt;lex</span> rotate <span class="skolem">n</span> <span class="free">w</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main"><span class="hidden">❙</span><b>|</b></span><span class="free">w</span><span class="main"><span class="hidden">❙</span><b>|</b></span> <span class="main">⟶</span> <span class="free">w</span> <span class="keyword1">&lt;lex</span> rotate <span class="bound">n</span> <span class="free">w</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹It is well known that an acyclic order can be extended to a total strict linear order. This means that
a word is Lyndon with respect to some order iff its <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"rotate_rel <span class="free"><span class="free">w</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is acyclic.
›</span></span>
<span class="keyword1" id="Lyndon_Addition-Lyndon_rotate_rel_iff"><span class="command">lemma</span></span> Lyndon_rotate_rel_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span>rotate_rel <span class="free">w</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> strict_linear_order <span class="bound">r</span> <span class="main">∧</span> rotate_rel <span class="free">w</span> <span class="main">⊆</span> <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_linear_order_on_def acyclic_def irrefl_def
    <span class="keyword1"><span class="command">using</span></span> trancl_id trancl_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> can_extend_acyclic_order_to_strict_linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Lyndon_Addition-slo_linorder"><span class="command">lemma</span></span> slo_linorder<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_linear_order <span class="free">r</span> <span class="main">⟹</span> class.linorder <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_linear_order_def strict_partial_order_def irrefl_def trans_def total_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Application examples›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span>rotate_rel <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"primitive <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"strict_linear_order <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rotate_rel <span class="free">w</span> <span class="main">⊆</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_rotate_rel_iff assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">interpret</span></span> r<span class="main">:</span> linorder <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">r</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> slo_linorder<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹strict_linear_order <span class="skolem">r</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"r.Lyndon <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r.rotate_rel_iff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹rotate_rel <span class="free">w</span> <span class="main">⊆</span> <span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> r.Lyndon_prim<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"primitive <span class="free">w</span>"</span></span><span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span>rotate_rel <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bordered <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"strict_linear_order <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rotate_rel <span class="free">w</span> <span class="main">⊆</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lyndon_rotate_rel_iff assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">interpret</span></span> r<span class="main">:</span> linorder <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">r</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> slo_linorder<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹strict_linear_order <span class="skolem">r</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"r.Lyndon <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r.rotate_rel_iff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹rotate_rel <span class="free">w</span> <span class="main">⊆</span> <span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> r.Lyndon_unbordered<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bordered <span class="free">w</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>