<div id="Rings2">
<div class="head">
<h1>Theory Rings2</h1>
</div>
<pre class="source"><span class="comment1">(*
    Title:      Rings2.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Rings›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Rings2
<span class="keyword2"><span class="keyword">imports</span></span>
   <span class="quoted">"<a href="../../HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span>
   <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial_Factorial.html">HOL-Computational_Algebra.Polynomial_Factorial</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Previous lemmas and results›</span></span>

<span class="keyword1" id="Rings2-chain_le"><span class="command">lemma</span></span> chain_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">I</span><span class="main">(</span><span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 inc lift_Suc_mono_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> Rings.ring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rings2-sum_add"><span class="command">lemma</span></span> sum_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="free">A</span> <span class="main">+</span> sum <span class="free">g</span> <span class="free">B</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">+</span> sum <span class="free">g</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">+</span> sum <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A Int_Diff_disjoint Un_Diff_Int finite_Diff finite_Int inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.sum.union_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="free">g</span> <span class="free">B</span> <span class="main">=</span> sum <span class="free">g</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> sum <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B Int_Diff_disjoint Int_commute Un_Diff_Int finite_Diff finite_Int local.sum.union_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">+</span> sum <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distrib<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"1"</span> <span class="quoted">"2"</span> <span class="quoted">"3"</span> add.assoc add.left_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This lemma is presented in the library but for additive abelian groups›</span></span>

<span class="keyword1" id="Rings2-sum_negf"><span class="command">lemma</span></span> sum_negf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">-</span> sum <span class="free">f</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemmas are presented in the library but for other type classes (semiring\_0)›</span></span>

<span class="keyword1" id="Rings2-sum_distrib_left"><span class="command">lemma</span></span> sum_distrib_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sum <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">%</span><span class="bound">n</span><span class="main">.</span> <span class="free">r</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
    <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rings2-sum_distrib_right"><span class="command">lemma</span></span> sum_distrib_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="free">A</span> <span class="main">*</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
    <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">context</span></span> comm_monoid_add
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rings2-sum_two_elements"><span class="command">lemma</span></span> sum_two_elements<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">+</span> <span class="free">f</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_cancel assms empty_Diff finite.emptyI infinite_remove add_0_right
    sum.empty sum.insert sum.insert_remove singletonD<span class="main">)</span>

<span class="keyword1" id="Rings2-sum_singleton"><span class="command">lemma</span></span> sum_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Subgroups›</span></span>

<span class="keyword1"><span class="command">context</span></span> group_add
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">subgroup</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">0</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">-</span><span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rings2-subgroup_0"><span class="command">lemma</span></span> subgroup_0<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subgroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-subgroup_UNIV"><span class="command">lemma</span></span> subgroup_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>UNIV<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subgroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-subgroup_inter"><span class="command">lemma</span></span> subgroup_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> subgroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rings2-subgroup_Inter"><span class="command">lemma</span></span> subgroup_Inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">I</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> subgroup <span class="bound">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="main">⋂</span><span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> subgroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-subgroup_Union"><span class="command">lemma</span></span> subgroup_Union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">≡</span><span class="main">{</span><span class="free">I</span> <span class="bound">n</span><span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>UNIV<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all_subgroup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> subgroup <span class="bound">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> subgroup_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">unfold</span> Union_iff<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">0</span> <span class="main">∈</span> <span class="bound">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">I</span></span> <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_subgroup <span class="keyword1"><span class="command">unfolding</span></span> subgroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">a</span> <span class="skolem">ya</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ya<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ya</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">ya</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> In<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="free">I</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Im<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ya</span> <span class="main">=</span> <span class="free">I</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y ya S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> In_I_max<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">n</span> <span class="main">⊆</span> <span class="free">I</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> chain_le<span class="main">[</span><span class="operator">OF</span> inc<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Im_I_max<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">m</span> <span class="main">⊆</span> <span class="free">I</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> chain_le<span class="main">[</span><span class="operator">OF</span> inc<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">I</span></span> <span class="main"><span class="main">(</span></span>max <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">m</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Im Im_I_max In In_I_max a all_subgroup b in_mono max_def subgroup_def y ya<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">I</span></span> <span class="main"><span class="main">(</span></span>max <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">m</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> In In_I_max a all_subgroup in_mono subgroup_def y<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span>max <span class="skolem">n</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Ideals›</span></span>

<span class="keyword1"><span class="command">context</span></span> Rings.ring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rings2-subgroup_left_principal_ideal"><span class="command">lemma</span></span> subgroup_left_principal_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">{</span><span class="bound">r</span><span class="main">*</span><span class="free">a</span><span class="main">|</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span><span class="main">∈</span>UNIV<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> subgroup_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">*</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">ra</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">rb</span><span class="main">.</span> <span class="skolem">r</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">ra</span> <span class="main">*</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">rb</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_0_right combine_common_factor<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ra</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="bound">ra</span> <span class="main">*</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_mult_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">left_ideal</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">(</span>subgroup <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span><span class="main">*</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">right_ideal</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">(</span>subgroup <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">x</span><span class="main">*</span><span class="bound">r</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ideal</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">=</span> <span class="main">(</span>left_ideal <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> right_ideal <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">left_ideal_generated</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">⋂</span><span class="main">{</span><span class="bound">I</span><span class="main">.</span> left_ideal <span class="bound">I</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊆</span> <span class="bound">I</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">right_ideal_generated</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">⋂</span><span class="main">{</span><span class="bound">I</span><span class="main">.</span> right_ideal <span class="bound">I</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊆</span> <span class="bound">I</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ideal_generated</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">⋂</span><span class="main">{</span><span class="bound">I</span><span class="main">.</span> ideal <span class="bound">I</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊆</span> <span class="bound">I</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">left_principal_ideal</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> left_ideal_generated <span class="main">{</span><span class="bound">a</span><span class="main">}</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">right_principal_ideal</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span>right_ideal <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> right_ideal_generated <span class="main">{</span><span class="bound">a</span><span class="main">}</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">principal_ideal</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> ideal_generated <span class="main">{</span><span class="bound">a</span><span class="main">}</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rings2-ideal_inter"><span class="command">lemma</span></span> ideal_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_def left_ideal_def right_ideal_def subgroup_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-ideal_Inter"><span class="command">lemma</span></span> ideal_Inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">I</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> ideal <span class="bound">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span><span class="main">⋂</span><span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> ideal_def left_ideal_def right_ideal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="main">⋂</span><span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="main">⋂</span><span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subgroup_Inter assms
    <span class="keyword1"><span class="command">unfolding</span></span> ideal_def left_ideal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">r</span> <span class="skolem">xa</span> <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">xa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> X assms ideal_def left_ideal_def xa<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">r</span> <span class="skolem">xa</span> <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">xa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> X assms ideal_def right_ideal_def xa<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Rings2-ideal_Union"><span class="command">lemma</span></span> ideal_Union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">≡</span><span class="main">{</span><span class="free">I</span> <span class="bound">n</span><span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span>UNIV<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> ideal <span class="bound">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ideal_def left_ideal_def right_ideal_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">unfold</span> Union_iff<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">x</span> <span class="skolem">r</span>
  <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="free">I</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xa</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">xa</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">I</span></span> <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ideal_def left_ideal_def x y<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n y<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xa</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">∈</span> <span class="bound">xa</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">I</span></span> <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">∈</span> <span class="free">I</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ideal_def right_ideal_def x y<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n y<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subgroup_Union
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> S all_ideal ideal_def inc right_ideal_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Rings2-ideal_not_empty"><span class="command">lemma</span></span> ideal_not_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ideal_def left_ideal_def subgroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-ideal_0"><span class="command">lemma</span></span> ideal_0<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_def left_ideal_def right_ideal_def <span class="keyword1"><span class="command">using</span></span> subgroup_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-ideal_UNIV"><span class="command">lemma</span></span> ideal_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal UNIV"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_def left_ideal_def right_ideal_def <span class="keyword1"><span class="command">using</span></span> subgroup_UNIV <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-ideal_generated_0"><span class="command">lemma</span></span> ideal_generated_0<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_def <span class="keyword1"><span class="command">using</span></span> ideal_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-ideal_generated_subset_generator"><span class="command">lemma</span></span> ideal_generated_subset_generator<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal_generated <span class="free">A</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-left_ideal_minus"><span class="command">lemma</span></span> left_ideal_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"left_ideal <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> diff_minus_eq_add left_ideal_def minus_minus subgroup_def<span class="main">)</span>

<span class="keyword1" id="Rings2-right_ideal_minus"><span class="command">lemma</span></span> right_ideal_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"right_ideal <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> diff_minus_eq_add minus_minus right_ideal_def subgroup_def<span class="main">)</span>

<span class="keyword1" id="Rings2-ideal_minus"><span class="command">lemma</span></span> ideal_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ideal_def right_ideal_minus<span class="main">)</span>


<span class="keyword1" id="Rings2-ideal_ideal_generated"><span class="command">lemma</span></span> ideal_ideal_generated<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>ideal_generated <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_def
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_def left_ideal_def subgroup_def right_ideal_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Rings2-sum_left_ideal"><span class="command">lemma</span></span> sum_left_ideal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> li_X<span class="main">:</span> <span class="quoted"><span class="quoted">"left_ideal <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> U_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">U</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> U U_X
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">U</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> li_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  left_ideal_def subgroup_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> x_in_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> fx_x_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> li_X x_in_X <span class="keyword1"><span class="command">unfolding</span></span> left_ideal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> sum_in_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.prems insert.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> li_X fx_x_X sum_in_X <span class="keyword1"><span class="command">unfolding</span></span> left_ideal_def subgroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rings2-sum_right_ideal"><span class="command">lemma</span></span> sum_right_ideal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> li_X<span class="main">:</span> <span class="quoted"><span class="quoted">"right_ideal <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> U_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">U</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> U U_X
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">U</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> li_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_ideal_def subgroup_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> x_in_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> fx_x_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> li_X x_in_X <span class="keyword1"><span class="command">unfolding</span></span> right_ideal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> sum_in_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.prems insert.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>  <span class="skolem">x</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> li_X fx_x_X sum_in_X <span class="keyword1"><span class="command">unfolding</span></span> right_ideal_def subgroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">U</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rings2-left_ideal_generated_subset"><span class="command">lemma</span></span> left_ideal_generated_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"left_ideal_generated <span class="free">S</span> <span class="main">⊆</span> left_ideal_generated <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> left_ideal_generated_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-right_ideal_generated_subset"><span class="command">lemma</span></span> right_ideal_generated_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"right_ideal_generated <span class="free">S</span> <span class="main">⊆</span> right_ideal_generated <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> right_ideal_generated_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-ideal_generated_subset"><span class="command">lemma</span></span> ideal_generated_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal_generated <span class="free">S</span> <span class="main">⊆</span> ideal_generated <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-ideal_generated_in"><span class="command">lemma</span></span> ideal_generated_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> ideal_generated <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-ideal_generated_repeated"><span class="command">lemma</span></span> ideal_generated_repeated<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> ideal_generated <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> ring_1
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rings2-left_ideal_explicit"><span class="command">lemma</span></span> left_ideal_explicit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"left_ideal_generated <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">f</span> <span class="bound">U</span><span class="main">.</span> finite <span class="bound">U</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">U</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> S_in_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">S</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span> <span class="bound">U</span><span class="main">.</span> finite <span class="bound">U</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">U</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> left_ideal_B<span class="main">:</span> <span class="quoted"><span class="quoted">"left_ideal <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> left_ideal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> subgroup_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span> <span class="bound">U</span><span class="main">.</span> finite <span class="bound">U</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">U</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"id"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">A</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> AS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">fa</span> <span class="bound">Ua</span><span class="main">.</span> finite <span class="bound">Ua</span> <span class="main">∧</span> <span class="bound">Ua</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">Ua</span><span class="main">.</span> <span class="bound">fa</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">A</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A AS sum_negf<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span> <span class="skolem">B</span> <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> BS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">-</span> <span class="skolem">B</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">-</span> <span class="skolem">A</span> <span class="keyword1">then</span> <span class="skolem">fa</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="skolem">fa</span> <span class="bound">i</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">fb</span> <span class="bound">Ub</span><span class="main">.</span> finite <span class="bound">Ub</span> <span class="main">∧</span> <span class="bound">Ub</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">Ub</span><span class="main">.</span> <span class="bound">fb</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="skolem">fa</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?g</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">A</span></span> <span class="main"><span class="main">∪</span></span> <span class="skolem"><span class="skolem">B</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A B AS BS<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">∉</span> <span class="skolem">B</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="keyword1">else</span>
          <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">-</span> <span class="skolem">A</span> <span class="keyword1">then</span> <span class="skolem">fa</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="skolem">fa</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span>
          <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">B</span> <span class="main">-</span> <span class="skolem">A</span><span class="main">.</span> <span class="skolem">fa</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">∩</span><span class="skolem">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">fa</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_add<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">B</span> <span class="main">-</span> <span class="skolem">A</span><span class="main">.</span> <span class="skolem">fa</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span>
          <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  sum <span class="var">?g2</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?g2</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">-</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?g2</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?g2</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_diff2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g2</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="skolem">fa</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">U</span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U_in_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">fa</span> <span class="bound">Ua</span><span class="main">.</span> finite <span class="bound">Ua</span> <span class="main">∧</span> <span class="bound">Ua</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">Ua</span><span class="main">.</span> <span class="bound">fa</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">r</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">U</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U U_in_S sum_distrib_left mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S_in_B <span class="keyword1"><span class="command">unfolding</span></span> left_ideal_generated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> left_ideal_generated_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">f</span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">assume</span></span> li_X<span class="main">:</span> <span class="quoted"><span class="quoted">"left_ideal <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U_in_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> U_in_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> U_in_S S_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_left_ideal<span class="main"><span class="main">[</span></span><span class="operator">OF</span> li_X U_in_X U<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Rings2-right_ideal_explicit"><span class="command">lemma</span></span> right_ideal_explicit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"right_ideal_generated <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">f</span> <span class="bound">U</span><span class="main">.</span> finite <span class="bound">U</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">f</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">U</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> S_in_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">S</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span> <span class="bound">U</span><span class="main">.</span> finite <span class="bound">U</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">U</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> right_ideal_B<span class="main">:</span> <span class="quoted"><span class="quoted">"right_ideal <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> right_ideal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> subgroup_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span> <span class="bound">U</span><span class="main">.</span> finite <span class="bound">U</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">U</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"id"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">A</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> AS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">fa</span> <span class="bound">Ua</span><span class="main">.</span> finite <span class="bound">Ua</span> <span class="main">∧</span> <span class="bound">Ua</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">Ua</span><span class="main">.</span>  <span class="bound">i</span> <span class="main">*</span> <span class="bound">fa</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span>  <span class="bound">i</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">A</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A AS sum_negf<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">i</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fa</span> <span class="skolem">B</span> <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> BS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">-</span> <span class="skolem">B</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">-</span> <span class="skolem">A</span> <span class="keyword1">then</span> <span class="skolem">fa</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="skolem">fa</span> <span class="bound">i</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">fb</span> <span class="bound">Ub</span><span class="main">.</span> finite <span class="bound">Ub</span> <span class="main">∧</span> <span class="bound">Ub</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">Ub</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">fb</span> <span class="bound">i</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?g</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">A</span></span> <span class="main"><span class="main">∪</span></span> <span class="skolem"><span class="skolem">B</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A B AS BS<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">∉</span> <span class="skolem">B</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="keyword1">else</span>
          <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">-</span> <span class="skolem">A</span> <span class="keyword1">then</span> <span class="skolem">fa</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span>  <span class="bound">i</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span>  <span class="bound">i</span> <span class="main">*</span> <span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span>
          <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">.</span>  <span class="bound">i</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">B</span> <span class="main">-</span> <span class="skolem">A</span><span class="main">.</span>  <span class="bound">i</span> <span class="main">*</span> <span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">∩</span><span class="skolem">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="bound">i</span> <span class="main">*</span> <span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_add<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">B</span> <span class="main">-</span> <span class="skolem">A</span><span class="main">.</span>  <span class="bound">i</span> <span class="main">*</span> <span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span>
          <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  sum <span class="var">?g2</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?g2</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">-</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?g2</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?g2</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_diff2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g2</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">U</span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U_in_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">fa</span> <span class="bound">Ua</span><span class="main">.</span> finite <span class="bound">Ua</span> <span class="main">∧</span> <span class="bound">Ua</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">Ua</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">fa</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">r</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">U</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U U_in_S sum_distrib_right mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S_in_B <span class="keyword1"><span class="command">unfolding</span></span> right_ideal_generated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> right_ideal_generated_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">f</span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">assume</span></span> li_X<span class="main">:</span> <span class="quoted"><span class="quoted">"right_ideal <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U_in_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> U_in_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> U_in_S S_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_right_ideal<span class="main"><span class="main">[</span></span><span class="operator">OF</span> li_X U_in_X U<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> comm_ring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rings2-left_ideal_eq_right_ideal"><span class="command">lemma</span></span> left_ideal_eq_right_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"left_ideal <span class="free">I</span> <span class="main">=</span> right_ideal <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> left_ideal_def right_ideal_def subgroup_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> mult_commute<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">corollary</span></span> ideal_eq_left_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">I</span> <span class="main">=</span> left_ideal <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ideal_def left_ideal_eq_right_ideal<span class="main">)</span>

<span class="keyword1" id="Rings2-ideal_eq_right_ideal"><span class="command">lemma</span></span> ideal_eq_right_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">I</span> <span class="main">=</span> right_ideal <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ideal_def left_ideal_eq_right_ideal<span class="main">)</span>

<span class="keyword1" id="Rings2-principal_ideal_eq_left"><span class="command">lemma</span></span> principal_ideal_eq_left<span class="main">:</span>
  <span class="quoted"><span class="quoted">"principal_ideal <span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> left_ideal_generated <span class="main">{</span><span class="bound">a</span><span class="main">}</span> <span class="main">=</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> principal_ideal_def ideal_generated_def left_ideal_generated_def
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_eq_left_ideal <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> comm_ring_1
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rings2-ideal_generated_eq_left_ideal"><span class="command">lemma</span></span> ideal_generated_eq_left_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="free">A</span> <span class="main">=</span> left_ideal_generated <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_def ideal_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong left_ideal_eq_right_ideal left_ideal_generated_def<span class="main">)</span>

<span class="keyword1" id="Rings2-ideal_generated_eq_right_ideal"><span class="command">lemma</span></span> ideal_generated_eq_right_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="free">A</span> <span class="main">=</span> right_ideal_generated <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_def ideal_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong left_ideal_eq_right_ideal right_ideal_generated_def<span class="main">)</span>


<span class="keyword1" id="Rings2-obtain_sum_ideal_generated"><span class="command">lemma</span></span> obtain_sum_ideal_generated<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> ideal_generated <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> UA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_eq_left_ideal
    <span class="keyword1"><span class="command">unfolding</span></span> left_ideal_explicit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="skolem">U</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">g</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> UA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">+</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ U<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A U UA<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rings2-dvd_ideal_generated_singleton"><span class="command">lemma</span></span> dvd_ideal_generated_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> ideal_generated <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_generated_in<span class="main">)</span>
 <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> ideal_generated <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subset subsetCE<span class="main">)</span>
 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> obtain_sum_ideal_generated<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command">hence</span></span> fb_b_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">b</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_singleton <span class="keyword1"><span class="command">.</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span> <span class="free"><span class="free"><span class="free">b</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> fb_b_a mult_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rings2-ideal_generated_singleton"><span class="command">lemma</span></span> ideal_generated_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">k</span><span class="main">*</span><span class="free">a</span><span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_generated_eq_left_ideal left_ideal_explicit<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U_in_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> Ua<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> U_in_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ua sum_singleton<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">f</span> <span class="bound">U</span><span class="main">.</span> finite <span class="bound">U</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">U</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="free"><span class="free"><span class="free">a</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Rings2-dvd_ideal_generated_singleton'"><span class="command">lemma</span></span> dvd_ideal_generated_singleton'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b_dvd_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal_generated_singleton<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> dvd_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> mult_assoc<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Rings2-ideal_generated_subset2"><span class="command">lemma</span></span> ideal_generated_subset2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="free">c</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ideal_generated <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> ideal_generated <span class="main">{</span><span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x bc <span class="keyword1"><span class="command">unfolding</span></span> True ideal_generated_repeated <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dvd_ideal_generated_singleton<span class="main">[</span><span class="operator">OF</span> ac<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">k'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dvd_ideal_generated_singleton<span class="main">[</span><span class="operator">OF</span> bc<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> obtain_sum_ideal_generated<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">a</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">f</span> <span class="free">b</span> <span class="main">*</span> <span class="free">b</span> "</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_two_elements<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">f</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="skolem">k'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k k' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">+</span>  <span class="skolem">f</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_commute<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">f</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_singleton <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Rings2-ideal_kZ"><span class="command">lemma</span></span> ideal_kZ<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">{</span><span class="free">k</span><span class="main">*</span><span class="bound">x</span><span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_def left_ideal_def right_ideal_def subgroup_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> int_distrib<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> minus_mult_right<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> int_distrib<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> minus_mult_right<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹GCD Rings and Bezout Domains›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹To define GCD rings and Bezout rings, there are at least two options:
fix the operation gcd or just assume its existence. We have chosen the second one in order to be
able to use subclasses (if we fix a gcd in the bezout ring class, then we couln't prove that
principal ideal rings are a subclass of bezout rings).›</span></span>

<span class="keyword1"><span class="command">class</span></span> GCD_ring <span class="main">=</span> comm_ring_1
  <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> exists_gcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In this structure, there is always a gcd for each pair of elements, but maybe not unique.
The following definition essentially says if a function satisfies the condition to be a gcd.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_gcd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_gcd</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">gcd'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">gcd'</span></span></span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">dvd</span> <span class="bound">a</span><span class="main">)</span>
                          <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">gcd'</span></span></span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">dvd</span> <span class="bound">b</span><span class="main">)</span>
                          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">gcd'</span></span></span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rings2-gcd'_dvd1"><span class="command">lemma</span></span> gcd'_dvd1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_gcd <span class="free">gcd'</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">gcd'</span> <span class="free">a</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_gcd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-gcd'_dvd2"><span class="command">lemma</span></span> gcd'_dvd2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_gcd <span class="free">gcd'</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">gcd'</span> <span class="free">a</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_gcd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-gcd'_greatest"><span class="command">lemma</span></span> gcd'_greatest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_gcd <span class="free">gcd'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="keyword1">dvd</span> <span class="free">gcd'</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_gcd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rings2-gcd'_zero"><span class="command">lemma</span></span> gcd'_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_gcd <span class="free">gcd'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">gcd'</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_0_left dvd_refl gcd'_dvd1 gcd'_dvd2 gcd'_greatest assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> GCD_domain <span class="main">=</span> GCD_ring <span class="main">+</span> idom

<span class="keyword1"><span class="command">class</span></span> bezout_ring <span class="main">=</span> comm_ring_1 <span class="main">+</span>
        <span class="keyword2"><span class="keyword">assumes</span></span> exists_bezout<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">*</span><span class="free">a</span> <span class="main">+</span> <span class="bound">q</span><span class="main">*</span><span class="free">b</span> <span class="main">=</span> <span class="bound">d</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="main">(</span><span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> GCD_ring
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> exists_bezout<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In this structure, there is always a bezout decomposition for each pair of elements, but it is
not unique. The following definition essentially says if a function satisfies the condition to be a
bezout decomposition.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_bezout</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_bezout</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="bound">a</span> <span class="bound">b</span>
                                      <span class="keyword1">in</span>
                                        <span class="bound">p</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">gcd_a_b</span>
                                        <span class="main">∧</span> <span class="main">(</span><span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">a</span><span class="main">)</span>
                                        <span class="main">∧</span> <span class="main">(</span><span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">b</span><span class="main">)</span>
                                        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">gcd_a_b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following definition is similar to the previous one, and checks if the input is a
function that given two parameters <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a b›</span></span></span></span> returns 5 elements <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(p,q,u,v,d)›</span></span></span></span>
where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d›</span></span></span></span> is a gcd of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q›</span></span></span></span> are the
bezout coefficients such that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p*a+q*b=d›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d*u = -b›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d*v= a›</span></span></span></span>.
The elements <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>u›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v›</span></span></span></span> are useful for defining the bezout matrix.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_bezout_ext</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_bezout_ext</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="bound">a</span> <span class="bound">b</span>
                                          <span class="keyword1">in</span>
                                            <span class="bound">p</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">gcd_a_b</span>
                                            <span class="main">∧</span> <span class="main">(</span><span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">a</span><span class="main">)</span>
                                            <span class="main">∧</span> <span class="main">(</span><span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">b</span><span class="main">)</span>
                                            <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">gcd_a_b</span><span class="main">)</span>
                                            <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span><span class="bound">b</span>
                                            <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rings2-is_gcd_is_bezout_ext"><span class="command">lemma</span></span> is_gcd_is_bezout_ext<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_gcd <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free">bezout</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span><span class="main">,</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">,</span> <span class="bound">gcd'</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">gcd'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_gcd_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_bezout_ext_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_beta<span class="main">)</span>

<span class="keyword1" id="Rings2-is_bezout_ext_is_bezout"><span class="command">lemma</span></span> is_bezout_ext_is_bezout<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_bezout <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free">bezout</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">xa</span><span class="main">,</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">,</span> <span class="bound">gcd'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">xa</span><span class="main">,</span><span class="bound">gcd'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_bezout_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_bezout_ext_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_beta<span class="main">)</span>

<span class="keyword1" id="Rings2-is_gcd_is_bezout"><span class="command">lemma</span></span> is_gcd_is_bezout<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_bezout <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_gcd <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">of</span> <span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">gcd'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">gcd'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_gcd_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_bezout_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_beta<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The assumptions of the Bezout rings say that there exists a bezout operation.
  Now we will show that there also exists an operation satisfying <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_bezout_ext›</span></span></span></span>›</span></span>

<span class="keyword1" id="Rings2-exists_bezout_ext_aux"><span class="command">lemma</span></span> exists_bezout_ext_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">d</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="main">(</span><span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span><span class="free">b</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> prems01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="main">(</span><span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> exists_bezout <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> db<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> da<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> prems02<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> prems03<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> db <span class="keyword2"><span class="keyword">and</span></span> da
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dvdE local.minus_mult_right<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> exI <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span>"</span></span><span class="main">]</span> prems01 prems02 prems03
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rings2-exists_bezout_ext"><span class="command">lemma</span></span> exists_bezout_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bezout_ext</span><span class="main">.</span> is_bezout_ext <span class="bound">bezout_ext</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bezout_ext</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bezout_ext</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">,</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="bound">p</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="bound">d</span>
    <span class="main">∧</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">b</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">bezout_ext</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> is_bezout_ext_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> foo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span>
              <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span>
              <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∧</span>
              <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> exists_bezout_ext_aux <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">bezout_ext</span> <span class="skolem">a</span> <span class="skolem">b</span>
           <span class="keyword1">in</span> <span class="bound">p</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="bound">gcd_a_b</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> bezout_ext_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> someI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">p</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">q</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">u</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">v</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> foo<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> bezout_domain <span class="main">=</span> bezout_ring <span class="main">+</span> idom

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> bezout_domain<span class="main">)</span> GCD_domain
<span class="keyword1"><span class="command">proof</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">class</span></span> bezout_ring_div <span class="main">=</span> bezout_ring <span class="main">+</span> euclidean_semiring
<span class="keyword1"><span class="command">class</span></span> bezout_domain_div <span class="main">=</span> bezout_domain <span class="main">+</span> euclidean_semiring

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> bezout_ring_div<span class="main">)</span> bezout_domain_div
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Principal Ideal Domains›</span></span>

<span class="keyword1"><span class="command">class</span></span> pir <span class="main">=</span> comm_ring_1 <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> all_ideal_is_principal<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">I</span> <span class="main">⟹</span> principal_ideal <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">class</span></span> pid <span class="main">=</span> idom <span class="main">+</span> pir

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Thanks to the following proof, we will show that there exist bezout and gcd operations
in principal ideal rings for each pair of elements.›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pir<span class="main">)</span> bezout_ring
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> ideal_generated <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ideal_S<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ideal_ideal_generated <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="skolem">d</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_ideal_is_principal<span class="main">[</span><span class="operator">OF</span> ideal_S<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> principal_ideal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> ideal_d<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>ideal_generated <span class="main">{</span><span class="skolem">d</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ideal_ideal_generated <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> a_subset_d<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="skolem">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> S_def d insertI1 ideal_generated_subset singletonD subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> b_subset_d<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="skolem">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> S_def d insert_iff ideal_generated_subset subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> d_in_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d insert_subset ideal_generated_subset_generator<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> left_ideal_explicit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main">]</span> d_in_S <span class="keyword1"><span class="command">unfolding</span></span> S_def ideal_generated_eq_left_ideal
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="skolem">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">p</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">∧</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">a</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">d</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> ga_a_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> Ua<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> U True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">unfolding</span></span> Ua
          <span class="keyword1"><span class="command">unfolding</span></span> sum_singleton <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> U_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> U True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">unfolding</span></span> U_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_ideal_generated_singleton<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a_subset_d<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_ideal_generated_singleton<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b_subset_d<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d'</span> <span class="keyword3"><span class="command">assume</span></span> d'_dvd_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d'_dvd_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="keyword1">dvd</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ga_a_d d'_dvd_a dvd_mult2 mult_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">a</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">b</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">d</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> U_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> U <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">f</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">unfolding</span></span> U_ab sum_two_elements<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> U_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> U <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">unfolding</span></span> U_a sum_singleton <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> U_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> U <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">unfolding</span></span> U_b sum_singleton <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> U <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_ideal_generated_singleton<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a_subset_d<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_ideal_generated_singleton<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b_subset_d<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d'</span> <span class="keyword3"><span class="command">assume</span></span> d'a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d'b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> ad'<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="skolem">d'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_ideal_generated_singleton'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> d'a<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> bd'<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="skolem">d'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_ideal_generated_singleton'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> d'b<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> abd'<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="skolem">d'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_generated_subset2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ad' bd'<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> dd'<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="skolem">d</span><span class="main">}</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="skolem">d'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_def d<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="keyword1">dvd</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_ideal_generated_singleton<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dd'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pid<span class="main">)</span> bezout_domain
<span class="keyword1"><span class="command">proof</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> pir
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rings2-ascending_chain_condition"><span class="command">lemma</span></span> ascending_chain_condition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">=&gt;</span><span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> ideal <span class="main">(</span><span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span><span class="main">=</span><span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">{</span><span class="free">I</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span><span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span>nat set<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ideal_Union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">I</span></span><span class="main">]</span> all_ideal inc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">=</span> <span class="var">?I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_ideal_is_principal
    <span class="keyword1"><span class="command">unfolding</span></span> principal_ideal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a ideal_generated_subset_generator<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_Ik<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Union_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">I</span> <span class="bound">n</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">k</span> <span class="main">⊆</span> <span class="free">I</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">I</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">=</span> <span class="free">I</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">have</span></span> ideal_Ik<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span><span class="free">I</span> <span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_ideal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">k</span> <span class="main">⊆</span> ideal_generated <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal_generated <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">I</span> <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> a_Ik all_ideal ideal_generated_def
            le_Inf_iff mem_Collect_eq singleton_iff subsetI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Rings2-ascending_chain_condition2"><span class="command">lemma</span></span> ascending_chain_condition2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">I</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> set<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> ideal <span class="main">(</span><span class="bound">I</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">I</span> <span class="bound">n</span> <span class="main">⊂</span> <span class="bound">I</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> ideal <span class="main">(</span><span class="skolem">I</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">I</span> <span class="bound">n</span> <span class="main">⊂</span> <span class="skolem">I</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> ideal <span class="main">(</span><span class="skolem">I</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">n</span> <span class="main">⊆</span> <span class="skolem">I</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">I</span><span class="main">(</span><span class="bound">n</span><span class="main">)</span><span class="main">=</span><span class="skolem">I</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ascending_chain_condition <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> pir_div <span class="main">=</span> pir <span class="main">+</span> euclidean_semiring
<span class="keyword1"><span class="command">class</span></span> pid_div <span class="main">=</span> pid <span class="main">+</span> euclidean_semiring

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pir_div<span class="main">)</span> pid_div
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pir_div<span class="main">)</span> bezout_ring_div
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pid_div<span class="main">)</span> bezout_domain_div
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Euclidean Domains›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We make use of the euclidean ring (domain) class developed by Manuel Eberl.›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> euclidean_ring<span class="main">)</span> pid
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="keyword3"><span class="command">assume</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">I</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"principal_ideal <span class="skolem">I</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">=</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> principal_ideal_def True
      <span class="keyword1"><span class="command">using</span></span> ideal_generated_0 ideal_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> fI_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>euclidean_size<span class="main">`</span> <span class="main">(</span><span class="skolem">I</span><span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False ideal_not_empty<span class="main">[</span><span class="operator">OF</span> I<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> fd<span class="main">:</span> <span class="quoted"><span class="quoted">"euclidean_size <span class="skolem">d</span>
      <span class="main">=</span> Least <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">(</span>euclidean_size<span class="main">`</span><span class="main">(</span><span class="skolem">I</span><span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span><span class="main">(</span><span class="skolem">I</span><span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> LeastI_ex imageE ex_in_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> d_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> fd_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">I</span><span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> euclidean_size <span class="skolem">d</span> <span class="main">≤</span> euclidean_size <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Least_le fd image_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"principal_ideal <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> principal_ideal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">d</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ideal_generated <span class="main">{</span><span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Diff_iff I d<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> fr_fd<span class="main">:</span> <span class="quoted"><span class="quoted">"euclidean_size <span class="skolem">r</span> <span class="main">&lt;</span> euclidean_size <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> div_mult_mod_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> d_not_0 mod_size_less
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal_generated <span class="main">{</span><span class="skolem">d</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">r</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ideal_generated_def
          <span class="keyword1"><span class="command">unfolding</span></span> ideal_def right_ideal_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> r_noteq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">r</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> left_ideal_minus<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"left_ideal <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">unfolding</span></span> ideal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d I <span class="keyword1"><span class="command">unfolding</span></span> ideal_def right_ideal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">I</span><span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_noteq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"euclidean_size <span class="skolem">d</span> <span class="main">≤</span> euclidean_size <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fd_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fr_fd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> euclidean_ring_gcd
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is similar to the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>euclid_ext›</span></span></span></span> operation, but involving two more parameters
to satisfy that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_bezout_ext euclid_ext2›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">euclid_ext2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">euclid_ext2</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
   <span class="main">(</span>fst <span class="main">(</span>bezout_coefficients <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>bezout_coefficients <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">div</span> gcd <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">div</span> gcd <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> gcd <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Rings2-is_bezout_ext_euclid_ext2"><span class="command">lemma</span></span> is_bezout_ext_euclid_ext2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="main">(</span>euclid_ext2<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_bezout_ext_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"euclid_ext2 <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bezout_coefficients <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> euclid_ext2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bezout_coefficients<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gcd <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gcd <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> euclid_ext2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rings2-is_bezout_euclid_ext"><span class="command">lemma</span></span> is_bezout_euclid_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>fst <span class="main">(</span>bezout_coefficients <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>bezout_coefficients <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> gcd <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_bezout_def bezout_coefficients<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> euclidean_ring<span class="main">)</span> pid_div <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹More gcd structures›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following classes represent structures where there exists a gcd
  for each pair of elements and the operation is fixed.›</span></span>

<span class="keyword1"><span class="command">class</span></span> pir_gcd <span class="main">=</span> pir <span class="main">+</span> semiring_gcd
<span class="keyword1"><span class="command">class</span></span> pid_gcd <span class="main">=</span> pid <span class="main">+</span> pir_gcd

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> euclidean_ring_gcd<span class="main">)</span> pid_gcd <span class="keyword1"><span class="command">..</span></span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Field›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Proving that any field is a euclidean domain. There are alternatives to do this,
see <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://lists.cam.ac.uk/pipermail/cl-isabelle-users/2014-October/msg00034.html"<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="comment1">(* TODO Remove *)</span>
<span class="keyword1"><span class="command">class</span></span> field_euclidean <span class="main">=</span> field <span class="main">+</span> euclidean_ring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"euclidean_size <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">normalisation_factor</span> <span class="main">=</span> id"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="comment1">(*********** Possible future work: ***********)</span>
<span class="comment1">(*
  - Prime elements, irreducible elements...
  - Prufer Domain, Noetherian...
*)</span>
</pre>
</div><div id="Cayley_Hamilton_Compatible">
<div class="head">
<h1>Theory Cayley_Hamilton_Compatible</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Cayley_Hamilton_Compatible
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Rings2.html">Rings2</a>
    <a href="../Cayley_Hamilton/Cayley_Hamilton.html">Cayley_Hamilton.Cayley_Hamilton</a>
    <a href="../Gauss_Jordan/Determinants2.html">Gauss_Jordan.Determinants2</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Compatibility layer btw <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="../Cayley_Hamilton/Square_Matrix.html"></a><a href="../Cayley_Hamilton/Square_Matrix.html">Cayley_Hamilton.Square_Matrix</a><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="../Gauss_Jordan/Determinants2.html"></a><a href="../Gauss_Jordan/Determinants2.html">Gauss_Jordan.Determinants2</a><span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Square_Matrix.det
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Square_Matrix.row
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Square_Matrix.col
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Square_Matrix.transpose
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Square_Matrix.cofactor
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Square_Matrix.adjugate

<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> det_upperdiagonal
<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> row_def
<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> col_def
<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> transpose_def

<span class="keyword1" id="Cayley_Hamilton_Compatible-det_sq_matrix_eq"><span class="command">lemma</span></span> det_sq_matrix_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Square_Matrix.det <span class="main">(</span>from_vec <span class="free">A</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Square_Matrix.det.rep_eq Determinants.det_def from_vec.rep_eq <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Cayley_Hamilton_Compatible-to_vec_matrix_scalar_mult"><span class="command">lemma</span></span> to_vec_matrix_scalar_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"to_vec <span class="main">(</span><span class="free">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>S</sub></span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">*k</span> to_vec <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_scalar_mult_def<span class="main">)</span>

<span class="keyword1" id="Cayley_Hamilton_Compatible-to_vec_matrix_matrix_mult"><span class="command">lemma</span></span> to_vec_matrix_matrix_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"to_vec <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> to_vec <span class="free">A</span> <span class="main">**</span> to_vec <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_matrix_mult_def<span class="main">)</span>

<span class="keyword1" id="Cayley_Hamilton_Compatible-to_vec_diag"><span class="command">lemma</span></span> to_vec_diag<span class="main">:</span> <span class="quoted"><span class="quoted">"to_vec <span class="main">(</span>diag <span class="free">x</span><span class="main">)</span> <span class="main">=</span> mat <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_def<span class="main">)</span>

<span class="keyword1" id="Cayley_Hamilton_Compatible-to_vec_one"><span class="command">lemma</span></span> to_vec_one<span class="main">:</span> <span class="quoted"><span class="quoted">"to_vec <span class="main">1</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_def<span class="main">)</span>

<span class="keyword1" id="Cayley_Hamilton_Compatible-to_vec_eq_iff"><span class="command">lemma</span></span> to_vec_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"to_vec <span class="free">M</span> <span class="main">=</span> to_vec <span class="free">N</span> <span class="main">⟷</span> <span class="free">M</span> <span class="main">=</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Some preliminary lemmas and results›</span></span>

<span class="keyword1" id="Cayley_Hamilton_Compatible-invertible_iff_is_unit"><span class="command">lemma</span></span> invertible_iff_is_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span> <span class="main">⟷</span> <span class="main">(</span>det <span class="free">A</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> inv_A<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> AB_mat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">**</span> <span class="skolem">B</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inv_A <span class="keyword1"><span class="command">unfolding</span></span> invertible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> det <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_I <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> AB_mat <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="free">A</span> <span class="main">*</span> det <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_mul <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> det <span class="free">A</span> <span class="main">*</span> det <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>det <span class="free">A</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> det_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>det <span class="free">A</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>det <span class="free">A</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_vec <span class="main">(</span>Square_Matrix.adjugate <span class="main">(</span>from_vec <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> invertible_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">a</span></span> <span class="keyword1"><span class="keyword1">*k</span></span> <span class="var"><span class="var">?A</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"from_vec <span class="free">A</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>S</sub></span> Square_Matrix.adjugate <span class="main">(</span>from_vec <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>S</sub></span> Square_Matrix.adjugate <span class="main">(</span>from_vec <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> from_vec <span class="free">A</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> smult_mult2<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> mult_adjugate_det<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_vec <span class="free">A</span>"</span></span><span class="main">]</span> smult_diag det_sq_matrix_eq
         smult_mult1<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> adjugate_mult_det<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_vec <span class="free">A</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> diag_1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">*k</span> <span class="var">?A</span><span class="main">)</span> <span class="main">=</span> mat <span class="main">1</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="keyword1">*k</span> <span class="var">?A</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_vec_eq_iff<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> to_vec_matrix_matrix_mult to_vec_matrix_scalar_mult
        to_vec_from_vec to_vec_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">minorM</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">k</span> <span class="bound">l</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∨</span> <span class="bound">l</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cayley_Hamilton_Compatible-minorM_eq"><span class="command">lemma</span></span> minorM_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"minorM <span class="free">M</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> to_vec <span class="main">(</span>minor <span class="main">(</span>from_vec <span class="free">M</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minorM_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">standard</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cofactor</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cofactor</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> det <span class="main">(</span>minorM <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cofactorM</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cofactorM</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> cofactor <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cayley_Hamilton_Compatible-cofactorM_eq"><span class="command">lemma</span></span> cofactorM_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"cofactorM <span class="main">=</span> to_vec <span class="main">∘</span> Square_Matrix.cofactor <span class="main">∘</span> from_vec"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cofactorM_def cofactor_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> det_sq_matrix_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> minorM_eq fun_eq_iff
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer'</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff vec_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat2matofpoly</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat2matofpoly</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">[:</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">:]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">charpoly</span> <span class="keyword2"><span class="keyword">where</span></span> charpoly_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">charpoly</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> det <span class="main">(</span>mat <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> mat2matofpoly <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cayley_Hamilton_Compatible-charpoly_eq"><span class="command">lemma</span></span> charpoly_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"charpoly <span class="free">A</span> <span class="main">=</span> Cayley_Hamilton.charpoly <span class="main">(</span>from_vec <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> charpoly_def Cayley_Hamilton.charpoly_def det_sq_matrix_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> X_def C_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">Square_Matrix.det</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer'</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff mat_def mat2matofpoly_def C_def monom_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">adjugate</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">adjugate</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> transpose <span class="main">(</span>cofactorM <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cayley_Hamilton_Compatible-adjugate_eq"><span class="command">lemma</span></span> adjugate_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"adjugate <span class="main">=</span> to_vec <span class="main">∘</span> Square_Matrix.adjugate <span class="main">∘</span> from_vec"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adjugate_def Square_Matrix.adjugate_def fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer'</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transpose_def cofactorM_eq to_vec.rep_eq
    Square_Matrix.cofactor.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Cayley_Hamilton">
<div class="head">
<h1>Theory Code_Cayley_Hamilton</h1>
</div>
<pre class="source"><span class="comment1">(* 
    Title:      Code_Cayley_Hamilton.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Code Cayley Hamilton›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Cayley_Hamilton
  <span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial.html">HOL-Computational_Algebra.Polynomial</a>"</span>
  <a href="Cayley_Hamilton_Compatible.html">Cayley_Hamilton_Compatible</a>
  <a href="../Gauss_Jordan/Code_Matrix.html">Gauss_Jordan.Code_Matrix</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Code equations for the definitions presented in the Cayley-Hamilton development›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">scalar_matrix_mult_row</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Cayley_Hamilton-scalar_matrix_mult_row_code"><span class="command">lemma</span></span> scalar_matrix_mult_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>scalar_matrix_mult_row <span class="free">c</span> <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="main">%</span> <span class="bound">j</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_matrix_mult_row_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Code_Cayley_Hamilton-scalar_matrix_mult_code"><span class="command">lemma</span></span> scalar_matrix_mult_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span><span class="free">c</span> <span class="keyword1">*k</span> <span class="free">A</span><span class="main">)</span>  <span class="main">=</span> scalar_matrix_mult_row <span class="free">c</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_scalar_mult_def scalar_matrix_mult_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> vec_lambda_beta <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">minorM_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">=</span>  vec_lambda <span class="main">(</span><span class="main">%</span><span class="bound">l</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∨</span> <span class="bound">l</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">$</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">$</span><span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Cayley_Hamilton-minorM_row_code"><span class="command">lemma</span></span> minorM_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>minorM_row <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="main">%</span><span class="bound">l</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∨</span> <span class="bound">l</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">A</span><span class="main">$</span><span class="free">k</span><span class="main">$</span><span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minorM_row_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Code_Cayley_Hamilton-minorM_code"><span class="command">lemma</span></span> minorM_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>minorM <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> minorM_row <span class="free">A</span> <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minorM_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_eq_iff fun_eq_iff minorM_row_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cofactorM_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> cofactorM <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Cayley_Hamilton-cofactorM_row_code"><span class="command">lemma</span></span> cofactorM_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>cofactorM_row <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> cofactor <span class="free">A</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff cofactorM_row_def cofactor_def cofactorM_def<span class="main">)</span>

<span class="keyword1" id="Code_Cayley_Hamilton-cofactorM_code"><span class="command">lemma</span></span> cofactorM_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>cofactorM <span class="free">A</span><span class="main">)</span> <span class="main">=</span> cofactorM_row <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff cofactorM_row_def vec_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> cofactor_def<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat2matofpoly_row</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat2matofpoly_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> vec_lambda <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">[:</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="main">:]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Cayley_Hamilton-mat2matofpoly_row_code"><span class="command">lemma</span></span> mat2matofpoly_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>mat2matofpoly_row <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">j</span><span class="main">.</span> <span class="main">[:</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">:]</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> mat2matofpoly_row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>mat2matofpoly <span class="free">k</span><span class="main">)</span> <span class="main">=</span> mat2matofpoly_row <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat2matofpoly_def <span class="keyword1"><span class="command">unfolding</span></span> mat2matofpoly_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">matpow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>semiring_1<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  matpow_0<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">matpow</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> <span class="main">|</span>
  matpow_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">matpow</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">**</span> <span class="main">(</span><span class="free">matpow</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">evalmat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_ring_1 poly <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">evalmat</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">n</span><span class="main">::</span>nat <span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="main">(</span> degree <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">)</span> <span class="main">}</span> <span class="main">.</span> <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*k</span> <span class="main">(</span>matpow <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Cayley_Hamilton-evalmat_unfold"><span class="command">lemma</span></span> evalmat_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalmat <span class="free">P</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span>degree <span class="free">P</span><span class="main">.</span> coeff <span class="free">P</span> <span class="bound">i</span> <span class="keyword1">*k</span> matpow <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> evalmat_def atMost_def <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> atMost_atLeast0<span class="main">)</span>

<span class="keyword1" id="Code_Cayley_Hamilton-evalmat_code"><span class="command">lemma</span></span> evalmat_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"evalmat <span class="free">P</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">←</span><span class="main">[</span><span class="main">0</span><span class="main">..</span>int <span class="main">(</span>degree <span class="free">P</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> coeff <span class="free">P</span> <span class="main">(</span>nat <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*k</span> matpow <span class="free">A</span> <span class="main">(</span>nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> coeff <span class="free">P</span> <span class="bound">n</span> <span class="keyword1">*k</span> matpow <span class="free">A</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span>degree <span class="free">P</span><span class="main">.</span> coeff <span class="free">P</span> <span class="bound">i</span> <span class="keyword1">*k</span> matpow <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span>int <span class="main">(</span>degree <span class="free">P</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> coeff <span class="free">P</span> <span class="main">(</span>nat <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*k</span> matpow <span class="free">A</span> <span class="main">(</span>nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_cong <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">nat</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_nat_nat_iff image_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">presburger</span><span class="main">)</span>
<span class="comment1">(* TODO: why does the proof step above need all of Analysis?? *)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_set_upto_conv_sum_list_int <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> evalmat_unfold<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">coeffM_zero</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">coeffM_zero</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>coeff <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">coeffM_zero_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>coeff <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">coeffM</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>zero<span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">coeffM</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> coeff <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Cayley_Hamilton-coeffM_zero_row_code"><span class="command">lemma</span></span> coeffM_zero_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>coeffM_zero_row <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span>coeff <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeffM_zero_row_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Code_Cayley_Hamilton-coeffM_zero_code"><span class="command">lemma</span></span> coeffM_zero_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>coeffM_zero <span class="free">A</span><span class="main">)</span> <span class="main">=</span> coeffM_zero_row <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeffM_zero_def coeffM_zero_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> vec_lambda_beta <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">coeffM_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">j</span><span class="main">.</span> coeff <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Cayley_Hamilton-coeffM_row_code"><span class="command">lemma</span></span> coeffM_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>coeffM_row <span class="free">A</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span> <span class="bound">j</span><span class="main">.</span> coeff <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeffM_row_def coeffM_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Code_Cayley_Hamilton-coeffM_code"><span class="command">lemma</span></span> coeffM_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>coeffM <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> coeffM_row <span class="free">A</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeffM_def coeffM_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> vec_lambda_beta <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Echelon_Form">
<div class="head">
<h1>Theory Echelon_Form</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Echelon_Form.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Echelon Form›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Echelon_Form
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Rings2.html">Rings2</a>
  <a href="../Gauss_Jordan/Determinants2.html">Gauss_Jordan.Determinants2</a>
  <a href="Cayley_Hamilton_Compatible.html">Cayley_Hamilton_Compatible</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition of Echelon Form›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Echelon form up to column k (NOT INCLUDED).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">echelon_form_upt_k</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> ord<span class="main">}</span> <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">echelon_form_upt_k</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> 
          <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="bound">i</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∧</span>  
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">j</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">echelon_form</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> echelon_form_upt_k <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>ncols <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some properties of matrices in echelon form.›</span></span>

<span class="keyword1" id="Echelon_Form-echelon_form_upt_k_intro"><span class="command">lemma</span></span> echelon_form_upt_k_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="bound">i</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">j</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">j</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="bound">j</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> 
  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Echelon_Form-echelon_form_upt_k_condition1"><span class="command">lemma</span></span> echelon_form_upt_k_condition1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="free">i</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">j</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Echelon_Form-echelon_form_upt_k_condition1'"><span class="command">lemma</span></span> echelon_form_upt_k_condition1'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Echelon_Form-echelon_form_upt_k_condition2"><span class="command">lemma</span></span> echelon_form_upt_k_condition2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_zero_row_upt_k <span class="free">j</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Echelon_Form-echelon_form_upt_k_if_equal"><span class="command">lemma</span></span> echelon_form_upt_k_if_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">&lt;</span>from_nat <span class="free">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">$</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">B</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">$</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">B</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_k_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> zero_iB<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="free">k</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> zero_iA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ja</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword3"><span class="command">assume</span></span> ja_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ja_k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> add_to_nat_def k from_nat_mono 
        ja_k monoid_add_class.add.right_neutral ncols_def to_nat_0<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">ja</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq ja_k2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_iB ja_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> zero_jA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">j</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e echelon_form_upt_k_condition1 ij<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">j</span> <span class="free">k</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ja</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword3"><span class="command">assume</span></span> ja_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ja_k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> add_to_nat_def k from_nat_mono 
        ja_k monoid_add_class.add.right_neutral ncols_def to_nat_0<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">ja</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq ja_k2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_jA ja_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> not_zero_iB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">i</span> <span class="free">k</span> <span class="free">B</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> not_zero_jB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="free">k</span> <span class="free">B</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> Bia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span>from_nat <span class="free">k</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> not_zero_iB k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def ncols_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_to_nat_def from_nat_mono monoid_add_class.add.right_neutral to_nat_0<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Aia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ak Bia eq<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> Bjb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&lt;</span>from_nat <span class="free">k</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> not_zero_jB k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def ncols_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_to_nat_def from_nat_mono monoid_add_class.add.right_neutral to_nat_0<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Ajb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bk Bjb eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_iA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Aia ak is_zero_row_upt_k_def to_nat_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_jA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Ajb bk is_zero_row_upt_k_def to_nat_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bia<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> least_bi_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ak <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI  eq is_zero_row_upt_k_def not_zero_iB<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Least_le  dual_order.strict_trans2 eq least_bi_less linear<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bjb<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> least_bi_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bk <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI eq is_zero_row_upt_k_def not_zero_jB<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Least_le  dual_order.strict_trans2 eq least_bi_less linear<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_condition2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e ij not_zero_iA not_zero_jA<span class="main"><span class="main">]</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-echelon_form_upt_k_0"><span class="command">lemma</span></span> echelon_form_upt_k_0<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_k_def is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Echelon_Form-echelon_form_condition1"><span class="command">lemma</span></span> echelon_form_condition1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row <span class="bound">i</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="bound">i</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> echelon_form_upt_k_condition1' is_zero_row_def<span class="main">)</span>

<span class="keyword1" id="Echelon_Form-echelon_form_condition2"><span class="command">lemma</span></span> echelon_form_condition2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="free">j</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="free">j</span> <span class="free">A</span><span class="main">)</span> 
  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> echelon_form_upt_k_condition2 is_zero_row_def<span class="main">)</span>


<span class="keyword1" id="Echelon_Form-echelon_form_condition2_explicit"><span class="command">lemma</span></span> echelon_form_condition2_explicit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref_A<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">i</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="free">j</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> echelon_form_condition2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Echelon_Form-echelon_form_intro"><span class="command">lemma</span></span> echelon_form_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row <span class="bound">i</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&gt;</span><span class="bound">i</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">j</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="bound">j</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>is_zero_row <span class="bound">j</span> <span class="free">A</span><span class="main">)</span> 
  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> echelon_form_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> echelon_form_upt_k_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="main">(</span>ncols <span class="free">A</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">j</span> <span class="main">(</span>ncols <span class="free">A</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 is_zero_row_imp_is_zero_row_upt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">i</span> <span class="main">(</span>ncols <span class="free">A</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="main">(</span>ncols <span class="free">A</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_imp_is_zero_row_upt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-echelon_form_implies_echelon_form_upt"><span class="command">lemma</span></span> echelon_form_implies_echelon_form_upt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">j</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> zero_i_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_less_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> not_zero_j_k<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> not_zero_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">j</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_zero_row_imp_is_zero_row_upt not_zero_j_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> not_zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row <span class="skolem">i</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> echelon_form_condition1<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> i_less_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> Least_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_condition2_explicit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rref i_less_j not_zero_i not_zero_j<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI2_ex<span class="main">)</span>   
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> not_zero_i <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_def is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> Aix_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> k_less_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> to_nat <span class="skolem">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> zero_i_k Aix_not_0 <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> k_less_ncols<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">using</span></span> to_nat_less_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ajs_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">s</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> not_zero_j_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ajs_not_zero Least_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> from_nat <span class="main">(</span>to_nat <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_id <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> from_nat_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> s_less_k k_less_ncols<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k_less_x leD not_le_imp_less to_nat_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">i</span> <span class="free">k</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">j</span> <span class="free">k</span> <span class="free">A</span> 
    <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> echelon_form_condition2<span class="main">[</span><span class="operator">OF</span> rref<span class="main">]</span> is_zero_row_imp_is_zero_row_upt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-upper_triangular_upt_k_def'"><span class="command">lemma</span></span> upper_triangular_upt_k_def'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> to_nat <span class="bound">j</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">j</span><span class="main">≥</span><span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"upper_triangular_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_upt_k_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leD linear<span class="main">)</span> 


<span class="keyword1" id="Echelon_Form-echelon_form_imp_upper_triagular_upt"><span class="command">lemma</span></span> echelon_form_imp_upper_triagular_upt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"upper_triangular_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_upt_k_def 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_less_suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> Suc.hyps
        <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_upt_k_def <span class="keyword1"><span class="command">using</span></span> j_less_i True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> j_eq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_less_suc_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> j_eq_k2<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat_id<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> rref_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms echelon_form_implies_echelon_form_upt<span class="main">)</span>   
      <span class="keyword1"><span class="command">have</span></span> zero_j_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">j</span> <span class="skolem">k</span> <span class="free">A</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Suc.hyps leD le_less_linear 
          j_eq_k to_nat_mono' upper_triangular_upt_k_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> zero_i_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="skolem">k</span> <span class="free">A</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> assms echelon_form_implies_echelon_form_upt 
          echelon_form_upt_k_condition1' j_less_i<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">j</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> zero_j_k<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True j_eq_k2<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">i</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> echelon_form_upt_k_condition1' j_less_i rref_suc<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_def j_eq_k lessI<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> Ajj_not_zero<span class="main">=</span>False
        <span class="keyword1"><span class="command">hence</span></span> not_zero_j<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_def j_eq_k lessI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> Aij_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> not_zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">i</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_def j_eq_k lessI<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> Least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> from_nat <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Aij_not_zero j_eq_k2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> from_nat <span class="skolem">k</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> is_zero_row_upt_k_def not_le_imp_less to_nat_le zero_i_k<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> Least_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> from_nat <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ajj_not_zero j_eq_k2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> from_nat <span class="skolem">k</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> is_zero_row_upt_k_def not_le_imp_less to_nat_le zero_j_k<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
            <span class="keyword1"><span class="command">using</span></span> echelon_form_upt_k_condition2<span class="main">[</span><span class="operator">OF</span> rref_suc j_less_i not_zero_j not_zero_i<span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A matrix in echelon form is upper triangular.›</span></span>
<span class="keyword1" id="Echelon_Form-echelon_form_imp_upper_triagular"><span class="command">lemma</span></span> echelon_form_imp_upper_triagular<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"upper_triangular <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> echelon_form_imp_upper_triagular_upt<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> upper_triangular_upt_imp_upper_triangular<span class="main">)</span>


<span class="keyword1" id="Echelon_Form-echelon_form_upt_k_interchange"><span class="command">lemma</span></span> echelon_form_upt_k_interchange<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'c</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_ikA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Amk_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_le_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span><span class="main">≤</span><span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> 
  <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_if_equal<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ k<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'c</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?least</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?interchange</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="var">?least</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span><span class="main">≤</span><span class="var">?least</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Amk_not_0 LeastI_ex i_le_m<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> zero_leastkA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="var">?least</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> echelon_form_upt_k_condition1<span class="main">[</span><span class="operator">OF</span> e zero_ikA<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> dual_order.strict_iff_order zero_ikA<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">=</span> <span class="var">?interchange</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span>from_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="var">?least</span> <span class="main">$</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_leastkA <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> b to_nat_le<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True b is_zero_row_upt_k_def to_nat_le zero_ikA<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> a_not_i<span class="main">=</span>False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="var">?least</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_ikA  <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> b to_nat_le<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True b is_zero_row_upt_k_def to_nat_le zero_leastkA<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a_not_i <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹There are similar theorems to the following ones in the Gauss-Jordan developments, but
for matrices in reduced row echelon form. It is possible to prove that reduced row echelon form 
implies echelon form. Then the theorems in the Gauss-Jordan development could be 
obtained with ease.›</span></span>

<span class="keyword1" id="Echelon_Form-greatest_less_zero_row"><span class="command">lemma</span></span> greatest_less_zero_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> not_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i_less_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_less_i neq_iff GreatestI not_all_zero zero_i<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r zero_i i_less_greatest <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> GreatestI_ex not_all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-greatest_ge_nonzero_row'"><span class="command">lemma</span></span> greatest_ge_nonzero_row'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">a</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greatest_less_zero_row<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> i not_all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Echelon_Form-rref_imp_ef"><span class="command">lemma</span></span> rref_imp_ef<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rref<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced_row_echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> is_zero_row <span class="bound">i</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_zero_row <span class="bound">j</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rref rref_condition1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">i</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">¬</span> is_zero_row <span class="bound">j</span> <span class="free">A</span> 
    <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rref_condition3_equiv rref<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Computing the echelon form of a matrix›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Demonstration over principal ideal rings›</span></span>
       
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Important remark:

We want to prove that there exist the echelon form of any matrix whose elements belong to a bezout 
domain. In addition, we want to compute the echelon form, so we will need computable gcd 
and bezout operations which is possible over euclidean domains. 
Our approach consists of demonstrating the correctness over bezout domains
and executing over euclidean domains.

To do that, we have studied several options:

\begin{enumerate}
  \item We could define a gcd in bezout rings (<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bezout_ring_gcd›</span></span></span></span>) as follows:
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>gcd_bezout_ring a b = (SOME d. d dvd a ∧ d dvd b ∧ (∀d'. d' dvd a ∧ d' dvd b ⟶ d' dvd d))›</span></span></span></span>

  And then define an algorithm that computes the Echelon Form using such a definition to the gcd.
  This would allow us to prove the correctness over bezout rings, but we would not be able
  to execute over euclidean rings because it is not possible to demonstrate a (code) lemma 
  stating that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(gcd_bezout_ring a b) = gcd_eucl a b›</span></span></span></span> (the gcd is not unique over 
  bezout rings and GCD rings).
  
  \item Create a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bezout_ring_norm›</span></span></span></span> class and define a gcd normalized over bezout rings:
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>definition gcd_bezout_ring_norm a b = gcd_bezout_ring a b div normalisation_factor (gcd_bezout_ring a b)›</span></span></span></span>

  Then, one could demonstrate a (code) lemma stating that: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(gcd_bezout_ring_norm a b) 
  = gcd_eucl a b›</span></span></span></span>
  This allows us to execute the gcd function, but with bezout it is not possible.

  \item The third option (and the chosen one) consists of defining the algorithm over bezout domains 
  and parametrizing the algorithm by a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bezout›</span></span></span></span> operation which must satisfy 
  suitable properties (i.e <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free"><span class="free">bezout</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>). Then we can prove the correctness over 
  bezout domains and we will execute over euclidean domains, since we can prove that the 
  operation  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"euclid_ext2"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is an executable operation which satisfies 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"is_bezout_ext euclid_ext2"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
\end{enumerate}
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Definition of the algorithm›</span></span>

<span class="keyword1"><span class="command">context</span></span> bezout_ring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">bezout_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span> <span class="main">⇒</span> <span class="tfree">'rows</span> <span class="main">⇒</span> <span class="tfree">'rows</span> <span class="main">⇒</span> <span class="tfree">'cols</span> 
                    <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">bezout_matrix</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> 
      <span class="main">(</span><span class="keyword1">let</span> 
        <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> 
       <span class="keyword1">in</span>
         <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="keyword1">else</span>
         <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="bound">q</span> <span class="keyword1">else</span>
         <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span>
         <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span>
         <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">bezout_iterate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> 
                     <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span> 
                     <span class="main">⇒</span> <span class="tfree">'cols</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bezout_iterate</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bezout_iterate</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> 
        <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">≤</span> to_nat <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">else</span> 
              <span class="free">bezout_iterate</span> <span class="main">(</span>bezout_matrix <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If every element in column <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span><span class="main"><span class="main">::</span></span>nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> over index <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">i</span></span><span class="main"><span class="main">::</span></span>nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are equal to zero,
      the same input is returned. If every element over <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">i</span></span><span class="main"><span class="main">::</span></span>nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
      is equal to zero, except the pivot, the algorithm does nothing, but pivot <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">i</span></span><span class="main"><span class="main">::</span></span>nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
      is increased in a unit. Finally, if there is a position <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span><span class="main"><span class="main">::</span></span>nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
      whose coefficient is different from zero, its row is interchanged with row 
      <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">i</span></span><span class="main"><span class="main">::</span></span>nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and the bezout coefficients are used to produce a zero in its position.›</span></span>


<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_column_k</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> 
     <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>from_nat <span class="bound">i</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> nrows <span class="bound">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">else</span> 
        <span class="keyword1">if</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="bound">i</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span>
            <span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="bound">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span> 
                <span class="bound">interchange_A</span> <span class="main">=</span> interchange_rows <span class="bound">A</span> <span class="main">(</span>from_nat <span class="bound">i</span><span class="main">)</span> <span class="bound">n</span>
           <span class="keyword1">in</span>
            <span class="main">(</span>bezout_iterate <span class="main">(</span><span class="bound">interchange_A</span><span class="main">)</span> <span class="main">(</span>nrows <span class="bound">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">,</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_upt_k</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> <span class="main">(</span>fst <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> echelon_form_of_upt_k <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>ncols <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The executable definition:›</span></span>

<span class="keyword1"><span class="command">context</span></span> euclidean_space
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_euclidean</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> echelon_form_of <span class="free"><span class="bound"><span class="entity">A</span></span></span> euclid_ext2"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties of the bezout matrix›</span></span>

<span class="keyword1" id="Echelon_Form-bezout_matrix_works1"><span class="command">lemma</span></span> bezout_matrix_works1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def bezout_matrix_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> bz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="var">?z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ib <span class="keyword1"><span class="command">have</span></span> foo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">=</span> <span class="free">bezout</span> <span class="bound">a</span> <span class="bound">b</span>
           <span class="keyword1">in</span> <span class="bound">p</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">gcd_a_b</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> is_bezout_ext_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">bezout</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> foo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="var">?b</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?a</span> <span class="main">∧</span>
            <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="var">?a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="var">?b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?b</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">=</span> <span class="var">?a</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> ib <span class="keyword1"><span class="command">using</span></span> is_bezout_ext_def <span class="keyword1"><span class="command">using</span></span> bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> foo <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> pa_bq_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">+</span> <span class="var">?b</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> foo <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="skolem">p</span>
              <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="skolem">q</span>
              <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="skolem">u</span>
              <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="skolem">v</span>
              <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">k</span> <span class="main">$</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">have</span></span> UNIV_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> insert <span class="free">b</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> sum_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">a</span> <span class="main">+</span> sum <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sum0<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span>
       <span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">of</span>
        <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">p</span>
          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">q</span>
               <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
       <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span>
       <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="skolem">p</span>
          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="skolem">q</span>
               <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="skolem">u</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="skolem">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
       <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="skolem">f</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span> UNIV <span class="main">=</span> sum <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">b</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> UNIV_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">b</span> <span class="main">+</span> sum <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> a_not_b<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">b</span> <span class="main">+</span> <span class="skolem">f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_rw sum0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> a_not_b bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add.commute mult.commute pa_bq_d<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span>
       <span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">of</span>
        <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">p</span>
          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">q</span>
               <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
       <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span>
    snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-bezout_matrix_not_zero"><span class="command">lemma</span></span> bezout_matrix_not_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Aaj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="main">(</span>snd<span class="main">(</span>snd <span class="main">(</span><span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bezout_matrix_works1<span class="main">[</span><span class="operator">OF</span> ib a_not_b<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">of</span> <span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span><span class="main"><span class="bound">_</span></span> <span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">,</span><span class="bound">gcd'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">gcd'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_beta<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gcd'_zero<span class="main">[</span><span class="operator">OF</span> is_gcd_is_bezout_ext<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main">]</span> Aaj <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-ua_vb_0"><span class="command">lemma</span></span> ua_vb_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>bezout_domain"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="free">bezout</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="free">bezout</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="free">bezout</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> bz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="free">bezout</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">bezout</span> <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ib <span class="keyword1"><span class="command">have</span></span> foo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">=</span> <span class="free">bezout</span> <span class="bound">a</span> <span class="bound">b</span>
           <span class="keyword1">in</span> <span class="bound">p</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">gcd_a_b</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> is_bezout_ext_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">bezout</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∧</span>
            <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span> <span class="free">b</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">a</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> foo <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> bz <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> dub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dva<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eq_neg_iff_add_eq_0 mult.commute mult_minus_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> dub dva minus_minus mult_minus_left 
          neg_eq_iff_add_eq_0 semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-bezout_matrix_works2"><span class="command">lemma</span></span> bezout_matrix_works2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>bezout_domain<span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_matrix_mult_def bezout_matrix_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ib <span class="keyword1"><span class="command">have</span></span> foo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">=</span> <span class="free">bezout</span> <span class="bound">a</span> <span class="bound">b</span>
           <span class="keyword1">in</span> <span class="bound">p</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">gcd_a_b</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> is_bezout_ext_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">bezout</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> bz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="var">?z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> pib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="var">?b</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?a</span> <span class="main">∧</span>
            <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="var">?a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="var">?b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?b</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">=</span> <span class="var">?a</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> foo <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> pa_bq_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">+</span> <span class="var">?b</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> d_dvd_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> d_dvd_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="main">-</span><span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> pa_bq_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">+</span> <span class="var">?b</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pa_bq_d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="skolem">p</span>
                 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="skolem">q</span>
                      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="skolem">u</span>
                           <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="skolem">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
                <span class="free">A</span> <span class="main">$</span> <span class="skolem">k</span> <span class="main">$</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">have</span></span> UNIV_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> insert <span class="free">b</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> sum_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">a</span> <span class="main">+</span> sum <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sum0<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span>
       <span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">of</span>
        <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">p</span>
          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">q</span>
               <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
       <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> sum <span class="skolem">f</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span> UNIV <span class="main">=</span> sum <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">b</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> UNIV_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">b</span> <span class="main">+</span> sum <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> a_not_b<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">b</span> <span class="main">+</span> <span class="skolem">f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_rw sum0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">*</span> <span class="var">?b</span> <span class="main">+</span> <span class="skolem">u</span> <span class="main">*</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> a_not_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">*</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ua_vb_0 <span class="main">[</span><span class="operator">OF</span> ib<span class="main">]</span> bz
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv minus_minus minus_zero mult_eq_0_iff pib snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">.</span>
       <span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">of</span>
        <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">p</span>
          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">q</span>
               <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
       <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-bezout_matrix_preserves_previous_columns"><span class="command">lemma</span></span> bezout_matrix_preserves_previous_columns<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_not_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Aik<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">&lt;</span><span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>to_nat <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">j</span> <span class="main">(</span>to_nat <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">k</span> <span class="free">bezout</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_matrix_mult_def <span class="keyword1"><span class="command">unfolding</span></span> bezout_matrix_def Let_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bezout_matrix <span class="free">A</span> <span class="free">i</span> <span class="free">j</span> <span class="free">k</span> <span class="free">bezout</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?j</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ib <span class="keyword1"><span class="command">have</span></span> foo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">=</span> <span class="free">bezout</span> <span class="bound">a</span> <span class="bound">b</span>
           <span class="keyword1">in</span> <span class="bound">p</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">gcd_a_b</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> is_bezout_ext_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">bezout</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> bz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="var">?z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Aib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b_k i is_zero_row_upt_k_def to_nat_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Ajb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b_k j is_zero_row_upt_k_def to_nat_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">ka</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="skolem">ka</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="skolem">p</span>
                  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="skolem">ka</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="skolem">q</span>
                  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="skolem">ka</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="skolem">u</span>
                  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="skolem">ka</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="skolem">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">ka</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ka</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ka</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span>
       <span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">of</span>
        <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="bound">p</span>
          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="bound">q</span>
               <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
       <span class="free">A</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">$</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
    <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span>
       <span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">of</span>
        <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="bound">p</span>
          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="bound">q</span>
               <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
       <span class="free">A</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">$</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> sum <span class="skolem">f</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span> UNIV <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aib Ajb f_def True i_not_j<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> Aib <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> a_not_i<span class="main">=</span>False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">j</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span>
       <span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">of</span>
        <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="bound">p</span>
          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="bound">q</span>
               <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
       <span class="free">A</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">$</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> sum <span class="skolem">f</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span> UNIV <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aib Ajb f_def True i_not_j<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> Ajb <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False 
      <span class="keyword1"><span class="command">have</span></span> UNIV_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> insert <span class="free">j</span> <span class="main">(</span>insert <span class="free">i</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> UNIV_rw2<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">=</span> insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False a_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sum0<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">ka</span><span class="main">∈</span>UNIV<span class="main">.</span>
       <span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">j</span> <span class="main">$</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">of</span>
        <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
          <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="bound">p</span>
          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="bound">q</span>
               <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> <span class="bound">ka</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ka</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span>
       <span class="free">A</span> <span class="main">$</span> <span class="bound">ka</span> <span class="main">$</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> sum <span class="skolem">f</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">f</span> UNIV <span class="main">=</span> sum <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">j</span> <span class="main">(</span>insert <span class="free">i</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> UNIV_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">j</span> <span class="main">+</span> sum <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">i</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> i_not_j<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">i</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> False a_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">i</span> <span class="main">+</span> sum <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> False a_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> UNIV_rw2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">a</span> <span class="main">+</span> sum <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> False a_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-det_bezout_matrix"><span class="command">lemma</span></span> det_bezout_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>wellorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a_less_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> aj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">bezout</span> <span class="var">?a</span> <span class="var">?b</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ib <span class="keyword1"><span class="command">have</span></span> foo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">=</span> <span class="free">bezout</span> <span class="bound">a</span> <span class="bound">b</span>
           <span class="keyword1">in</span> <span class="bound">p</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">gcd_a_b</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span>
              <span class="bound">gcd_a_b</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="bound">gcd_a_b</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">gcd_a_b</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> is_bezout_ext_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">bezout</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> bz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="var">?z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> pib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="var">?b</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?a</span> <span class="main">∧</span>
            <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="var">?a</span> <span class="main">∧</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="var">?b</span> <span class="main">⟶</span> <span class="bound">d'</span> <span class="keyword1">dvd</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?b</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">=</span> <span class="var">?a</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> foo <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> pa_bq_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">+</span> <span class="var">?b</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_less_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> d_dvd_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> UNIV_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> insert <span class="free">b</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> p0<span class="main">=</span>True
    <span class="keyword1"><span class="command">have</span></span> q_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pib
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True q add.right_neutral mult.commute mult_zero_right<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aj d_dvd_a dvd_0_left_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> aj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> d_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aj d_dvd_a dvd_0_left_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> qb_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="var">?b</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_not_0 mult_cancel_left1 neg_equal_0_iff_equal 
          no_zero_divisors p0 pa_bq_d q_not_0 right_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>interchange_rows <span class="var">?B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span>interchange_rows <span class="var">?B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> det_upperdiagonal<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">ja</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'rows</span></span></span> <span class="keyword3"><span class="command">assume</span></span> ja_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span><span class="main">&lt;</span><span class="skolem">i</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"interchange_rows <span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="main">0</span>"</span></span>    
        <span class="keyword1"><span class="command">unfolding</span></span> interchange_rows_def <span class="keyword1"><span class="command">using</span></span> a_less_b ja_i p0 a_not_b 
        <span class="keyword1"><span class="command">using</span></span> bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> bezout_matrix_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">=</span> interchange_rows <span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">have</span></span> prod_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"prod <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">=</span>  <span class="skolem">f</span> <span class="free">a</span> <span class="main">*</span> prod <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> prod1<span class="main">:</span> <span class="quoted"><span class="quoted">"prod <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.neutral<span class="main">)</span> 
            <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def interchange_rows_def bezout_matrix_def Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="skolem">f</span> UNIV <span class="main">=</span> prod <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">b</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> UNIV_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">b</span> <span class="main">*</span> prod <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_not_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod_rw prod1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">u</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> a_not_b 
        <span class="keyword1"><span class="command">using</span></span> bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def interchange_rows_def bezout_matrix_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> du_b<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span><span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="var">?b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.left_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">+</span> <span class="var">?b</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pa_bq_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?b</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">*</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="var">?b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="var">?r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> qb_not_0 
          <span class="keyword1"><span class="command">unfolding</span></span> mult_cancel_left1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> det_inter_1<span class="main">:</span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>interchange_rows <span class="var">?B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> det <span class="main">(</span>interchange_rows <span class="var">?B</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> det_interchange_rows <span class="keyword1"><span class="command">using</span></span> a_not_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_inter_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mult_b_dp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mult_b_dp</span> <span class="main">=</span> mult_row <span class="var">?B</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sum_ab</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sum_ab</span> <span class="main">=</span> row_add <span class="skolem">mult_b_dp</span> <span class="free">b</span> <span class="free">a</span> <span class="var">?b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span><span class="skolem">sum_ab</span><span class="main">)</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">sum_ab</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> det_upperdiagonal<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'rows</span></span></span> 
      <span class="keyword3"><span class="command">assume</span></span> j_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="var">?b</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pib
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_neg_iff_add_eq_0 mult_minus_left semiring_normalization_rules<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sum_ab</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_ab_def mult_b_dp_def <span class="keyword1"><span class="command">unfolding</span></span> row_add_def
        <span class="keyword1"><span class="command">unfolding</span></span> mult_row_def bezout_matrix_def
        <span class="keyword1"><span class="command">using</span></span> a_not_b j_less_i a_less_b 
        <span class="keyword1"><span class="command">unfolding</span></span> bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">sum_ab</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">have</span></span> prod_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"prod <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">=</span>  <span class="skolem">f</span> <span class="free">a</span> <span class="main">*</span> prod <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> prod1<span class="main">:</span> <span class="quoted"><span class="quoted">"prod <span class="skolem">f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.neutral<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def sum_ab_def row_add_def 
          mult_b_dp_def mult_row_def bezout_matrix_def Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> ap_bq_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">+</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute pa_bq_d<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="skolem">f</span> UNIV <span class="main">=</span> prod <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">b</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> UNIV_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">b</span> <span class="main">*</span> prod <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_not_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod_rw prod1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">+</span> <span class="var">?b</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> f_def sum_ab_def row_add_def mult_b_dp_def mult_row_def bezout_matrix_def
        <span class="keyword1"><span class="command">unfolding</span></span> bz <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> a_not_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> pib ap_bq_d semiring_normalization_rules<span class="main">(</span>16<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span><span class="skolem">sum_ab</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span><span class="skolem">sum_ab</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">*</span> det <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_ab_def
      <span class="keyword1"><span class="command">unfolding</span></span> det_row_add'<span class="main">[</span><span class="operator">OF</span> not_sym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a_not_b<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult_b_dp_def <span class="keyword1"><span class="command">unfolding</span></span> det_mult_row <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> False aj d_dvd_a dvd_0_left_iff mult_cancel_left1 mult_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-invertible_bezout_matrix"><span class="command">lemma</span></span> invertible_bezout_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring_div<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span>wellorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a_less_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> aj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invertible_iff_is_unit
  <span class="keyword1"><span class="command">unfolding</span></span> det_bezout_matrix<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Echelon_Form-echelon_form_upt_k_bezout_matrix"><span class="command">lemma</span></span> echelon_form_upt_k_bezout_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">k</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>mod_type"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Aik_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> i_less_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">i</span> <span class="free">n</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">i</span> <span class="free">n</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i_not_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_less_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> zero_n<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">n</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> e echelon_form_upt_k_condition1 zero_i<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> zero_i2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>to_nat <span class="main">(</span>from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'c</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> zero_i 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> k ncols_def to_nat_from_nat_id<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> zero_n2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">n</span> <span class="main">(</span>to_nat <span class="main">(</span>from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'c</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zero_n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> k ncols_def to_nat_from_nat_id<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_k_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> ia<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">ia</span> <span class="free">k</span> <span class="var">?B</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ia_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ia_A<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">ia</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'c</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns
          <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> ib i_not_n Aik_0 _ zero_i2 zero_n2<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_less_k k 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id ncols_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ia is_zero_row_upt_k_def j_less_k<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">j</span> <span class="free">k</span> <span class="var">?B</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ja</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'c</span></span></span> <span class="keyword3"><span class="command">assume</span></span> ja_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">ja</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib i_not_n Aik_0 _ zero_i2 zero_n2<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ja_less_k k 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id ncols_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e echelon_form_upt_k_condition1 ia_A ia_j is_zero_row_upt_k_def ja_less_k<span class="main">)</span>
     <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">ja</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span> <span class="skolem">j</span>
   <span class="keyword3"><span class="command">assume</span></span> ia_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> not_zero_ia_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">ia</span> <span class="free">k</span> <span class="var">?B</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> not_zero_j_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="free">k</span> <span class="var">?B</span>"</span></span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">na</span></span> <span class="keyword2"><span class="keyword">where</span></span> na<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">na</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Biana<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">na</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
     <span class="keyword1"><span class="command">using</span></span> not_zero_ia_B <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">na2</span></span> <span class="keyword2"><span class="keyword">where</span></span> na2<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">na2</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Bjna2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">na2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
     <span class="keyword1"><span class="command">using</span></span> not_zero_j_B <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> na_less_fn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">na</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id k na ncols_def<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">na</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">na</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns
     <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> ib i_not_n Aik_0 na_less_fn zero_i2 zero_n2<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Biana <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">na</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
   <span class="keyword1"><span class="command">have</span></span> na_less_fn2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">na2</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id k na2 ncols_def<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">na2</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">na2</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns
     <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> ib i_not_n Aik_0 na_less_fn2 zero_i2 zero_n2<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bjna2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">na2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
   <span class="keyword1"><span class="command">have</span></span> not_zero_ia_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">ia</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> na A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> not_zero_j_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">j</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> na2 A2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">na</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">na</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> na_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">na</span><span class="main">&lt;</span><span class="free">k</span>"</span></span> 
     <span class="keyword1"><span class="command">using</span></span> not_zero_ia_A <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> na_less_fn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">na</span><span class="main">&lt;</span>from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> na_less_k
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id k ncols_def<span class="main">)</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">na2</span></span> <span class="keyword2"><span class="keyword">where</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">na2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> na2_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">na2</span><span class="main">&lt;</span><span class="free">k</span>"</span></span> 
     <span class="keyword1"><span class="command">using</span></span> not_zero_j_A <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> na_less_fn2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">na2</span><span class="main">&lt;</span>from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> na2_less_k
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id k ncols_def<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="var">?B</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib i_not_n Aik_0 _ zero_i2 zero_n2<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Least_le A na_less_fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> A LeastI<span class="main">)</span>
     <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
     <span class="keyword3"><span class="command">assume</span></span> B_ia_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&lt;</span>from_nat <span class="free">k</span>"</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">case</span></span> True
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> 
             <span class="operator">OF</span> ib i_not_n Aik_0 True zero_i2 zero_n2<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B_ia_y <span class="keyword1"><span class="command">.</span></span>
         <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">case</span></span> False
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> A Least_le dual_order.strict_iff_order
            le_less_trans na_less_fn not_le<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">have</span></span> least_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="var">?B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib i_not_n Aik_0 _ zero_i2 zero_n2<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Least_le A2 na_less_fn2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> A2 LeastI<span class="main">)</span>
     <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
     <span class="keyword3"><span class="command">assume</span></span> B_ia_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> 
     <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&lt;</span>from_nat <span class="free">k</span>"</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">case</span></span> True
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> 
            <span class="operator">OF</span> ib i_not_n Aik_0 True zero_i2 zero_n2<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B_ia_y <span class="keyword1"><span class="command">.</span></span>
         <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">case</span></span> False
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> A2 Least_le dual_order.strict_iff_order
            le_less_trans na_less_fn2 not_le<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>   
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="var">?B</span> <span class="main">$</span> <span class="skolem">ia</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">na</span><span class="main">.</span> <span class="var">?B</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">na</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> least_eq least_eq2
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_condition2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e ia_j not_zero_ia_A not_zero_j_A<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-bezout_matrix_preserves_rest"><span class="command">lemma</span></span> bezout_matrix_preserves_rest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a_not_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_not_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≠</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Aik_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_ikA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>to_nat <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">i</span> <span class="free">n</span> <span class="free">k</span> <span class="free">bezout</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_matrix_mult_def <span class="keyword1"><span class="command">unfolding</span></span> bezout_matrix_def Let_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_not_n i_not_n a_not_i<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> UNIV_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">$</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> sum0<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> UNIV_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span> <span class="free">a</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> UNIV <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Code equations to execute the bezout matrix›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">bezout_matrix_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>
  <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> 
      <span class="keyword1">in</span>
         vec_lambda <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="keyword1">else</span>
                         <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="bound">q</span> <span class="keyword1">else</span>
                         <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span>
                         <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span>
                         <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Echelon_Form-bezout_matrix_row_code"><span class="command">lemma</span></span> bezout_matrix_row_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>bezout_matrix_row <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>
        <span class="keyword1">in</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="keyword1">else</span>
               <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">q</span> <span class="keyword1">else</span>
               <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span>
               <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span>
               <span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_matrix_row_def 
               <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_nth <span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">=</span> bezout_matrix_row <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bezout_matrix_def <span class="keyword1"><span class="command">unfolding</span></span> bezout_matrix_row_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> Let_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Properties of the bezout iterate function›</span></span>

<span class="keyword1" id="Echelon_Form-bezout_iterate_not_zero"><span class="command">lemma</span></span> bezout_iterate_not_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Aik_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Aik_0 n a
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> le_0_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_nat_eq_0<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"0.prems"</span><span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> i0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">using</span></span> True Suc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">**</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> i_le_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> 
      <span class="main">=</span> bezout_iterate <span class="var">?B</span> <span class="skolem">n</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">using</span></span> i_le_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bezout_matrix_not_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nrows_def to_nat_from_nat_id<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc_lessD nrows_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_le_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Echelon_Form-bezout_iterate_preserves"><span class="command">lemma</span></span> bezout_iterate_preserves<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">k</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>mod_type"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Aik_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_le_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_upt_k_i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Aik_0 n i_le_n k zero_upt_k_i  e
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">using</span></span> True  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> i_not_fn<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">i</span> <span class="main">≠</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nrows_def to_nat_from_nat_id<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">**</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> i_le_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> le_imp_less_or_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> 
      <span class="main">=</span> bezout_iterate <span class="var">?B</span> <span class="skolem">n</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">using</span></span> i_le_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bezout_matrix_not_zero 
            ib nrows_def to_nat_from_nat_id<span class="main">)</span>   
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc_lessD nrows_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> ncols_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_le_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'c</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> j_k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id j_k k ncols_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib i_not_fn Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> j_k2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
            <span class="operator">unfold</span> to_nat_from_nat_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="skolem">A</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> echelon_form_upt_k_condition1<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> from_nat_mono from_nat_to_nat_id i_le_n nrows_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> is_zero_row_upt_k_def j_k<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="var">?B</span> <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_bezout_matrix<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="skolem">A</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ib<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span><span class="main">≤</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> from_nat_mono'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_not_fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nrows_def to_nat_from_nat_id<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>to_nat <span class="main">(</span>from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'c</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="main">(</span>from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'c</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> add_to_nat_def
          echelon_form_upt_k_condition1 from_nat_mono i_le_n monoid_add_class.add.right_neutral 
          nrows_def to_nat_0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="Echelon_Form-bezout_iterate_preserves_below_n"><span class="command">lemma</span></span> bezout_iterate_preserves_below_n<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Aik_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n_less_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> to_nat <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_le_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_upt_k_i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Aik_0 n i_le_n k zero_upt_k_i e n_less_a
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">using</span></span> True  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> i_not_fn<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">i</span> <span class="main">≠</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nrows_def to_nat_from_nat_id<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">**</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> i_le_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> le_imp_less_or_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> zero_ikB<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> j_k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id j_k k ncols_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib i_not_fn Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> j_k2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
          <span class="operator">unfold</span> to_nat_from_nat_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="skolem">A</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> echelon_form_upt_k_condition1<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> from_nat_mono from_nat_to_nat_id i_le_n nrows_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> is_zero_row_upt_k_def j_k<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span> 
      <span class="main">=</span> bezout_iterate <span class="var">?B</span> <span class="skolem">n</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">using</span></span> i_le_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bezout_matrix_not_zero i_not_fn ib<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc_lessD nrows_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i_le_n less_Suc_eq_le<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> ncols_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_ikB<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="var">?B</span> <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_bezout_matrix<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> ib 
          Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> _ Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> add_to_nat_def dual_order.strict_iff_order from_nat_mono
            i_le_n le_less_trans monoid_add_class.add.right_neutral to_nat_0 to_nat_less_card<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> to_nat <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> Suc_lessD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_rest<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib _ _ _ Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> add_to_nat_def from_nat_mono less_irrefl
          monoid_add_class.add.right_neutral to_nat_0 to_nat_less_card<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i_not_fn<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> n_less_a not_le<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="main">(</span>to_nat <span class="main">(</span>from_nat <span class="free">k</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> ncols_def to_nat_from_nat_id<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-bezout_iterate_zero_column_k"><span class="command">lemma</span></span> bezout_iterate_zero_column_k<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>bezout_domain<span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Aik_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_le_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span><span class="main">≤</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_upt_k_i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> e Aik_0 n k a_n zero_upt_k_i
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"0.prems"</span><span class="main">(</span>5<span class="main">)</span> i_le_a to_nat_from_nat to_nat_le to_nat_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">using</span></span> True 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> i_le_a leD to_nat_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> i_not_fn<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">i</span> <span class="main">≠</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nrows_def to_nat_from_nat_id<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">**</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> i_le_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> i_le_a le_less_trans not_le to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> zero_ikB<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="var">?B</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> j_k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> from_nat_mono<span class="main">[</span><span class="operator">OF</span> j_k Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_id <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_matrix_preserves_previous_columns<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib i_not_fn Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> j_k2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">unfold</span> to_nat_from_nat_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="skolem">A</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> echelon_form_upt_k_condition1<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> add_to_nat_def 
            from_nat_mono i_le_n monoid_add_class.add.right_neutral nrows_def to_nat_0<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> is_zero_row_upt_k_def j_k<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> 
      <span class="main">=</span> bezout_iterate <span class="var">?B</span> <span class="skolem">n</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">using</span></span> i_le_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="var">?B</span> <span class="skolem">n</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?B</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> from_nat <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_preserves_below_n<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="var">?B</span> <span class="free">k</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> True
            echelon_form_upt_k_bezout_matrix from_nat_to_nat_id i_le_a ib<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bezout_matrix_not_zero i_not_fn ib<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Suc_lessD nrows_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> to_nat <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True lessI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> ncols_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i_le_n less_Suc_eq_le<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_ikB<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> True bezout_matrix_works2 
           i_not_fn ib to_nat_from_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="var">?B</span> <span class="free">k</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_bezout_matrix
          <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ib Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> _ Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> from_nat_mono from_nat_to_nat_id i_le_n nrows_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bezout_matrix_not_zero i_not_fn ib<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Suc_lessD nrows_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> ncols_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc.prems<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> le_SucE<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">i</span> <span class="free">k</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_ikB<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Proving the correctness›</span></span>

<span class="keyword1" id="Echelon_Form-condition1_index_le_zero_row"><span class="command">lemma</span></span> condition1_index_le_zero_row<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">k</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span>
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span><span class="main">≤</span><span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> zero_ik<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_zero_row_upt_k_le<span class="main">)</span> 
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> ai<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> from_nat <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="free">i</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ai least_mod_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> True from_nat_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> from_nat <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> leI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> from_nat_0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">…</span> <span class="main">=</span> from_nat <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> from_nat_suc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> ai2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> from_nat <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> from_nat_to_nat_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span>from_nat <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False GreatestI_ex i
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat_id to_nat_0<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> echelon_form_upt_k_condition1<span class="main">[</span><span class="operator">OF</span> e zero_ik<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> ai2 zero_ik <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> from_nat <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Echelon_Form-condition1_part1"><span class="command">lemma</span></span> condition1_part1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">k</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> 
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> zero_ik<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_zero_row_upt_k_le<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> echelon_form_upt_k_condition1<span class="main">[</span><span class="operator">OF</span> e zero_ik<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span><span class="main">≤</span><span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition1_index_le_zero_row<span class="main">[</span><span class="operator">OF</span> e a<span class="main">]</span> all_zero <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Echelon_Form-condition1_part2"><span class="command">lemma</span></span> condition1_part2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">k</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> 
  <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_last<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="main">(</span>nrows <span class="free">A</span><span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> zero_ik<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> is_zero_row_upt_k_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> i_le_a<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span><span class="main">≤</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> condition1_index_le_zero_row<span class="main">[</span><span class="operator">OF</span> e a<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="main">(</span>nrows <span class="free">A</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">using</span></span> from_nat_CARD <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ab i_last i_le_a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_zero e echelon_form_upt_k_condition1 is_zero_row_upt_k_suc le_less_trans zero_ik<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Echelon_Form-condition1_part3"><span class="command">lemma</span></span> condition1_part3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">k</span> <span class="free">bezout</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> 
  <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span> fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_not_last<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_le_m<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Amk_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B echelon_form_of_column_k_def Let_def <span class="keyword1"><span class="command">using</span></span> all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> i_le_a<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span><span class="main">≤</span><span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> condition1_index_le_zero_row<span class="main">[</span><span class="operator">OF</span> e a<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> AB<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i_le_a all_zero assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> le_less_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> AB a assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> e 
        echelon_form_upt_k_condition1 is_zero_row_upt_k_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-condition1_part4"><span class="command">lemma</span></span> condition1_part4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">k</span> <span class="free">bezout</span> <span class="free">i</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> 
  <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≡</span> fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq_G<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_eq_plus1 i_nrows diff_Suc_Suc 
        diff_zero from_nat_to_nat_id i nrows_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> a_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≤</span>from_nat <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_pred i_nrows lessI not_less not_less_eq nrows_def 
      to_nat_from_nat_id to_nat_less_card to_nat_mono zero_less_card_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span>from_nat<span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_G 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> GreatestI_ex i_nrows i nrows_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_le dual_order.strict_iff_order e echelon_form_upt_k_condition1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_le<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Echelon_Form-condition1_part5"><span class="command">lemma</span></span> condition1_part5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>bezout_domain<span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="free">bezout</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> 
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span> fst<span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero_a_B<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> im<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Amk_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_last_row<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>bezout_iterate 
  <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?least</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?interchange</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="var">?least</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bezout_iterate</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_iterate <span class="var">?interchange</span> 
    <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> B_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="var">?bezout_iterate</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B echelon_form_of_column_k_def
    Let_def fst_conv snd_conv <span class="keyword1"><span class="command">using</span></span> im Amk_not_0 not_last_row <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> zero_ikA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> i_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span>to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> row_greater_greatest_is_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_eq from_nat_to_nat_greatest<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> Suc_le'<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">∨</span> <span class="main">¬</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">R</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">R</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> i_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def add_Suc_right neq_iff 
            from_nat_to_nat_greatest i_eq monoid_add_class.add.right_neutral 
            nat.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> not_last_row nrows_def to_nat_0 to_nat_from_nat_id to_nat_less_card<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> zero_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="free">k</span> <span class="var">?interchange</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> i_le_least<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span><span class="main">≤</span><span class="var">?least</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Amk_not_0 LeastI2_wellorder less_imp_le im<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> zero_least_kA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="var">?least</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> echelon_form_upt_k_condition1<span class="main">[</span><span class="operator">OF</span> e zero_ikA<span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> dual_order.strict_iff_order zero_ikA<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="var">?least</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_least_kA j_less_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> zero_a_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?bezout_iterate</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_preserves<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="var">?interchange</span> <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_interchange<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e zero_ikA Amk_not_0 _ k<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> im <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ib <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Amk_not_0 LeastI_ex dual_order.strict_iff_order 
          im interchange_rows_i<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id j_less_k k ncols_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="free">i</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_le_mono Suc_pred 
          discrete nrows_def to_nat_less_card zero_less_card_finite<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="free">k</span> <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_interchange <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_a_B j_less_k <span class="keyword1"><span class="command">unfolding</span></span> B_eq is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span>from_nat <span class="free">i</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> zero_ikA j_less_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> a_not_i<span class="main">=</span>False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="var">?least</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> zero_interchange <span class="keyword1"><span class="command">unfolding</span></span> True is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> j_less_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> a_not_least<span class="main">=</span>False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_not_least a_not_i 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> interchange_rows_preserves<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>               
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> zero_b_k<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab e echelon_form_upt_k_condition1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> i_le_a<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span><span class="main">≤</span><span class="free">a</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> i
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> from_nat_to_nat_greatest from_nat_0<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> least_mod_type<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> GreatestI_ex neq_iff 
        e echelon_form_upt_k_condition1 m zero_a_k<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">have</span></span> i_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_le_a ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="var">?bezout_iterate</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j_less_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bezout_iterate</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?interchange</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_preserves<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="var">?interchange</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_interchange<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e zero_ikA Amk_not_0 _ k<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> im <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ib <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Amk_not_0 LeastI_ex 
          dual_order.strict_iff_order im interchange_rows_i<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id j_less_k k ncols_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="free">i</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_le_mono Suc_pred 
          discrete nrows_def to_nat_less_card zero_less_card_finite<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="free">k</span> <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_interchange<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">=</span><span class="var">?least</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> zero_b_k zero_ikA j_less_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">using</span></span> interchange_rows_preserves<span class="main">[</span><span class="operator">OF</span> i_not_b<span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>        
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_b_k j_less_k <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bezout_iterate</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bezout_iterate</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_zero_column_k<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="var">?interchange</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_interchange<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e zero_ikA Amk_not_0 _ k<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> im <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Amk_not_0 LeastI_ex 
        dual_order.strict_iff_order im interchange_rows_i<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab i_le_a le_less_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> k ncols_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">b</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred leD not_less_eq_eq nrows_def to_nat_less_card zero_less_card_finite<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="free">k</span> <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_interchange<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Echelon_Form-condition2_part1"><span class="command">lemma</span></span> condition2_part1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="free">bezout</span> <span class="free">i</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> 
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span> fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_zero_aB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_bB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> B echelon_form_of_column_k_def Let_def fst_conv snd_conv
    <span class="keyword1"><span class="command">using</span></span> all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero <span class="keyword1"><span class="command">unfolding</span></span> i0 from_nat_0 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B_eq_A least_mod_type<span class="main">)</span>  
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_aB <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> not_all_zero<span class="main">=</span>False
    <span class="keyword1"><span class="command">have</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> not_zero_aA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> B_eq_A GreatestI_ex add_to_nat_def all_zero neq_iff e 
        echelon_form_upt_k_condition1 i2 is_zero_row_upt_k_suc le_Suc 
        not_all_zero not_zero_aB to_nat_1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> not_zero_bA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> B_eq_A GreatestI_ex add_to_nat_def all_zero neq_iff e 
        echelon_form_upt_k_condition1 i2 is_zero_row_upt_k_suc le_Suc 
        not_all_zero not_zero_bB to_nat_1<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> echelon_form_upt_k_condition2<span class="main">[</span><span class="operator">OF</span> e ab<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-condition2_part2"><span class="command">lemma</span></span> condition2_part2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="free">bezout</span> <span class="free">i</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> 
  to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="main">(</span>nrows <span class="free">A</span><span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> i_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i i_nrows nrows_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_0_right One_nat_def Suc_le' add_Suc_right i i_nrows 
      less_not_refl less_trans_Suc nrows_def to_nat_less_card to_nat_mono zero_less_card_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_eq_minus_1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Greatest_is_minus_1 g_minus_1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Greatest_is_minus_1 g_minus_1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> echelon_form_upt_k_condition2<span class="main">[</span><span class="operator">OF</span> e ab<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-condition2_part3"><span class="command">lemma</span></span> condition2_part3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="free">bezout</span> <span class="free">i</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> 
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span> fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_zero_aB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_bB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">ma</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A_ma_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> B echelon_form_of_column_k_def Let_def fst_conv snd_conv
    <span class="keyword1"><span class="command">using</span></span> all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B_eq_A ab all_zero from_nat_0 i is_zero_row_upt_k_suc 
      le_less_trans least_mod_type not_zero_bB<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">using</span></span> not_all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_aA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> from_nat <span class="main">(</span>to_nat <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&lt;</span> <span class="bound">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add_to_nat_def le_Suc to_nat_1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab e echelon_form_upt_k_condition1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B_eq_A greatest_less_zero_row ab all_zero le_imp_less_or_eq e i2 
        is_zero_row_upt_k_suc not_all_zero not_zero_aB not_zero_bB<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_zero_aA echelon_form_upt_k_condition2<span class="main">[</span><span class="operator">OF</span> e ab<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> zero_bA<span class="main">=</span>False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> Aav<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">&lt;</span>from_nat <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> not_zero_aA <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id k ncols_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> least_v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aav<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> b_ge_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">&gt;</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> greatest_less_zero_row e not_all_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> i_eq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> Abk_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_bA <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Abk_0 <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> not_zero_bB <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">assume</span></span> i_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> b_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">&gt;</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> b_ge_greatest <span class="keyword1"><span class="command">unfolding</span></span> i
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> False Suc_less add_to_nat_def i2 i_not_b to_nat_1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> Abk_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False not_zero_bB <span class="keyword1"><span class="command">unfolding</span></span> B_eq_A is_zero_row_upt_k_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B_eq_A False is_zero_row_upt_k_suc not_zero_bB<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="free">k</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Abk_not_0<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> from_nat <span class="free">k</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False is_zero_row_upt_k_def k ncols_def not_less to_nat_from_nat_id to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> least_v v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-condition2_part4"><span class="command">lemma</span></span> condition2_part4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="free">bezout</span> <span class="free">i</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> 
  <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> i_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i_nrows i nrows_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_nrows<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">=</span> mod_type_class.to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> to_nat_plus_one_less_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_eq_minus_1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Greatest_is_minus_1 g<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Greatest_is_minus_1 g<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> echelon_form_upt_k_condition2<span class="main">[</span><span class="operator">OF</span> e ab<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-condition2_part5"><span class="command">lemma</span></span> condition2_part5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="free">bezout</span> <span class="free">i</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> 
  <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span> fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_zero_aB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> not_zero_bB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_m<span class="main">:</span><span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_mk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i_not_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> B_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> bezout_iterate <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span>
    <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B echelon_form_of_column_k_def Let_def fst_conv snd_conv
    <span class="keyword1"><span class="command">using</span></span> i_m A_mk i_not_nrows <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?least</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?interchange</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="var">?least</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?greatest</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> nrows_less<span class="main">:</span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> interchange_ik_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> A_mk LeastI_ex dual_order.strict_iff_order 
      i_m interchange_rows_i<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> to_nat_b<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">b</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred leD not_less_eq_eq nrows_def to_nat_less_card zero_less_card_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> to_nat_from_nat_i<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="free">i</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_not_nrows <span class="keyword1"><span class="command">unfolding</span></span> nrows_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred less_Suc_eq_le to_nat_less_card zero_less_card_finite<span class="main">)</span>    
  <span class="keyword1"><span class="command">have</span></span> not_all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> zero_aA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zero_bA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> echelon_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="var">?interchange</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_interchange<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ A_mk _ k<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> zero_i_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="free">k</span> <span class="var">?interchange</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> all_zero <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> zero_bB<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?interchange</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> B_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bezout_iterate_preserves
          <span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_interchange ib interchange_ik_not_zero nrows_less _ 
            to_nat_from_nat_i k2 zero_i_interchange<span class="main"><span class="main">]</span></span><span class="main">)</span>  
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id k ncols_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> all_zero j
        <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def interchange_rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> i_not_b<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> i all_zero ab least_mod_type <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leD from_nat_0<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_suc not_zero_bB zero_bB<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> B_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bezout_iterate_zero_column_k
        <span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_interchange ib interchange_ik_not_zero nrows_less 
          _ k2 to_nat_b zero_i_interchange<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_zero antisym_conv1 from_nat_0 i i_not_b least_mod_type<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>   
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="var">?greatest</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">using</span></span> not_all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> g_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_to_nat_def to_nat_1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> zero_least_kA<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="var">?least</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> row_greater_greatest_is_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> <span class="main">&lt;</span> from_nat <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_le' add_to_nat_def neq_iff from_nat_0 from_nat_mono 
        i2 i_not_nrows not_less_eq nrows_def to_nat_1 to_nat_less_card zero_less_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?least</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> A_mk LeastI_ex dual_order.strict_iff_order i_m<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> <span class="main">&lt;</span> <span class="var">?least</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> zero_ik_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="free">k</span> <span class="var">?interchange</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> interchange_rows_i is_zero_row_upt_k_def zero_least_kA<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> echelon_form_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="var">?interchange</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_interchange<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ A_mk _ k<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> greatest_ge_nonzero_row' Greatest_is_minus_1 Suc_le' 
        a_eq_minus_1 e g_rw i2 row_greater_greatest_is_zero zero_least_kA<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_m <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> b_le_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> from_nat <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b</span> <span class="main">≤</span> from_nat <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> b_gr_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> from_nat <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> B_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bezout_iterate_zero_column_k<span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_form_interchange ib 
          interchange_ik_not_zero nrows_less b_gr_i k2 to_nat_b zero_ik_interchange<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> 
        <span class="keyword3"><span class="command">assume</span></span> j_k<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?interchange</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> B_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bezout_iterate_preserves<span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_form_interchange ib 
            interchange_ik_not_zero nrows_less _ to_nat_from_nat_i k2 zero_ik_interchange<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id j_k k ncols_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> b_gr_i echelon_form_interchange echelon_form_upt_k_condition1 
            is_zero_row_upt_k_def j_k zero_ik_interchange<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> not_zero_bB <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> from_nat <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> not_zero_aA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">a</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">a</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_less_i <span class="keyword1"><span class="command">unfolding</span></span> i2 g_rw
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_Suc not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> least_eq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="var">?interchange</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> B_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bezout_iterate_preserves<span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_form_interchange ib 
        interchange_ik_not_zero nrows_less _ to_nat_from_nat_i k2 zero_ik_interchange<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Aaj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> not_zero_aA <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aaj<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> from_nat_mono from_nat_to_nat_id j k ncols_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>      
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ab b_le_i interchange_rows_preserves 
        leD not_zero_aA zero_least_kA<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def' is_zero_row_imp_is_zero_row_upt not_zero_aA<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> Bay<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&lt;</span>from_nat <span class="free">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">=</span> <span class="var">?interchange</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> B_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bezout_iterate_preserves<span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_form_interchange ib
          interchange_ik_not_zero nrows_less True to_nat_from_nat_i k2 zero_ik_interchange<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ab b_le_i interchange_rows_preserves 
          leD not_zero_aA zero_least_kA<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bay <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Least_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Aaj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> not_zero_aA <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aaj<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> from_nat_mono from_nat_to_nat_id j k ncols_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">=</span>from_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> zero_bB<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword3"><span class="command">assume</span></span> jk<span class="main">:</span><span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> jk2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id jk k ncols_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?interchange</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> B_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bezout_iterate_preserves<span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_form_interchange ib
          interchange_ik_not_zero nrows_less jk2 to_nat_from_nat_i k2 zero_ik_interchange<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="var">?least</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_least_kA jk <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> least_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> B_eq True
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_not_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> interchange_ik_not_zero 
            nrows_less to_nat_from_nat_i ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> from_nat <span class="free">k</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_def le_less_linear to_nat_le zero_bB<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Abj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_zero_aA <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abj<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> from_nat_mono from_nat_to_nat_id j k ncols_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> least_eq1 least_eq2 <span class="keyword1"><span class="command">.</span></span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> b_not_i<span class="main">=</span>False
    <span class="keyword1"><span class="command">hence</span></span> b_less_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> from_nat <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_le_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> not_zero_bA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">b</span> <span class="free">k</span> <span class="free">A</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> greatest_ge_nonzero_row'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ not_all_zero<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">b</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b_less_i <span class="keyword1"><span class="command">unfolding</span></span> i2 g_rw
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_Suc not_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> least_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="var">?interchange</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> B_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bezout_iterate_preserves<span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_form_interchange ib 
          interchange_ik_not_zero nrows_less _ to_nat_from_nat_i k2 zero_ik_interchange<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Abj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> not_zero_bA <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abj<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> from_nat_mono from_nat_to_nat_id j k ncols_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>      
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> b_not_i interchange_rows_preserves not_zero_bA zero_least_kA<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI is_zero_row_def' is_zero_row_imp_is_zero_row_upt not_zero_bA<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>     
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> Bby<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&lt;</span>from_nat <span class="free">k</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">=</span> <span class="var">?interchange</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> B_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bezout_iterate_preserves<span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_form_interchange ib
            interchange_ik_not_zero nrows_less True to_nat_from_nat_i k2 zero_ik_interchange<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> b_not_i interchange_rows_preserves not_zero_bA zero_least_kA<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bby <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Least_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Abj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> not_zero_bA <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abj<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> from_nat_mono from_nat_to_nat_id j k ncols_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> least_eq1 least_eq2 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_upt_k_condition2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e ab not_zero_aA not_zero_bA<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-echelon_echelon_form_column_k"><span class="command">lemma</span></span> echelon_echelon_form_column_k<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="free">bezout</span>
  <span class="keyword2"><span class="keyword">defines</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> 
  <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span> fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">B</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_upt_k_def echelon_form_of_column_k_def Let_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B2</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="main">(</span>bezout_iterate
    <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span> <span class="main">⟹</span> is_zero_row_upt_k <span class="skolem">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> B echelon_form_of_column_k_def Let_def fst_conv snd_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> condition1_part1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e 1 2 3<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> i<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> nrows <span class="free">A</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="main">(</span>nrows <span class="free">A</span><span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> condition1_part2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e 1 2 3<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> i<span class="main"><span class="main">]</span></span> 4<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="var">?B2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> condition1_part3<span class="main">[</span><span class="operator">OF</span> e ib _ 2 _ _ _ 6<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> 1 3 4 5 <span class="keyword1"><span class="command">unfolding</span></span> i echelon_form_of_column_k_def Let_def fst_conv snd_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'c</span></span></span> <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> condition1_part4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e 1 2<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> i<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B2</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span>bezout_iterate
      <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span>
      <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">,</span>
      <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>     
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="var">?B2</span>"</span></span>                 
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>
      <span class="main">(</span>bezout_iterate
      <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> condition1_part5<span class="main">[</span><span class="operator">OF</span> ib e _ 2 _ 4 _ k<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> 1 3 5 <span class="keyword1"><span class="command">unfolding</span></span> i echelon_form_of_column_k_def Let_def fst_conv snd_conv 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>               
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_zero_aB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> not_zero_bB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">b</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">B</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> B echelon_form_of_column_k_def Let_def fst_conv snd_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> condition2_part1<span class="main">[</span><span class="operator">OF</span> e ab<span class="main">]</span> not_zero_aB not_zero_bB all_zero
      <span class="keyword1"><span class="command">unfolding</span></span> B i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="main">(</span>nrows <span class="free">A</span><span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> condition2_part2<span class="main">[</span><span class="operator">OF</span> e ab 1<span class="main">]</span> 2 <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ma</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">ma</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ma</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> condition2_part3<span class="main">[</span><span class="operator">OF</span> e k ab _ _ _ _ 3<span class="main">]</span> 
      <span class="keyword1"><span class="command">using</span></span> 1 2 not_zero_aB not_zero_bB <span class="keyword1"><span class="command">unfolding</span></span> i B
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> condition2_part4<span class="main">[</span><span class="operator">OF</span> e ab<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B2</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"bezout_iterate <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> 
      <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> B_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">=</span><span class="var">?B2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B echelon_form_of_column_k_def Let_def <span class="keyword1"><span class="command">using</span></span> 1 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?B2</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?B2</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> condition2_part5<span class="main">[</span><span class="operator">OF</span> ib e k ab _ _ _ 2<span class="main">]</span> 1 3 not_zero_aB not_zero_bB 
      <span class="keyword1"><span class="command">unfolding</span></span> i<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> B<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> B_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Echelon_Form-echelon_foldl_condition1"><span class="command">lemma</span></span> echelon_foldl_condition1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">ma</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>bezout_iterate <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> 
    <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"from_nat <span class="main"><span class="main">(</span></span>Suc <span class="free"><span class="free">k</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_mono from_nat_to_nat_id less_irrefl not_less_eq to_nat_less_card<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_not_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI_ex assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> interchange_rows_i<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">0</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_0 nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-echelon_foldl_condition2"><span class="command">lemma</span></span> echelon_foldl_condition2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">ma</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Greatest_equality<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> GreatestI_ex n is_zero_row_upt_k_le<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> row_greater_greatest_is_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  all_zero le_Suc y2<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-echelon_foldl_condition3"><span class="command">lemma</span></span> echelon_foldl_condition3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Am0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>
  <span class="main">(</span>bezout_iterate <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> to_nat_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Greatest_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?interchange</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> b0k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_not_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI Am0 interchange_rows_i<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> nrows <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">0</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_0 nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> least_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> least_mod_type<span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> all_zero_below<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">a</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="var">?b</span> <span class="main">$</span> <span class="bound">a</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'rows</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="skolem">a</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>    
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_zero_column_k<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ib _ _ a<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> from_nat_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> least_eq<span class="main"><span class="keyword3">,</span></span> 
          <span class="operator">rule</span> echelon_form_upt_k_interchange<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ Am0 _ k<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="main">0</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_zero<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">0</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> from_nat_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> least_mod_type<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Am0 LeastI interchange_rows_i<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">a</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> One_nat_def Suc_leI Suc_le_D diff_Suc_eq_diff_pred 
          not_le nrows_def to_nat_less_card zero_less_diff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">0</span> <span class="free">k</span> <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_zero interchange_rows_i is_zero_row_upt_k_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">0</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="var">?b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b0k is_zero_row_upt_k_def k lessI ncols_def to_nat_from_nat_id<span class="main">)</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span>  y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="var">?b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="var">?b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="free">k</span> <span class="var">?b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?interchange</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_preserves<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="var">?interchange</span> <span class="free">k</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> least_eq from_nat_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
              <span class="operator">rule</span> echelon_form_upt_k_interchange<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ Am0 _ k<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span>from_nat <span class="main">0</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_zero<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">0</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_0 least_mod_type<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Am0 LeastI interchange_rows_i<span class="main">)</span>              
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> j from_nat_mono from_nat_to_nat_id k ncols_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">0</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le0 to_nat_0<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">0</span> <span class="free">k</span> <span class="var">?interchange</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_zero interchange_rows_i is_zero_row_upt_k_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_zero dual_order.strict_iff_order interchange_rows_j 
            interchange_rows_preserves is_zero_row_upt_k_def j y2<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero_below <span class="keyword1"><span class="command">using</span></span> y2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Echelon_Form-echelon_foldl_condition4"><span class="command">lemma</span></span> echelon_foldl_condition4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">.</span>
  <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> greatest_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> le_mb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">mb</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_mb_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">mb</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?greatest</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> mb_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mb</span><span class="main">=</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_zero le_mb A_mb_k le_less <span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> 
    <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Greatest_equality<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> A_mb_k is_zero_row_upt_k_def less_Suc_eq less_trans 
        mb_eq not_less_eq to_nat_from_nat_id to_nat_less_card<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> y_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span>  <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> row_greater_greatest_is_zero<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> y_greatest greatest_nrows <span class="keyword1"><span class="command">unfolding</span></span> nrows_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 dual_order.strict_implies_order 
              le_Suc' suc_not_zero to_nat_plus_one_less_card'<span class="main">)</span> 
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> all_zero y_greatest 
          <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1 Suc_lessI add_to_nat_def greatest_nrows 
      nrows_def to_nat_1 to_nat_from_nat_id to_nat_less_card<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-echelon_foldl_condition5"><span class="command">lemma</span></span> echelon_foldl_condition5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>        
  <span class="keyword2"><span class="keyword">assumes</span></span> mb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">mb</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">=</span> Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> GreatestI Suc_lessI Suc_less_eq mb nrows from_nat_mono 
    from_nat_to_nat_id is_zero_row_upt_k_le not_greater_Greatest nrows_def to_nat_less_card<span class="main">)</span> 


<span class="keyword1" id="Echelon_Form-echelon_foldl_condition6"><span class="command">lemma</span></span> echelon_foldl_condition6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> g_mc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">mc</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_mc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">mc</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>
  <span class="main">(</span>bezout_iterate <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
  <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?greatest</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?interchange</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> 
    <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_not_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI_ex g_mc A_mc_k interchange_rows_i<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred less_Suc_eq_le nrows_def to_nat_less_card zero_less_card_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> from_nat_mono from_nat_to_nat_id is_zero_row_upt_k_def 
      less_irrefl not_less_eq to_nat_less_card<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Echelon_Form-echelon_foldl_condition7"><span class="command">lemma</span></span> echelon_foldl_condition7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> mb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="free">mb</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> not_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> g_mc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">mc</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_mc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">mc</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">(</span>bezout_iterate
  <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
  <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?greatest</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?interchange</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> 
    <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> g_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> 
    <span class="main">=</span> from_nat <span class="main">(</span>to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_id <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> B_gk<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_not_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI_ex g_mc A_mc_k interchange_rows_i<span class="main">)</span>      
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="main">(</span><span class="var">?interchange</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred less_Suc_eq_le nrows_def to_nat_less_card 
        zero_less_card_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Greatest_equality<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> B_gk from_nat_mono from_nat_to_nat_id 
        is_zero_row_upt_k_def less_irrefl not_less_eq to_nat_less_card<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="var">?B</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> y_gr<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> y_gr2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1 leI le_Suc' less_irrefl less_trans 
          not_nrows nrows_def suc_not_zero to_nat_plus_one_less_card'<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> echelon_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="var">?interchange</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> from_nat_to_nat_id
          <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">GREATEST</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¬</span></span> is_zero_row_upt_k <span class="bound"><span class="bound">n</span></span> <span class="free"><span class="free">k</span></span> <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
            <span class="operator">rule</span> echelon_form_upt_k_interchange<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e _ A_mc_k _ k<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k 
          <span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_le' g_rw not_nrows nrows_def 
            row_greater_greatest_is_zero suc_not_zero<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">mc</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g_mc g_rw<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>        
      <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> A_mc_k LeastI_ex g_mc interchange_rows_i<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> zero_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_le' not_nrows nrows_def 
          row_greater_greatest_is_zero suc_not_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> <span class="main">&lt;</span> <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> greatest_less_zero_row e mb zero_greatest<span class="main">)</span> 
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> A_mc_k LeastI_ex g_mc<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> least_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> 
          <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span> <span class="free">k</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> row_greater_greatest_is_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> least_less<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> zero_g1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="var">?interchange</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> zero_y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="free">k</span> <span class="var">?interchange</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> echelon_form_upt_k_condition1' echelon_interchange y_gr<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_row_upt_k_suc<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_zero_column_k<span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_interchange ib i _ y_gr _ _ zero_g1<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">y</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_eq_plus1 Suc_leI nrows_def 
              le_diff_conv2 to_nat_less_card zero_less_card_finite<span class="main">)</span>            
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">y</span> <span class="free">k</span> <span class="var">?B</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> is_zero_row_upt_k_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'cols</span></span></span> <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?interchange</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_preserves<span class="main"><span class="main">[</span></span><span class="operator">OF</span> echelon_interchange ib i _ _ _ _ zero_g1<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> from_nat_mono from_nat_to_nat_id k ncols_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="free">k</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred less_Suc_eq_le nrows_def to_nat_less_card zero_less_card_finite<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_y <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="skolem">y</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1 add_to_nat_def not_nrows nrows_def suc_not_zero 
      to_nat_1 to_nat_from_nat_id to_nat_plus_one_less_card'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> echelon_echelon_form_of_upt_k<span class="main">:</span>
  <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="free">k</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span> <span class="main">=</span>
  <span class="main">(</span>fst <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> 
  <span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> 
  <span class="main">(</span>fst <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
  <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> 
  <span class="main">(</span>fst <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> k
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?interchange</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">0</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">0</span> 
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">0</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="main">0</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> i_rw<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> echelon_echelon_form_column_k<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib echelon_form_upt_k_0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ncols_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rw_upt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span>
    <span class="main">(</span>fst <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">,</span>
    <span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> 
    <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> 
    <span class="main">(</span>fst <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rw_upt
    <span class="keyword1"><span class="command">unfolding</span></span> foldl.simps
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_def
    <span class="keyword1"><span class="command">unfolding</span></span> Let_def 
    <span class="keyword1"><span class="command">unfolding</span></span> split_beta
    <span class="keyword1"><span class="command">unfolding</span></span> from_nat_0 fst_conv snd_conv
    <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> least_mod_type to_nat_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> GreatestI least_mod_type less_le<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">mb</span> <span class="keyword3"><span class="command">assume</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> <span class="free">bezout</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> <span class="free">bezout</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> 
      bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">0</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> from_nat_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_not_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ ib<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nrows_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> from_nat_0<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">0</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le0 to_nat_0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> <span class="free">bezout</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">mb</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> all_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> Am0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> GreatestI neq_iff not_less0 to_nat_0 to_nat_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">ma</span> <span class="skolem">mb</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> <span class="free">bezout</span> <span class="main">$</span> <span class="skolem">ma</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> <span class="free">bezout</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> 
      bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">0</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> from_nat_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_not_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ ib<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nrows_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> from_nat <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> LeastI <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> from_nat_0<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">0</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le0 to_nat_0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> <span class="free">bezout</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> <span class="free">bezout</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'rows</span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> <span class="free">bezout</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="main">0</span> 
        <span class="main">=</span> bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">0</span><span class="main">)</span> <span class="free">bezout</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> from_nat <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> from_nat_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_zero_column_k<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="main">(</span><span class="var">?interchange</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> echelon_form_upt_k_0<span class="main">)</span>   
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> <span class="main">0</span> <span class="main">$</span> from_nat <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI_ex <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> from_nat_0 interchange_rows_i<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="main">(</span><span class="var">?interchange</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> ncols <span class="main">(</span><span class="var">?interchange</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">b</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 discrete less_one add.left_neutral not_le 
            nrows_def nrows_not_0 le_diff_conv2 to_nat_less_card<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="main">0</span> <span class="main">0</span> <span class="main">(</span><span class="var">?interchange</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_utp_0<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> <span class="free">bezout</span> <span class="main">$</span> <span class="skolem">b</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>      
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> bezout_iterate <span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> <span class="free">bezout</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Greatest_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fold</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span><span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fold2</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> echelon_form_upt_k <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">=</span>
    <span class="main">(</span>fst <span class="var">?fold2</span><span class="main">,</span> <span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>fst <span class="var">?fold2</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>fst <span class="var">?fold2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Suc_k<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> hyp_foldl<span class="main">:</span> <span class="quoted"><span class="quoted">"foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">=</span>
    <span class="main">(</span>fst <span class="var">?fold2</span><span class="main">,</span> <span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>fst <span class="var">?fold2</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
    <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>fst <span class="var">?fold2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> hyp_echelon<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fold2</span> <span class="main">=</span> <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">,</span> <span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> 
    <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span>
    to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_def <span class="keyword1"><span class="command">using</span></span> hyp_foldl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_def 
    <span class="keyword1"><span class="command">unfolding</span></span> rw <span class="keyword1"><span class="command">unfolding</span></span> foldl_append <span class="keyword1"><span class="command">unfolding</span></span> foldl.simps <span class="keyword1"><span class="command">unfolding</span></span> rw2
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_echelon_form_column_k<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib hyp_echelon<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span>
    <span class="main">(</span>fst <span class="var">?fold</span><span class="main">,</span>
    <span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">(</span>fst <span class="var">?fold</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
    <span class="keyword1">else</span> to_nat
    <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">(</span>fst <span class="var">?fold</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> fst_conv<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> fst <span class="var">?fold2</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?greatest</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_k <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fst_snd_foldl<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="var">?fold2</span> <span class="main">=</span> snd <span class="main">(</span>fst <span class="var">?fold2</span><span class="main">,</span>
      <span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>fst <span class="var">?fold2</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
      <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>fst <span class="var">?fold2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hyp_foldl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> ncols_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ncols <span class="free">A</span> <span class="main">=</span> ncols <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A'_def ncols_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> rref_A'<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form_upt_k <span class="skolem">A'</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hyp_echelon <span class="keyword1"><span class="command">unfolding</span></span> A'_def echelon_form_of_upt_k_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="var">?fold</span> <span class="main">=</span> snd <span class="main">(</span>fst <span class="var">?fold</span><span class="main">,</span> <span class="keyword1">if</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="var">?fold</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span>
      <span class="keyword1">else</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="var">?fold</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> fst_conv snd_conv <span class="keyword1"><span class="command">unfolding</span></span> rw 
        <span class="keyword1"><span class="command">unfolding</span></span> foldl_append <span class="keyword1"><span class="command">unfolding</span></span> foldl.simps
        <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_def Let_def split_beta fst_snd_foldl 
        <span class="keyword1"><span class="command">unfolding</span></span> A'_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> least_mod_type from_nat_0 from_nat_to_nat_greatest<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> is_zero_row_upt_k_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_to_nat_def from_nat_mono less_irrefl 
            monoid_add_class.add.right_neutral not_less_eq to_nat_0 to_nat_less_card<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_le<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ma</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">ma</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">mb</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">mb</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_zero_row_upt_k <span class="skolem">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_zero_row_upt_k_suc<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ma</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">ma</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span> 
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> GreatestI_ex le_less
            is_zero_row_upt_k_suc least_mod_type to_nat_0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="var">?greatest</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> 
          <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> echelon_form_upt_k_condition1 from_nat_0 
            is_zero_row_upt_k_le is_zero_row_upt_k_suc less_nat_zero_code neq_iff rref_A' to_nat_le<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">ma</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="var">?greatest</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> 
          <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="var">?greatest</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">ma</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">ma</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="var">?greatest</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Suc_eq_plus1 less_linear 
            leD least_mod_type nrows_def suc_not_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">ma</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="var">?greatest</span><span class="main">)</span> <span class="main">=</span> nrows <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">ma</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nrows <span class="skolem">A'</span> <span class="main">=</span> Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> echelon_foldl_condition5<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ma</span> <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">ma</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>bezout_iterate <span class="main">(</span>interchange_rows <span class="skolem">A'</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>nrows <span class="skolem">A'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>bezout_iterate <span class="main">(</span>interchange_rows <span class="skolem">A'</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>nrows <span class="skolem">A'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_foldl_condition1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib 1 k<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">ma</span> <span class="skolem">mb</span>
        <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">ma</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> 
          <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_foldl_condition2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 2<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> 
        <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>bezout_iterate <span class="main">(</span>interchange_rows <span class="skolem">A'</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>nrows <span class="skolem">A'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>bezout_iterate <span class="main">(</span>interchange_rows <span class="skolem">A'</span> <span class="main">0</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>nrows <span class="skolem">A'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_foldl_condition3<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib 1 2 rref_A'<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> ncols_def Suc_k<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> 
          <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="var">?greatest</span><span class="main">)</span> <span class="main">=</span> nrows <span class="skolem">A'</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nrows <span class="skolem">A'</span> <span class="main">=</span> Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Suc_eq_plus1 Suc_le' from_nat_suc 
            from_nat_to_nat_id not_less_eq nrows_def to_nat_less_card to_nat_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">mb</span>
        <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="var">?greatest</span><span class="main">+</span><span class="main">1</span><span class="main">.</span>
          <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="var">?greatest</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="skolem">mb</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">mb</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="var">?greatest</span><span class="main">)</span> <span class="main">=</span>
          to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_foldl_condition4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 2 3 4<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> "</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nrows <span class="skolem">A'</span> <span class="main">=</span> Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_less_trans least_mod_type<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>bezout_iterate
          <span class="main">(</span>interchange_rows <span class="skolem">A'</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> 
          <span class="main">∧</span> <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nrows <span class="skolem">A'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_less_trans least_mod_type<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">mb</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">mb</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="var">?greatest</span><span class="main">)</span> <span class="main">=</span> nrows <span class="skolem">A'</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" nrows <span class="skolem">A'</span> <span class="main">=</span> Suc <span class="main">(</span>to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_foldl_condition5<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="var">?greatest</span><span class="main">)</span> <span class="main">=</span>
          to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>bezout_iterate <span class="main">(</span>interchange_rows <span class="skolem">A'</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
          <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>nrows <span class="skolem">A'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_less_trans least_mod_type<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">mc</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">mc</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">mc</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>bezout_iterate <span class="main">(</span>interchange_rows <span class="skolem">A'</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
          <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>nrows <span class="skolem">A'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> echelon_foldl_condition6<span class="main">[</span><span class="operator">OF</span> ib<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">mb</span> <span class="skolem">mc</span>
        <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero_row_upt_k <span class="skolem">mb</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>to_nat <span class="var">?greatest</span><span class="main">)</span> <span class="main">≠</span> nrows <span class="skolem">A'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">mc</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">$</span> <span class="skolem">mc</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" Suc <span class="main">(</span>to_nat <span class="var">?greatest</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> is_zero_row_upt_k <span class="bound">n</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>bezout_iterate <span class="main">(</span>interchange_rows <span class="skolem">A'</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
          <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">A'</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>nrows <span class="skolem">A'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="var">?greatest</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_foldl_condition7<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib rref_A' k2 1 2 3 4 <span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Proving the existence of invertible matrices which do the transformations›</span></span>

<span class="keyword1" id="Echelon_Form-bezout_iterate_invertible"><span class="command">lemma</span></span> bezout_iterate_invertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span><span class="main">≤</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="bound">P</span><span class="main">**</span><span class="free">A</span> <span class="main">=</span> bezout_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">bezout</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span> matrix_mul_lid invertible_def<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">using</span></span> True Suc.prems<span class="main">(</span>1<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span> matrix_mul_lid invertible_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> i_le_n<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">j</span> <span class="free">bezout</span> <span class="main">**</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"bezout_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="free">bezout</span> <span class="main">=</span> bezout_iterate <span class="var">?B</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">bezout</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">using</span></span> i_le_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="bound">P</span><span class="main">**</span><span class="var">?B</span> <span class="main">=</span> bezout_iterate <span class="var">?B</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">bezout</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib _<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_le_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> bezout_matrix_not_zero 
          ib nrows_def to_nat_from_nat_id<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">**</span><span class="var">?B</span> <span class="main">=</span> bezout_iterate <span class="var">?B</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">bezout</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">P</span></span> <span class="main"><span class="main">**</span></span> bezout_matrix <span class="skolem"><span class="skolem">A</span></span> <span class="free"><span class="free">i</span></span> <span class="main"><span class="main">(</span></span>from_nat <span class="main"><span class="main">(</span></span>Suc <span class="skolem"><span class="skolem">n</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">j</span></span> <span class="free"><span class="free">bezout</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> invertible_mult<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">**</span> bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">j</span> <span class="free">bezout</span> <span class="main">**</span> <span class="skolem">A</span> 
        <span class="main">=</span> bezout_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="free">bezout</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">unfolding</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_mul_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> det_bezout_matrix<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> i_le_n from_nat_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span><span class="main">]</span> Suc.prems<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat_id<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>mod_type_class.from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> invertible_iff_is_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inv_P <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-echelon_form_of_column_k_invertible"><span class="command">lemma</span></span> echelon_form_of_column_k_invertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span> matrix_mul_lid invertible_def<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> echelon_form_of_column_k_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">m</span> <span class="skolem">ma</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?least</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?interchange</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="var">?least</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"mod_type_class.from_nat <span class="free">i</span> <span class="main">≤</span> <span class="skolem">ma</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">ma</span> <span class="main">$</span> mod_type_class.from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span>
      <span class="bound">P</span> <span class="main">**</span> <span class="var">?interchange</span> <span class="main">=</span>
      bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_iterate_invertible<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> nrows <span class="var">?interchange</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span>from_nat <span class="free">i</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI Suc_le_mono Suc_pred nrows_def to_nat_less_card zero_less_card_finite<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LeastI_ex i2 ma interchange_rows_i<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">**</span> <span class="var">?interchange</span> <span class="main">=</span>
      bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span> 
      <span class="main">=</span> bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">P</span></span> <span class="main"><span class="main">**</span></span> interchange_rows <span class="main"><span class="main">(</span></span>mat <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>from_nat <span class="free"><span class="free">i</span></span><span class="main"><span class="main">)</span></span> <span class="var"><span class="var">?least</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> invertible_mult<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">**</span> interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="var">?least</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span>
        bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> interchange_rows_mat_1 matrix_mul_assoc<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inv_P<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>interchange_rows <span class="main">(</span>mat <span class="main">1</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="var">?least</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_interchange_rows<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-echelon_form_of_upt_k_invertible"><span class="command">lemma</span></span> echelon_form_of_upt_k_invertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="bound">P</span><span class="main">**</span><span class="free">A</span> <span class="main">=</span> <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="free">k</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> echelon_form_of_column_k_invertible<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> set_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?foldl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> invP<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">P</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> fst <span class="var">?foldl</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> invQ<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">**</span> fst <span class="var">?foldl</span> <span class="main">=</span> fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span>fst <span class="var">?foldl</span><span class="main">,</span> snd <span class="var">?foldl</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> echelon_form_of_column_k_invertible <span class="main">[</span><span class="operator">OF</span> ib<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">Q</span></span><span class="main"><span class="main">**</span></span><span class="skolem"><span class="skolem">P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="skolem">Q</span><span class="main">**</span><span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> invP invQ invertible_mult<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">**</span> <span class="skolem">P</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> echelon_form_of_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_def 
      <span class="keyword1"><span class="command">unfolding</span></span> set_rw <span class="keyword1"><span class="command">unfolding</span></span> foldl_append <span class="keyword1"><span class="command">unfolding</span></span> foldl.simps
      <span class="keyword1"><span class="command">unfolding</span></span> matrix_mul_assoc<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> P Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Final results›</span></span>

<span class="keyword1" id="Echelon_Form-echelon_form_echelon_form_of"><span class="command">lemma</span></span> echelon_form_echelon_form_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"ncols <span class="free">A</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_def echelon_form_of_def 
    <span class="keyword1"><span class="command">using</span></span> echelon_echelon_form_of_upt_k<span class="main">[</span><span class="operator">OF</span> n ib<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form-echelon_form_of_invertible"><span class="command">lemma</span></span> echelon_form_of_invertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="main">(</span><span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> 
            <span class="main">∧</span> <span class="bound">P</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span> 
            <span class="main">∧</span> echelon_form <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> echelon_form_of_upt_k_invertible<span class="main">[</span><span class="operator">OF</span> ib<span class="main">]</span> echelon_form_echelon_form_of<span class="main">[</span><span class="operator">OF</span> ib<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Executable version›</span></span>
 
<span class="keyword1"><span class="command">corollary</span></span> echelon_form_echelon_form_of_euclidean<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_ring_gcd<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="main">(</span>echelon_form_of_euclidean <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> echelon_form_echelon_form_of is_bezout_ext_euclid_ext2 
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_euclidean_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> echelon_form_of_euclidean_invertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_ring_gcd<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">.</span> invertible <span class="bound">P</span> <span class="main">∧</span> <span class="bound">P</span><span class="main">**</span><span class="free">A</span> <span class="main">=</span> <span class="main">(</span>echelon_form_of <span class="free">A</span> euclid_ext2<span class="main">)</span> 
         <span class="main">∧</span> echelon_form <span class="main">(</span>echelon_form_of <span class="free">A</span> euclid_ext2<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> echelon_form_of_invertible<span class="main">[</span><span class="operator">OF</span> is_bezout_ext_euclid_ext2<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹More efficient code equations›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_column_k_efficient</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span>
         <span class="bound">from_nat_k</span> <span class="main">=</span> from_nat <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">;</span>
         <span class="bound">from_nat_i</span> <span class="main">=</span> from_nat <span class="bound">i</span><span class="main">;</span>
         <span class="bound">all_zero_below_i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="bound">from_nat_i</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="bound">from_nat_k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">in</span> <span class="keyword1">if</span>  <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> nrows <span class="bound">A</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">A</span> <span class="main">$</span> <span class="bound">from_nat_i</span> <span class="main">$</span> <span class="bound">from_nat_k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">all_zero_below_i</span>  <span class="keyword1">then</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span>
           <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">all_zero_below_i</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
           <span class="keyword1">else</span>
            <span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> <span class="bound">from_nat_k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">from_nat_i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">;</span>
               <span class="bound">interchange_A</span> <span class="main">=</span> interchange_rows <span class="bound">A</span> <span class="main">(</span><span class="bound">from_nat_i</span><span class="main">)</span> <span class="bound">n</span>
            <span class="keyword1">in</span>
              <span class="main">(</span>bezout_iterate <span class="main">(</span><span class="bound">interchange_A</span><span class="main">)</span> <span class="main">(</span>nrows <span class="bound">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="bound">from_nat_i</span><span class="main">)</span> <span class="main">(</span><span class="bound">from_nat_k</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">,</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Echelon_Form-echelon_form_of_column_k_efficient"><span class="command">lemma</span></span> echelon_form_of_column_k_efficient<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span>
    <span class="main">=</span> <span class="main">(</span>echelon_form_of_column_k_efficient <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_def echelon_form_of_column_k_efficient_def
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="comment1">(*********** Possible future work: ***********)</span>
<span class="comment1">(* 
  - Other kind of Echelon Forms (minimal Echelon, Howell...) and more applications: 
    ranks, system of equations...

  - Hermite Normal Form and its uniqueness. HNF is unique over PID (not in PIR) with respect to 
    a given complete set of associates and a given complete set of residues.
    In general terms, with the integers we use the positive integers, 
    in F[x] we use monic polynomials...

  - Smith Normal Form and its uniqueness.
*)</span>
</pre>
</div><div id="Echelon_Form_Det">
<div class="head">
<h1>Theory Echelon_Form_Det</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Echelon_Form_Det.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Determinant of matrices over principal ideal rings›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Echelon_Form_Det
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Echelon_Form.html">Echelon_Form</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following definition can be improved in terms of performance, because it checks if
  there exists an element different from zero twice.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">echelon_form_of_column_k_det</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> 
      <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span> 
      <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> vec<span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> vec 
      <span class="main">×</span> nat 
     <span class="main">⇒</span>  nat <span class="main">⇒</span> <span class="tfree">'b</span> 
      <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> vec<span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> vec 
      <span class="main">×</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_column_k_det</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">det_P</span><span class="main">,</span> <span class="bound">A</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span>
      <span class="bound">from_nat_i</span> <span class="main">=</span> from_nat <span class="bound">i</span><span class="main">;</span>
      <span class="bound">from_nat_k</span> <span class="main">=</span> from_nat <span class="free"><span class="bound"><span class="entity">k</span></span></span>
     <span class="keyword1">in</span> 
      <span class="keyword1">if</span> <span class="main">(</span> <span class="main">(</span><span class="bound">i</span> <span class="main">≠</span> nrows <span class="bound">A</span><span class="main">)</span> <span class="main">∧</span> 
           <span class="main">(</span><span class="bound">A</span> <span class="main">$</span> <span class="bound">from_nat_i</span> <span class="main">$</span> <span class="bound">from_nat_k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="bound">i</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
         <span class="keyword1">then</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="bound">det_P</span><span class="main">,</span> <span class="main">(</span>echelon_form_of_column_k <span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> 
         <span class="keyword1">else</span> <span class="main">(</span>     <span class="bound">det_P</span><span class="main">,</span> <span class="main">(</span>echelon_form_of_column_k <span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_upt_k_det</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span><span class="main">;</span> 
         <span class="bound">f</span> <span class="main">=</span> <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span><span class="main">)</span>
     <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">f</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">echelon_form_of_det</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>
      <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> 
      <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_det</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> echelon_form_of_upt_k_det <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>ncols <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Bezout Iterate›</span></span>

<span class="keyword1" id="Echelon_Form_Det-det_bezout_iterate"><span class="command">lemma</span></span> det_bezout_iterate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Aik<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>bezout_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Aik n
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">≤</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?B</span> <span class="main">**</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">case</span></span> False    
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span>mod_type_class.from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span> 
      <span class="main">=</span> bezout_iterate <span class="var">?A</span> <span class="skolem">n</span> <span class="free">i</span> <span class="main">(</span>mod_type_class.from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span><span class="main">...</span><span class="main">)</span> <span class="main">=</span> det <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bezout_matrix_not_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib _ Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> ncols <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq_imp_le ncols_def to_nat_from_nat_id<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="var">?B</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> det_bezout_matrix<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib _  Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>          
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">::</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> from_nat_mono<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> mod_type_class.from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> from_nat_to_nat_id <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span>  det_mul <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Echelon Form of column k›</span></span>

<span class="keyword1" id="Echelon_Form_Det-det_echelon_form_of_column_k_det"><span class="command">lemma</span></span> det_echelon_form_of_column_k_det<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">det_P</span> <span class="main">*</span> det <span class="free">B</span> <span class="main">=</span> det <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">det_P</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> det <span class="free">B</span> 
  <span class="main">=</span> det <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">det_P</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?interchange</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> 
    <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_iterate <span class="var">?interchange</span> <span class="main">(</span>nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> echelon_form_of_column_k_det_def Let_def echelon_form_of_column_k_def<span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Amk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> <span class="skolem">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> i_not_nrows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> nrows <span class="free">A</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Aik<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="var">?B</span> <span class="main">=</span> det <span class="var">?interchange</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> det_bezout_iterate<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Amk LeastI_ex 
          dual_order.strict_iff_order i interchange_rows_i<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> ncols <span class="var">?interchange</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> nrows_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> det <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> det_interchange_different_rows<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> i_least<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Amk LeastI_ex 
          linear i i_least leD<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> Aik <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>    
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> det <span class="free">A</span> <span class="main">=</span> det <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Aik<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="var">?B</span> <span class="main">=</span> det <span class="var">?interchange</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> det_bezout_iterate<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?interchange</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Aik LeastI order_refl interchange_rows_i<span class="main">)</span>    
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows <span class="free">A</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">&lt;</span> ncols <span class="var">?interchange</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> nrows_def ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> det <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_interchange_same_rows<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Least_equality<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aik<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"det <span class="free">A</span> <span class="main">=</span> det <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Echelon_Form_Det-snd_echelon_form_of_column_k_det_eq"><span class="command">lemma</span></span> snd_echelon_form_of_column_k_det_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> 
  <span class="main">=</span> <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_det_def echelon_form_of_column_k_def Let_def snd_conv fst_conv
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Echelon form up to column k›</span></span>

<span class="keyword1" id="Echelon_Form_Det-snd_foldl_ef_det_eq"><span class="command">lemma</span></span> snd_foldl_ef_det_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span><span class="main">)</span> 
  <span class="main">=</span> foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> echelon_form_of_column_k_det_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Suc_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Suc_rw foldl_append List.foldl.simps fst_conv snd_conv
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">[</span><span class="operator">unfolded</span> echelon_form_of_upt_k_det_def Let_def snd_conv<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.collapse snd_echelon_form_of_column_k_det_eq<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form_Det-snd_echelon_form_of_upt_k_det_eq"><span class="command">lemma</span></span> snd_echelon_form_of_upt_k_det_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> echelon_form_of_upt_k <span class="free">A</span> <span class="free">k</span> <span class="free">bezout</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_det_def echelon_form_of_upt_k_def Let_def fst_conv snd_conv
  <span class="keyword1"><span class="command">unfolding</span></span> snd_foldl_ef_det_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Echelon_Form_Det-det_echelon_form_of_upt_k_det"><span class="command">lemma</span></span> det_echelon_form_of_upt_k_det<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span>  det <span class="free">A</span> 
  <span class="main">=</span> det <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_det_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> det_echelon_form_of_column_k_det<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Suc_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> fold_expand<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> <span class="main">(</span>fst <span class="var">?f</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_det_def Let_def 
    <span class="keyword1"><span class="command">unfolding</span></span> Suc_rw foldl_append List.foldl.simps fst_conv snd_conv
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> fold_expand<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> det_echelon_form_of_column_k_det<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ib<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> snd_foldl_ef_det_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.hyps echelon_form_of_upt_k_det_def fst_conv snd_conv snd_foldl_ef_det_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Echelon form›</span></span>

<span class="keyword1" id="Echelon_Form_Det-det_echelon_form_of_det"><span class="command">lemma</span></span> det_echelon_form_of_det<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span> <span class="main">=</span> det <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> det_echelon_form_of_upt_k_det ib <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_det_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Proving that the first component is a unit›</span></span>

<span class="keyword1" id="Echelon_Form_Det-echelon_form_of_column_k_det_unit"><span class="command">lemma</span></span> echelon_form_of_column_k_det_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain_div<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> det<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span><span class="free">det_P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">det_P</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_det_def Let_def fst_conv snd_conv <span class="keyword1"><span class="command">using</span></span> det <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Echelon_Form_Det-echelon_form_of_upt_k_det_unit"><span class="command">lemma</span></span> echelon_form_of_upt_k_det_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain_div<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_det_def Let_def fst_conv
    <span class="keyword1"><span class="command">using</span></span> echelon_form_of_column_k_det_unit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Suc_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> fold_expand<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> <span class="main">(</span>fst <span class="var">?f</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_det_def Let_def 
    <span class="keyword1"><span class="command">unfolding</span></span> Suc_rw foldl_append List.foldl.simps fst_conv snd_conv 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> fold_expand<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> echelon_form_of_column_k_det_unit
    <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc.hyps<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> echelon_form_of_upt_k_det_def Let_def fst_conv snd_conv<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form_Det-echelon_form_of_unit"><span class="command">lemma</span></span> echelon_form_of_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain_div<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span>fst <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_det_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_of_upt_k_det_unit<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Final lemmas›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> det_echelon_form_of_det'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain_div<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="free">A</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">div</span> <span class="main">(</span>fst <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">*</span> det <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> det <span class="free">A</span> <span class="main">=</span> det <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_echelon_form_of_det<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"det <span class="free">A</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">div</span> <span class="main">(</span>fst <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">*</span> det <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> echelon_form_of_unit <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Echelon_Form_Det-ef_echelon_form_of_det"><span class="command">lemma</span></span> ef_echelon_form_of_det<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"echelon_form <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_det_def
  <span class="keyword1"><span class="command">unfolding</span></span> snd_echelon_form_of_upt_k_det_eq
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> echelon_form_echelon_form_of<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Echelon_Form_Det-det_echelon_form"><span class="command">lemma</span></span> det_echelon_form<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ef<span class="main">:</span> <span class="quoted"><span class="quoted">"echelon_form <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="free">A</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span> <span class="tfree">'n</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> det_upperdiagonal echelon_form_imp_upper_triagular<span class="main">[</span><span class="operator">OF</span> ef<span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> upper_triangular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">corollary</span></span> det_echelon_form_of_det_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain_div<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bezout_ext <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="free">A</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">div</span> <span class="main">(</span>fst <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">*</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span> <span class="tfree">'n</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> det_echelon_form_of_det'<span class="main">[</span><span class="operator">OF</span> ib<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> det_echelon_form<span class="main">[</span><span class="operator">OF</span> ef_echelon_form_of_det<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ib<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> det_echelon_form_of_euclidean<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_ring_gcd<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="free">A</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">div</span> <span class="main">(</span>fst <span class="main">(</span>echelon_form_of_det <span class="free">A</span> euclid_ext2<span class="main">)</span><span class="main">)</span> 
  <span class="main">*</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> euclid_ext2<span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span> <span class="tfree">'n</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_echelon_form_of_det_prod<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_bezout_ext_euclid_ext2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Echelon_Form_Inverse">
<div class="head">
<h1>Theory Echelon_Form_Inverse</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Echelon_Form_Inverse.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Inverse matrix over principal ideal rings›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Echelon_Form_Inverse
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="Echelon_Form_Det.html">Echelon_Form_Det</a>
    <a href="../Gauss_Jordan/Inverse.html">Gauss_Jordan.Inverse</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Computing the inverse of matrix over rings›</span></span>

<span class="keyword1" id="Echelon_Form_Inverse-scalar_mult_mat"><span class="command">lemma</span></span> scalar_mult_mat<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">*k</span> mat <span class="free">y</span> <span class="main">=</span> mat <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_scalar_mult_def mat_def vec_eq_iff<span class="main">)</span>

<span class="keyword1" id="Echelon_Form_Inverse-matrix_mul_mat"><span class="command">lemma</span></span> matrix_mul_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_semiring_1 <span class="main">^</span> <span class="tfree">'m</span> <span class="main">^</span> <span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">**</span> mat <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">*k</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_matrix_mult_def mat_def if_distrib sum.If_cases matrix_scalar_mult_def vec_eq_iff <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Echelon_Form_Inverse-mult_adjugate_det"><span class="command">lemma</span></span> mult_adjugate_det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">**</span> adjugate <span class="free">A</span> <span class="main">=</span> mat <span class="main">(</span>det <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_adjugate_det<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_vec <span class="free">A</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> det_sq_matrix_eq adjugate_eq to_vec_eq_iff<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> to_vec_matrix_matrix_mult to_vec_from_vec 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_vec_diag<span class="main">)</span>

<span class="keyword1" id="Echelon_Form_Inverse-invertible_imp_matrix_inv"><span class="command">lemma</span></span> invertible_imp_matrix_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span><span class="free">A</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">,</span>euclidean_semiring<span class="main">}</span><span class="main">)</span> <span class="main">^</span> <span class="tfree">'b</span> <span class="main">^</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_inv <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="main">(</span>det <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*k</span> adjugate <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"adjugate <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">**</span> <span class="var">?A</span> <span class="main">=</span> det <span class="free">A</span> <span class="keyword1">*k</span> mat <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> mult_adjugate_det <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_mult_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"matrix_inv <span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="var">?A</span><span class="main">)</span> <span class="main">=</span> matrix_inv <span class="free">A</span> <span class="main">**</span> <span class="main">(</span>det <span class="free">A</span> <span class="keyword1">*k</span> mat <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> det <span class="free">A</span> <span class="keyword1">*k</span> matrix_inv <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_mul_assoc matrix_inv_left<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> matrix_mul_lid scalar_mult_mat matrix_mul_mat
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> i <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> dvd_mult_div_cancel invertible_iff_is_unit
                 matrix_mul_assoc matrix_mul_mat matrix_mul_rid scalar_mult_mat mult.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1" id="Echelon_Form_Inverse-inverse_matrix_code_rings"><span class="command">lemma</span></span> inverse_matrix_code_rings<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inverse_matrix <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">d</span><span class="main">=</span>det <span class="free">A</span> <span class="keyword1">in</span> <span class="keyword1">if</span> is_unit <span class="bound">d</span> <span class="keyword1">then</span> Some <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="keyword1">*k</span> adjugate <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_imp_matrix_inv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> inverse_matrix_def invertible_iff_is_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Examples_Echelon_Form_Abstract">
<div class="head">
<h1>Theory Examples_Echelon_Form_Abstract</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Examples_Echelon_Form_Abstract.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Examples of execution over matrices represented as functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Examples_Echelon_Form_Abstract
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Code_Cayley_Hamilton.html">Code_Cayley_Hamilton</a>
  <a href="../Gauss_Jordan/Examples_Gauss_Jordan_Abstract.html">Gauss_Jordan.Examples_Gauss_Jordan_Abstract</a>
  <a href="Echelon_Form_Inverse.html">Echelon_Form_Inverse</a>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Field_as_Ring.html">HOL-Computational_Algebra.Field_as_Ring</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The definitions introduced in this file will be also used in 
  the computations presented in file <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹Examples_Echelon_Form_IArrays.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
  Some of these definitions are not even used in this file since they are quite 
  time consuming.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_real_6x4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">4</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">test_real_6x4</span> <span class="main">=</span> list_of_list_to_matrix
        <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
         <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
         <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
         <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span>"</span></span>
  
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_list_of_list <span class="main">(</span>minorM test_real_6x4 <span class="main">0</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"cofactor <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span>rat<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vec_to_list <span class="main">(</span>cofactorM_row  <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span>int<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_list_of_list <span class="main">(</span>cofactorM  <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span>int<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_rat_3x3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">test_rat_3x3</span> <span class="main">=</span> list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_list_of_list <span class="main">(</span>matpow test_rat_3x3 <span class="numeral">5</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_int_3x3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">test_int_3x3</span> <span class="main">=</span> list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det test_int_3x3"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_real_3x3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">test_real_3x3</span> <span class="main">=</span> list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"charpoly test_real_3x3"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We check that the Cayley-Hamilton theorem holds for this particular case:›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_list_of_list <span class="main">(</span>evalmat <span class="main">(</span>charpoly test_real_3x3<span class="main">)</span> test_real_3x3<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_int_3x3_02</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">test_int_3x3_02</span> <span class="main">=</span> list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_list_of_list <span class="main">(</span>adjugate test_int_3x3_02<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following integer matrix is not invertible, so the result is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>None›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"inverse_matrix test_int_3x3_02"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_int_3x3_03</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">test_int_3x3_03</span> <span class="main">=</span> list_of_list_to_matrix <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_list_of_list <span class="main">(</span>the <span class="main">(</span>inverse_matrix test_int_3x3_03<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We check that the previous inverse has been correctly computed:›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"test_int_3x3_03 <span class="main">**</span> <span class="main">(</span>the <span class="main">(</span>inverse_matrix test_int_3x3_03<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span>int<span class="main">^</span><span class="numeral">3</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_int_8x8</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int<span class="main">^</span><span class="numeral">8</span><span class="main">^</span><span class="numeral">8</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">test_int_8x8</span> <span class="main">=</span> list_of_list_to_matrix 
       <span class="main">[</span><span class="main">[</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">6</span><span class="main">]</span><span class="main">,</span>
        <span class="main">[</span> <span class="main">0</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">9</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span> <span class="numeral">7</span><span class="main">]</span><span class="main">,</span>
        <span class="main">[</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> <span class="numeral">9</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
        <span class="main">[</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
        <span class="main">[</span> <span class="main">0</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">]</span><span class="main">,</span>
        <span class="main">[</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">5</span><span class="main">]</span><span class="main">,</span>
        <span class="main">[</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="numeral">3</span><span class="main">]</span><span class="main">,</span>
        <span class="main">[</span> <span class="numeral">7</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="numeral">9</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹SLOW; several minutes.›</span></span>

<span class="comment1">(*value "det test_int_8x8"

value "matrix_to_list_of_list (echelon_form_of test_int_8x8 euclid_ext2)"*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following definitions will be used in 
  file <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹Examples_Echelon_Form_IArrays.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  Using the abstract version of matrices would produce lengthy computations.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_int_6x6</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">6</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">test_int_6x6</span> <span class="main">=</span> list_of_list_to_matrix 
    <span class="main">[</span><span class="main">[</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">8</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span> <span class="main">0</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">9</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> <span class="numeral">9</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="main">1</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span> <span class="main">0</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_real_6x6</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">6</span><span class="main">^</span><span class="numeral">6</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">test_real_6x6</span> <span class="main">=</span> list_of_list_to_matrix 
    <span class="main">[</span><span class="main">[</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">8</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span> <span class="main">0</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">9</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> <span class="numeral">9</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="main">1</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span> <span class="main">0</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_int_20x20</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int<span class="main">^</span><span class="numeral">20</span><span class="main">^</span><span class="numeral">20</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">test_int_20x20</span> <span class="main">=</span>  list_of_list_to_matrix 
    <span class="main">[</span><span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">9</span><span class="main">::</span>int<span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="main">-</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">]</span><span class="main">,</span>
     <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">9</span><span class="main">::</span>int<span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">]</span>"</span></span>
     


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test_int_20x20_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int<span class="main">^</span><span class="numeral">20</span><span class="main">^</span><span class="numeral">20</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">test_int_20x20_2</span> <span class="main">=</span> list_of_list_to_matrix
      <span class="main">[</span><span class="main">[</span><span class="numeral">58</span><span class="main">,</span><span class="numeral">18</span><span class="main">,</span><span class="numeral">18</span><span class="main">,</span><span class="numeral">41</span><span class="main">,</span><span class="numeral">68</span><span class="main">,</span><span class="numeral">62</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">21</span><span class="main">,</span><span class="numeral">19</span><span class="main">,</span><span class="numeral">78</span><span class="main">,</span><span class="numeral">34</span><span class="main">,</span><span class="numeral">22</span><span class="main">,</span><span class="numeral">108</span><span class="main">,</span><span class="numeral">63</span><span class="main">,</span><span class="numeral">71</span><span class="main">,</span><span class="numeral">38</span><span class="main">,</span><span class="numeral">43</span><span class="main">,</span><span class="numeral">52</span><span class="main">,</span><span class="numeral">37</span><span class="main">,</span><span class="numeral">24</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">18</span><span class="main">,</span><span class="numeral">51</span><span class="main">,</span><span class="numeral">29</span><span class="main">,</span><span class="numeral">91</span><span class="main">,</span><span class="numeral">76</span><span class="main">,</span><span class="numeral">98</span><span class="main">,</span><span class="numeral">56</span><span class="main">,</span><span class="numeral">37</span><span class="main">,</span><span class="numeral">47</span><span class="main">,</span><span class="numeral">61</span><span class="main">,</span><span class="numeral">88</span><span class="main">,</span><span class="numeral">99</span><span class="main">,</span><span class="numeral">88</span><span class="main">,</span><span class="numeral">78</span><span class="main">,</span><span class="numeral">210</span><span class="main">,</span><span class="numeral">57</span><span class="main">,</span><span class="numeral">27</span><span class="main">,</span><span class="numeral">87</span><span class="main">,</span><span class="numeral">72</span><span class="main">,</span><span class="numeral">79</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">49</span><span class="main">,</span><span class="numeral">19</span><span class="main">,</span><span class="numeral">81</span><span class="main">,</span><span class="numeral">107</span><span class="main">,</span><span class="numeral">43</span><span class="main">,</span><span class="numeral">34</span><span class="main">,</span><span class="numeral">69</span><span class="main">,</span><span class="numeral">28</span><span class="main">,</span><span class="numeral">101</span><span class="main">,</span><span class="numeral">39</span><span class="main">,</span><span class="numeral">21</span><span class="main">,</span><span class="numeral">910</span><span class="main">,</span><span class="numeral">27</span><span class="main">,</span><span class="numeral">53</span><span class="main">,</span><span class="numeral">15</span><span class="main">,</span><span class="numeral">38</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">34</span><span class="main">,</span><span class="numeral">47</span><span class="main">,</span><span class="numeral">23</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">97</span><span class="main">,</span><span class="numeral">102</span><span class="main">,</span><span class="numeral">68</span><span class="main">,</span><span class="numeral">27</span><span class="main">,</span><span class="numeral">56</span><span class="main">,</span><span class="numeral">56</span><span class="main">,</span><span class="numeral">102</span><span class="main">,</span><span class="numeral">210</span><span class="main">,</span><span class="numeral">68</span><span class="main">,</span><span class="numeral">56</span><span class="main">,</span><span class="numeral">24</span><span class="main">,</span><span class="numeral">33</span><span class="main">,</span><span class="numeral">88</span><span class="main">,</span><span class="numeral">110</span><span class="main">,</span><span class="numeral">71</span><span class="main">,</span><span class="numeral">23</span><span class="main">,</span><span class="numeral">35</span><span class="main">,</span><span class="numeral">36</span><span class="main">,</span><span class="numeral">72</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">63</span><span class="main">,</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">39</span><span class="main">,</span><span class="numeral">16</span><span class="main">,</span><span class="numeral">32</span><span class="main">,</span><span class="numeral">81</span><span class="main">,</span><span class="numeral">16</span><span class="main">,</span><span class="numeral">98</span><span class="main">,</span><span class="numeral">94</span><span class="main">,</span><span class="numeral">26</span><span class="main">,</span><span class="numeral">53</span><span class="main">,</span><span class="numeral">23</span><span class="main">,</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">51</span><span class="main">,</span><span class="numeral">98</span><span class="main">,</span><span class="numeral">51</span><span class="main">,</span><span class="numeral">81</span><span class="main">,</span><span class="numeral">57</span><span class="main">,</span><span class="numeral">610</span><span class="main">,</span><span class="numeral">85</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">46</span><span class="main">,</span><span class="numeral">61</span><span class="main">,</span><span class="numeral">68</span><span class="main">,</span><span class="numeral">710</span><span class="main">,</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">105</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">61</span><span class="main">,</span><span class="numeral">210</span><span class="main">,</span><span class="numeral">67</span><span class="main">,</span><span class="numeral">34</span><span class="main">,</span><span class="numeral">108</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="numeral">44</span><span class="main">,</span><span class="numeral">71</span><span class="main">,</span><span class="numeral">36</span><span class="main">,</span><span class="numeral">66</span><span class="main">,</span><span class="numeral">38</span><span class="main">,</span><span class="numeral">42</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">39</span><span class="main">,</span><span class="numeral">75</span><span class="main">,</span><span class="numeral">106</span><span class="main">,</span><span class="numeral">42</span><span class="main">,</span><span class="numeral">36</span><span class="main">,</span><span class="numeral">92</span><span class="main">,</span><span class="numeral">110</span><span class="main">,</span><span class="numeral">42</span><span class="main">,</span><span class="numeral">89</span><span class="main">,</span><span class="numeral">105</span><span class="main">,</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">108</span><span class="main">,</span><span class="numeral">22</span><span class="main">,</span><span class="numeral">61</span><span class="main">,</span><span class="numeral">65</span><span class="main">,</span><span class="numeral">101</span><span class="main">,</span><span class="numeral">410</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">31</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">106</span><span class="main">,</span><span class="numeral">94</span><span class="main">,</span><span class="numeral">24</span><span class="main">,</span><span class="numeral">63</span><span class="main">,</span><span class="numeral">16</span><span class="main">,</span><span class="numeral">75</span><span class="main">,</span><span class="numeral">47</span><span class="main">,</span><span class="numeral">82</span><span class="main">,</span><span class="numeral">62</span><span class="main">,</span><span class="numeral">210</span><span class="main">,</span><span class="numeral">52</span><span class="main">,</span><span class="numeral">57</span><span class="main">,</span><span class="numeral">810</span><span class="main">,</span><span class="numeral">41</span><span class="main">,</span><span class="numeral">55</span><span class="main">,</span><span class="numeral">93</span><span class="main">,</span><span class="numeral">73</span><span class="main">,</span><span class="numeral">58</span><span class="main">,</span><span class="numeral">41</span><span class="main">,</span><span class="numeral">82</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">55</span><span class="main">,</span><span class="numeral">49</span><span class="main">,</span><span class="numeral">102</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">41</span><span class="main">,</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">110</span><span class="main">,</span><span class="numeral">109</span><span class="main">,</span><span class="numeral">310</span><span class="main">,</span><span class="numeral">95</span><span class="main">,</span><span class="numeral">51</span><span class="main">,</span><span class="numeral">103</span><span class="main">,</span><span class="numeral">71</span><span class="main">,</span><span class="numeral">92</span><span class="main">,</span><span class="numeral">85</span><span class="main">,</span><span class="numeral">910</span><span class="main">,</span><span class="numeral">410</span><span class="main">,</span><span class="numeral">17</span><span class="main">,</span><span class="numeral">21</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">31</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">77</span><span class="main">,</span><span class="numeral">93</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">98</span><span class="main">,</span><span class="numeral">510</span><span class="main">,</span><span class="numeral">94</span><span class="main">,</span><span class="numeral">56</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">91</span><span class="main">,</span><span class="numeral">69</span><span class="main">,</span><span class="numeral">31</span><span class="main">,</span><span class="numeral">62</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">92</span><span class="main">,</span><span class="numeral">65</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">22</span><span class="main">,</span><span class="numeral">29</span><span class="main">,</span><span class="numeral">103</span><span class="main">,</span><span class="numeral">34</span><span class="main">,</span><span class="numeral">64</span><span class="main">,</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">610</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">19</span><span class="main">,</span><span class="numeral">35</span><span class="main">,</span><span class="numeral">24</span><span class="main">,</span><span class="numeral">21</span><span class="main">,</span><span class="numeral">49</span><span class="main">,</span><span class="numeral">31</span><span class="main">,</span><span class="numeral">43</span><span class="main">,</span><span class="numeral">81</span><span class="main">,</span><span class="numeral">102</span><span class="main">,</span><span class="numeral">14</span><span class="main">,</span><span class="numeral">11</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">75</span><span class="main">,</span><span class="numeral">81</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">109</span><span class="main">,</span><span class="numeral">61</span><span class="main">,</span><span class="numeral">110</span><span class="main">,</span><span class="numeral">19</span><span class="main">,</span><span class="numeral">46</span><span class="main">,</span><span class="numeral">55</span><span class="main">,</span><span class="numeral">23</span><span class="main">,</span><span class="numeral">31</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">98</span><span class="main">,</span><span class="numeral">28</span><span class="main">,</span><span class="numeral">56</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">83</span><span class="main">,</span><span class="numeral">81</span><span class="main">,</span><span class="numeral">91</span><span class="main">,</span><span class="numeral">41</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">510</span><span class="main">,</span><span class="numeral">58</span><span class="main">,</span><span class="numeral">41</span><span class="main">,</span><span class="numeral">38</span><span class="main">,</span><span class="numeral">106</span><span class="main">,</span><span class="numeral">99</span><span class="main">,</span><span class="numeral">103</span><span class="main">,</span><span class="numeral">31</span><span class="main">,</span><span class="numeral">84</span><span class="main">,</span><span class="numeral">110</span><span class="main">,</span><span class="numeral">63</span><span class="main">,</span><span class="numeral">17</span><span class="main">,</span><span class="numeral">105</span><span class="main">,</span><span class="numeral">210</span><span class="main">,</span><span class="numeral">61</span><span class="main">,</span><span class="numeral">95</span><span class="main">,</span><span class="numeral">103</span><span class="main">,</span><span class="numeral">63</span><span class="main">,</span><span class="numeral">51</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">38</span><span class="main">,</span><span class="numeral">32</span><span class="main">,</span><span class="numeral">510</span><span class="main">,</span><span class="numeral">62</span><span class="main">,</span><span class="numeral">410</span><span class="main">,</span><span class="numeral">14</span><span class="main">,</span><span class="numeral">86</span><span class="main">,</span><span class="numeral">310</span><span class="main">,</span><span class="numeral">59</span><span class="main">,</span><span class="numeral">69</span><span class="main">,</span><span class="numeral">107</span><span class="main">,</span><span class="numeral">13</span><span class="main">,</span><span class="numeral">29</span><span class="main">,</span><span class="numeral">610</span><span class="main">,</span><span class="numeral">38</span><span class="main">,</span><span class="numeral">103</span><span class="main">,</span><span class="numeral">43</span><span class="main">,</span><span class="numeral">98</span><span class="main">,</span><span class="numeral">98</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">101</span><span class="main">,</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">101</span><span class="main">,</span><span class="numeral">99</span><span class="main">,</span><span class="numeral">810</span><span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">510</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">35</span><span class="main">,</span><span class="numeral">62</span><span class="main">,</span><span class="numeral">45</span><span class="main">,</span><span class="numeral">49</span><span class="main">,</span><span class="numeral">34</span><span class="main">,</span><span class="numeral">86</span><span class="main">,</span><span class="numeral">63</span><span class="main">,</span><span class="numeral">66</span><span class="main">,</span><span class="numeral">71</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">16</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">77</span><span class="main">,</span><span class="numeral">110</span><span class="main">,</span><span class="numeral">109</span><span class="main">,</span><span class="numeral">13</span><span class="main">,</span><span class="numeral">63</span><span class="main">,</span><span class="numeral">54</span><span class="main">,</span><span class="numeral">310</span><span class="main">,</span><span class="numeral">102</span><span class="main">,</span><span class="numeral">92</span><span class="main">,</span><span class="numeral">103</span><span class="main">,</span><span class="numeral">310</span><span class="main">,</span><span class="numeral">26</span><span class="main">,</span><span class="numeral">15</span><span class="main">,</span><span class="numeral">22</span><span class="main">,</span><span class="numeral">66</span><span class="main">,</span><span class="numeral">106</span><span class="main">,</span><span class="numeral">210</span><span class="main">,</span><span class="numeral">91</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">13</span><span class="main">,</span><span class="numeral">810</span><span class="main">,</span><span class="numeral">66</span><span class="main">,</span><span class="numeral">51</span><span class="main">,</span><span class="numeral">91</span><span class="main">,</span><span class="numeral">84</span><span class="main">,</span><span class="numeral">19</span><span class="main">,</span><span class="numeral">25</span><span class="main">,</span><span class="numeral">110</span><span class="main">,</span><span class="numeral">41</span><span class="main">,</span><span class="numeral">51</span><span class="main">,</span><span class="numeral">87</span><span class="main">,</span><span class="numeral">27</span><span class="main">,</span><span class="numeral">79</span><span class="main">,</span><span class="numeral">18</span><span class="main">,</span><span class="numeral">69</span><span class="main">,</span><span class="numeral">99</span><span class="main">,</span><span class="numeral">95</span><span class="main">,</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">46</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">410</span><span class="main">,</span><span class="numeral">910</span><span class="main">,</span><span class="numeral">62</span><span class="main">,</span><span class="numeral">89</span><span class="main">,</span><span class="numeral">43</span><span class="main">,</span><span class="numeral">23</span><span class="main">,</span><span class="numeral">108</span><span class="main">,</span><span class="numeral">52</span><span class="main">,</span><span class="numeral">33</span><span class="main">,</span><span class="numeral">67</span><span class="main">,</span><span class="numeral">31</span><span class="main">,</span><span class="numeral">105</span><span class="main">,</span><span class="numeral">26</span><span class="main">,</span><span class="numeral">106</span><span class="main">,</span><span class="numeral">108</span><span class="main">,</span><span class="numeral">85</span><span class="main">,</span><span class="numeral">87</span><span class="main">,</span><span class="numeral">68</span><span class="main">,</span><span class="numeral">56</span><span class="main">,</span><span class="numeral">23</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">310</span><span class="main">,</span><span class="numeral">68</span><span class="main">,</span><span class="numeral">21</span><span class="main">,</span><span class="numeral">91</span><span class="main">,</span><span class="numeral">107</span><span class="main">,</span><span class="numeral">85</span><span class="main">,</span><span class="numeral">94</span><span class="main">,</span><span class="numeral">28</span><span class="main">,</span><span class="numeral">101</span><span class="main">,</span><span class="numeral">34</span><span class="main">,</span><span class="numeral">109</span><span class="main">,</span><span class="numeral">27</span><span class="main">,</span><span class="numeral">63</span><span class="main">,</span><span class="numeral">84</span><span class="main">,</span><span class="numeral">25</span><span class="main">,</span><span class="numeral">106</span><span class="main">,</span><span class="numeral">65</span><span class="main">,</span><span class="numeral">81</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">310</span><span class="main">]</span><span class="main">,</span>
      <span class="main">[</span><span class="numeral">42</span><span class="main">,</span><span class="numeral">63</span><span class="main">,</span><span class="numeral">27</span><span class="main">,</span><span class="numeral">24</span><span class="main">,</span><span class="numeral">1010</span><span class="main">,</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">107</span><span class="main">,</span><span class="numeral">69</span><span class="main">,</span><span class="numeral">910</span><span class="main">,</span><span class="numeral">810</span><span class="main">,</span><span class="numeral">31</span><span class="main">,</span><span class="numeral">15</span><span class="main">,</span><span class="numeral">97</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">56</span><span class="main">,</span><span class="numeral">77</span><span class="main">,</span><span class="numeral">51</span><span class="main">,</span><span class="numeral">108</span><span class="main">,</span><span class="numeral">31</span><span class="main">,</span><span class="numeral">26</span><span class="main">::</span>int<span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Echelon_Form_IArrays">
<div class="head">
<h1>Theory Echelon_Form_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Echelon_Form_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Echelon Form refined to immutable arrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Echelon_Form_IArrays
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Echelon_Form.html">Echelon_Form</a>
  <a href="../Gauss_Jordan/Gauss_Jordan_IArrays.html">Gauss_Jordan.Gauss_Jordan_IArrays</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The algorithm over immutable arrays›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bezout_matrix_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span>
    tabulate2 <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> 
      <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>      
        <span class="keyword1">in</span> <span class="main">(</span><span class="main">%</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="bound">p</span> <span class="keyword1">else</span> 
              <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="bound">q</span> <span class="keyword1">else</span> 
              <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="bound">u</span> <span class="keyword1">else</span> 
              <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="bound">v</span> <span class="keyword1">else</span> 
              <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> 
  <span class="entity">bezout_iterate_iarrays</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span> iarray iarray <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat
                              <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">⇒</span> <span class="tfree">'a</span> iarray iarray"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bezout_iterate_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
      <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bezout_iterate_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> 
        <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> 
          <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> 
          <span class="keyword1">else</span> <span class="free">bezout_iterate_iarrays</span> <span class="main">(</span>bezout_matrix_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="keyword1">**i</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_column_k_iarrays</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">bezout</span><span class="main">)</span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span> 
          <span class="bound">nrows_A</span> <span class="main">=</span> nrows_iarray <span class="bound">A</span><span class="main">;</span>
          <span class="bound">column_Ak</span> <span class="main">=</span> column_iarray <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">A</span><span class="main">;</span>
          <span class="bound">all_zero_below_i</span> <span class="main">=</span> vector_all_zero_from_index <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">,</span> <span class="bound">column_Ak</span><span class="main">)</span>
      <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">nrows_A</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">A</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">all_zero_below_i</span> 
            <span class="keyword1">then</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">bezout</span><span class="main">)</span> <span class="keyword1">else</span> 
         <span class="keyword1">if</span> <span class="bound">all_zero_below_i</span>
            <span class="keyword1">then</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">bezout</span><span class="main">)</span> <span class="keyword1">else</span>
                <span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> least_non_zero_position_of_vector_from_index <span class="bound">column_Ak</span> <span class="bound">i</span><span class="main">;</span> 
                    <span class="bound">interchange_A</span> <span class="main">=</span> interchange_rows_iarray <span class="bound">A</span> <span class="bound">i</span> <span class="bound">n</span>
                <span class="keyword1">in</span>
          <span class="main">(</span>bezout_iterate_iarrays <span class="bound">interchange_A</span> <span class="main">(</span><span class="bound">nrows_A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">bezout</span><span class="main">,</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_upt_k_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> 
  <span class="main">=</span> fst <span class="main">(</span>foldl echelon_form_of_column_k_iarrays <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> 
  <span class="main">=</span> echelon_form_of_upt_k_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Bezout Matrix for immutable arrays›</span></span>

<span class="keyword1" id="Echelon_Form_IArrays-matrix_to_iarray_bezout_matrix"><span class="command">lemma</span></span> matrix_to_iarray_bezout_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>bezout_matrix <span class="free">A</span> <span class="free">a</span> <span class="free">b</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span> 
  <span class="main">=</span> bezout_matrix_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">a</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">b</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"nrows_iarray <span class="main">(</span>IArray <span class="main">(</span>map <span class="main">(</span>vec_to_iarray <span class="main">∘</span> <span class="main">($)</span> <span class="free">A</span> <span class="main">∘</span> from_nat<span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def vec_to_iarray_def o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> IArray.of_fun 
    <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span> <span class="main">$</span> from_nat <span class="bound">i</span><span class="main">)</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> to_nat <span class="free">a</span> <span class="main">!!</span> to_nat <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> from_nat_to_nat_id length_upt minus_nat.diff_0 nth_map 
      nth_upt of_fun_nth plus_nat.add_0 to_nat_less_card<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> IArray.of_fun 
    <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span> <span class="main">$</span> from_nat <span class="bound">i</span><span class="main">)</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> to_nat <span class="free">b</span> <span class="main">!!</span> to_nat <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> from_nat_to_nat_id length_upt minus_nat.diff_0 nth_map 
      nth_upt of_fun_nth plus_nat.add_0 to_nat_less_card<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rw3<span class="main">:</span> <span class="quoted"><span class="quoted">"IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> IArray.of_fun 
    <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span> <span class="main">$</span> from_nat <span class="bound">i</span><span class="main">)</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="free">a</span> <span class="main">!!</span> to_nat <span class="free">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IArray.sub_def list_of.simps rw1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rw4<span class="main">:</span> <span class="quoted"><span class="quoted">"IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> IArray.of_fun
    <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span> <span class="main">$</span> from_nat <span class="bound">i</span><span class="main">)</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">!!</span> to_nat <span class="free">b</span> <span class="main">!!</span> to_nat <span class="free">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IArray.sub_def list_of.simps rw2<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def bezout_matrix_iarrays_def tabulate2_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bezout_matrix_def Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> o_def vec_to_iarray_def  Let_def 
    <span class="keyword1"><span class="command">unfolding</span></span> IArray.sub_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> rw1 rw2 rw3 rw4
    <span class="keyword1"><span class="command">unfolding</span></span> IArray.of_fun_def iarray.inject
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_ext<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> vec_lambda_beta
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xa</span> 
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> xa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> atLeast_upt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> rw5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> to_nat <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x from_nat_not_eq from_nat_to_nat_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> rw6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> to_nat <span class="free">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> x from_nat_to_nat_id to_nat_from_nat_id<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> rw7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="skolem">xa</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xa</span> <span class="main">=</span> to_nat <span class="free">b</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> xa from_nat_to_nat_id to_nat_from_nat_id<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> rw8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>from_nat <span class="skolem">x</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>from_nat <span class="skolem">xa</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">xa</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_not_eq x xa<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> rw9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="skolem">xa</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xa</span> <span class="main">=</span> to_nat <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat_id to_nat_from_nat_id xa<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cond01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> from_nat <span class="skolem">xa</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">==</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> to_nat <span class="free">a</span> <span class="main">∧</span> <span class="skolem">xa</span> <span class="main">=</span> to_nat <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rw5 rw9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> cond02<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> from_nat <span class="skolem">xa</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span> <span class="main">==</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> to_nat <span class="free">a</span> <span class="main">∧</span> <span class="skolem">xa</span> <span class="main">=</span> to_nat <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rw5 rw7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> cond03<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> from_nat <span class="skolem">xa</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">==</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> to_nat <span class="free">b</span> <span class="main">∧</span> <span class="skolem">xa</span> <span class="main">=</span> to_nat <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rw6 rw9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> cond04<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> from_nat <span class="skolem">xa</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span> <span class="main">==</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> to_nat <span class="free">b</span> <span class="main">∧</span> <span class="skolem">xa</span> <span class="main">=</span> to_nat <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rw6 rw7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> cond05<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>from_nat <span class="skolem">x</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>from_nat <span class="skolem">xa</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">==</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">xa</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rw8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">of</span>
             <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
               <span class="keyword1">if</span> from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> from_nat <span class="skolem">xa</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">p</span>
               <span class="keyword1">else</span> <span class="keyword1">if</span> from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> from_nat <span class="skolem">xa</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">q</span>
                    <span class="keyword1">else</span> <span class="keyword1">if</span> from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> from_nat <span class="skolem">xa</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">u</span>
                         <span class="keyword1">else</span> <span class="keyword1">if</span> from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> from_nat <span class="skolem">xa</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">v</span>
                              <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span>from_nat <span class="skolem">x</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="skolem">xa</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">case</span> <span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">of</span>
             <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
               <span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> to_nat <span class="free">a</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> to_nat <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">p</span>
                     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> to_nat <span class="free">a</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> to_nat <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">q</span>
                          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> to_nat <span class="free">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> to_nat <span class="free">a</span> <span class="keyword1">then</span> <span class="bound">u</span>
                               <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> to_nat <span class="free">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> to_nat <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">v</span>
                                    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
             <span class="skolem">x</span> <span class="skolem">xa</span>"</span></span> 
             <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">)</span>
             <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">d</span>
             <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bezout</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">a</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">$</span> <span class="free">b</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
             <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> b
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
              <span class="keyword1"><span class="command">unfolding</span></span> cond01 
              <span class="keyword1"><span class="command">unfolding</span></span> cond02
              <span class="keyword1"><span class="command">unfolding</span></span> cond03
              <span class="keyword1"><span class="command">unfolding</span></span> cond04
              <span class="keyword1"><span class="command">unfolding</span></span> cond05 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Bezout Iterate for immutable arrays›</span></span>

<span class="keyword1" id="Echelon_Form_IArrays-matrix_to_iarray_bezout_iterate"><span class="command">lemma</span></span> matrix_to_iarray_bezout_iterate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>bezout_iterate <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span> 
  <span class="main">=</span> bezout_iterate_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">n</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate_iarrays.simps bezout_iterate.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">≤</span> to_nat <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps bezout_iterate_iarrays.simps
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>bezout_matrix_iarrays <span class="main">(</span>matrix_to_iarray <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="free">bezout</span> 
      <span class="keyword1">**i</span> matrix_to_iarray <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B2</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">j</span> <span class="free">bezout</span> <span class="main">**</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>bezout_iterate <span class="skolem">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span> 
      <span class="main">=</span> matrix_to_iarray <span class="main">(</span>bezout_iterate <span class="main">(</span>bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">j</span> <span class="free">bezout</span> <span class="main">**</span> <span class="skolem">A</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">i</span> <span class="free">j</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate.simps <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bezout_iterate_iarrays <span class="var">?B2</span> <span class="skolem">n</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nrows <span class="main">(</span>bezout_matrix <span class="skolem">A</span> <span class="free">i</span> <span class="main">(</span>from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">j</span> <span class="free">bezout</span> <span class="main">**</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bezout_iterate_iarrays <span class="var">?B</span> <span class="skolem">n</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_matrix_matrix_mult
      <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_bezout_matrix<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">bezout</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bezout_iterate_iarrays <span class="main">(</span>matrix_to_iarray <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bezout_iterate_iarrays.simps <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Echelon_Form_IArrays-matrix_vector_all_zero_from_index2"><span class="command">lemma</span></span> matrix_vector_all_zero_from_index2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>zero<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> vector_all_zero_from_index <span class="main">(</span><span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">i</span> <span class="main">=</span> nrows <span class="free">A</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> True"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_pred True not_less_eq nrows_def to_nat_0 to_nat_less_card to_nat_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> vector_all_zero_from_index <span class="main">(</span><span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vector_all_zero_from_index_def Let_def
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def column_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> True nrows_def One_nat_def Suc_pred not_le zero_less_card_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> i_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">i</span><span class="main">+</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False Suc_le' add_diff_cancel_right' nrows_def suc_not_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_le le_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> vector_all_zero_from_index <span class="main">(</span><span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_all_zero_from_index
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> from_nat_suc from_nat_to_nat_id i_le not_less0 
      to_nat_0 to_nat_from_nat_id to_nat_mono to_nat_plus_one_less_card<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Echelon form of column k for immutable arrays›</span></span>

<span class="keyword1" id="Echelon_Form_IArrays-matrix_to_iarray_echelon_form_of_column_k"><span class="command">lemma</span></span> matrix_to_iarray_echelon_form_of_column_k<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">=</span> fst <span class="main">(</span>echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> i_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span>nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False le_imp_less_or_eq i<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> fst <span class="main">(</span>echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_efficient echelon_form_of_column_k_def Let_def
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_iarrays_def Let_def snd_conv fst_conv
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows
    <span class="keyword1"><span class="command">unfolding</span></span> i_eq matrix_to_iarray_nrows <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?interchange</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> 
    <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>mod_type_class.from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> mod_type_class.from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
    <span class="main">=</span> vector_all_zero_from_index <span class="main">(</span><span class="free">i</span><span class="main">,</span> column_iarray <span class="free">k</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_all_zero_from_index
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column'<span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> all_zero2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> mod_type_class.from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>vector_all_zero_from_index <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> column_iarray <span class="free">k</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_all_zero_from_index2
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column'<span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> nrows <span class="var">?interchange</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> True
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_efficient echelon_form_of_column_k_def Let_def split_beta
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_iarrays_def Let_def snd_conv fst_conv
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows
    <span class="keyword1"><span class="command">unfolding</span></span> all_zero all_zero2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_bezout_iterate<span class="main">[</span><span class="operator">OF</span> n<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_interchange_rows
    <span class="keyword1"><span class="command">using</span></span> vec_to_iarray_least_non_zero_position_of_vector_from_index'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span>"</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column'<span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Suc_eq_plus1 all_zero all_zero2 less_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form_IArrays-snd_matrix_to_iarray_echelon_form_of_column_k"><span class="command">lemma</span></span> snd_matrix_to_iarray_echelon_form_of_column_k<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> 
  <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> i_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span>nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False le_imp_less_or_eq i<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> 
    <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_efficient echelon_form_of_column_k_def Let_def
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_iarrays_def Let_def snd_conv fst_conv
    <span class="keyword1"><span class="command">unfolding</span></span> i_eq matrix_to_iarray_nrows <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?interchange</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>interchange_rows <span class="free">A</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> 
    <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">n</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> from_nat <span class="free">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> all_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>mod_type_class.from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> mod_type_class.from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
    <span class="main">=</span> vector_all_zero_from_index <span class="main">(</span><span class="free">i</span><span class="main">,</span> column_iarray <span class="free">k</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_all_zero_from_index
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column'<span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> all_zero2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> mod_type_class.from_nat <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>vector_all_zero_from_index <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> column_iarray <span class="free">k</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_all_zero_from_index2
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column'<span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> Aik<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">$</span> from_nat <span class="free">i</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">=</span> matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">!!</span> <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True k matrix_to_iarray_nth ncols_def nrows_def to_nat_from_nat_id<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> True Aik
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_efficient
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_efficient_def Let_def split_beta
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_iarrays_def Let_def snd_conv fst_conv
    <span class="keyword1"><span class="command">unfolding</span></span> all_zero all_zero2
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> fst_snd_matrix_to_iarray_echelon_form_of_column_k<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>
  <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> snd_matrix_to_iarray_echelon_form_of_column_k<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Echelon form up to column k for immutable arrays›</span></span>

<span class="keyword1" id="Echelon_Form_IArrays-snd_snd_foldl_echelon_form_of_column_k_iarrays"><span class="command">lemma</span></span> snd_snd_foldl_echelon_form_of_column_k_iarrays<span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">=</span> <span class="free">bezout</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_iarrays_def
    <span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">unfolding</span></span> split_beta <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form_IArrays-foldl_echelon_form_column_k_eq"><span class="command">lemma</span></span> foldl_echelon_form_column_k_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> matrix_to_iarray_echelon_form_of_upt_k<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="free">k</span> <span class="free">bezout</span><span class="main">)</span>
  <span class="main">=</span> echelon_form_of_upt_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span> <span class="free">bezout</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fst_foldl_ef_k_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_iarrays 
  <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">=</span> snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fst_foldl_ef_k_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="main">0</span> <span class="free">bezout</span><span class="main">)</span> 
    <span class="main">=</span> echelon_form_of_upt_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">0</span> <span class="free">bezout</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_def echelon_form_of_upt_k_iarrays_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> le0 matrix_to_iarray_echelon_form_of_column_k ncols_not_0 neq0_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> le0 ncols_not_0 not_gr0 snd_matrix_to_iarray_echelon_form_of_column_k<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_def Let_def snd_conv fst_conv 
    <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> matrix_to_iarray <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span> 
    <span class="main">=</span> echelon_form_of_upt_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span>
    fst <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hyp3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Suc_k_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> hyp1<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span> 
    <span class="main">=</span> echelon_form_of_upt_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span> <span class="free">bezout</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hyp2<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_iarrays 
    <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hyp3<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> hyp1_unfolded<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> fst <span class="main">(</span>foldl echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> hyp1 <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_def echelon_form_of_upt_k_iarrays_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> upt_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fold_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> <span class="main">(</span>fst <span class="var">?f</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> fold_rw'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f2</span> <span class="main">=</span> <span class="main">(</span>fst <span class="var">?f2</span><span class="main">,</span> snd <span class="var">?f2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span>
    <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> hyp2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> 
    <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> upt_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fold_rw<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fold_rw'<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> hyp2 <span class="keyword1"><span class="command">unfolding</span></span> hyp1_unfolded<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> rw 
    <span class="keyword1"><span class="command">unfolding</span></span> snd_snd_foldl_echelon_form_of_column_k_iarrays  
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fst_snd_matrix_to_iarray_echelon_form_of_column_k <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>fst <span class="var">?f2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_k_less_card <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">≤</span> nrows <span class="main">(</span>fst <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hyp2 hyp3 nrows_def<span class="main">)</span>      
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>echelon_form_of_upt_k <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span> 
    <span class="main">=</span> echelon_form_of_upt_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_def echelon_form_of_upt_k_iarrays_def
      upt_rw foldl_append List.foldl.simps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fold_rw<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fold_rw'<span class="main">)</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> hyp2 hyp1_unfolded<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> rw
    <span class="keyword1"><span class="command">unfolding</span></span> snd_snd_foldl_echelon_form_of_column_k_iarrays
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_echelon_form_of_column_k<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>fst <span class="var">?f2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_k_less_card <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">≤</span> nrows <span class="main">(</span>fst <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hyp2 hyp3 nrows_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> upt_rw foldl_append <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fold_rw'<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_def Let_def
    <span class="keyword1"><span class="command">using</span></span> hyp3 le_antisym not_less_eq_eq <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Echelon form up to column k for immutable arrays›</span></span>

<span class="keyword1" id="Echelon_Form_IArrays-matrix_to_iarray_echelon_form_of"><span class="command">lemma</span></span> matrix_to_iarray_echelon_form_of<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>echelon_form_of <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span> 
    <span class="main">=</span> echelon_form_of_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">bezout</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_def echelon_form_of_iarrays_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> One_nat_def diff_less lessI matrix_to_iarray_echelon_form_of_upt_k 
    ncols_def ncols_eq_card_columns zero_less_card_finite<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Echelon_Form_Det_IArrays">
<div class="head">
<h1>Theory Echelon_Form_Det_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Echelon_Form_Det_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Determinant of matrices computed using immutable arrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Echelon_Form_Det_IArrays
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Echelon_Form_Det.html">Echelon_Form_Det</a>
  <a href="Echelon_Form_IArrays.html">Echelon_Form_IArrays</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">echelon_form_of_column_k_det_iarrays</span> <span class="main">::</span> 
          <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span> <span class="main">×</span> <span class="tfree">'a</span> iarray iarray <span class="main">×</span> nat <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> 
          <span class="main">⇒</span> nat 
          <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> iarray iarray <span class="main">×</span> nat <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span>  
 <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_column_k_det_iarrays</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">det_P</span><span class="main">,</span> <span class="bound">A</span><span class="main">,</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">bezout</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span>
      <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">≠</span> nrows_iarray <span class="bound">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">A</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
            <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> vector_all_zero_from_index <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="main">(</span>column_iarray <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
         <span class="keyword1">then</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="bound">det_P</span><span class="main">,</span> echelon_form_of_column_k_iarrays <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">bezout</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> 
         <span class="keyword1">else</span> <span class="main">(</span><span class="bound">det_P</span><span class="main">,</span>echelon_form_of_column_k_iarrays <span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">i</span><span class="main">,</span><span class="bound">bezout</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_upt_k_det_iarrays</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> 
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> snd <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">;</span> 
           <span class="bound">f</span> <span class="main">=</span> foldl echelon_form_of_column_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">]</span> 
       <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">f</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">echelon_form_of_det_iarrays</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span> iarray iarray 
    <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> 
    <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> iarray iarray<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">echelon_form_of_det_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span> <span class="main">=</span> 
      echelon_form_of_upt_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bezout</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">det_iarrays_rings</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> echelon_form_of_det_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> euclid_ext2 
     <span class="keyword1">in</span> <span class="main">1</span> <span class="keyword1">div</span> <span class="main">(</span>fst <span class="bound">A'</span><span class="main">)</span> <span class="main">*</span> prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>snd <span class="bound">A'</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Echelon Form of column k›</span></span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-vector_all_zero_from_index3"><span class="command">lemma</span></span> vector_all_zero_from_index3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_ring<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
  <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> matrix_vector_all_zero_from_index2 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> matrix_vector_all_zero_from_index2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span><span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span>vector_all_zero_from_index <span class="main">(</span>to_nat <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> vec_to_iarray <span class="main">(</span>column <span class="free">k</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-fst_matrix_to_iarray_echelon_form_of_column_k_det"><span class="command">lemma</span></span> fst_matrix_to_iarray_echelon_form_of_column_k_det<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">det_P</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>
  <span class="main">=</span> fst <span class="main">(</span>echelon_form_of_column_k_det_iarrays <span class="main">(</span><span class="free">det_P</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span>nrows <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> ex_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">m</span></span><span class="main">&gt;</span>from_nat <span class="free">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> <span class="bound">m</span> <span class="main">$</span> from_nat <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> vector_all_zero_from_index <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> column_iarray <span class="free">k</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vector_all_zero_from_index3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">i</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_column
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ncols_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_nat_from_nat_id<span class="main">[</span><span class="operator">OF</span> True<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nrows_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> Aik<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="free">A</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">!!</span> <span class="free">k</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span>from_nat <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True k matrix_to_iarray_nth ncols_def nrows_def to_nat_from_nat_id<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_det_iarrays_def echelon_form_of_column_k_det_def
    <span class="keyword1"><span class="command">unfolding</span></span> Let_def 
    <span class="keyword1"><span class="command">unfolding</span></span> split_beta
    <span class="keyword1"><span class="command">unfolding</span></span> fst_conv snd_conv 
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows
    <span class="keyword1"><span class="command">unfolding</span></span> ex_rw Aik <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span>nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_det_iarrays_def echelon_form_of_column_k_det_def
    <span class="keyword1"><span class="command">unfolding</span></span> Let_def fst_conv snd_conv 
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows
    <span class="keyword1"><span class="command">unfolding</span></span> i2 <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-snd_echelon_form_of_column_k_det"><span class="command">lemma</span></span> snd_echelon_form_of_column_k_det<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span>echelon_form_of_column_k_det_iarrays <span class="main">(</span><span class="free">det_P</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> echelon_form_of_column_k_iarrays <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">,</span><span class="free">bezout</span><span class="main">)</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_det_iarrays_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Echelon_Form_Det_IArrays-fst_snd_echelon_form_of_column_k_le_nrows"><span class="command">lemma</span></span> fst_snd_echelon_form_of_column_k_le_nrows<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_def Let_def fst_conv snd_conv
  <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-fst_snd_snd_echelon_form_of_column_k_det_le_nrows"><span class="command">lemma</span></span> fst_snd_snd_echelon_form_of_column_k_det_le_nrows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_det_def Let_def fst_conv snd_conv
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms fst_snd_echelon_form_of_column_k_le_nrows<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Echelon Form up to column k›</span></span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-snd_snd_snd_foldl_echelon_form_of_column_k_det_iarrays"><span class="command">lemma</span></span> snd_snd_snd_foldl_echelon_form_of_column_k_det_iarrays<span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_det_iarrays <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bezout</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> echelon_form_of_column_k_det_iarrays_def Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_beta echelon_form_of_column_k_iarrays_def Let_def Suc.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*lemma snd_snd_snd_echelon_form_of_column_k_det:
  "snd (snd (snd (foldl echelon_form_of_column_k_det (n, A, 0, bezout) [0..&lt;k]))) = bezout"
  by (metis snd_foldl_ef_det_eq snd_snd_foldl_echelon_form_of_column_k)*)</span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-matrix_to_iarray_echelon_form_of_column_k_det"><span class="command">lemma</span></span> matrix_to_iarray_echelon_form_of_column_k_det<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span>nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">=</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_column_k_det_iarrays <span class="main">(</span><span class="free">n</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> snd_echelon_form_of_column_k_det 
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_column_k_det_def Let_def fst_conv snd_conv 
  <span class="keyword1"><span class="command">using</span></span> assms matrix_to_iarray_echelon_form_of_column_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Echelon_Form_Det_IArrays-fst_snd_snd_echelon_form_of_column_k_det"><span class="command">lemma</span></span> fst_snd_snd_echelon_form_of_column_k_det<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_column_k_det_iarrays <span class="main">(</span><span class="free">n</span><span class="main">,</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="free">i</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> snd_echelon_form_of_column_k_det_eq
  <span class="keyword1"><span class="command">unfolding</span></span> snd_echelon_form_of_column_k_det
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fst_snd_matrix_to_iarray_echelon_form_of_column_k<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>bezout_domain<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span>ncols <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> matrix_to_iarray_fst_echelon_form_of_upt_k_det<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> 
  <span class="main">=</span> fst <span class="main">(</span>echelon_form_of_upt_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> matrix_to_iarray_snd_echelon_form_of_upt_k_det<span class="main">:</span>
  <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span><span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">=</span> <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_upt_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">k</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_det_iarrays 
  <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span>matrix_to_iarray <span class="free">A</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>snd 
  <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> 
    <span class="main">=</span> fst <span class="main">(</span>echelon_form_of_upt_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">0</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_det_def echelon_form_of_upt_k_det_iarrays_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> fst_matrix_to_iarray_echelon_form_of_column_k_det le0 ncols_not_0 neq0_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    snd <span class="main">(</span>echelon_form_of_upt_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">0</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_det_def echelon_form_of_upt_k_det_iarrays_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> le0 matrix_to_iarray_echelon_form_of_column_k ncols_not_0 neq0_conv 
      snd_echelon_form_of_column_k_det snd_echelon_form_of_column_k_det_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_snd_snd_echelon_form_of_column_k_det_le_nrows<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> fst_snd_matrix_to_iarray_echelon_form_of_column_k le0 ncols_not_0 neq0_conv 
      snd_echelon_form_of_column_k_det snd_echelon_form_of_column_k_det_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> fst <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span> 
    <span class="main">=</span> fst <span class="main">(</span>echelon_form_of_upt_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span>
    matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> snd <span class="main">(</span>echelon_form_of_upt_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span> 
    snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span> <span class="main">⟹</span>
    fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> hyp1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span> 
    <span class="main">=</span> fst <span class="main">(</span>echelon_form_of_upt_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hyp2<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> snd <span class="main">(</span>echelon_form_of_upt_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="skolem">k</span> <span class="free">bezout</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> hyp3<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hyp4<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_det_iarrays 
    <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> list_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span><span class="main">=</span> <span class="main">(</span>fst <span class="var">?f</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>foldl echelon_form_of_column_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> g_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="main">(</span>fst <span class="var">?g</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="var">?g</span><span class="main">)</span><span class="main">,</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?g</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="var">?g</span> <span class="main">=</span> fst <span class="var">?f</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> hyp1<span class="main">[</span><span class="operator">unfolded</span> echelon_form_of_upt_k_det_def echelon_form_of_upt_k_det_iarrays_def Let_def 
      fst_conv snd_conv<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="var">?g</span><span class="main">)</span> <span class="main">=</span> matrix_to_iarray <span class="main">(</span>fst <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> hyp2<span class="main">[</span><span class="operator">unfolded</span> echelon_form_of_upt_k_det_def 
      echelon_form_of_upt_k_det_iarrays_def Let_def snd_conv<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> rw3<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> hyp4 <span class="keyword1"><span class="command">.</span></span>
  <span class="comment1">(*have rw4: "snd (snd (snd ?g)) = snd (snd (snd ?f))" 
    unfolding snd_snd_snd_foldl_echelon_form_of_column_k_det_iarrays
    unfolding snd_snd_snd_echelon_form_of_column_k_det ..*)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> fst <span class="main">(</span>echelon_form_of_upt_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_det_iarrays_def echelon_form_of_upt_k_det_def Let_def fst_conv snd_conv
    <span class="keyword1"><span class="command">unfolding</span></span> list_rw foldl_append
    <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_rw<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> g_rw<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> rw1<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> rw2 rw3
    <span class="keyword1"><span class="command">unfolding</span></span> snd_snd_snd_foldl_echelon_form_of_column_k_det_iarrays
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fst_matrix_to_iarray_echelon_form_of_column_k_det<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>fst <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">≤</span> nrows <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hyp3 nrows_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span><span class="main">(</span>echelon_form_of_upt_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    snd <span class="main">(</span>echelon_form_of_upt_k_det_iarrays <span class="main">(</span><span class="main">1</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_det_iarrays_def echelon_form_of_upt_k_det_def Let_def fst_conv snd_conv
    <span class="keyword1"><span class="command">unfolding</span></span> list_rw foldl_append
    <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_rw<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> g_rw<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> rw1<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> rw2 rw3 <span class="keyword1"><span class="command">unfolding</span></span> snd_snd_snd_foldl_echelon_form_of_column_k_det_iarrays
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_echelon_form_of_column_k_det<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>fst <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">≤</span> nrows <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hyp3 nrows_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nrows <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list_rw foldl_append List.foldl.simps
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_rw<span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> fst_snd_snd_echelon_form_of_column_k_det_le_nrows
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hyp3 nrows_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>foldl echelon_form_of_column_k_det_iarrays 
    <span class="main">(</span><span class="main">1</span><span class="main">,</span> matrix_to_iarray <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">bezout</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_upt_k_det_iarrays_def echelon_form_of_upt_k_det_def Let_def fst_conv snd_conv
    <span class="keyword1"><span class="command">unfolding</span></span> list_rw foldl_append
    <span class="keyword1"><span class="command">unfolding</span></span> List.foldl.simps
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f_rw<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> g_rw<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> rw1<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> rw2 rw3 
     <span class="keyword1"><span class="command">unfolding</span></span> snd_snd_snd_foldl_echelon_form_of_column_k_det_iarrays
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fst_snd_snd_echelon_form_of_column_k_det<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> ncols <span class="main">(</span>fst <span class="main">(</span>snd <span class="var">?f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">≤</span> nrows <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>foldl <span class="main">(</span>echelon_form_of_column_k_det <span class="free">bezout</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hyp3 nrows_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Echelon Form›</span></span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-matrix_to_iarray_echelon_form_of_det"><span class="command">lemma</span></span> matrix_to_iarray_echelon_form_of_det<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">=</span> snd <span class="main">(</span>echelon_form_of_det_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_det_def echelon_form_of_det_iarrays_def
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_ncols<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_snd_echelon_form_of_upt_k_det<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ncols_def<span class="main">)</span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-fst_echelon_form_of_det"><span class="command">lemma</span></span> fst_echelon_form_of_det<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>echelon_form_of_det <span class="free">A</span> <span class="free">bezout</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">=</span> fst <span class="main">(</span>echelon_form_of_det_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="free">bezout</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> echelon_form_of_det_def echelon_form_of_det_iarrays_def
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_ncols<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_fst_echelon_form_of_upt_k_det<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ncols_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Computing the determinant›</span></span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-det_echelon_form_of_euclidean_iarrays"><span class="command">lemma</span></span> det_echelon_form_of_euclidean_iarrays<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_ring_gcd<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> echelon_form_of_det_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> euclid_ext2 
  <span class="keyword1">in</span> <span class="main">1</span> <span class="keyword1">div</span> <span class="main">(</span>fst <span class="bound">A'</span><span class="main">)</span> 
  <span class="main">*</span> prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>snd <span class="bound">A'</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span>echelon_form_of_det_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> euclid_ext2<span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>map <span class="var">?f</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> 
    <span class="main">=</span> prod <span class="var">?f</span> <span class="main">(</span>set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> distinct_upt prod.distinct_set_conv_list<span class="main">)</span>  
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> euclid_ext2<span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span> <span class="tfree">'n</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"to_nat<span class="main"><span class="main">::</span></span><span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'n</span></span><span class="main"><span class="main">=&gt;</span></span>nat<span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>to_nat<span class="main">::</span><span class="main">(</span><span class="tfree">'n</span><span class="main">=&gt;</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strict_mono_imp_inj_on strict_mono_to_nat<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> range <span class="main">(</span>to_nat<span class="main">::</span><span class="tfree">'n</span><span class="main">=&gt;</span>nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> nrows_eq_card_rows <span class="keyword1"><span class="command">using</span></span> bij_to_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def 
      <span class="keyword1"><span class="command">unfolding</span></span> atLeast0LessThan atLeast_upt  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>echelon_form_of_det_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> euclid_ext2<span class="main">)</span> <span class="main">!!</span> to_nat <span class="skolem">x</span> <span class="main">!!</span> to_nat <span class="skolem">x</span>
      <span class="main">=</span> snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> euclid_ext2<span class="main">)</span> <span class="main">$</span> <span class="skolem">x</span> <span class="main">$</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_echelon_form_of_det<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nth <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span>echelon_form_of_det_iarrays 
    <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> euclid_ext2<span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> euclid_ext2<span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="free">A</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">div</span> <span class="main">(</span>fst <span class="main">(</span>echelon_form_of_det <span class="free">A</span> euclid_ext2<span class="main">)</span><span class="main">)</span> 
    <span class="main">*</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span>echelon_form_of_det <span class="free">A</span> euclid_ext2<span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span> <span class="tfree">'n</span> set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> det_echelon_form_of_euclidean <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">A'</span> <span class="main">=</span> echelon_form_of_det_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> euclid_ext2
    <span class="keyword1">in</span> <span class="main">1</span> <span class="keyword1">div</span> <span class="main">(</span>fst <span class="bound">A'</span><span class="main">)</span> 
    <span class="main">*</span> prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>snd <span class="bound">A'</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">unfolding</span></span> * fst_echelon_form_of_det <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">corollary</span></span> matrix_to_iarray_det_euclidean_ring<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_ring_gcd<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="free">A</span> <span class="main">=</span> det_iarrays_rings <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> det_echelon_form_of_euclidean_iarrays det_iarrays_rings_def <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Computing the characteristic polynomial of a matrix›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat2matofpoly_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> 
  <span class="main">=</span> tabulate2 <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">[:</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">j</span><span class="main">:]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-matrix_to_iarray_mat2matofpoly"><span class="command">lemma</span></span> matrix_to_iarray_mat2matofpoly<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>mat2matofpoly <span class="free">A</span><span class="main">)</span> <span class="main">=</span> mat2matofpoly_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat2matofpoly_def mat2matofpoly_iarrays_def tabulate2_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> matrix_to_iarray_eq_of_fun<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nrows_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>IArray.list_of <span class="main">(</span>matrix_to_iarray <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">[:</span><span class="free">A</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def matrix_to_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">j</span><span class="main">.</span> <span class="main">[:</span><span class="free">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span>
    IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">[:</span>IArray.list_of <span class="main">(</span>IArray.list_of <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">!</span> mod_type_class.to_nat <span class="skolem">i</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span><span class="main">:]</span><span class="main">)</span>
    <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>ncols_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_ncols<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> ncols_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> IArray.sub_def vec_matrix vec_to_iarray_nth<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following two lemmas must be added to the file <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Matrix_To_IArray›</span></span></span></span> 
  of the AFP Gauss-Jordan development.›</span></span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-vec_to_iarray_minus"><span class="command">lemma</span></span> vec_to_iarray_minus<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_to_iarray <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> 
  <span class="main">=</span> <span class="main">(</span>vec_to_iarray <span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>vec_to_iarray <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_to_iarray_def
  <span class="keyword1"><span class="command">unfolding</span></span> minus_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-matrix_to_iarray_minus"><span class="command">lemma</span></span> matrix_to_iarray_minus<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> 
  <span class="main">=</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>matrix_to_iarray <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def o_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_iarray_def Let_def vec_to_iarray_minus<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">charpoly_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> 
  <span class="main">=</span> det_iarrays_rings <span class="main">(</span>mat_iarray <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">-</span> mat2matofpoly_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Echelon_Form_Det_IArrays-matrix_to_iarray_charpoly"><span class="command">lemma</span></span> matrix_to_iarray_charpoly<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"charpoly <span class="free">A</span> <span class="main">=</span> charpoly_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> charpoly_def charpoly_iarrays_def
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_mat2matofpoly<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_nrows<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> nrows_def
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_mat<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_minus<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> det_iarrays_rings_def
  <span class="keyword1"><span class="command">unfolding</span></span> det_echelon_form_of_euclidean_iarrays <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Code_Cayley_Hamilton_IArrays">
<div class="head">
<h1>Theory Code_Cayley_Hamilton_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(* 
    Title:      Code_Cayley_Hamilton_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Code Cayley Hamilton›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Code_Cayley_Hamilton_IArrays
  <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Cayley_Hamilton/Cayley_Hamilton.html">Cayley_Hamilton.Cayley_Hamilton</a>
  <a href="Echelon_Form_Det_IArrays.html">Echelon_Form_Det_IArrays</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Implementations over immutable arrays of some definitions 
  presented in the Cayley-Hamilton development›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">scalar_matrix_mult_iarrays</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ab_semigroup_mult<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> iarray iarray<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> iarray iarray<span class="main">)</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">*ssi</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1"><span class="free">*ssi</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> tabulate2 <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">%</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">!!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">minorM_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> tabulate2  <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>ncols_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> 
  <span class="main">(</span><span class="main">%</span><span class="bound">k</span> <span class="bound">l</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∨</span> <span class="bound">l</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">!!</span> <span class="bound">k</span> <span class="main">!!</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cofactor_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> det_iarrays_rings <span class="main">(</span>minorM_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">cofactorM_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> tabulate2 <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>nrows_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> 
  <span class="main">(</span><span class="main">%</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> cofactor_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">adjugate_iarrays</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> transpose_iarray <span class="main">(</span>cofactorM_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Code_Cayley_Hamilton_IArrays-matrix_to_iarray_scalar_matrix_mult"><span class="command">lemma</span></span> matrix_to_iarray_scalar_matrix_mult<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span><span class="free">k</span> <span class="keyword1">*k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*ssi</span> <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> n_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"nrows_iarray <span class="main">(</span>IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vec_to_iarray <span class="main">(</span><span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> n_rw2<span class="main">:</span> <span class="quoted"><span class="quoted">"nrows_iarray <span class="main">(</span>IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span> <span class="main">$</span> from_nat <span class="bound">i</span><span class="main">)</span> 
    <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span>"</span></span>   <span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> n_rw3<span class="main">:</span> <span class="quoted"><span class="quoted">"ncols_iarray <span class="main">(</span>IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span> <span class="main">$</span> from_nat <span class="bound">i</span><span class="main">)</span> 
    <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ncols_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def o_def matrix_scalar_mult_def scalar_matrix_mult_iarrays_def
      tabulate2_def vec_to_iarray_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_rw n_rw2 n_rw3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Code_Cayley_Hamilton_IArrays-matrix_to_iarray_minorM"><span class="command">lemma</span></span> matrix_to_iarray_minorM<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>minorM <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> minorM_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> n_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"nrows_iarray <span class="main">(</span>IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span> <span class="main">$</span> from_nat <span class="bound">i</span><span class="main">)</span> 
    <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> n_rw2<span class="main">:</span> <span class="quoted"><span class="quoted">"ncols_iarray <span class="main">(</span>IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span> <span class="main">$</span> from_nat <span class="bound">i</span><span class="main">)</span> 
    <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'c</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ncols_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_def o_def
    minorM_def minorM_iarrays_def
    tabulate2_def vec_to_iarray_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_rw n_rw2 to_nat_from_nat_id<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Code_Cayley_Hamilton_IArrays-matrix_to_iarray_cofactor"><span class="command">lemma</span></span> matrix_to_iarray_cofactor<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>cofactor <span class="free">A</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> cofactor_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">i</span><span class="main">)</span> <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> o_def cofactor_iarrays_def cofactor_def cofactorM_def
   <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_minorM<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
   <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_det_euclidean_ring<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Code_Cayley_Hamilton_IArrays-matrix_to_iarray_cofactorM"><span class="command">lemma</span></span> matrix_to_iarray_cofactorM<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>cofactorM <span class="free">A</span><span class="main">)</span> <span class="main">=</span> cofactorM_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> n_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"nrows_iarray <span class="main">(</span>IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> IArray <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">$</span> from_nat <span class="bound">x</span> <span class="main">$</span> from_nat <span class="bound">i</span><span class="main">)</span> 
    <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nrows_iarray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cofactorM_iarrays_def tabulate2_def cofactorM_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_rw matrix_to_iarray_cofactor
        matrix_to_iarray_def o_def vec_to_iarray_def to_nat_from_nat_id<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Code_Cayley_Hamilton_IArrays-matrix_to_iarray_adjugate"><span class="command">lemma</span></span> matrix_to_iarray_adjugate<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>adjugate <span class="free">A</span><span class="main">)</span> <span class="main">=</span> adjugate_iarrays <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> adjugate_def adjugate_iarrays_def
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_cofactorM<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_transpose<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Echelon_Form_Inverse_IArrays">
<div class="head">
<h1>Theory Echelon_Form_Inverse_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Echelon_Form_Inverse_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Inverse matrices over principal ideal rings using immutable arrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Echelon_Form_Inverse_IArrays
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="Echelon_Form_Inverse.html">Echelon_Form_Inverse</a>
    <a href="Code_Cayley_Hamilton_IArrays.html">Code_Cayley_Hamilton_IArrays</a>
    <a href="../Gauss_Jordan/Inverse_IArrays.html">Gauss_Jordan.Inverse_IArrays</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Computing the inverse of matrices over rings using immutable arrays›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">inverse_matrix_ring_iarray</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">d</span><span class="main">=</span>det_iarrays_rings <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">in</span> 
  <span class="keyword1">if</span> is_unit <span class="bound">d</span> <span class="keyword1">then</span> Some<span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="bound">d</span> <span class="keyword1">*ssi</span> adjugate_iarrays <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1" id="Echelon_Form_Inverse_IArrays-matrix_to_iarray_inverse"><span class="command">lemma</span></span> matrix_to_iarray_inverse<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_ring_gcd<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"matrix_to_iarray_option <span class="main">(</span>inverse_matrix <span class="free">A</span><span class="main">)</span> <span class="main">=</span> inverse_matrix_ring_iarray <span class="main">(</span>matrix_to_iarray <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inverse_matrix_ring_iarray_def inverse_matrix_code_rings matrix_to_iarray_option_def
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_to_iarray_det_euclidean_ring matrix_to_iarray_adjugate 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_to_iarray_adjugate matrix_to_iarray_scalar_matrix_mult Let_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Examples_Echelon_Form_IArrays">
<div class="head">
<h1>Theory Examples_Echelon_Form_IArrays</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Examples_Echelon_Form_IArrays.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Examples of computations using immutable arrays›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Examples_Echelon_Form_IArrays
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Echelon_Form_Inverse_IArrays.html">Echelon_Form_Inverse_IArrays</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Numeral.html">HOL-Library.Code_Target_Numeral</a>"</span>
  <a href="../Gauss_Jordan/Examples_Gauss_Jordan_Abstract.html">Gauss_Jordan.Examples_Gauss_Jordan_Abstract</a>
  <a href="Examples_Echelon_Form_Abstract.html">Examples_Echelon_Form_Abstract</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The file <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹Examples_Echelon_Form_Abstract.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span> is only imported to 
  include the definitions of matrices that we use in the following examples. 
  Otherwise, it could be removed.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Computing echelon forms, determinants, characteristic polynomials and so on using
  immutable arrays›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Serializing gcd›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹First of all, we serialize the gcd to the ones of PolyML and MLton as we did in the
  Gauss-Jordan development.›</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">includes</span></span> integer.lifting
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> gcd_integer <span class="main">::</span> <span class="quoted"><span class="quoted">"integer <span class="main">=&gt;</span> integer <span class="main">=&gt;</span> integer"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">::</span> int <span class="main">=&gt;</span> int <span class="main">=&gt;</span> int"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Examples_Echelon_Form_IArrays-gcd_integer_code"><span class="command">lemma</span></span> gcd_integer_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"gcd_integer <span class="free">l</span> <span class="free">k</span> <span class="main">=</span> <span class="main">¦</span><span class="keyword1">if</span> <span class="free">l</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>integer<span class="main">)</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="keyword1">else</span> gcd_integer <span class="free">l</span> <span class="main">(</span><span class="main">¦</span><span class="free">k</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="main">¦</span><span class="free">l</span><span class="main">¦</span><span class="main">)</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd_code_int <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">code_printing</span></span>
 <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">::</span> integer <span class="main">=&gt;</span> <span class="main">_</span>"</span></span> <span class="main">⇀</span> <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"IntInf.abs"</span>
 <span class="main">|</span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"gcd_integer <span class="main">::</span> integer <span class="main">=&gt;</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">_</span>"</span></span> <span class="main">⇀</span> <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"(PolyML.IntInf.gcd ((_),(_)))"</span> <span class="comment1">(*Only for Poly/ML*)</span>
 <span class="comment1">(* | constant "gcd_integer :: integer =&gt; _ =&gt; _" ⇀ (SML) "(MLton.IntInf.gcd ((_),(_)))"*)</span> <span class="comment1">(*Only for MLton*)</span>

<span class="keyword1" id="Examples_Echelon_Form_IArrays-gcd_code"><span class="command">lemma</span></span> gcd_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gcd <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> int_of_integer <span class="main">(</span>gcd_integer <span class="main">(</span>of_int <span class="free">a</span><span class="main">)</span> <span class="main">(</span>of_int <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gcd_integer.abs_eq int_of_integer_integer_of_int integer_of_int_eq_of_int<span class="main">)</span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">::</span> real <span class="main">=&gt;</span> real"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.abs"</span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">::</span> real <span class="main">⇒</span> real"</span></span><span class="main">]</span><span class="main">]</span>
  
<span class="keyword1"><span class="command">code_printing</span></span>
<span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"divmod_integer <span class="main">::</span> integer <span class="main">=&gt;</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">_</span>"</span></span> <span class="main">⇀</span> <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"(IntInf.divMod ((_),(_)))"</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Examples›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det test_int_3x3"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det test_int_3x3_03"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det test_int_6x6"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det test_int_8x8"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det test_int_20x20"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"charpoly test_real_3x3"</span></span>
  
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"charpoly test_real_6x6"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"inverse_matrix test_int_3x3_02"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>echelon_form_of test_int_3x3 euclid_ext2<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray <span class="main">(</span>echelon_form_of test_int_8x8 euclid_ext2<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following computations are much faster when code is exported.›</span></span>

<span class="comment1">(*value "matrix_to_iarray (echelon_form_of_euclidean test_int_20x20)"*)</span>

<span class="comment1">(*value "echelon_form_of_iarrays (matrix_to_iarray test_int_20x20) euclid_ext2"*)</span>

<span class="comment1">(*value "matrix_to_iarray (echelon_form_of test_int_20x20 euclid_ext2)"*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following matrix will have an integer inverse since its determinant is equal to one›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det test_int_3x3_03"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>matrix_to_iarray_option <span class="main">(</span>inverse_matrix test_int_3x3_03<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We check that the previous inverse has been correctly computed:›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_matrix_mult_iarray 
              <span class="main">(</span>matrix_to_iarray test_int_3x3_03<span class="main">)</span> 
              <span class="main">(</span>the <span class="main">(</span>matrix_to_iarray_option <span class="main">(</span>inverse_matrix test_int_3x3_03<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_matrix_mult_iarray 
              <span class="main">(</span>the <span class="main">(</span>matrix_to_iarray_option <span class="main">(</span>inverse_matrix test_int_3x3_03<span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>matrix_to_iarray test_int_3x3_03<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following matrices have determinant different from zero, 
    and thus do not have an integer inverse›</span></span>
              
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det test_int_6x6"</span></span>
              
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray_option <span class="main">(</span>inverse_matrix test_int_6x6<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"det test_int_20x20"</span></span>
             
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"matrix_to_iarray_option <span class="main">(</span>inverse_matrix test_int_20x20<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The inverse in dimension 20 has (trivial) inverse.›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>matrix_to_iarray_option <span class="main">(</span>inverse_matrix <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span>int<span class="main">^</span><span class="numeral">20</span><span class="main">^</span><span class="numeral">20</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>matrix_to_iarray_option <span class="main">(</span>inverse_matrix <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span>int<span class="main">^</span><span class="numeral">20</span><span class="main">^</span><span class="numeral">20</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> matrix_to_iarray <span class="main">(</span>mat <span class="main">1</span><span class="main">::</span>int<span class="main">^</span><span class="numeral">20</span><span class="main">^</span><span class="numeral">20</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">print_echelon_int</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">::</span>int<span class="main">^</span><span class="numeral">20</span><span class="main">^</span><span class="numeral">20</span><span class="main">)</span> <span class="main">=</span> echelon_form_of_iarrays <span class="main">(</span>matrix_to_iarray <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> euclid_ext2"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Performance is better when code is exported. In addition, it depends on the growth of 
the integer coefficients of the matrices. For instance, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>test_int_20x20›</span></span></span></span>
is a matrix of integer numbers between $-10$ and $10$. The computation of its echelon form (by means
of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>print_echelon_int›</span></span></span></span>) needs about 2 seconds. However, the matrix <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>test_int_20x20_2›</span></span></span></span>
has elements between $0$ and $1010$. The computation of its echelon form (by means
of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>print_echelon_int›</span></span></span></span> too) needs about 0.310 seconds. These benchmarks have been carried
out in a laptop with an i5-3360M processor with 4 GB of RAM.›</span></span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">charpoly</span></span> <span class="quoted"><span class="quoted">det</span></span> <span class="quoted"><span class="quoted">echelon_form_of</span></span> <span class="quoted"><span class="quoted">test_int_8x8</span></span> <span class="quoted"><span class="quoted">test_int_20x20</span></span> <span class="quoted"><span class="quoted">test_int_20x20_2</span></span> <span class="quoted"><span class="quoted">print_echelon_int</span></span>
  <span class="keyword2"><span class="keyword">in</span></span> SML <span class="keyword2"><span class="keyword">module_name</span></span> Echelon <span class="comment1">(*file "Echelon.sml"*)</span>

<span class="comment1">(*
  PolyML.use "Echelon.sml"; open Echelon; open Timer; 
  let val now=startCPUTimer (); in print_echelon_int (test_int_20x20); checkCPUTimes (now) end;
*)</span>

<span class="comment1">(*Analogously, code can be exported to Haskell using the file Code_Rational presented in the
  Gauss-Jordan AFP entry.*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>