<div id="Missing_Matrix">
<div class="head">
<h1>Theory Missing_Matrix</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Missing Lemmas on Vectors and Matrices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We provide some results on vector spaces which should be merged into Jordan-Normal-Form/Matrix.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Missing_Matrix
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../jordan_normal_form/theories/#Matrix">Jordan_Normal_Form.Matrix</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Missing_Matrix-orthogonalD'"><span class="command">lemma</span></span> orthogonalD'<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orthogonal <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="free">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> set <span class="free">vs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">∙</span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">≠</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">vs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="free">vs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> orthogonalD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> i j<span class="main">,</span> <span class="operator">folded</span> v w<span class="main">]</span> orthogonalD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> i i<span class="main">,</span> <span class="operator">folded</span> v v<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> v w <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Matrix-zero_mat_mult_vector"><span class="command">lemma</span></span> zero_mat_mult_vector<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span> <span class="main">⟹</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span> <span class="free">nc</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-add_diff_cancel_right_vec"><span class="command">lemma</span></span> add_diff_cancel_right_vec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> cancel_ab_semigroup_add vec<span class="main">)</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-elements_four_block_mat_id"><span class="command">lemma</span></span> elements_four_block_mat_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr1</span> <span class="free">nc1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> carrier_mat <span class="free">nr1</span> <span class="free">nc2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> carrier_mat <span class="free">nr2</span> <span class="free">nc1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">∈</span> carrier_mat <span class="free">nr2</span> <span class="free">nc2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"elements_mat <span class="main">(</span>four_block_mat <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span>
   elements_mat <span class="free">A</span> <span class="main">∪</span> elements_mat <span class="free">B</span> <span class="main">∪</span> elements_mat <span class="free">C</span> <span class="main">∪</span> elements_mat <span class="free">D</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"elements_mat <span class="var">?four</span> <span class="main">=</span> <span class="var">?X</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"elements_mat <span class="var">?four</span> <span class="main">⊆</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> elements_four_block_mat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?four</span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="free">nr1</span> <span class="main">+</span> <span class="free">nr2</span><span class="main">)</span> <span class="main">(</span><span class="free">nc1</span> <span class="main">+</span> <span class="free">nc2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>A<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elements_mat <span class="free">A</span>"</span></span>
      <span class="main">|</span> <span class="main">(</span>B<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elements_mat <span class="free">B</span>"</span></span>
      <span class="main">|</span> <span class="main">(</span>C<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elements_mat <span class="free">C</span>"</span></span>
      <span class="main">|</span> <span class="main">(</span>D<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elements_mat <span class="free">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> elements_mat <span class="var">?four</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> A
      <span class="keyword1"><span class="command">from</span></span> elements_matD<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nc1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> elements_matI<span class="main">[</span><span class="operator">OF</span> 4<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> * c
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> B
      <span class="keyword1"><span class="command">from</span></span> elements_matD<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nc2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> elements_matI<span class="main">[</span><span class="operator">OF</span> 4<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="quoted">"<span class="free">nc1</span> <span class="main">+</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> * c
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> C
      <span class="keyword1"><span class="command">from</span></span> elements_matD<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nc1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">C</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> elements_matI<span class="main">[</span><span class="operator">OF</span> 4<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">nr1</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> * c
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> D
      <span class="keyword1"><span class="command">from</span></span> elements_matD<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">nc2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">D</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> elements_matI<span class="main">[</span><span class="operator">OF</span> 4<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">nr1</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">nc1</span> <span class="main">+</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> * c
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"elements_mat <span class="var">?four</span> <span class="main">⊇</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Missing_Matrix-elements_mat_append_rows"><span class="command">lemma</span></span> elements_mat_append_rows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">∈</span> carrier_mat <span class="free">nr2</span> <span class="free">n</span> <span class="main">⟹</span>
  elements_mat <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> elements_mat <span class="free">A</span> <span class="main">∪</span> elements_mat <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> append_rows_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> elements_four_block_mat_id<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-elements_mat_uminus"><span class="command">lemma</span></span> elements_mat_uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elements_mat <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="main">=</span> uminus <span class="main">`</span> elements_mat <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> elements_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-vec_set_uminus"><span class="command">lemma</span></span> vec_set_uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_set <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="main">=</span> uminus <span class="main">`</span> vec_set <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">append_cols</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero mat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1"><span class="free">@<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>

<span class="keyword1" id="Missing_Matrix-carrier_append_cols"><span class="command">lemma</span></span> carrier_append_cols<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nc1</span> <span class="main">⟹</span>
   <span class="free">B</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nc2</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="main">(</span><span class="free">nc1</span> <span class="main">+</span> <span class="free">nc2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> append_cols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-elements_mat_transpose_mat"><span class="command">lemma</span></span> elements_mat_transpose_mat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elements_mat <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> elements_mat <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> elements_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-elements_mat_append_cols"><span class="command">lemma</span></span> elements_mat_append_cols<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">n</span> <span class="free">nc</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">∈</span> carrier_mat <span class="free">n</span> <span class="free">nc1</span>
  <span class="main">⟹</span> elements_mat <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> elements_mat <span class="free">A</span> <span class="main">∪</span> elements_mat <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> append_cols_def elements_mat_transpose_mat
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> elements_mat_append_rows<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-vec_first_index"><span class="command">lemma</span></span> vec_first_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_first <span class="free">v</span> <span class="free">n</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_first_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Matrix-vec_last_index"><span class="command">lemma</span></span> vec_last_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_last <span class="free">v</span> <span class="free">m</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_last_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Matrix-vec_first_add"><span class="command">lemma</span></span> vec_first_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">x</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">y</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"vec_first <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> vec_first <span class="free">x</span> <span class="free">n</span> <span class="main">+</span> vec_first <span class="free">y</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_first_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-vec_first_zero"><span class="command">lemma</span></span> vec_first_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> vec_first <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_first_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-vec_first_smult"><span class="command">lemma</span></span> vec_first_smult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">n</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> vec_first <span class="main">(</span><span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> vec_first <span class="free">x</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_first_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-elements_mat_mat_of_row"><span class="command">lemma</span></span> elements_mat_mat_of_row<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elements_mat <span class="main">(</span>mat_of_row <span class="free">v</span><span class="main">)</span> <span class="main">=</span> vec_set <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mat_of_row_def elements_mat_def vec_set_def<span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-vec_set_append_vec"><span class="command">lemma</span></span> vec_set_append_vec<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec_set <span class="main">(</span><span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> vec_set <span class="free">v</span> <span class="main">∪</span> vec_set <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list_of_vec_append set_append set_list_of_vec<span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-vec_set_vNil"><span class="command">lemma</span></span> vec_set_vNil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">set<span class="hidden">⇩</span><sub>v</sub></span> vNil <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_list_of_vec <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Missing_Matrix-diff_smult_distrib_vec"><span class="command">lemma</span></span> diff_smult_distrib_vec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>ring<span class="main">)</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">-</span> <span class="free">y</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> smult_vec_def minus_vec_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> left_diff_distrib<span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-add_diff_eq_vec"><span class="command">lemma</span></span> add_diff_eq_vec<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> group_add vec"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">-</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_diff_eq<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_of_col</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>mat_of_row <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>

<span class="keyword1" id="Missing_Matrix-elements_mat_mat_of_col"><span class="command">lemma</span></span> elements_mat_mat_of_col<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"elements_mat <span class="main">(</span>mat_of_col <span class="free">v</span><span class="main">)</span> <span class="main">=</span> vec_set <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_of_col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-mat_of_col_dim"><span class="command">lemma</span></span> mat_of_col_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>mat_of_col <span class="free">v</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>mat_of_col <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"mat_of_col <span class="free">v</span> <span class="main">∈</span> carrier_mat <span class="main">(</span>dim_vec <span class="free">v</span><span class="main">)</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_of_col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-col_mat_of_col"><span class="command">lemma</span></span> col_mat_of_col<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>mat_of_col <span class="free">v</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_of_col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Missing_Matrix-mult_mat_of_col"><span class="command">lemma</span></span> mult_mat_of_col<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nc</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span> <span class="main">⟹</span>
                        <span class="free">A</span> <span class="main">*</span> mat_of_col <span class="free">v</span> <span class="main">=</span> mat_of_col <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mat_col_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-mat_mult_append_cols"><span class="command">lemma</span></span> mat_mult_append_cols<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_0 mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nc1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nc2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v1</span> <span class="main">∈</span> carrier_vec <span class="free">nc1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v2</span> <span class="main">∈</span> carrier_vec <span class="free">nc2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">v1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v1</span> <span class="main">+</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">v1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> col <span class="main">(</span>mat_of_col <span class="main">(</span><span class="free">v1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> col <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">*</span> mat_of_col <span class="main">(</span><span class="free">v1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">*</span> mat_of_col <span class="main">(</span><span class="free">v1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">*</span> mat_of_col <span class="main">(</span><span class="free">v1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">*</span> mat_of_col <span class="main">(</span><span class="free">v1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span>
             <span class="main">(</span>mat_of_row <span class="main">(</span><span class="free">v1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> append_cols_def mat_of_col_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> transpose_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> transpose_carrier_mat<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> mat_of_row_carrier<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">∈</span> carrier_mat <span class="free">nc1</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">∈</span> carrier_mat <span class="free">nc2</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="free">nc1</span> <span class="main">+</span> <span class="free">nc2</span><span class="main">)</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">nc1</span> <span class="main">+</span> <span class="free">nc2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">v1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span> <span class="main">∈</span> carrier_vec <span class="main">(</span>dim_row <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v1 v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>mat_of_row <span class="main">(</span><span class="free">v1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mat_of_row <span class="free">v1</span> <span class="main">*</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> mat_of_row <span class="free">v2</span> <span class="main">*</span> <span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_row_mult_append_rows<span class="main">[</span><span class="operator">OF</span> v1 v2<span class="main">]</span> A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">(</span>mat_of_row <span class="free">v1</span> <span class="main">*</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">+</span> <span class="main">(</span>mat_of_row <span class="free">v2</span> <span class="main">*</span> <span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> transpose_add A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_of_row <span class="free">v1</span> <span class="main">*</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>mat_of_row <span class="free">v1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> transpose_mult A v1 transpose_carrier_mat mat_of_row_carrier<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_of_row <span class="free">v2</span> <span class="main">*</span> <span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>mat_of_row <span class="free">v2</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> transpose_mult B v2 transpose_carrier_mat mat_of_row_carrier<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>mat_of_row <span class="free">v1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">+</span> <span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>mat_of_row <span class="free">v2</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span>
             <span class="free">A</span> <span class="main">*</span> mat_of_col <span class="free">v1</span> <span class="main">+</span> <span class="free">B</span> <span class="main">*</span> mat_of_col <span class="free">v2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mat_of_col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"col <span class="main">…</span> <span class="main">0</span> <span class="main">=</span> col <span class="main">(</span><span class="free">A</span> <span class="main">*</span> mat_of_col <span class="free">v1</span><span class="main">)</span> <span class="main">0</span> <span class="main">+</span> col <span class="main">(</span><span class="free">B</span> <span class="main">*</span> mat_of_col <span class="free">v2</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> col <span class="main">(</span>mat_of_col <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">+</span> col <span class="main">(</span>mat_of_col <span class="main">(</span><span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_mat_of_col assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v1</span> <span class="main">+</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Matrix-vec_first_append"><span class="command">lemma</span></span> vec_first_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span><span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span> <span class="main">=</span> vec_first <span class="main">(</span><span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="main">(</span><span class="free">v</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span>dim_vec <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_first_last_append assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> append_vec_eq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Matrix-vec_le_iff_diff_le_0"><span class="command">lemma</span></span> vec_le_iff_diff_le_0<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ordered_ab_group_add vec"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_row_first</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> mat <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_row_last</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> mat <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$$</span> <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Missing_Matrix-mat_row_first_carrier"><span class="command">lemma</span></span> mat_row_first_carrier<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mat_row_first <span class="free">A</span> <span class="free">n</span> <span class="main">∈</span> carrier_mat <span class="free">n</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_row_first_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Matrix-mat_row_first_dim"><span class="command">lemma</span></span> mat_row_first_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>mat_row_first <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>mat_row_first <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_row_first_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Missing_Matrix-mat_row_last_carrier"><span class="command">lemma</span></span> mat_row_last_carrier<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mat_row_last <span class="free">A</span> <span class="free">n</span> <span class="main">∈</span> carrier_mat <span class="free">n</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_row_last_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Matrix-mat_row_last_dim"><span class="command">lemma</span></span> mat_row_last_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>mat_row_last <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>mat_row_last <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_row_last_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Missing_Matrix-mat_row_first_nth"><span class="command">lemma</span></span> mat_row_first_nth<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> row <span class="main">(</span>mat_row_first <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="free">A</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_row_first_def row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Missing_Matrix-append_rows_nth"><span class="command">lemma</span></span> append_rows_nth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr1</span> <span class="free">nc</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> carrier_mat <span class="free">nr2</span> <span class="free">nc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr1</span> <span class="main">⟹</span> row <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="free">A</span> <span class="free">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span> <span class="main">≥</span> <span class="free">nr1</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr1</span> <span class="main">+</span> <span class="free">nr2</span> <span class="main">⟧</span> <span class="main">⟹</span> row <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="free">B</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">nr1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> append_rows_def <span class="keyword1"><span class="command">using</span></span> row_four_block_mat assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-mat_of_row_last_nth"><span class="command">lemma</span></span> mat_of_row_last_nth<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> row <span class="main">(</span>mat_row_last <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="free">A</span> <span class="main">(</span>dim_row <span class="free">A</span> <span class="main">-</span> <span class="free">n</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_row_last_def row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-mat_row_first_last_append"><span class="command">lemma</span></span> mat_row_first_last_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_row_first <span class="free">A</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span>mat_row_last <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq_rowI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>mat_row_first <span class="free">A</span> <span class="free">m</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> mat_row_last <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> append_rows_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>mat_row_first <span class="free">A</span> <span class="free">m</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> mat_row_last <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> append_rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>mat_row_first <span class="free">A</span> <span class="free">m</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> mat_row_last <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> row <span class="free">A</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> append_rows_nth<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mat_row_first_carrier<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span>
          mat_row_last_carrier<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span> i<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> append_rows_nth<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mat_row_first_carrier<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span>
          mat_row_last_carrier<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> i assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_col_first</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span>mat_row_first <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mat_col_last</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span>mat_row_last <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>

<span class="keyword1" id="Missing_Matrix-mat_col_first_carrier"><span class="command">lemma</span></span> mat_col_first_carrier<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mat_col_first <span class="free">A</span> <span class="free">n</span> <span class="main">∈</span> carrier_mat <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_col_first_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Missing_Matrix-mat_col_first_dim"><span class="command">lemma</span></span> mat_col_first_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>mat_col_first <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>mat_col_first <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_col_first_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Missing_Matrix-mat_col_last_carrier"><span class="command">lemma</span></span> mat_col_last_carrier<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mat_col_last <span class="free">A</span> <span class="free">n</span> <span class="main">∈</span> carrier_mat <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_col_last_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Missing_Matrix-mat_col_last_dim"><span class="command">lemma</span></span> mat_col_last_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>mat_col_last <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>mat_col_last <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_col_last_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Missing_Matrix-mat_col_first_nth"><span class="command">lemma</span></span> mat_col_first_nth<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> dim_col <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> col <span class="main">(</span>mat_col_first <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> col <span class="free">A</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_col_first_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Missing_Matrix-append_cols_nth"><span class="command">lemma</span></span> append_cols_nth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nc1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nc2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nc1</span> <span class="main">⟹</span> col <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> col <span class="free">A</span> <span class="free">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span> <span class="main">≥</span> <span class="free">nc1</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">nc1</span> <span class="main">+</span> <span class="free">nc2</span> <span class="main">⟧</span> <span class="main">⟹</span> col <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">B</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> col <span class="free">B</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">nc1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> append_cols_def append_rows_def <span class="keyword1"><span class="command">using</span></span> row_four_block_mat assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-mat_of_col_last_nth"><span class="command">lemma</span></span> mat_of_col_last_nth<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> dim_col <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> col <span class="main">(</span>mat_col_last <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> col <span class="free">A</span> <span class="main">(</span>dim_col <span class="free">A</span> <span class="main">-</span> <span class="free">n</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_col_last_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-mat_col_first_last_append"><span class="command">lemma</span></span> mat_col_first_last_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat_col_first <span class="free">A</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span>mat_col_last <span class="free">A</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> append_cols_def mat_col_first_def mat_col_last_def
  <span class="keyword1"><span class="command">using</span></span> mat_row_first_last_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Matrix-mat_of_row_dim_row_1"><span class="command">lemma</span></span> mat_of_row_dim_row_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_row <span class="free">A</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">=</span> mat_of_row <span class="main">(</span>row <span class="free">A</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> mat_of_row <span class="main">(</span>row <span class="free">A</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> mat_of_row <span class="main">(</span>row <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> dim_row <span class="free">A</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_of_row_dim<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Matrix-mat_of_col_dim_col_1"><span class="command">lemma</span></span> mat_of_col_dim_col_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim_col <span class="free">A</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">=</span> mat_of_col <span class="main">(</span>col <span class="free">A</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> mat_of_col <span class="main">(</span>col <span class="free">A</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mat_of_col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> mat_of_col <span class="main">(</span>col <span class="free">A</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> dim_col <span class="free">A</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat_of_col_dim<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec_of_scal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec_of_scal</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> vec <span class="main">1</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Missing_Matrix-vec_of_scal_dim"><span class="command">lemma</span></span> vec_of_scal_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>vec_of_scal <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"vec_of_scal <span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_of_scal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-index_vec_of_scal"><span class="command">lemma</span></span> index_vec_of_scal<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_of_scal <span class="free">x</span><span class="main">)</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_of_scal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-row_mat_of_col"><span class="command">lemma</span></span> row_mat_of_col<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span> <span class="main">⟹</span> row <span class="main">(</span>mat_of_col <span class="free">v</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> vec_of_scal <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mat_of_col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-vec_of_scal_dim_1"><span class="command">lemma</span></span> vec_of_scal_dim_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">∈</span> carrier_vec <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">=</span> vec_of_scal <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> vec_of_scal_dim<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-mult_mat_of_row_vec_of_scal"><span class="command">lemma</span></span> mult_mat_of_row_vec_of_scal<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_of_col <span class="free">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prod_def<span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-smult_pos_vec"><span class="command">lemma</span></span> smult_pos_vec<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> linordered_ring_strict"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">=</span> <span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> True
      mult_le_cancel_left_pos<span class="main">[</span><span class="operator">OF</span> l<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_vec_def<span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-finite_elements_mat"><span class="command">lemma</span></span> finite_elements_mat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>elements_mat <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> elements_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_set<span class="main">)</span>

<span class="keyword1" id="Missing_Matrix-finite_vec_set"><span class="command">lemma</span></span> finite_vec_set<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vec_set <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-lesseq_vecI"><span class="command">lemma</span></span> lesseq_vecI<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-lesseq_vecD"><span class="command">lemma</span></span> lesseq_vecD<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-vec_add_mono"><span class="command">lemma</span></span> vec_add_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ordered_ab_semigroup_add vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">b</span> <span class="main">=</span> dim_vec <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">+</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">d</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> id cd <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> id dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ia<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ib ab <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab ia ib <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cd ic id <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> abcdi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">c</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">d</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">a</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">c</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> index_add_vec<span class="main">(</span>1<span class="main">)</span> ic <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">d</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abcdi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">d</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> index_add_vec<span class="main">(</span>1<span class="main">)</span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">+</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def
    <span class="keyword1"><span class="command">using</span></span> dim index_add_vec<span class="main">(</span>2<span class="main">)</span> cd less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Matrix-smult_nneg_npos_vec"><span class="command">lemma</span></span> smult_nneg_npos_vec<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ordered_semiring_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> vi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">l</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v i <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_nonneg_nonpos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> l vi<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Matrix-smult_vec_nonneg_eq"><span class="command">lemma</span></span> smult_vec_nonneg_eq<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> smult_smult_assoc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">1</span></span></span> <span class="main"><span class="main"><span class="main">/</span></span></span> <span class="free"><span class="free"><span class="free">c</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">c</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> nonzero_divide_eq_eq one_smult_vec<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Matrix-distinct_smult_nonneg"><span class="command">lemma</span></span> distinct_smult_nonneg<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">lC</span> <span class="main">⟹</span> distinct <span class="main">(</span>map <span class="main">(</span><span class="keyword1">(⋅<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">c</span><span class="main">)</span> <span class="free">lC</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">lC</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">lC</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> set <span class="skolem">lC</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">∉</span> set <span class="main">(</span>map <span class="main">(</span><span class="keyword1">(⋅<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">c</span><span class="main">)</span> <span class="skolem">lC</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> smult_vec_nonneg_eq<span class="main">[</span><span class="operator">OF</span> c<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="keyword1">(⋅<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">lC</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">#</span> map <span class="main">(</span><span class="keyword1">(⋅<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">c</span><span class="main">)</span> <span class="skolem">lC</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons.IH Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Matrix-exists_vec_append"><span class="command">lemma</span></span> exists_vec_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x1</span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">x2</span> <span class="main">∈</span> carrier_vec <span class="free">m</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Px<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vec <span class="free">n</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec <span class="free">m</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> xcarr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>vec <span class="free">n</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec <span class="free">m</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xcarr Px calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x1</span><span class="main">∈</span>carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x2</span><span class="main">∈</span>carrier_vec <span class="free">m</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 vec_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">x1</span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">x2</span> <span class="main">∈</span> carrier_vec <span class="free">m</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> carrier_vec <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> xcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1 x2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P12 xcarr <span class="keyword1"><span class="command">using</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xcarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Missing_VS_Connect">
<div class="head">
<h1>Theory Missing_VS_Connect</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Missing Lemmas on Vector Spaces›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We provide some results on vector spaces which should be merged into other AFP entries.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Missing_VS_Connect
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../../jordan_normal_form/theories/#VS_Connect">Jordan_Normal_Form.VS_Connect</a>
    <a href="#Missing_Matrix">Missing_Matrix</a>
    <a href="../../polynomial_factorization/theories/#Missing_List">Polynomial_Factorization.Missing_List</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> vec_space
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Missing_VS_Connect-span_diff"><span class="command">lemma</span></span> span_diff<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> span <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> span <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">∈</span> span <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A a <span class="keyword1"><span class="command">have</span></span> an<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> A b <span class="keyword1"><span class="command">have</span></span> bn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> span <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_add1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A a<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> b A<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> an bn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_VS_Connect-finsum_scalar_prod_sum'"><span class="command">lemma</span></span> finsum_scalar_prod_sum'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">→</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∙</span> finsum V <span class="free">f</span> <span class="free">U</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">w</span> <span class="main">∙</span> <span class="free">f</span> <span class="bound">u</span><span class="main">)</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> comm_scalar_prod<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">insert</span> f<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">subst</span> finsum_scalar_prod_sum<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f w<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">insert</span> f<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span> comm_scalar_prod<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ w<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_VS_Connect-lincomb_scalar_prod_left"><span class="command">lemma</span></span> lincomb_scalar_prod_left<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="free">W</span> <span class="main">∙</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span><span class="free">W</span><span class="main">.</span> <span class="free">a</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">∙</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lincomb_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finsum_scalar_prod_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>

<span class="keyword1" id="Missing_VS_Connect-lincomb_scalar_prod_right"><span class="command">lemma</span></span> lincomb_scalar_prod_right<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∙</span> lincomb <span class="free">a</span> <span class="free">W</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span><span class="free">W</span><span class="main">.</span> <span class="free">a</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lincomb_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finsum_scalar_prod_sum'<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>

<span class="keyword1" id="Missing_VS_Connect-lin_indpt_empty"><span class="command">lemma</span></span> lin_indpt_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lin_dep_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_VS_Connect-span_carrier_lin_indpt_card_n"><span class="command">lemma</span></span> span_carrier_lin_indpt_card_n<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">W</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"span <span class="free">W</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms basis_def dim_is_n dim_li_is_basis fin_dim_li_fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_VS_Connect-ortho_span"><span class="command">lemma</span></span> ortho_span<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ortho<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> span <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> w W <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> VW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_spanE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> w
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_scalar_prod_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> W VW X x ortho<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_VS_Connect-ortho_span'"><span class="command">lemma</span></span> ortho_span'<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ortho<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> span <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∙</span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> w W <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> VW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_spanE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> w
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_scalar_prod_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> W VW X x ortho<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_VS_Connect-ortho_span_span"><span class="command">lemma</span></span> ortho_span_span<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ortho<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> span <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> span <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ortho_span<span class="main"><span class="main">[</span></span><span class="operator">OF</span> W _ ortho_span'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> X W _ _<span class="main"><span class="main">]</span></span> w x<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> W X ortho<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_VS_Connect-lincomb_in_span"><span class="command">lemma</span></span> lincomb_in_span<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="free">X</span> <span class="main">∈</span> span <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">a</span> <span class="free">X</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lincomb_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> X<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_VS_Connect-generating_card_n_basis"><span class="command">lemma</span></span> generating_card_n_basis<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"carrier_vec <span class="free">n</span> <span class="main">⊆</span> span <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> card <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card.infinite<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> span <span class="keyword1"><span class="command">have</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">X</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> dim_is_n card <span class="keyword1"><span class="command">have</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≤</span> dim"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> dim_gen_is_basis<span class="main">[</span><span class="operator">OF</span> fin X span card<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"basis <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_VS_Connect-lincomb_list_append"><span class="command">lemma</span></span> lincomb_list_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Ws<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">Ws</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> lincomb_list <span class="free">f</span> <span class="main">(</span><span class="free">Vs</span> <span class="main">@</span> <span class="free">Ws</span><span class="main">)</span> <span class="main">=</span>
    lincomb_list <span class="free">f</span> <span class="free">Vs</span> <span class="main">+</span> lincomb_list <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> length <span class="free">Vs</span><span class="main">)</span><span class="main">)</span> <span class="free">Ws</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Vs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lincomb_list_carrier<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Ws<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">Vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="free">Ws</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> lincomb_list <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="free">Ws</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_list_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="free">Ws</span><span class="main">)</span> <span class="main">=</span>
             lincomb_list <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Vs</span> <span class="main">+</span> lincomb_list <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> length <span class="skolem">Vs</span><span class="main">)</span><span class="main">)</span> <span class="free">Ws</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> length <span class="skolem">Vs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">Vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>lincomb_list <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Vs</span><span class="main">)</span> <span class="main">+</span> lincomb_list <span class="main">…</span> <span class="free">Ws</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>lincomb_list <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Vs</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> lincomb_list <span class="main">…</span> <span class="free">Ws</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assoc_add_vec Cons.prems Ws lincomb_list_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_list_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_VS_Connect-lincomb_list_snoc"><span class="command">lemma</span></span> lincomb_list_snoc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span>
          lincomb_list <span class="free">f</span> <span class="main">(</span><span class="free">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> lincomb_list <span class="free">f</span> <span class="free">Vs</span> <span class="main">+</span> <span class="free">f</span> <span class="main">(</span>length <span class="free">Vs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lincomb_list_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_VS_Connect-lincomb_list_smult"><span class="command">lemma</span></span> lincomb_list_smult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> lincomb_list <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span> <span class="bound">i</span><span class="main">)</span> <span class="free">Vs</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="free">c</span> <span class="free">Vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Vs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">Vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snoc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
        lincomb_list <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">Vs</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">c</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x Vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">Vs</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="free">c</span> <span class="skolem">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> snoc.IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Vs<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">c</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">c</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_smult_assoc x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="free">c</span> <span class="skolem">Vs</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>lincomb_list <span class="free">c</span> <span class="skolem">Vs</span> <span class="main">+</span> <span class="free">c</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smult_add_distrib_vec<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">n</span></span> <span class="main">_</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> lincomb_list_carrier<span class="main">[</span><span class="operator">OF</span> Vs<span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="free">c</span> <span class="skolem">Vs</span> <span class="main">+</span> <span class="free">c</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">=</span> lincomb_list <span class="free">c</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Vs x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_VS_Connect-lincomb_list_index"><span class="command">lemma</span></span> lincomb_list_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">Xs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span>
         lincomb_list <span class="free">c</span> <span class="free">Xs</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="free">c</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span><span class="free">Xs</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">Xs</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">Xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Xs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="free">c</span> <span class="main">(</span><span class="skolem">Xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> lincomb_list <span class="free">c</span> <span class="skolem">Xs</span> <span class="main">+</span> <span class="free">c</span> <span class="main">(</span>length <span class="skolem">Xs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> lincomb_list <span class="free">c</span> <span class="skolem">Xs</span> <span class="main">$</span> <span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span> <span class="main">(</span>length <span class="skolem">Xs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i index_add_vec<span class="main">(</span>1<span class="main">)</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">(</span>length <span class="skolem">Xs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">c</span> <span class="main">(</span>length <span class="skolem">Xs</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">$</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="free">i</span><span class="main">=</span> <span class="main">(</span><span class="skolem">Xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">Xs</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="free">c</span> <span class="skolem">Xs</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Xs</span><span class="main">.</span> <span class="free">c</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">Xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> snoc.IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Xs<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Xs</span><span class="main">.</span> <span class="free">c</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">Xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R.finsum_restrict<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> restrict_ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> append_Cons_nth_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> sum.atLeast0_lessThan_Suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="free">c</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">Xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">$</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">Xs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Basis_Extension">
<div class="head">
<h1>Theory Basis_Extension</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Basis Extension›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove that every linear indepent set/list of vectors can be extended into a basis.
  Similarly, from every set of vectors one can extract a linear independent set of vectors
  that spans the same space.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Basis_Extension
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../../lll_basis_reduction/theories/#Gram_Schmidt_2">LLL_Basis_Reduction.Gram_Schmidt_2</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">context</span></span> cof_vec_space
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Basis_Extension-lin_indpt_list_length_le_n"><span class="command">lemma</span></span> lin_indpt_list_length_le_n<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> lin_indpt_list_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> dist <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> distinct_card<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lin xs dim_is_n li_le_dim<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Basis_Extension-lin_indpt_list_length_eq_n"><span class="command">lemma</span></span> lin_indpt_list_length_eq_n<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"basis <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> lin_indpt_list_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> dist <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> distinct_card<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> lin xs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"basis <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> dim_is_n
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basis_def dim_basis dim_li_is_basis fin_dim finite_basis_exists gen_ge_dim li_le_dim<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Basis_Extension-expand_to_basis"><span class="command">lemma</span></span> expand_to_basis<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ys</span><span class="main">.</span> set <span class="bound">ys</span> <span class="main">⊆</span> set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> lin_indpt_list <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">∧</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> lin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lin_indpt_list_length_le_n<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ys</span><span class="main">.</span> set <span class="bound">ys</span> <span class="main">⊆</span> set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> lin_indpt_list <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">∧</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lin
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">xs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">Nil</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">y</span> <span class="skolem">xs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> lin_indpt_list_def<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> distinct_card<span class="main">[</span><span class="operator">OF</span> dist<span class="main">]</span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">xs</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="skolem">xs</span><span class="main">)</span> <span class="main">≠</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card dim_is_n xs basis_def dim_basis lin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> span_closed<span class="main">[</span><span class="operator">OF</span> xs<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="skolem">xs</span><span class="main">)</span> <span class="main">⊂</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"carrier_vec <span class="free">n</span> <span class="main">=</span> span <span class="main">(</span>set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> span_unit_vecs_is_carrier <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="skolem">xs</span><span class="main">)</span> <span class="main">⊂</span> span <span class="main">(</span>set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∉</span> span <span class="main">(</span>set <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> span_subsetI<span class="main">[</span><span class="operator">OF</span> xs<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">]</span> sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> uu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> usxs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> span <span class="main">(</span>set <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unit_vecs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">u</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> span_mem<span class="main">[</span><span class="operator">OF</span> xs<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> usxs <span class="keyword1"><span class="command">have</span></span> uxs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> dist <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="var">?xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="var">?xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lin_dep_iff_in_span<span class="main">[</span><span class="operator">OF</span> xs lin u uxs<span class="main">]</span> usxs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> lin dist u xs <span class="keyword1"><span class="command">have</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="var">?xs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lin_indpt_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?xs</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this lin<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"set <span class="skolem">ys</span> <span class="main">⊆</span> set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="main">(</span><span class="var">?xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="var">?xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> uu
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">u</span></span></span> <span class="main"><span class="main"><span class="main">#</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">ys</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis_extension</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">ys</span><span class="main">.</span>
  set <span class="bound">ys</span> <span class="main">⊆</span> set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> lin_indpt_list <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">@</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">∧</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">@</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Basis_Extension-basis_extension"><span class="command">lemma</span></span> basis_extension<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>basis_extension <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"lin_indpt_list <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> basis_extension <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> basis_extension <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> expand_to_basis<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">folded</span> basis_extension_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Basis_Extension-exists_lin_indpt_sublist"><span class="command">lemma</span></span> exists_lin_indpt_sublist<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">Ls</span><span class="main">.</span> lin_indpt_list <span class="bound">Ls</span> <span class="main">∧</span> span <span class="main">(</span>set <span class="bound">Ls</span><span class="main">)</span> <span class="main">=</span> span <span class="free">X</span> <span class="main">∧</span> set <span class="bound">Ls</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">Ls</span><span class="main">.</span> lin_indpt_list <span class="bound">Ls</span> <span class="main">∧</span> span <span class="main">(</span>set <span class="bound">Ls</span><span class="main">)</span> <span class="main">⊆</span> span <span class="free">X</span> <span class="main">∧</span> set <span class="bound">Ls</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> length <span class="bound">Ls</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?T</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lindep_span<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> span_is_monotone <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lin_indpt_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ls</span></span> <span class="keyword2"><span class="keyword">where</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="skolem">Ls</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="skolem">Ls</span><span class="main">)</span> <span class="main">⊆</span> span <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ls<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ls</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">Ls</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> Ls X <span class="keyword1"><span class="command">have</span></span> LsC<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ls</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> span <span class="main">(</span>set <span class="skolem">Ls</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"span <span class="free">X</span> <span class="main">⊆</span> span <span class="main">(</span>set <span class="skolem">Ls</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LsC X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> span_subsetI<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> span <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="skolem">Ls</span><span class="main">)</span> <span class="main">=</span> span <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Ls</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI True lin Ls<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> span <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xSLs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> span <span class="main">(</span>set <span class="skolem">Ls</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> Ls X <span class="keyword1"><span class="command">have</span></span> LsC<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ls</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> span_mem<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> xSLs <span class="keyword1"><span class="command">have</span></span> xLs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> set <span class="skolem">Ls</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ls</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">Ls</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> disjI1 exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?Ls</span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?Ls</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="var">?Ls</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lin xSLs xLs <span class="keyword1"><span class="command">unfolding</span></span> lin_indpt_list_def
            <span class="keyword1"><span class="command">using</span></span> lin_dep_iff_in_span<span class="main">[</span><span class="operator">OF</span> LsC _ _ xLs<span class="main">]</span> xX X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?Ls</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xX Ls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> span_is_monotone<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="var">?Ls</span><span class="main">)</span> <span class="main">⊆</span> span <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> lin_indpt_list_length_le_n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Basis_Extension-exists_lin_indpt_subset"><span class="command">lemma</span></span> exists_lin_indpt_subset<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">Ls</span><span class="main">.</span> lin_indpt <span class="bound">Ls</span> <span class="main">∧</span> span <span class="main">(</span><span class="bound">Ls</span><span class="main">)</span> <span class="main">=</span> span <span class="free">X</span> <span class="main">∧</span> <span class="bound">Ls</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> exists_lin_indpt_sublist<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ls</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="skolem">Ls</span> <span class="main">∧</span> span <span class="main">(</span>set <span class="skolem">Ls</span><span class="main">)</span> <span class="main">=</span> span <span class="free">X</span> <span class="main">∧</span> set <span class="skolem">Ls</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"set <span class="skolem"><span class="skolem"><span class="skolem">Ls</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lin_indpt_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Sum_Vec_Set">
<div class="head">
<h1>Theory Sum_Vec_Set</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sum of Vector Sets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We use Isabelle's Set-Algebra theory to be able to write V + W for sets of vectors V and W,
 and prove some obvious properties about them.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Sum_Vec_Set
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#Missing_Matrix">Missing_Matrix</a>
    <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Set_Algebras.html">HOL-Library.Set_Algebras</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1" id="Sum_Vec_Set-add_0_right_vecset"><span class="command">lemma</span></span> add_0_right_vecset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> monoid_add vec set<span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">+</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Sum_Vec_Set-add_0_left_vecset"><span class="command">lemma</span></span> add_0_left_vecset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> monoid_add vec set<span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span> <span class="main">+</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Sum_Vec_Set-assoc_add_vecset"><span class="command">lemma</span></span> assoc_add_vecset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> semigroup_add vec set<span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">+</span> <span class="main">(</span><span class="free">B</span> <span class="main">+</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span> <span class="main">+</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">+</span> <span class="main">(</span><span class="free">B</span> <span class="main">+</span> <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assoc_add_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span> <span class="main">+</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span> <span class="main">+</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assoc_add_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">+</span> <span class="main">(</span><span class="free">B</span> <span class="main">+</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sum_Vec_Set-sum_carrier_vec"><span class="command">lemma</span></span> sum_carrier_vec<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">+</span> <span class="free">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Sum_Vec_Set-comm_add_vecset"><span class="command">lemma</span></span> comm_add_vecset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> ab_semigroup_add vec set<span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">+</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span> <span class="main">+</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">using</span></span> comm_add_vec assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Integral_Bounded_Vectors">
<div class="head">
<h1>Theory Integral_Bounded_Vectors</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Integral and Bounded Matrices and Vectors›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define notions of integral vectors and matrices and bounded vectors and matrices
  and prove some preservation lemmas. Moreover, we prove a bound on determinants.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Integral_Bounded_Vectors
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#Missing_VS_Connect">Missing_VS_Connect</a>
    <a href="#Sum_Vec_Set">Sum_Vec_Set</a>
    <a href="../../lll_basis_reduction/theories/#Gram_Schmidt_2">LLL_Basis_Reduction.Gram_Schmidt_2</a> <span class="comment1">(* for some simp-rules *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TODO: move into theory Norms *)</span>
<span class="keyword1" id="Integral_Bounded_Vectors-sq_norm_unit_vec"><span class="command">lemma</span></span> sq_norm_unit_vec<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">∥<span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">,</span>conjugatable_ring<span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="free">i</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="free">i</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons append_Nil diff_zero length_upt list_trisect<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sq_norm_vec_def unit_vec_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def id<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> sum_list_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Ints_vec</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ℤ<span class="hidden">⇩</span><sub>v</sub></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">indexed_Ints_vec</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">indexed_Ints_vec</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="bound">x</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Integral_Bounded_Vectors-indexed_Ints_vec_UNIV"><span class="command">lemma</span></span> indexed_Ints_vec_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">=</span> indexed_Ints_vec UNIV"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ints_vec_def indexed_Ints_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integral_Bounded_Vectors-indexed_Ints_vec_subset"><span class="command">lemma</span></span> indexed_Ints_vec_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">⊆</span> indexed_Ints_vec <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ints_vec_def indexed_Ints_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integral_Bounded_Vectors-Ints_vec_vec_set"><span class="command">lemma</span></span> Ints_vec_vec_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">=</span> <span class="main">(</span>vec_set <span class="free">v</span> <span class="main">⊆</span> <span class="main">ℤ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ints_vec_def vec_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Ints_mat</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ℤ<span class="hidden">⇩</span><sub>m</sub></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">A</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_row <span class="bound">A</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> dim_col <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Integral_Bounded_Vectors-Ints_mat_elements_mat"><span class="command">lemma</span></span> Ints_mat_elements_mat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">(</span>elements_mat <span class="free">A</span> <span class="main">⊆</span> <span class="main">ℤ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ints_mat_def elements_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Integral_Bounded_Vectors-minus_in_Ints_vec_iff"><span class="command">lemma</span></span> minus_in_Ints_vec_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> ring_1 vec<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ints_vec_vec_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minus_in_Ints_iff<span class="main">)</span>

<span class="keyword1" id="Integral_Bounded_Vectors-minus_in_Ints_mat_iff"><span class="command">lemma</span></span> minus_in_Ints_mat_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">⟷</span> <span class="main">(</span><span class="free">A</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> ring_1 mat<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ints_mat_elements_mat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minus_in_Ints_iff<span class="main">)</span>

<span class="keyword1" id="Integral_Bounded_Vectors-Ints_vec_rows_Ints_mat"><span class="command">lemma</span></span> Ints_vec_rows_Ints_mat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rows <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rows_def Ints_vec_def Ints_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Integral_Bounded_Vectors-unit_vec_integral"><span class="command">lemma</span></span> unit_vec_integral<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"unit_vec <span class="free">n</span> <span class="free">i</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ints_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unit_vec_def<span class="main">)</span>

<span class="keyword1" id="Integral_Bounded_Vectors-diff_indexed_Ints_vec"><span class="command">lemma</span></span> diff_indexed_Ints_vec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>
  <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> indexed_Ints_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integral_Bounded_Vectors-smult_indexed_Ints_vec"><span class="command">lemma</span></span> smult_indexed_Ints_vec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> indexed_Ints_vec_def smult_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Integral_Bounded_Vectors-add_indexed_Ints_vec"><span class="command">lemma</span></span> add_indexed_Ints_vec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>
  <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> indexed_Ints_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> vec_space<span class="main">)</span> lincomb_indexed_Ints_vec<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> cI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">c</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> CI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> indexed_Ints_vec <span class="free">I</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">c</span> <span class="free">C</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> C <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>lincomb <span class="free">c</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> indexed_Ints_vec_def mem_Collect_eq id
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> iI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">c</span> <span class="free">C</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> <span class="free">c</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i C<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Ints_sum Ints_mult cI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i iI CI<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> indexed_Ints_vec_def<span class="main"><span class="main">]</span></span> C<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">c</span> <span class="free">C</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Bounded_vec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> linordered_idom<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="bound">x</span> <span class="main">.</span> abs <span class="main">(</span><span class="bound">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Integral_Bounded_Vectors-Bounded_vec_vec_set"><span class="command">lemma</span></span> Bounded_vec_vec_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> Bounded_vec <span class="free">b</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> vec_set <span class="free">v</span><span class="main">.</span> abs <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def vec_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Bounded_mat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> linordered_idom<span class="main">)</span> <span class="main">=</span>
  <span class="main">{</span><span class="bound">A</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_row <span class="bound">A</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> dim_col <span class="bound">A</span><span class="main">.</span> abs <span class="main">(</span><span class="bound">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Integral_Bounded_Vectors-Bounded_mat_elements_mat"><span class="command">lemma</span></span> Bounded_mat_elements_mat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> Bounded_mat <span class="free">b</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> elements_mat <span class="free">A</span><span class="main">.</span> abs <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Bounded_mat_def elements_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integral_Bounded_Vectors-Bounded_vec_rows_Bounded_mat"><span class="command">lemma</span></span> Bounded_vec_rows_Bounded_mat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rows <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> Bounded_vec <span class="free">B</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">∈</span> Bounded_mat <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rows_def Bounded_vec_def Bounded_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Integral_Bounded_Vectors-unit_vec_Bounded_vec"><span class="command">lemma</span></span> unit_vec_Bounded_vec<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"unit_vec <span class="free">n</span> <span class="free">i</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def unit_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integral_Bounded_Vectors-Bounded_matD"><span class="command">lemma</span></span> Bounded_matD<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> Bounded_mat <span class="free">b</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nc</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">nc</span> <span class="main">⟹</span> abs <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Bounded_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integral_Bounded_Vectors-Bounded_vec_mono"><span class="command">lemma</span></span> Bounded_vec_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">⟹</span> Bounded_vec <span class="free">b</span> <span class="main">⊆</span> Bounded_vec <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integral_Bounded_Vectors-Bounded_mat_mono"><span class="command">lemma</span></span> Bounded_mat_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">⟹</span> Bounded_mat <span class="free">b</span> <span class="main">⊆</span> Bounded_mat <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Bounded_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Integral_Bounded_Vectors-finite_Bounded_vec_Max"><span class="command">lemma</span></span> finite_Bounded_vec_Max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> Bounded_vec <span class="main">(</span>Max <span class="main">{</span> abs <span class="main">(</span><span class="bound">a</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">|</span> <span class="bound">a</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> abs <span class="main">(</span><span class="bound">a</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">|</span> <span class="bound">a</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">λ</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> abs <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">a</span></span></span> <span class="main"><span class="main"><span class="main">$</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">`</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">A</span></span></span> <span class="main"><span class="main"><span class="main">×</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span> <span class="main"><span class="main"><span class="main">..&lt;</span></span></span> <span class="free"><span class="free"><span class="free">n</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> fin<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>Max <span class="var">?B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI Max_ge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fin<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> a A<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">det_bound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> linordered_idom <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">det_bound</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> fact <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Integral_Bounded_Vectors-det_bound"><span class="command">lemma</span></span> det_bound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">n</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> Bounded_mat <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>det <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> det_bound <span class="free">n</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>det <span class="free">A</span><span class="main">)</span> <span class="main">=</span> abs <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> signof <span class="bound">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> det_def'<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> abs <span class="main">(</span>signof <span class="bound">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> abs <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_mult abs_prod signof_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">p</span></span> <span class="main">|</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono prod_mono conjI Bounded_matD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fact <span class="free">n</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_permutations<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>det <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> det_bound <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integral_Bounded_Vectors-minus_in_Bounded_vec"><span class="command">lemma</span></span> minus_in_Bounded_vec<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> Bounded_vec <span class="free">b</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> Bounded_vec <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integral_Bounded_Vectors-sum_in_Bounded_vecI"><span class="command">lemma</span></span> sum_in_Bounded_vecI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>
  xB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> Bounded_vec <span class="free">B1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  yB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> Bounded_vec <span class="free">B2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span><span class="free">B1</span> <span class="main">+</span> <span class="free">B2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> x y <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def mem_Collect_eq id
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> x y xB yB <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">B1</span>"</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">y</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">B2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">B1</span> <span class="main">+</span> <span class="free">B2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> gram_schmidt<span class="main">)</span> lincomb_card_bound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> XBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Bnd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> abs <span class="main">(</span><span class="free">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">c</span> <span class="free">X</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>of_nat <span class="free">k</span> <span class="main">*</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> X <span class="keyword1"><span class="command">have</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>lincomb <span class="free">c</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def mem_Collect_eq dim
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>lincomb <span class="free">c</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> abs <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">c</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i X<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> abs <span class="main">(</span><span class="free">c</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> abs <span class="main">(</span><span class="free">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> abs <span class="main">(</span><span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> abs <span class="main">(</span><span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mult_right_mono<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> c<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> abs <span class="main">(</span><span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i XBnd<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Bounded_vec_def<span class="main"><span class="main">]</span></span> X<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_nat <span class="main">(</span>card <span class="free">X</span><span class="main">)</span> <span class="main">*</span> <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> of_nat <span class="free">k</span> <span class="main">*</span> <span class="free">Bnd</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Bnd<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> card<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>lincomb <span class="free">c</span> <span class="free">X</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> of_nat <span class="free">k</span> <span class="main">*</span> <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integral_Bounded_Vectors-bounded_vecset_sum"><span class="command">lemma</span></span> bounded_vecset_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Acarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Bcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="free">A</span> <span class="main">+</span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Cbnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">bndC</span><span class="main">.</span> <span class="free">C</span> <span class="main">⊆</span> Bounded_vec <span class="bound">bndC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">bndB</span><span class="main">.</span> <span class="free">B</span> <span class="main">⊆</span> Bounded_vec <span class="bound">bndB</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">bndA</span><span class="main">.</span> <span class="free">A</span> <span class="main">⊆</span> Bounded_vec <span class="bound">bndA</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> Acarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> Bcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">+</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> Ane<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">bndB</span><span class="main">.</span> <span class="skolem">B</span> <span class="main">⊆</span> Bounded_vec <span class="bound">bndB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Bne<span class="main">:</span> False
      <span class="keyword1"><span class="command">from</span></span> Cbnd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bndC</span></span> <span class="keyword2"><span class="keyword">where</span></span> bndC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">bndC</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> Ane <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> aA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> acarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Acarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>abs <span class="main">(</span><span class="skolem">a</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> finM<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nb</span> <span class="main">=</span> abs <span class="skolem">bndC</span> <span class="main">+</span> Max <span class="var">?M</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> bB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">∈</span> Bounded_vec <span class="skolem">bndC</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aA bB bndC sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
          <span class="keyword3"><span class="command">assume</span></span> i_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> ai_le_max<span class="main">:</span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="skolem">a</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> Max <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> acarr finM Max_ge <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="skolem">a</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> abs <span class="skolem">bndC</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ab bcarr acarr index_add_vec<span class="main">(</span>1<span class="main">)</span> i_lt_n <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="skolem">b</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> abs <span class="skolem">bndC</span> <span class="main">+</span> abs<span class="main">(</span><span class="skolem">a</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="skolem">b</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">nb</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_lt_n bcarr ai_le_max <span class="keyword1"><span class="command">unfolding</span></span> nb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> Bounded_vec <span class="skolem">nb</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def <span class="keyword1"><span class="command">using</span></span> bcarr carrier_vecD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">nb</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def <span class="keyword1"><span class="command">using</span></span> Bcarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> theor <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">bndB</span><span class="main">.</span> <span class="free">B</span> <span class="main">⊆</span> Bounded_vec <span class="bound">bndB</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> theor<span class="main">[</span><span class="operator">OF</span> Acarr Bcarr sum<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> CBA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="free">B</span> <span class="main">+</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> comm_add_vecset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Acarr Bcarr<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">bndA</span><span class="main">.</span> <span class="free">A</span> <span class="main">⊆</span> Bounded_vec <span class="bound">bndA</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> theor<span class="main">[</span><span class="operator">OF</span> Bcarr Acarr CBA<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Cone">
<div class="head">
<h1>Theory Cone</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cones›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the notions like cone, polyhedral cone, etc. and prove some basic facts about them.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cone
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#Basis_Extension">Basis_Extension</a>
    <a href="#Missing_VS_Connect">Missing_VS_Connect</a>
    <a href="#Integral_Bounded_Vectors">Integral_Bounded_Vectors</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> gram_schmidt
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">nonneg_lincomb</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span>lincomb <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">nonneg_lincomb_list</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span>lincomb_list <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">Vs</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finite_cone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set <span class="main">⇒</span> <span class="tfree">'a</span> vec set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finite_cone</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> nonneg_lincomb <span class="bound">c</span> <span class="main">(</span><span class="keyword1">if</span> finite <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set <span class="main">⇒</span> <span class="tfree">'a</span> vec set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cone</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">Ws</span><span class="main">.</span> finite <span class="bound">Ws</span> <span class="main">∧</span> <span class="bound">Ws</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> finite_cone <span class="bound">Ws</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cone_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec list <span class="main">⇒</span> <span class="tfree">'a</span> vec set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cone_list</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> nonneg_lincomb_list <span class="bound">c</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="bound">b</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Cone-finite_cone_iff_cone_list"><span class="command">lemma</span></span> finite_cone_iff_cone_list<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">=</span> set <span class="free">Vsl</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_cone <span class="free">Vs</span> <span class="main">=</span> cone_list <span class="free">Vsl</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Vs id <span class="keyword1"><span class="command">have</span></span> Vsl<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">Vsl</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="free">Vs</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">`</span> <span class="free">Vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> lincomb_as_lincomb_list<span class="main">[</span><span class="operator">OF</span> Vsl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> <span class="free">Vsl</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">Vsl</span> <span class="main">!</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">c</span> <span class="main">(</span><span class="free">Vsl</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">Vsl</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> b<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> nonneg_lincomb_list <span class="bound">c</span> <span class="free">Vsl</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> nonneg_lincomb_list_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> b<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> c<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth id<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="skolem">c</span> <span class="free">Vsl</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">Vsl</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonneg_lincomb <span class="main">(</span>mk_coeff <span class="free">Vsl</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">Vs</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> b<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> nonneg_lincomb_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_list_as_lincomb<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Vsl<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> c<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id mk_coeff_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_list_nonneg<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> nonneg_lincomb <span class="bound">c</span> <span class="free">Vs</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def cone_list_def
      nonneg_lincomb_def nonneg_lincomb_list_def <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-cone_alt_def"><span class="command">lemma</span></span> cone_alt_def<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">Vs</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">Ws</span><span class="main">.</span> set <span class="bound">Ws</span> <span class="main">⊆</span> <span class="free">Vs</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> cone_list <span class="bound">Ws</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cone_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Collect_cong iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Ws</span><span class="main">.</span> finite <span class="bound">Ws</span> <span class="main">∧</span> <span class="bound">Ws</span> <span class="main">⊆</span> <span class="free">Vs</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> finite_cone <span class="bound">Ws</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Ws</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ws</span> <span class="main">⊆</span> <span class="free">Vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> finite_cone <span class="skolem">Ws</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finite_list<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Wsl</span></span> <span class="keyword2"><span class="keyword">where</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ws</span> <span class="main">=</span> set <span class="skolem">Wsl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finite_cone_iff_cone_list<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> *<span class="main">(</span>2-3<span class="main">)</span> Vs
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone_list <span class="skolem">Wsl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> *<span class="main">(</span>2<span class="main">)</span> id <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Wsl</span><span class="main">.</span> set <span class="bound">Wsl</span> <span class="main">⊆</span> <span class="free">Vs</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> cone_list <span class="bound">Wsl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Wsl</span><span class="main">.</span> set <span class="bound">Wsl</span> <span class="main">⊆</span> <span class="free">Vs</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> cone_list <span class="bound">Wsl</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Wsl</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">Wsl</span> <span class="main">⊆</span> <span class="free">Vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone_list <span class="skolem">Wsl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Ws</span><span class="main">.</span> finite <span class="bound">Ws</span> <span class="main">∧</span> <span class="bound">Ws</span> <span class="main">⊆</span> <span class="free">Vs</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> finite_cone <span class="bound">Ws</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Vs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"set <span class="skolem"><span class="skolem"><span class="skolem">Wsl</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> finite_cone_iff_cone_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-cone_mono"><span class="command">lemma</span></span> cone_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> <span class="free">Ws</span> <span class="main">⟹</span> cone <span class="free">Vs</span> <span class="main">⊆</span> cone <span class="free">Ws</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Cone-finite_cone_mono"><span class="command">lemma</span></span> finite_cone_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Ws</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Ws<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Ws</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> <span class="free">Ws</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_cone <span class="free">Vs</span> <span class="main">⊆</span> finite_cone <span class="free">Ws</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> finite_cone <span class="free">Vs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="free">Vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">`</span> <span class="free">Vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def nonneg_lincomb_def <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> sub fin<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Vs</span> <span class="keyword1">then</span> <span class="skolem">c</span> <span class="bound">v</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> c <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">`</span> <span class="free">Ws</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">d</span> <span class="free">Ws</span> <span class="main">=</span> lincomb <span class="skolem">d</span> <span class="main">(</span><span class="free">Ws</span> <span class="main">-</span> <span class="free">Vs</span><span class="main">)</span> <span class="main">+</span> lincomb <span class="skolem">d</span> <span class="free">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_vec_diff_add<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Ws sub fin<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">d</span> <span class="free">Vs</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="free">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Ws sub<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">d</span> <span class="main">(</span><span class="free">Ws</span> <span class="main">-</span> <span class="free">Vs</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Ws sub<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">+</span> lincomb <span class="skolem">c</span> <span class="free">Vs</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ws sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> lincomb <span class="skolem">d</span> <span class="free">Ws</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> finite_cone <span class="free">Ws</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d fin
    <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-finite_cone_carrier"><span class="command">lemma</span></span> finite_cone_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> finite_cone <span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cone-cone_carrier"><span class="command">lemma</span></span> cone_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> cone <span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_cone_carrier <span class="keyword1"><span class="command">unfolding</span></span> cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Cone-cone_iff_finite_cone"><span class="command">lemma</span></span> cone_iff_finite_cone<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> finite_cone <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_cone <span class="free">A</span> <span class="main">⊆</span> cone <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cone_def <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">⊆</span> finite_cone <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cone_def <span class="keyword1"><span class="command">using</span></span> fin finite_cone_mono<span class="main">[</span><span class="operator">OF</span> fin A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-set_in_finite_cone"><span class="command">lemma</span></span> set_in_finite_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> finite_cone <span class="free">Vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Vs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> finite_cone <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> Vsx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?c</span> <span class="free">Vs</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> lincomb <span class="var">?c</span> <span class="main">(</span><span class="free">Vs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_del2 x Vs fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?c</span> <span class="main">(</span><span class="free">Vs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_zero Vsx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">x</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> M.r_zero Vs x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?c</span> <span class="free">Vs</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">`</span> <span class="free">Vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> nonneg_lincomb <span class="bound">c</span> <span class="main">(</span><span class="keyword1">if</span> finite <span class="free">Vs</span> <span class="keyword1">then</span> <span class="free">Vs</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> nonneg_lincomb_def
      <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-set_in_cone"><span class="command">lemma</span></span> set_in_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> cone <span class="free">Vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Vs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cone_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI exI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Vs x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> finite_cone <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_in_finite_cone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∧</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Vs</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> finite_cone <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-zero_in_finite_cone"><span class="command">lemma</span></span> zero_in_finite_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">∈</span> finite_cone <span class="free">Vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Vs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> finite <span class="free">Vs</span> <span class="keyword1">then</span> <span class="free">Vs</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="var">?Vs</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_zero Vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">`</span> <span class="var">?Vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-lincomb_in_finite_cone"><span class="command">lemma</span></span> lincomb_in_finite_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> lincomb <span class="free">l</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">.</span> <span class="free">l</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> finite_cone <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cone_iff_finite_cone assms <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cone-lincomb_in_cone"><span class="command">lemma</span></span> lincomb_in_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> lincomb <span class="free">l</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">.</span> <span class="free">l</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cone <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cone_iff_finite_cone assms <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cone-zero_in_cone"><span class="command">lemma</span></span> zero_in_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span> cone <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">∈</span> finite_cone <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_in_finite_cone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-cone_smult"><span class="command">lemma</span></span> cone_smult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> x Vs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ws</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ws<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ws</span> <span class="main">⊆</span> <span class="free">Vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Ws</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"nonneg_lincomb <span class="skolem">c</span> <span class="skolem">Ws</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cone_def finite_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonneg_lincomb <span class="main">(</span><span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="skolem">Ws</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nonneg_lincomb_def <span class="keyword1"><span class="command">using</span></span> a lincomb_distrib Vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Ws fin <span class="keyword1"><span class="command">unfolding</span></span> cone_def finite_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-finite_cone_empty"><span class="command">lemma</span></span> finite_cone_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite_cone <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_cone_def nonneg_lincomb_def<span class="main">)</span>

<span class="keyword1" id="Cone-cone_empty"><span class="command">lemma</span></span> cone_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1" id="Cone-cone_elem_sum"><span class="command">lemma</span></span> cone_elem_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> Xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Xs</span> <span class="main">⊆</span> <span class="free">Vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin_Xs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Xs_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> finite_cone <span class="skolem">Xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Vs x <span class="keyword1"><span class="command">unfolding</span></span> cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ys</span> <span class="main">⊆</span> <span class="free">Vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin_Ys<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Ys_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> finite_cone <span class="skolem">Ys</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Vs y <span class="keyword1"><span class="command">unfolding</span></span> cone_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> finite_cone <span class="main">(</span><span class="skolem">Xs</span> <span class="main">∪</span> <span class="skolem">Ys</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> finite_cone <span class="main">(</span><span class="skolem">Xs</span> <span class="main">∪</span> <span class="skolem">Ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_cone_mono fin_Xs fin_Ys Xs Ys Vs Xs_cone Ys_cone
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cx</span></span> <span class="skolem"><span class="skolem">cy</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"nonneg_lincomb <span class="skolem">cx</span> <span class="main">(</span><span class="skolem">Xs</span> <span class="main">∪</span> <span class="skolem">Ys</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nonneg_lincomb <span class="skolem">cy</span> <span class="main">(</span><span class="skolem">Xs</span> <span class="main">∪</span> <span class="skolem">Ys</span><span class="main">)</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def <span class="keyword1"><span class="command">using</span></span> fin_Xs fin_Ys <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nonneg_lincomb <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> <span class="skolem">cx</span> <span class="bound">v</span> <span class="main">+</span> <span class="skolem">cy</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Xs</span> <span class="main">∪</span> <span class="skolem">Ys</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nonneg_lincomb_def
    <span class="keyword1"><span class="command">using</span></span> lincomb_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Xs</span> <span class="main">∪</span> <span class="skolem">Ys</span>"</span></span> <span class="quoted"><span class="skolem">cx</span></span> <span class="quoted"><span class="skolem">cy</span></span><span class="main">]</span> fin_Xs fin_Ys Xs Ys Vs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∈</span> finite_cone <span class="main">(</span><span class="skolem">Xs</span> <span class="main">∪</span> <span class="skolem">Ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def <span class="keyword1"><span class="command">using</span></span> fin_Xs fin_Ys <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cone_def <span class="keyword1"><span class="command">using</span></span> fin_Xs fin_Ys Xs Ys <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-cone_cone"><span class="command">lemma</span></span> cone_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span>cone <span class="free">Vs</span><span class="main">)</span> <span class="main">=</span> cone <span class="free">Vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">Vs</span> <span class="main">⊆</span> cone <span class="main">(</span>cone <span class="free">Vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_in_cone<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cone_carrier<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Vs<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span>cone <span class="free">Vs</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="free">Vs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone <span class="main">(</span>cone <span class="free">Vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ws</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ws<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ws</span> <span class="main">⊆</span> cone <span class="free">Vs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"nonneg_lincomb_list <span class="skolem">c</span> <span class="skolem">Ws</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cone_alt_def Vs cone_carrier <span class="keyword1"><span class="command">unfolding</span></span> cone_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ws</span> <span class="main">⊆</span> cone <span class="free">Vs</span> <span class="main">⟹</span> nonneg_lincomb_list <span class="skolem">c</span> <span class="skolem">Ws</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Ws</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nonneg_lincomb_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_in_cone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">Ws</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> nonneg_lincomb_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">a</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cone_smult Vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Ws</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">unfolding</span></span> nonneg_lincomb_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">a</span> <span class="main">+</span> lincomb_list <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Ws</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> nonneg_lincomb_list_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cone_elem_sum Vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ws c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-cone_smult_basis"><span class="command">lemma</span></span> cone_smult_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">`</span> <span class="free">Vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">{</span><span class="free">l</span> <span class="bound">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">v</span> <span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Vs</span><span class="main">}</span> <span class="main">=</span> cone <span class="free">Vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">l</span> <span class="bound">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Vs</span><span class="main">}</span> <span class="main">⊆</span> cone <span class="free">Vs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">l</span> <span class="bound">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Vs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">Vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">l</span> <span class="skolem">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>
        set_in_cone<span class="main">[</span><span class="operator">OF</span> Vs<span class="main">]</span> cone_smult<span class="main">[</span><span class="operator">OF</span> _ Vs<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">{</span><span class="free">l</span> <span class="bound">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Vs</span><span class="main">}</span> <span class="main">⊆</span> cone <span class="free">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cone_mono cone_cone<span class="main">[</span><span class="operator">OF</span> Vs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> lVs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">l</span> <span class="bound">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Vs</span><span class="main">}</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> cone <span class="main">{</span><span class="free">l</span> <span class="bound">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Vs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="skolem">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">∈</span> cone <span class="main">{</span><span class="free">l</span> <span class="bound">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Vs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_in_cone<span class="main">[</span><span class="operator">OF</span> lVs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="free">l</span> <span class="skolem">v</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">l</span> <span class="skolem">v</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">l</span> <span class="skolem">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> cone <span class="main">{</span><span class="free">l</span> <span class="bound">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Vs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cone_smult<span class="main">[</span><span class="operator">OF</span> _ lVs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">l</span> <span class="skolem">v</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">l</span> <span class="skolem">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l v
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_smult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> cone <span class="main">{</span><span class="free">l</span> <span class="bound">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Vs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">Vs</span> <span class="main">⊆</span> cone <span class="main">{</span><span class="free">l</span> <span class="bound">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">Vs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cone_mono cone_cone<span class="main">[</span><span class="operator">OF</span> lVs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-cone_add_cone"><span class="command">lemma</span></span> cone_add_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">C</span> <span class="main">+</span> cone <span class="free">C</span> <span class="main">=</span> cone <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">note</span></span> CC <span class="main">=</span> cone_carrier<span class="main">[</span><span class="operator">OF</span> C<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">C</span> <span class="main">=</span> cone <span class="free">C</span> <span class="main">+</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_0_right_vecset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> CC<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> cone <span class="free">C</span> <span class="main">+</span> cone <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_plus_mono2<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> zero_in_cone<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">C</span> <span class="main">⊆</span> cone <span class="free">C</span> <span class="main">+</span> cone <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> cone_elem_sum<span class="main">[</span><span class="operator">OF</span> C<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">C</span> <span class="main">+</span> cone <span class="free">C</span> <span class="main">⊆</span> cone <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_plus_elim<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-orthogonal_cone"><span class="command">lemma</span></span> orthogonal_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> finX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> spanLW<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="free">Ls</span> <span class="main">∪</span> <span class="free">W</span><span class="main">)</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ortho<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">Ls</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> WWs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">=</span> set <span class="free">Ws</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> spanL<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">=</span> span <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> LX<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">Ls</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lin_Ls_Bs<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> len_Ls_Bs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> set <span class="free">Bs</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">W</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> cone <span class="free">X</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">W</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">Z</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">⊆</span> set <span class="free">Bs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> lincomb <span class="free">c</span> <span class="main">(</span><span class="free">Z</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> lincomb <span class="free">c</span> <span class="main">(</span><span class="free">Z</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> WWs <span class="keyword1"><span class="command">have</span></span> finW<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="free">X</span> <span class="main">∪</span> set <span class="free">Bs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> lin_Ls_Bs<span class="main">[</span><span class="operator">unfolded</span> lin_indpt_list_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    Ls<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">Ls</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Bs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">Bs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    distLsBs<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> LW<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">Ls</span> <span class="main">∩</span> <span class="free">W</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">Ls</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ortho<span class="main">[</span><span class="operator">OF</span> xW xX<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sq_norm <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sq_norm_vec_as_cscalar_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> vs_zero_lin_dep<span class="main">[</span><span class="operator">OF</span> _ lin<span class="main">]</span> xX Ls Bs <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X Bs <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> CLB<span class="main">:</span> <span class="quoted"><span class="quoted">"carrier_vec <span class="free">n</span> <span class="main">=</span> span <span class="main">(</span>set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lin_Ls_Bs len_Ls_Bs lin_indpt_list_length_eq_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> span <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_monotone<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> LX<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="skolem">Y</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> finY<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finX finW <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">Z</span> <span class="skolem">B</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">W</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ZX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> set <span class="free">Bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      xd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">d</span> <span class="main">(</span><span class="skolem">Z</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ZX B X Bs <span class="keyword1"><span class="command">have</span></span> ZB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">∪</span> <span class="skolem">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> xd <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> xX W <span class="keyword1"><span class="command">have</span></span> w0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">w</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> finite_in_span<span class="main">[</span><span class="operator">OF</span> _ _ x<span class="main"><span class="main">[</span></span><span class="operator">folded</span> spanLW<span class="main"><span class="main">]</span></span><span class="main">]</span> Ls X W finW finX
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="main">(</span>set <span class="free">Ls</span> <span class="main">∪</span> <span class="free">W</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="main">(</span>set <span class="free">Ls</span> <span class="main">∪</span> <span class="free">W</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">+</span> lincomb <span class="skolem">c</span> <span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_union<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> X LX W LW finW<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> xsum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">+</span> lincomb <span class="skolem">c</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
      <span class="keyword3"><span class="command">assume</span></span> wW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> W <span class="keyword1"><span class="command">have</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> w0<span class="main">[</span><span class="operator">OF</span> wW<span class="main">,</span> <span class="operator">unfolded</span> xsum<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">∙</span> <span class="main">(</span>lincomb <span class="skolem">c</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">+</span> lincomb <span class="skolem">c</span> <span class="free">W</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">∙</span> lincomb <span class="skolem">c</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">w</span> <span class="main">∙</span> lincomb <span class="skolem">c</span> <span class="free">W</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> scalar_prod_add_distrib<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Ls W<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∙</span> lincomb <span class="skolem">c</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ortho<span class="main">[</span><span class="operator">OF</span> wW<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_scalar_prod_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Ls w<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∙</span> lincomb <span class="skolem">c</span> <span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="free">W</span> <span class="main">∙</span> lincomb <span class="skolem">c</span> <span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> W
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_scalar_prod_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sq_norm <span class="main">(</span>lincomb <span class="skolem">c</span> <span class="free">W</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sq_norm_vec_as_cscalar_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="free">W</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lincomb_closed<span class="main">[</span><span class="operator">OF</span> W<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xsum 0 <span class="keyword1"><span class="command">using</span></span> Ls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> xL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> span <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">-</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">d</span> <span class="var">?X</span> <span class="main">∈</span> span <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ finX<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span><span class="main">]</span> X ZX <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> finite_in_span<span class="main">[</span><span class="operator">OF</span> finite_set Ls this<span class="main"><span class="main">[</span></span><span class="operator">folded</span> spanL<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> ed<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">e</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">=</span> lincomb <span class="skolem">d</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> B finite_subset<span class="main">[</span><span class="operator">OF</span> B<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> finB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> B Bs <span class="keyword1"><span class="command">have</span></span> BC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">Bs</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="keyword1">then</span> <span class="skolem">d</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">Ls</span> <span class="keyword1">then</span> <span class="skolem">e</span> <span class="bound">x</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">d</span> <span class="main">(</span><span class="var">?X</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lincomb <span class="skolem">d</span> <span class="var">?X</span> <span class="main">+</span> lincomb <span class="skolem">d</span> <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_union<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finX<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> ZX X finB B Bs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> xd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">d</span> <span class="var">?X</span> <span class="main">+</span> lincomb <span class="skolem">d</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lincomb <span class="skolem">e</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">+</span> lincomb <span class="skolem">d</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">e</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">=</span> lincomb <span class="skolem">f</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Ls<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> distLsBs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">d</span> <span class="skolem">B</span> <span class="main">=</span> lincomb <span class="skolem">f</span> <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ BC<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">f</span> <span class="skolem">B</span> <span class="main">=</span> lincomb <span class="skolem">f</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">∪</span> <span class="main">(</span>set <span class="free">Bs</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_clean<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> finB Bs B<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∪</span> <span class="main">(</span>set <span class="free">Bs</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> set <span class="free">Bs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">f</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">+</span> lincomb <span class="skolem">f</span> <span class="main">(</span>set <span class="free">Bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">f</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">+</span> lincomb <span class="skolem">f</span> <span class="main">(</span>set <span class="free">Bs</span><span class="main">)</span> <span class="main">=</span> lincomb <span class="skolem">f</span> <span class="main">(</span>set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_union<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Ls distLsBs Bs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">f</span> <span class="main">(</span>set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> UNIV <span class="main">∧</span> lincomb <span class="skolem">f</span> <span class="main">(</span>set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> finite_in_span<span class="main">[</span><span class="operator">OF</span> finite_set Ls xL<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      xg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">g</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">Bs</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">Ls</span> <span class="keyword1">then</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">h</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xg
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Ls<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> distLsBs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lincomb <span class="skolem">h</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">=</span> lincomb <span class="skolem">h</span> <span class="main">(</span>set <span class="free">Bs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_zero<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> Bs<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">h</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span> <span class="main">+</span> lincomb <span class="skolem">h</span> <span class="main">(</span>set <span class="free">Bs</span><span class="main">)</span> <span class="main">=</span> lincomb <span class="skolem">h</span> <span class="main">(</span>set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_union<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Ls Bs distLsBs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">h</span> <span class="main">(</span>set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> UNIV <span class="main">∧</span> lincomb <span class="skolem">h</span> <span class="main">(</span>set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> basis<span class="main">:</span> <span class="quoted"><span class="quoted">"basis <span class="main">(</span>set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lin_Ls_Bs<span class="main">[</span><span class="operator">unfolded</span> lin_indpt_list_def<span class="main">]</span> len_Ls_Bs
      <span class="keyword1"><span class="command">using</span></span> CLB basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> Ls Bs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">Ls</span> <span class="main">@</span> <span class="free">Bs</span><span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> basis<span class="main">[</span><span class="operator">unfolded</span> basis_criterion<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_set this<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x<span class="main">]</span> f h
    <span class="keyword1"><span class="command">have</span></span> fh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">Bs</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">⟹</span> <span class="skolem">d</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">d</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xd
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lincomb_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> BC ZB X<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> M.r_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="skolem">Y</span> <span class="main">∩</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">W</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> cone <span class="free">X</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> cone_carrier<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> cone_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> xX <span class="keyword1"><span class="command">have</span></span> xY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> cone_iff_finite_cone<span class="main">[</span><span class="operator">OF</span> X finX<span class="main">]</span> xX <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> finite_cone <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> finite_cone_def nonneg_lincomb_def<span class="main">]</span> finX <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> finX X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> span <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> spanL <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> span <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> finite_in_span<span class="main">[</span><span class="operator">OF</span> _ Ls this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="main">(</span>set <span class="free">Ls</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
        <span class="keyword3"><span class="command">assume</span></span> wW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> W <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xc <span class="keyword1"><span class="command">using</span></span> ortho<span class="main">[</span><span class="operator">OF</span> wW<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_scalar_prod_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Ls w<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">with</span></span> xY x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">X</span> <span class="main">⊆</span> <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">-</span> set <span class="free">Bs</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?I</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> cone_carrier<span class="main">[</span><span class="operator">OF</span> Y<span class="main">]</span> cone_iff_finite_cone<span class="main">[</span><span class="operator">OF</span> Y finY<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> xY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> finite_cone <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> w0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> xY<span class="main">[</span><span class="operator">unfolded</span> finite_cone_def nonneg_lincomb_def<span class="main">]</span> finY <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> xd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">d</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">`</span> <span class="skolem">Y</span> <span class="main">⊆</span> Collect <span class="main">(</span><span class="main">(≤)</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> main<span class="main">[</span><span class="operator">OF</span> _ _ _ xd<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Y_def<span class="main"><span class="main">]</span></span><span class="main">]</span> w0
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">d</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nonneg_lincomb <span class="skolem">d</span> <span class="var">?X</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nonneg_lincomb_def
        <span class="keyword1"><span class="command">using</span></span> nonneg<span class="main">[</span><span class="operator">unfolded</span> Y_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> finite_cone <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finX
        <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ finX<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">⊆</span> cone <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cone <span class="main">(</span><span class="free">X</span> <span class="main">∪</span> set <span class="free">Bs</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">w</span><span class="main">∈</span><span class="free">W</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> cone <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">polyhedral_cone</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> mat<span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Cone-polyhedral_cone_carrier"><span class="command">lemma</span></span> polyhedral_cone_carrier<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"polyhedral_cone <span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> polyhedral_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cone-cone_in_polyhedral_cone"><span class="command">lemma</span></span> cone_in_polyhedral_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> CA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> polyhedral_cone <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">C</span> <span class="main">⊆</span> polyhedral_cone <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> nr<span class="main">:</span> gram_schmidt <span class="quoted"><span class="free">nr</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> polyhedral_cone_carrier<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cone_carrier<span class="main">[</span><span class="operator">OF</span> C<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x<span class="main">[</span><span class="operator">unfolded</span> cone_alt_def<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span> cone_list_def nonneg_lincomb_list_def<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ll</span></span> <span class="skolem"><span class="skolem">Ds</span></span> <span class="keyword2"><span class="keyword">where</span></span> l0<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="skolem">ll</span> <span class="skolem">Ds</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">Ds</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ll</span> <span class="bound">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> DsC<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ds</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> DsC C <span class="keyword1"><span class="command">have</span></span> Ds<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ds</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>lincomb_list <span class="skolem">ll</span> <span class="skolem">Ds</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> nr.lincomb_list <span class="skolem">ll</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">d</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">d</span><span class="main">)</span> <span class="skolem">Ds</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>set <span class="skolem">Ds</span><span class="main">.</span> dim_vec <span class="bound">w</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DsC C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>set <span class="main">(</span>map <span class="main">(</span><span class="keyword1">(*<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">Ds</span><span class="main">)</span><span class="main">.</span> dim_vec <span class="bound">w</span> <span class="main">=</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A DsC C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="skolem">ll</span> <span class="skolem">Ds</span> <span class="main">=</span> nr.lincomb_list <span class="skolem">ll</span> <span class="main">(</span>map <span class="main">(</span><span class="keyword1">(*<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">Ds</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lincomb_list_as_mat_mult<span class="main">[</span><span class="operator">OF</span> one<span class="main">]</span> nr.lincomb_list_as_mat_mult<span class="main">[</span><span class="operator">OF</span> two<span class="main">]</span> length_map
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> assoc_mult_mat_vec<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="keyword1"><span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span></span> <span class="main"><span class="main">_</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">*</span> mat_of_cols <span class="free">n</span> <span class="skolem">Ds</span> <span class="main">=</span> mat_of_cols <span class="free">nr</span> <span class="main">(</span>map <span class="main">(</span><span class="keyword1">(*<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">Ds</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mat_of_cols_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> A Ds<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> set_conv_nth<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> row <span class="free">A</span> <span class="main">_</span> <span class="main">∙</span> <span class="bound">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> lesseq_vecI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">nr</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map <span class="main">(</span><span class="keyword1">(*<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">Ds</span><span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A Ds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> Carr<span class="main">:</span> <span class="quoted"><span class="quoted">"nr.lincomb_list <span class="skolem">ll</span> <span class="main">(</span>map <span class="main">(</span><span class="keyword1">(*<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">Ds</span><span class="main">)</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nr.lincomb_list_carrier<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> CA<span class="main">[</span><span class="operator">unfolded</span> polyhedral_cone_def<span class="main">]</span> A
    <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nr.lincomb_list <span class="skolem">ll</span> <span class="main">(</span>map <span class="main">(</span><span class="keyword1">(*<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">Ds</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subst nr.lincomb_list_index<span class="main">[</span><span class="operator">OF</span> i *<span class="main">]</span> length_map index_zero_vec<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_nonpos mult_nonneg_nonpos<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Ds</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">Ds</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> j <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">ll</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ds</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DsC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> l2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">Ds</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> lesseq_vecD<span class="main">[</span><span class="operator">OF</span> _ this i<span class="main">]</span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">Ds</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="keyword1">(*<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">Ds</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> polyhedral_cone <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> polyhedral_cone_def <span class="keyword1"><span class="command">using</span></span> A xn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-bounded_cone_is_zero"><span class="command">lemma</span></span> bounded_cone_is_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Ccarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="free">C</span> <span class="main">⊆</span> Bounded_vec <span class="free">bnd</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">C</span> <span class="main">=</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> vC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> cone <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vnz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zero_in_cone assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> vcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vC Ccarr cone_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> vnz vcarr <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_le_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vinz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">bnd</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> abs_ge_bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">M</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">bnd</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vinz<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> aMvC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs <span class="skolem">M</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">∈</span> cone <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cone_smult<span class="main">[</span><span class="operator">OF</span> _ Ccarr vC<span class="main">]</span> abs_ge_bnd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>abs <span class="main">(</span>abs <span class="skolem">M</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">bnd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abs_ge_bnd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs <span class="skolem">M</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">∉</span> Bounded_vec <span class="free">bnd</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def <span class="keyword1"><span class="command">using</span></span> i_le_n aMvC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> aMvC bnd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cone-cone_of_cols"><span class="command">lemma</span></span> cone_of_cols<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">n</span> <span class="free">nr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> cone <span class="main">(</span>set <span class="main">(</span>cols <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>cols <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C'<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>set <span class="main">(</span>cols <span class="free">A</span><span class="main">)</span><span class="main">.</span> dim_vec <span class="bound">w</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?C</span> <span class="main">=</span> True"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>cols <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Aid<span class="main">:</span> <span class="quoted"><span class="quoted">"mat_of_cols <span class="free">n</span> <span class="main">(</span>cols <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">unfolding</span></span> mat_of_cols_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cone_iff_finite_cone<span class="main">[</span><span class="operator">OF</span> C finite_set<span class="main">]</span> finite_cone_iff_cone_list<span class="main">[</span><span class="operator">OF</span> C refl<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cone_list_def nonneg_lincomb_list_def mem_Collect_eq id
    <span class="keyword1"><span class="command">unfolding</span></span> lincomb_list_as_mat_mult<span class="main">[</span><span class="operator">OF</span> C'<span class="main">]</span> id Aid
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≥</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec <span class="free">nr</span> <span class="bound">c</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">nr</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">c</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A b
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span> <span class="main"><span class="main"><span class="main">$</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_vec_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(*<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="free">A</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec <span class="free">nr</span> <span class="skolem">c</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">nr</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≥</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"vec <span class="free"><span class="free"><span class="free">nr</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_vec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec <span class="free">nr</span> <span class="bound">c</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">nr</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">c</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Convex_Hull">
<div class="head">
<h1>Theory Convex_Hull</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Convex Hulls›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the notion of convex hull of a set or list of vectors and derive basic
  properties thereof.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Convex_Hull
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Cone">Cone</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> gram_schmidt
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">convex_lincomb</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span>nonneg_lincomb <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> sum <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">convex_lincomb_list</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span>nonneg_lincomb_list <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> sum <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free"><span class="bound"><span class="entity">Vs</span></span></span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">convex_hull</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">Ws</span> <span class="bound">c</span><span class="main">.</span> finite <span class="bound">Ws</span> <span class="main">∧</span> <span class="bound">Ws</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">∧</span> convex_lincomb <span class="bound">c</span> <span class="bound">Ws</span> <span class="bound">x</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Convex_Hull-convex_hull_carrier"><span class="command">lemma</span></span> convex_hull_carrier<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> convex_hull <span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_def convex_lincomb_def nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Convex_Hull-convex_hull_mono"><span class="command">lemma</span></span> convex_hull_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> <span class="free">Ws</span> <span class="main">⟹</span> convex_hull <span class="free">Vs</span> <span class="main">⊆</span> convex_hull <span class="free">Ws</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Convex_Hull-convex_lincomb_empty"><span class="command">lemma</span></span> convex_lincomb_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>convex_lincomb <span class="free">c</span> <span class="main">{}</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> convex_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Convex_Hull-set_in_convex_hull"><span class="command">lemma</span></span> set_in_convex_hull<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> convex_hull <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> acarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"convex_lincomb <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="skolem">a</span> "</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_lincomb_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nonneg_lincomb_def lincomb_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> convex_hull <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Convex_Hull-convex_hull_empty"><span class="command">lemma</span></span> convex_hull_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"convex_hull <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> convex_hull <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convex_hull <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> convex_hull <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_in_convex_hull<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Convex_Hull-convex_hull_bound"><span class="command">lemma</span></span> convex_hull_bound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> XBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex_hull <span class="free">X</span> <span class="main">⊆</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> convex_hull <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> convex_hull_def<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cx<span class="main">:</span> <span class="quoted"><span class="quoted">"convex_lincomb <span class="skolem">c</span> <span class="skolem">Y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> cx<span class="main">[</span><span class="operator">unfolded</span> convex_lincomb_def nonneg_lincomb_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟹</span> <span class="skolem">c</span> <span class="bound">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> YX X XBnd <span class="keyword1"><span class="command">have</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> Bounded_vec <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x Y <span class="keyword1"><span class="command">have</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">x</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Bounded_vec <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def mem_Collect_eq dim
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> abs <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Y</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_index<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i Y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Y</span><span class="main">.</span> abs <span class="main">(</span><span class="skolem">c</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Y</span><span class="main">.</span> abs <span class="main">(</span><span class="skolem">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> abs <span class="main">(</span><span class="bound">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Y</span><span class="main">.</span> abs <span class="main">(</span><span class="skolem">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_left_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> YBnd<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Bounded_vec_def<span class="main"><span class="main">]</span></span> i Y<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Y</span><span class="main">.</span> abs <span class="main">(</span><span class="skolem">c</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">Bnd</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_right<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Y</span><span class="main">.</span> abs <span class="main">(</span><span class="skolem">c</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Y</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> c0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">convex_hull_list</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> convex_lincomb_list <span class="bound">c</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="bound">x</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Convex_Hull-lincomb_list_elem"><span class="command">lemma</span></span> lincomb_list_elem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span>
   lincomb_list <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">i</span><span class="main">=</span><span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="free">Vs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">Vs</span> <span class="keyword1">then</span> <span class="free">Vs</span> <span class="main">!</span> <span class="free">i</span> <span class="keyword1">else</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Vs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">Vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snoc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="var">?f</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> lincomb_list <span class="var">?f</span> <span class="skolem">Vs</span> <span class="main">+</span> <span class="var">?f</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x Vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="keyword1">else</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> less_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">Vs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="skolem">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">Vs</span> <span class="main">=</span> <span class="skolem">Vs</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> snoc.IH<span class="main">[</span><span class="operator">OF</span> Vs<span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> length <span class="skolem">Vs</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="keyword1">else</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Vs</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i append_Cons_nth_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword1"><span class="command">using</span></span> Vs i lincomb_list_carrier M.r_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> length <span class="skolem">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">Vs</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> snoc.IH<span class="main">[</span><span class="operator">OF</span> Vs<span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> length <span class="skolem">Vs</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="keyword1">else</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i append_Cons_nth_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&gt;</span> length <span class="skolem">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">Vs</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> snoc.IH<span class="main">[</span><span class="operator">OF</span> Vs<span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> length <span class="skolem">Vs</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="keyword1">else</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Convex_Hull-set_in_convex_hull_list"><span class="command">lemma</span></span> set_in_convex_hull_list<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Vs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">Vs</span> <span class="main">⊆</span> convex_hull_list <span class="free">Vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">Vs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">Vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">Vs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Vs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="var">?f</span> <span class="free">Vs</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i x lincomb_list_elem<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> length <span class="free">Vs</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">j</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">Vs</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> convex_hull_list <span class="free">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_list_def convex_lincomb_list_def nonneg_lincomb_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Convex_Hull-convex_hull_list_combination"><span class="command">lemma</span></span> convex_hull_list_combination<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> convex_hull_list <span class="free">Vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> convex_hull_list <span class="free">Vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> l0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span> <span class="main">∈</span> convex_hull_list <span class="free">Vs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cx</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="skolem">cx</span> <span class="free">Vs</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cx0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">Vs</span><span class="main">.</span> <span class="skolem">cx</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cx1<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">cx</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">Vs</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_list_def convex_lincomb_list_def nonneg_lincomb_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> y <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cy</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="skolem">cy</span> <span class="free">Vs</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cy0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">Vs</span><span class="main">.</span> <span class="skolem">cy</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cy1<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">cy</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">Vs</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_list_def convex_lincomb_list_def nonneg_lincomb_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">l</span> <span class="main">*</span> <span class="skolem">cx</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">cy</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span>
        lincomb_list <span class="var">?c</span> <span class="free">Vs</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="skolem">cx</span> <span class="free">Vs</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="skolem">cy</span> <span class="free">Vs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Vs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">v</span> <span class="skolem">Vs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> snoc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="var">?c</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> lincomb_list <span class="var">?c</span> <span class="skolem">Vs</span> <span class="main">+</span> <span class="var">?c</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> snoc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="var">?c</span> <span class="skolem">Vs</span> <span class="main">=</span>
               <span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="skolem">cx</span> <span class="skolem">Vs</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="skolem">cy</span> <span class="skolem">Vs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> snoc.IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Vs<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">=</span>
               <span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">cx</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">cy</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_smult_distrib_vec smult_smult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="skolem">cx</span> <span class="skolem">Vs</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="skolem">cy</span> <span class="skolem">Vs</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span>
                  <span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>lincomb_list <span class="skolem">cx</span> <span class="skolem">Vs</span> <span class="main">+</span> <span class="skolem">cx</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">+</span>
                  <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>lincomb_list <span class="skolem">cy</span> <span class="skolem">Vs</span> <span class="main">+</span> <span class="skolem">cy</span> <span class="main">(</span>length <span class="skolem">Vs</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_list_carrier<span class="main">[</span><span class="operator">OF</span> Vs<span class="main">]</span> v
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M.add.m_assoc M.add.m_lcomm smult_r_distr<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Vs v <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="var">?c</span> <span class="free">Vs</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Vs x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">Vs</span><span class="main">.</span> <span class="var">?c</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cx0 cy0 l0 l1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?c</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">Vs</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>length <span class="free">Vs</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">cy</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">*</span> sum <span class="skolem">cy</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">Vs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>length <span class="free">Vs</span><span class="main">.</span> <span class="free">l</span> <span class="main">*</span> <span class="skolem">cx</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span> <span class="main">*</span> sum <span class="skolem">cx</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">Vs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>length <span class="free">Vs</span><span class="main">.</span> <span class="free">l</span> <span class="main">*</span> <span class="skolem">cx</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>length <span class="free">Vs</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">cy</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cx1 cy1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_list_def convex_lincomb_list_def nonneg_lincomb_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Convex_Hull-convex_hull_list_mono"><span class="command">lemma</span></span> convex_hull_list_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">Ws</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">Vs</span> <span class="main">⊆</span> set <span class="free">Ws</span> <span class="main">⟹</span> convex_hull_list <span class="free">Vs</span> <span class="main">⊆</span> convex_hull_list <span class="free">Ws</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">Vs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_list_def convex_lincomb_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">Vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> set <span class="free">Ws</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Vs</span> <span class="main">⊆</span> set <span class="free">Ws</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> convex_hull_list <span class="free">Ws</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_in_convex_hull_list<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="skolem">c</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">Vs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">Vs</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vs</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_list_def convex_lincomb_list_def nonneg_lincomb_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">+</span> lincomb_list <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Vs v assms x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vs</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.atLeast0_lessThan_Suc_shift c1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def R.show_r_zero add.right_neutral add_Suc_right<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vs</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vs</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_nonneg_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="skolem">Vs</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="bound">i</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">Vs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Vs assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Vs</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_list_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P x v assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> v1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">next</span></span>

    <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span> <span class="main">+</span> sum <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vs</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.atLeast0_lessThan_Suc_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vs</span><span class="main">}</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> c0<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">c</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?c'</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vs</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">c</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> sum <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c1 P sum_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?c'</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vs</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">Vs</span><span class="main">.</span> <span class="var">?c'</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="var">?c'</span> <span class="skolem">Vs</span> <span class="main">∈</span> convex_hull_list <span class="free">Ws</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Vs<span class="main">]</span>
        convex_hull_list_def convex_lincomb_list_def nonneg_lincomb_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb_list <span class="var">?c'</span> <span class="skolem">Vs</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">c</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Vs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> lincomb_list_smult<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Vs assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">c</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="var">?c'</span> <span class="skolem">Vs</span> <span class="main">=</span> lincomb_list <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Vs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">c</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb_list <span class="var">?c'</span> <span class="skolem">Vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> convex_hull_list <span class="free">Ws</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> convex_hull_list_combination<span class="main">[</span><span class="operator">OF</span> assms v1 c'<span class="main">]</span> c0 <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Convex_Hull-convex_hull_list_eq_set"><span class="command">lemma</span></span> convex_hull_list_eq_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> set <span class="free">Vs</span> <span class="main">=</span> set <span class="free">Ws</span> <span class="main">⟹</span> convex_hull_list <span class="free">Vs</span> <span class="main">=</span> convex_hull_list <span class="free">Ws</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> convex_hull_list_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Convex_Hull-find_indices_empty"><span class="command">lemma</span></span> find_indices_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>find_indices <span class="free">x</span> <span class="free">Vs</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∉</span> set <span class="free">Vs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Vs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">v</span> <span class="skolem">Vs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"find_indices <span class="free">x</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">v</span> <span class="main">∧</span> find_indices <span class="free">x</span> <span class="skolem">Vs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">v</span> <span class="main">∧</span> find_indices <span class="free">x</span> <span class="skolem">Vs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"find_indices <span class="free">x</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Convex_Hull-distinct_list_find_indices"><span class="command">lemma</span></span> distinct_list_find_indices<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">Vs</span><span class="main">;</span> <span class="free">Vs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span> distinct <span class="free">Vs</span> <span class="main">⟧</span> <span class="main">⟹</span> find_indices <span class="free">x</span> <span class="free">Vs</span> <span class="main">=</span> <span class="main">[</span><span class="free">i</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Vs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">v</span> <span class="skolem">Vs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">Vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xVs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> set <span class="skolem">Vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> length <span class="skolem">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> xVs find_indices_empty i
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> length <span class="skolem">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="skolem">Vs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> Vsi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Vs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>2<span class="main">)</span> append_Cons_nth_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>3<span class="main">)</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc.IH<span class="main">[</span><span class="operator">OF</span> i Vsi dist<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Convex_Hull-finite_convex_hull_iff_convex_hull_list"><span class="command">lemma</span></span> finite_convex_hull_iff_convex_hull_list<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> id'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">=</span> set <span class="free">Vsl'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex_hull <span class="free">Vs</span> <span class="main">=</span> convex_hull_list <span class="free">Vsl'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Vs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finite_distinct_list fin <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Vsl</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">=</span> set <span class="skolem">Vsl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">Vsl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Vs id <span class="keyword1"><span class="command">have</span></span> Vsl<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Vsl</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">Vsl</span> <span class="main">⟹</span><span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">Vsl</span><span class="main">.</span> sum_list <span class="main">(</span>map <span class="skolem">c</span> <span class="main">(</span>find_indices <span class="bound">x</span> <span class="skolem">Vsl</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                          sum <span class="skolem">c</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vsl</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">Vsl</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">v</span> <span class="skolem">Vsl</span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?coef</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> sum_list <span class="main">(</span>map <span class="skolem">c</span> <span class="main">(</span>find_indices <span class="bound">x</span> <span class="main">(</span><span class="skolem">Vsl</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?coef'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> sum_list <span class="main">(</span>map <span class="skolem">c</span> <span class="main">(</span>find_indices <span class="bound">x</span> <span class="skolem">Vsl</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">Vsl</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> snoc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?coef</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">Vsl</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="var">?coef</span> <span class="main">(</span><span class="skolem">Vsl</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.distinct_set_conv_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> snoc.prems<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?coef</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="var">?coef</span> <span class="skolem">Vsl</span><span class="main">)</span> <span class="main">+</span> <span class="var">?coef</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="var">?coef</span> <span class="skolem">Vsl</span><span class="main">)</span> <span class="main">=</span> sum <span class="var">?coef</span> <span class="main">(</span>set <span class="skolem">Vsl</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum.distinct_set_conv_list<span class="main">[</span><span class="operator">OF</span> dist<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?coef</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="var">?coef'</span> <span class="main">(</span>set <span class="skolem">Vsl</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> R.finsum_restrict<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?coef</span></span></span></span></span><span class="main"><span class="main">]</span></span> restrict_ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">Vsl</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">Vsl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">Vsl</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> in_set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">Vsl</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Vsl</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_Cons_nth_left<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?coef</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">c</span> <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> distinct_list_find_indices<span class="main">[</span><span class="operator">OF</span> _ _ snoc.prems<span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?coef'</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> distinct_list_find_indices<span class="main">[</span><span class="operator">OF</span> i _ dist<span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?coef</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?coef'</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="skolem">c</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vsl</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> snoc.IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dist<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?coef</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">(</span>length <span class="skolem">Vsl</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> distinct_list_find_indices<span class="main">[</span><span class="operator">OF</span> _ _ snoc.prems<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">Vsl</span>"</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
          nth_append_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> sum.atLeast0_lessThan_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> sum_sumlist <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> convex_hull_list <span class="skolem">Vsl</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="skolem">c</span> <span class="skolem">Vsl</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">Vsl</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vsl</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_list_def convex_lincomb_list_def nonneg_lincomb_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex_lincomb <span class="main">(</span>mk_coeff <span class="skolem">Vsl</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">Vs</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> b<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> convex_lincomb_def nonneg_lincomb_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_list_as_lincomb<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Vsl<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> c c1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id mk_coeff_def dist sum_sumlist <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_list_nonneg<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> convex_hull <span class="free">Vs</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_def convex_lincomb_def <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> convex_hull <span class="free">Vs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">Ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ws<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ws</span> <span class="main">⊆</span> <span class="free">Vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="skolem">Ws</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">`</span> <span class="skolem">Ws</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="skolem">Ws</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_def convex_lincomb_def nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Ws</span> <span class="keyword1">then</span> <span class="skolem">c</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?d</span> <span class="free">Vs</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="skolem">Ws</span> <span class="main">+</span> lincomb <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">Vs</span> <span class="main">-</span> <span class="skolem">Ws</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_union2<span class="main">[</span><span class="operator">OF</span> _ _ Diff_disjoint<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">Ws</span></span> <span class="quoted"><span class="free">Vs</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span>"</span></span><span class="main">]</span>
        fin Vs Diff_partition<span class="main">[</span><span class="operator">OF</span> Ws<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">Vs</span> <span class="main">-</span> <span class="skolem">Ws</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Vs</span> <span class="main">-</span> <span class="skolem">Ws</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span>"</span></span><span class="main">]</span> Vs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?d</span> <span class="free">Vs</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b lincomb_closed Vs Ws <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">`</span> <span class="free">Vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?d</span> <span class="free">Vs</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  c1 R.extend_sum<span class="main">[</span><span class="operator">OF</span> fin Ws<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> convex_lincomb <span class="bound">c</span> <span class="free">Vs</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> convex_lincomb_def nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> convex_lincomb <span class="bound">c</span> <span class="free">Vs</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="free">Vs</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">`</span> <span class="free">Vs</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="free">Vs</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> convex_lincomb_def nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> lincomb_as_lincomb_list_distinct<span class="main">[</span><span class="operator">OF</span> Vsl dist<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="skolem">Vsl</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Vsl</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> b<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> sum <span class="skolem">c</span> <span class="main">(</span>set <span class="skolem">Vsl</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="skolem">c</span> <span class="skolem">Vsl</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> sum.distinct_set_conv_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dist<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">(!)</span> <span class="main">(</span>map <span class="skolem">c</span> <span class="skolem">Vsl</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vsl</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_sum_nth length_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="skolem">Vsl</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vsl</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> sum_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Vsl</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="skolem">Vsl</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> convex_lincomb_list <span class="bound">c</span> <span class="skolem">Vsl</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> convex_lincomb_list_def nonneg_lincomb_list_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">Vsl</span></span></span> <span class="main"><span class="main"><span class="main">!</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> conjI b sum_1<span class="main">)</span>
        <span class="main">(</span><span class="operator">insert</span> c<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth id<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> convex_hull_list <span class="skolem">Vsl</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex_hull <span class="free">Vs</span> <span class="main">=</span> convex_hull_list <span class="skolem">Vsl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex_hull_list <span class="skolem">Vsl</span> <span class="main">=</span> convex_hull_list <span class="free">Vsl'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> convex_hull_list_eq_set<span class="main">[</span><span class="operator">OF</span> Vsl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">Vsl'</span></span><span class="main">]</span> id id' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">convex</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span>convex_hull <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Convex_Hull-convex_convex_hull"><span class="command">lemma</span></span> convex_convex_hull<span class="main">:</span> <span class="quoted"><span class="quoted">"convex <span class="free">S</span> <span class="main">⟹</span> convex_hull <span class="free">S</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> convex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Convex_Hull-convex_hull_convex_hull_listD"><span class="command">lemma</span></span> convex_hull_convex_hull_listD<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> convex_hull <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">as</span><span class="main">.</span> set <span class="bound">as</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> convex_hull_list <span class="bound">as</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> x<span class="main">[</span><span class="operator">unfolded</span> convex_hull_def<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> finX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> XA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"convex_lincomb <span class="skolem">c</span> <span class="skolem">X</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> convex_hull <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finite_list<span class="main">[</span><span class="operator">OF</span> finX<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> set <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finite_convex_hull_iff_convex_hull_list<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> x XA A <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> convex_hull_list <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> XA <span class="keyword1"><span class="command">unfolding</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Convex_Hull-convex_hull_convex_sum"><span class="command">lemma</span></span> convex_hull_convex_sum<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> convex_hull <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> convex_hull <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span> <span class="main">∈</span> convex_hull <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> convex_hull_convex_hull_listD<span class="main">[</span><span class="operator">OF</span> A x<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> convex_hull_list <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> convex_hull_convex_hull_listD<span class="main">[</span><span class="operator">OF</span> A y<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ys</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> convex_hull_list <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs ys <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> convex_hull_list_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span> x sub A <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> convex_hull_list <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> convex_hull_list_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">]</span> y sub A <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> convex_hull_list <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> convex_hull_list_combination<span class="main">[</span><span class="operator">OF</span> _ x y a<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span> <span class="main">∈</span> convex_hull_list <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sub A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finite_convex_hull_iff_convex_hull_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span>"</span></span><span class="main">]</span> this sub A
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span> <span class="main">∈</span> convex_hull <span class="main">(</span>set <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> convex_hull_mono<span class="main">[</span><span class="operator">OF</span> sub<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">y</span> <span class="main">∈</span> convex_hull <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Convex_Hull-convexI"><span class="command">lemma</span></span> convexI<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> convex_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> convex_hull <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> convex_hull_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> WS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"convex_lincomb <span class="skolem">c</span> <span class="skolem">W</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">W</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">w</span> <span class="skolem">W</span> <span class="skolem">c</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex_lincomb <span class="skolem">c</span> <span class="main">(</span>insert <span class="skolem">w</span> <span class="skolem">W</span><span class="main">)</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">hence</span></span> zl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="main">(</span>insert <span class="skolem">w</span> <span class="skolem">W</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="skolem">W</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="bound">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> cw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">w</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="main">(</span>insert <span class="skolem">w</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> convex_lincomb_def nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> zl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">c</span> <span class="skolem">w</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">w</span> <span class="main">+</span> lincomb <span class="skolem">c</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> zl
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_insert2<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> insert S<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">w</span> <span class="main">+</span> sum <span class="skolem">c</span> <span class="skolem">W</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="skolem">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> nonneg <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="skolem">W</span> <span class="main">⟹</span> <span class="skolem">c</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert<span class="main">(</span>1<span class="main">)</span> sum_nonneg_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> sum <span class="keyword1"><span class="command">have</span></span> cw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">w</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> lin0<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="skolem">W</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_zero W<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> c0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> zl cw lin0 <span class="keyword1"><span class="command">using</span></span> w <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> insert<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="skolem">W</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonneg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sum_nonneg<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="skolem">W</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> inverse <span class="main">(</span>sum <span class="skolem">c</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex_lincomb <span class="skolem">b</span> <span class="skolem">W</span> <span class="main">(</span>lincomb <span class="skolem">b</span> <span class="skolem">W</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> convex_lincomb_def nonneg_lincomb_def b_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI refl<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> inverse <span class="main">(</span>sum <span class="skolem">c</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">W</span> <span class="main">⊆</span> Collect <span class="main">(</span><span class="main">(≤)</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonneg pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span><span class="skolem">W</span><span class="main">.</span> inverse <span class="main">(</span>sum <span class="skolem">c</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="bound">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_distrib_left<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> insert<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> insert
      <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">b</span> <span class="skolem">W</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="skolem">W</span> <span class="main">=</span> sum <span class="skolem">c</span> <span class="skolem">W</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb <span class="skolem">b</span> <span class="skolem">W</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> b_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_smult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> W<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> lincomb_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ W<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> False<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sum cw pos <span class="keyword1"><span class="command">have</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="skolem">W</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">c</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cw1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> zl lin <span class="keyword1"><span class="command">unfolding</span></span> sum
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ IH cw cw1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> convex_hull <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_in_convex_hull<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Convex_Hull-convex_hulls_are_convex"><span class="command">lemma</span></span> convex_hulls_are_convex<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>convex_hull <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> convexI convex_hull_convex_sum convex_hull_carrier assms<span class="main">)</span>

<span class="keyword1" id="Convex_Hull-convex_hull_sum"><span class="command">lemma</span></span> convex_hull_sum<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex_hull <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> convex_hull <span class="free">A</span> <span class="main">+</span> convex_hull <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">note</span></span> cA <span class="main">=</span> convex_hull_carrier<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> cB <span class="main">=</span> convex_hull_carrier<span class="main">[</span><span class="operator">OF</span> B<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>convex_hull <span class="free">A</span> <span class="main">+</span> convex_hull <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> convexI sum_carrier_vec convex_hull_carrier A B<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> convex_hull <span class="free">A</span> <span class="main">+</span> convex_hull <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> convex_hull <span class="free">A</span> <span class="main">+</span> convex_hull <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      x12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="skolem">y1</span> <span class="main">+</span> <span class="skolem">z1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> <span class="skolem">y2</span> <span class="main">+</span> <span class="skolem">z2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      y12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">∈</span> convex_hull <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">∈</span> convex_hull <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      z12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span> <span class="main">∈</span> convex_hull <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z2</span> <span class="main">∈</span> convex_hull <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> y12 z12 cA cB <span class="keyword1"><span class="command">have</span></span> carr<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">z1</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z2</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y2</span> <span class="main">∈</span> convex_hull <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y12 a A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> convex_hull_convex_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">z1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">z2</span> <span class="main">∈</span> convex_hull <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z12 a B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> convex_hull_convex_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y1</span> <span class="main">+</span> <span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">z1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y2</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">z2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x12
      <span class="keyword1"><span class="command">using</span></span> carr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> smult_add_distrib_vec<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">z1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">z2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> carr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span> <span class="main">∈</span> convex_hull <span class="free">A</span> <span class="main">+</span> convex_hull <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> convex_convex_hull<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"convex_hull <span class="main">(</span>convex_hull <span class="free">A</span> <span class="main">+</span> convex_hull <span class="free">B</span><span class="main">)</span> <span class="main">=</span> convex_hull <span class="free">A</span> <span class="main">+</span> convex_hull <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convex_hull <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> convex_hull <span class="free">A</span> <span class="main">+</span> convex_hull <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> convex_hull_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set_plus_mono2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> set_in_convex_hull A B<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convex_hull <span class="free">A</span> <span class="main">+</span> convex_hull <span class="free">B</span> <span class="main">⊆</span> convex_hull <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> convex_hull <span class="free">A</span> <span class="main">+</span> convex_hull <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> convex_hull <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> convex_hull <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_plus_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> convex_hull_convex_hull_listD<span class="main">[</span><span class="operator">OF</span> A y<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> ysA<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ys</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> convex_hull_list <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> convex_hull_convex_hull_listD<span class="main">[</span><span class="operator">OF</span> B z<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> zsB<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">zs</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> convex_hull_list <span class="skolem">zs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> y<span class="main">[</span><span class="operator">unfolded</span> convex_hull_list_def convex_lincomb_list_def nonneg_lincomb_list_def<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> yid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> lincomb_list <span class="skolem">c</span> <span class="skolem">ys</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> conv_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">ys</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> sum <span class="skolem">c</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">ys</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> z<span class="main">[</span><span class="operator">unfolded</span> convex_hull_list_def convex_lincomb_list_def nonneg_lincomb_list_def<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> zid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> lincomb_list <span class="skolem">d</span> <span class="skolem">zs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> conv_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">zs</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> sum <span class="skolem">d</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">zs</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ysA A <span class="keyword1"><span class="command">have</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ys</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> zsB B <span class="keyword1"><span class="command">have</span></span> zs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">zs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="skolem">x</span> <span class="skolem">ys</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> lincomb_list_carrier<span class="main">[</span><span class="operator">OF</span> ys<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="skolem">x</span> <span class="skolem">zs</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> lincomb_list_carrier<span class="main">[</span><span class="operator">OF</span> zs<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>lincomb_list <span class="skolem">d</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> yid <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> zid <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">(+)</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="skolem">zs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">zs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> set <span class="skolem">zs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> zsj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?list</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">+</span> <span class="skolem">zs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?set</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="var">?list</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?set</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ys A zsj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> lin_map<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="skolem">c</span> <span class="var">?list</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_list_carrier<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">zs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> lincomb_list <span class="skolem">c</span> <span class="var">?list</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> yid <span class="keyword1"><span class="command">using</span></span> zsj lin_map lincomb_list_index<span class="main">[</span><span class="operator">OF</span> _ set<span class="main">]</span> lincomb_list_index<span class="main">[</span><span class="operator">OF</span> _ ys<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> sum_distrib_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> conv_c<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"convex_lincomb_list <span class="skolem">c</span> <span class="var">?list</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">zs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> convex_lincomb_list_def nonneg_lincomb_list_def <span class="keyword1"><span class="command">using</span></span> conv_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">zs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> convex_hull_list <span class="var">?list</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> finite_convex_hull_iff_convex_hull_list<span class="main">[</span><span class="operator">OF</span> set refl<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">zs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> convex_hull <span class="var">?set</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> convex_hull <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> convex_hull_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> mem ys ysA zsB<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_plus_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> convex_hull <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> step1 <span class="main">=</span> this
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?list</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">(+)</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">zs</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?set</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="var">?list</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?set</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zs B y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> lin_map<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb_list <span class="skolem">d</span> <span class="var">?list</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_list_carrier<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">zs</span><span class="main">.</span> <span class="skolem">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">zs</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">zs</span><span class="main">.</span> <span class="skolem">d</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">zs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> zs<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> set_conv_nth<span class="main"><span class="main">]</span></span> y<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> lincomb_list <span class="skolem">d</span> <span class="var">?list</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> zid <span class="keyword1"><span class="command">using</span></span> y zs lin_map lincomb_list_index<span class="main">[</span><span class="operator">OF</span> _ set<span class="main">]</span> lincomb_list_index<span class="main">[</span><span class="operator">OF</span> _ zs<span class="main">]</span>
          set lincomb_list_carrier<span class="main">[</span><span class="operator">OF</span> zs<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> zs<span class="main">[</span><span class="operator">unfolded</span> set_conv_nth<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> sum_distrib_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> conv_d<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"convex_lincomb_list <span class="skolem">d</span> <span class="var">?list</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x
        <span class="keyword1"><span class="command">unfolding</span></span> convex_lincomb_list_def nonneg_lincomb_list_def <span class="keyword1"><span class="command">using</span></span> conv_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> convex_hull_list <span class="var">?list</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> finite_convex_hull_iff_convex_hull_list<span class="main">[</span><span class="operator">OF</span> set refl<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> convex_hull <span class="var">?set</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> convex_hull <span class="main">(</span>convex_hull <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> convex_hull_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> step1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> convex_hull <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> convex_convex_hull<span class="main"><span class="main">[</span></span><span class="operator">OF</span> convex_hulls_are_convex<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> sum_carrier_vec A B<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> convex_hull <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Convex_Hull-convex_hull_in_cone"><span class="command">lemma</span></span> convex_hull_in_cone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"convex_hull <span class="free">C</span> <span class="main">⊆</span> cone <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> convex_hull_def cone_def convex_lincomb_def finite_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Convex_Hull-convex_cone"><span class="command">lemma</span></span> convex_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>cone <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> convex_def
  <span class="keyword1"><span class="command">using</span></span> convex_hull_in_cone set_in_convex_hull<span class="main">[</span><span class="operator">OF</span> cone_carrier<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span><span class="main">]</span> cone_cone<span class="main">[</span><span class="operator">OF</span> C<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Normal_Vector">
<div class="head">
<h1>Theory Normal_Vector</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Normal Vectors›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We provide a function for the normal vector of a half-space (given as n-1 linearly
  independent vectors).
  We further provide a function that returns a list of normal vectors that span the
  orthogonal complement of some subspace of $R^n$.
  Bounds for all normal vectors are provided.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Normal_Vector
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#Integral_Bounded_Vectors">Integral_Bounded_Vectors</a>
    <a href="#Basis_Extension">Basis_Extension</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> gram_schmidt
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="comment1">(* TODO move *)</span>
<span class="keyword1" id="Normal_Vector-ortho_sum_in_span"><span class="command">lemma</span></span> ortho_sum_in_span<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ortho<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inspan<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="free">l1</span> <span class="free">X</span> <span class="main">+</span> lincomb <span class="free">l2</span> <span class="free">W</span> <span class="main">∈</span> span <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="free">l2</span> <span class="free">W</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lincomb <span class="free">l2</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> W <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> vspan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> span <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> W <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> vnz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lincomb <span class="free">l1</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> xcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> xspan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> span <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X xcarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> sq_norm <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vnz vcarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sq_norm <span class="var">?v</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> <span class="var">?v</span> <span class="main">∙</span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sq_norm_vec_as_cscalar_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">∙</span> <span class="var">?v</span> <span class="main">+</span> <span class="var">?v</span> <span class="main">∙</span> <span class="var">?v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ortho_span_span<span class="main"><span class="main">[</span></span><span class="operator">OF</span> X W ortho<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> X W<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="var">?v</span> <span class="main">)</span> <span class="main">∙</span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xcarr vcarr
    <span class="keyword1"><span class="command">using</span></span> add_scalar_prod_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ortho_span_span<span class="main"><span class="main">[</span></span><span class="operator">OF</span> X W ortho inspan vspan<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO move *)</span>
<span class="keyword1" id="Normal_Vector-ortho_lin_indpt"><span class="command">lemma</span></span> ortho_lin_indpt<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ortho<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> linW<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> linX<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span><span class="free">W</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> zerocomb<span class="main">:</span><span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="main">(</span><span class="free">W</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> notallz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="main">(</span><span class="free">W</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms fin_dim fin_dim_li_fin finite_lin_indpt2 infinite_Un le_sup_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> zero_nin_W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">∉</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vs_zero_lin_dep<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> WXinters<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∩</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span> <span class="free">W</span> <span class="main">∩</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∙</span><span class="skolem">v</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ortho <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sq_norm_vec_as_cscalar_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> zero_nin_W v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> finX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X linX <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_dim_li_fin<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> finW<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> W linW <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_dim_li_fin<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> split<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="main">(</span><span class="free">W</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="free">X</span> <span class="main">+</span> lincomb <span class="skolem">c</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_union<span class="main">[</span><span class="operator">OF</span> W X WXinters finW finX<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M.add.m_comm W X<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="free">X</span> <span class="main">+</span> lincomb <span class="skolem">c</span> <span class="free">W</span>  <span class="main">∈</span> span <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zerocomb
    <span class="keyword1"><span class="command">using</span></span> local.span_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> z1<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="free">W</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ortho_sum_in_span<span class="main">[</span><span class="operator">OF</span> W X ortho<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> z2<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">c</span> <span class="free">X</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> split zerocomb X <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> or<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">W</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v</span><span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> notallz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">W</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> linW
    <span class="keyword1"><span class="command">using</span></span> finW lin_dep_def z1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> ex2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">v</span><span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> linX
    <span class="keyword1"><span class="command">using</span></span> finX lin_dep_def z2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ex1 ex2 or <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normal_vector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">normal_vector</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ws</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">ws</span><span class="main">.</span> set <span class="bound">ws</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">∧</span> distinct <span class="bound">ws</span><span class="main">)</span><span class="main">;</span>
     <span class="bound">m</span> <span class="main">=</span> length <span class="bound">ws</span><span class="main">;</span>
     <span class="bound">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> mat <span class="bound">m</span> <span class="bound">m</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span><span class="main">.</span> <span class="bound">ws</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">j'</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="bound">j'</span> <span class="keyword1">else</span> Suc <span class="bound">j'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">in</span> vec <span class="free">n</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">m</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span> <span class="main">*</span> det <span class="main">(</span><span class="bound">B</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Normal_Vector-normal_vector"><span class="command">lemma</span></span> normal_vector<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="free">W</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal_vector <span class="free">W</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="quoted"><span class="quoted">"normal_vector <span class="free">W</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">∙</span> normal_vector <span class="free">W</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> normal_vector <span class="free">W</span> <span class="main">∙</span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>insert <span class="main">(</span>normal_vector <span class="free">W</span><span class="main">)</span> <span class="free">W</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"normal_vector <span class="free">W</span> <span class="main">∉</span> <span class="free">W</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span> <span class="main">⟹</span> normal_vector <span class="free">W</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">ws</span><span class="main">.</span> set <span class="bound">ws</span> <span class="main">=</span> <span class="free">W</span> <span class="main">∧</span> distinct <span class="bound">ws</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> finite_distinct_list<span class="main">[</span><span class="operator">OF</span> fin<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">ws</span><span class="main">.</span> set <span class="bound">ws</span> <span class="main">=</span> <span class="free">W</span> <span class="main">∧</span> distinct <span class="bound">ws</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">folded</span> ws_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">=</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ws</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> card <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_card<span class="main">[</span><span class="operator">OF</span> dist<span class="main">]</span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> mat <span class="var">?n</span> <span class="var">?n</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j'</span><span class="main">)</span><span class="main">.</span> <span class="skolem">ws</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">$</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">j'</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="bound">j'</span> <span class="keyword1">else</span> Suc <span class="bound">j'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">=</span> vec <span class="free">n</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="var">?n</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span> <span class="main">*</span> det <span class="main">(</span><span class="skolem">B</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> nv2<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_vector <span class="free">W</span> <span class="main">=</span> <span class="skolem">nv</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> normal_vector_def Let_def
      ws_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> B_def nv_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> mat_of_rows <span class="free">n</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="bound">w</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> len id card <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="var">?n</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">w</span> <span class="main">∈</span> carrier_mat <span class="free">n</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">w</span> <span class="keyword1"><span class="command">using</span></span> id W len <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> len <span class="keyword1"><span class="command">have</span></span> n1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat_delete <span class="main">(</span><span class="skolem">A</span> <span class="skolem">w</span><span class="main">)</span> <span class="var">?n</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">B</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mat_delete_def A_def mat_of_rows_def B_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> j len<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> B <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span><span class="skolem">A</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span>length <span class="skolem">ws</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> cofactor <span class="main">(</span><span class="skolem">A</span> <span class="skolem">w</span><span class="main">)</span> <span class="var">?n</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> laplace_expansion_row<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?n</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> len<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="skolem">w</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="var">?n</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span> <span class="main">*</span> det <span class="main">(</span>mat_delete <span class="main">(</span><span class="skolem">A</span> <span class="skolem">w</span><span class="main">)</span> <span class="var">?n</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def mat_of_rows_def cofactor_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="skolem">w</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="var">?n</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span> <span class="main">*</span> det <span class="main">(</span><span class="skolem">B</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="skolem">w</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">nv</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nv_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">nv</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def <span class="keyword1"><span class="command">unfolding</span></span> nv_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span><span class="skolem">A</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">nv</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> det_scalar <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> nv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> wW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> W <span class="keyword1"><span class="command">have</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> wW id <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="var">?n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ws<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> det_scalar<span class="main">[</span><span class="operator">OF</span> w<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span><span class="skolem">A</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">nv</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span><span class="skolem">A</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> det_identical_rows<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?n</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i ws len<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def mat_of_rows_def nth_append<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">nv</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">note</span></span> this this<span class="main">[</span><span class="operator">unfolded</span> comm_scalar_prod<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w nv<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> ortho <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> nv0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> nv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> basis_extension <span class="skolem">ws</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> hd <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="skolem">ws</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist lin W <span class="keyword1"><span class="command">unfolding</span></span> lin_indpt_list_def id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> basis_extension<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">folded</span> bs_def<span class="main">]</span> len
    <span class="keyword1"><span class="command">have</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">bs</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bsc<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">bs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unit_vecs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> bsc <span class="keyword1"><span class="command">have</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> lin <span class="main">=</span> lin<span class="main">[</span><span class="operator">unfolded</span> bs<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> lin_indpt_list_length_eq_n<span class="main">[</span><span class="operator">OF</span> lin<span class="main">]</span> len
    <span class="keyword1"><span class="command">have</span></span> basis<span class="main">:</span> <span class="quoted"><span class="quoted">"basis <span class="main">(</span>set <span class="main">(</span><span class="skolem">ws</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> w det_scalar nv <span class="keyword1"><span class="command">have</span></span> det0<span class="main">:</span> <span class="quoted"><span class="quoted">"det <span class="main">(</span><span class="skolem">A</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> basis_det_nonzero<span class="main">[</span><span class="operator">OF</span> basis<span class="main">]</span> len <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"normal_vector <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ortho nv nv0
  <span class="keyword3"><span class="command">show</span></span> nv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ortho<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∙</span> <span class="var">?nv</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="var">?nv</span> <span class="main">∙</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nv2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> n0 nv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sq_norm <span class="var">?nv</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> nvnv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">∙</span> <span class="var">?nv</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sq_norm_vec_as_cscalar_prod<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> nvW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">∉</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nvnv ortho <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">∉</span> span <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> W ortho nvnv nv
    <span class="keyword1"><span class="command">using</span></span> orthocompl_span <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> lin_dep_iff_in_span<span class="main">[</span><span class="operator">OF</span> W lin nv nvW<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>insert <span class="var">?nv</span> <span class="free">W</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> wsI<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ws<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> W <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> wsI ws <span class="keyword1"><span class="command">have</span></span> wsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="var">?n</span> <span class="main">⟹</span> <span class="skolem">ws</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span> <span class="main">∩</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> len wsI <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ints<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="var">?n</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="skolem">ws</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">using</span></span> wsI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">,</span> <span class="operator">unfolded</span> Ints_vec_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="var">?n</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> abs <span class="main">(</span><span class="skolem">ws</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">$</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">Bnd</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">using</span></span> wsI<span class="main">[</span><span class="operator">unfolded</span> Bounded_vec_def<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> ints<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nv_def <span class="keyword1"><span class="command">using</span></span> wsI len ws
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i B_def set_conv_nth <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_mult Ints_det ints<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">nv</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">¦</span> <span class="main">≤</span> det_bound <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nv_def <span class="keyword1"><span class="command">using</span></span> wsI len ws i
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def Bounded_mat_def abs_mult <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> det_bound bnd<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> ints this
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> nv nv2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Ints_vec_def Bounded_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Normal_Vector-normal_vector_span"><span class="command">lemma</span></span> normal_vector_span<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"span <span class="free">D</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∙</span> normal_vector <span class="free">D</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> nv <span class="main">=</span> normal_vector<span class="main">[</span><span class="operator">OF</span> fin card lin D<span class="main">]</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> xspan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> span <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> finite_in_span<span class="main">[</span><span class="operator">OF</span> fin D xspan<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∙</span> normal_vector <span class="free">D</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="free">D</span> <span class="main">∙</span> normal_vector <span class="free">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">∙</span> normal_vector <span class="free">D</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_scalar_prod_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> D nv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> nv<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> D comm_scalar_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"normal_vector <span class="free">D</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∙</span> normal_vector <span class="free">D</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xspan D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"normal_vector <span class="free">D</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xscal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∙</span> normal_vector <span class="free">D</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="main">(</span>normal_vector <span class="free">D</span><span class="main">)</span> <span class="free">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?B</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card card_insert_disjoint<span class="main">[</span><span class="operator">OF</span> fin nv<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D nv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="var">?B</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> span_carrier_lin_indpt_card_n<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> nv<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> xspan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> span <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_in_span<span class="main">[</span><span class="operator">OF</span> _ B xspan<span class="main">]</span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="var">?B</span> <span class="main">∙</span> normal_vector <span class="free">D</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xscal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">∙</span> normal_vector <span class="free">D</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_scalar_prod_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span> <span class="free">D</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">∙</span> normal_vector <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c</span> <span class="var">?n</span> <span class="main">*</span> <span class="main">(</span><span class="var">?n</span> <span class="main">∙</span> <span class="var">?n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fin nv<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span> <span class="free">D</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">∙</span> normal_vector <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> nv<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> nv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">∙</span> <span class="var">?n</span> <span class="main">=</span> sq_norm <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sq_norm_vec_as_cscalar_prod<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="var">?n</span> <span class="main">*</span> sq_norm <span class="var">?n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> ncoord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="var">?n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nv<span class="main">(</span>1-5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="free">D</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_insert2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fin D _ nv<span class="main"><span class="main"><span class="main">(</span></span></span>6<span class="main"><span class="main"><span class="main">,</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ncoord nv<span class="main">(</span>1<span class="main">)</span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> span <span class="free">D</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normal_vectors</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec list <span class="main">⇒</span> <span class="tfree">'a</span> vec list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">normal_vectors</span> <span class="free"><span class="bound"><span class="entity">ws</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">us</span> <span class="main">=</span> basis_extension <span class="free"><span class="bound"><span class="entity">ws</span></span></span>
    <span class="keyword1">in</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> normal_vector <span class="main">(</span>set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ws</span></span></span> <span class="main">@</span> <span class="bound">us</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="bound">us</span> <span class="main">!</span> <span class="bound">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="bound">us</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Normal_Vector-normal_vectors"><span class="command">lemma</span></span> normal_vectors<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="free">ws</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>normal_vectors <span class="free">ws</span><span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> set <span class="free">ws</span> <span class="main">⟹</span> <span class="free">nv</span> <span class="main">∈</span> set <span class="main">(</span>normal_vectors <span class="free">ws</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">nv</span> <span class="main">∙</span> <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> set <span class="free">ws</span> <span class="main">⟹</span> <span class="free">nv</span> <span class="main">∈</span> set <span class="main">(</span>normal_vectors <span class="free">ws</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">∙</span> <span class="free">nv</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"lin_indpt_list <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> normal_vectors <span class="free">ws</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="free">ws</span> <span class="main">+</span> length <span class="main">(</span>normal_vectors <span class="free">ws</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">ws</span> <span class="main">∩</span> set <span class="main">(</span>normal_vectors <span class="free">ws</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">ws</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span> <span class="main">⟹</span>
       set <span class="main">(</span>normal_vectors <span class="free">ws</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> basis_extension <span class="free">ws</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> basis_extension<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">folded</span> us_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> units<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> lin_indpt_list_length_eq_n<span class="main">[</span><span class="operator">OF</span> lin len<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> lin<span class="main">[</span><span class="operator">unfolded</span> lin_indpt_list_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> wsus<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lin'<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"normal_vectors <span class="free">ws</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> nv_def <span class="main">=</span> normal_vectors_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ws</span></span><span class="main">,</span> <span class="operator">unfolded</span> Let_def<span class="main">,</span> <span class="operator">folded</span> us_def<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="free">ws</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> lnv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="var">?nv</span> <span class="main">=</span> length <span class="skolem">us</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="var">?n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> nvi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> normal_vector <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="skolem">us</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> wsus <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?V</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wsus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> finV<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="var">?V</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>insert <span class="main">(</span><span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="var">?V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_insert_disjoint<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finV<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="var">?V</span> <span class="main">=</span> set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> cardV<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="var">?V</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len distinct_card<span class="main">[</span><span class="operator">OF</span> dist<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> subset_li_is_li<span class="main">[</span><span class="operator">OF</span> lin'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> linV<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> lin_dep_iff_in_span<span class="main">[</span><span class="operator">OF</span> _ linV u<span class="main">,</span> <span class="operator">unfolded</span> id<span class="main">]</span> wsus lin'
    <span class="keyword1"><span class="command">have</span></span> usV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∉</span> span <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> nv <span class="main">=</span> normal_vector<span class="main">[</span><span class="operator">OF</span> finV cardV linV V<span class="main">,</span> <span class="operator">folded</span> nvi<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> normal_vector_span<span class="main">[</span><span class="operator">OF</span> cardV V _ linV<span class="main">,</span> <span class="operator">folded</span> nvi<span class="main">]</span> comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> _ nv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="var">?V</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> nv<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sq_norm <span class="main">(</span><span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> nvi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sq_norm_vec_as_cscalar_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> span nvi <span class="keyword1"><span class="command">have</span></span> nvspan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∉</span> span <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> u usV<span class="main">[</span><span class="operator">unfolded</span> span<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">note</span></span> nv nvi this span usV nvspan
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> nvi <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> nv<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?nv</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth <span class="keyword1"><span class="command">using</span></span> nvi<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">nv</span>
    <span class="keyword3"><span class="command">assume</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="free">ws</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> dist <span class="keyword1"><span class="command">have</span></span> wus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> set <span class="skolem">us</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">∈</span> set <span class="var">?nv</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> w wus <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">∙</span> <span class="skolem">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"normal_vectors <span class="main">_</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nvi<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">nv</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comm_scalar_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">nv</span></span><span class="main">]</span> w nv n wsus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> scalar_0 <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ws</span> <span class="main">+</span> length <span class="var">?nv</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> wsI<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ws</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nv</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">∈</span> set <span class="var">?nv</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> nv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">=</span> <span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> wsI <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">}</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> units
          Bounded_vec_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Bnd</span></span> <span class="quoted"><span class="quoted">"max <span class="main">1</span> <span class="free">Bnd</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unit_vecs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> nvi<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i this<span class="main">]</span> nv
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?nv</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">have</span></span> dist_nv<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="var">?nv</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> distinct_conv_nth lnv
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="var">?n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="var">?n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> dist <span class="keyword1"><span class="command">have</span></span> usj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> distinct_conv_nth set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> nvi<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i this<span class="main">]</span> nvi<span class="main">(</span>9<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> j<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="var">?nv</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ws</span> <span class="main">∩</span> set <span class="var">?nv</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="free">ws</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="var">?nv</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> scalar_0<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sq_norm <span class="skolem">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sq_norm_vec_as_cscalar_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> w wsus <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> vs_zero_lin_dep<span class="main">[</span><span class="operator">OF</span> wsus lin'<span class="main">]</span> w<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> dist'<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="var">?nv</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist disj dist_nv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="var">?nv</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lin_indpt_list_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI dist'<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="var">?nv</span><span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nv wsus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> ws<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ws</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> lin_nv<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="var">?nv</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lin_dep <span class="main">(</span>set <span class="var">?nv</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> finite_lin_dep<span class="main">[</span><span class="operator">OF</span> finite_set this nv<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> comb<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">a</span> <span class="main">(</span>set <span class="var">?nv</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vnv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> set <span class="var">?nv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> av0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> vnv<span class="main">[</span><span class="operator">unfolded</span> set_conv_nth<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="var">?n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">w</span> <span class="main">/</span> <span class="skolem">a</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">w</span><span class="main">.</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="skolem">b</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> lincomb <span class="skolem">b</span> <span class="main">(</span>set <span class="var">?nv</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="main">(</span>set <span class="var">?nv</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command">using</span></span> nv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">using</span></span> nv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> comb<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span> <span class="skolem">a</span> <span class="skolem">v</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">a</span> <span class="skolem">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> lincomb <span class="skolem">a</span> <span class="main">(</span>set <span class="var">?nv</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lincomb <span class="skolem">b</span> <span class="main">(</span>set <span class="var">?nv</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_smult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> nv<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">b</span> <span class="skolem">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">+</span> lincomb <span class="skolem">b</span> <span class="main">(</span>set <span class="var">?nv</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_del2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ nv _ vnv<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> av0 <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">+</span> lincomb <span class="skolem">b</span> <span class="main">(</span>set <span class="var">?nv</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> lincomb <span class="skolem">b</span> <span class="main">(</span>set <span class="var">?nv</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
         <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">-</span> lincomb <span class="skolem">b</span> <span class="main">(</span>set <span class="var">?nv</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_diff_cancel_right_vec<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> vnv nv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> w_def c_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_smult<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> x_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> nv x<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> vw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i wsus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> nv'<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?nv</span> <span class="main">-</span> <span class="main">{</span><span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">}</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> vi<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> vw <span class="keyword1"><span class="command">unfolding</span></span> w_def vi
        <span class="keyword1"><span class="command">unfolding</span></span> lincomb_scalar_prod_left<span class="main">[</span><span class="operator">OF</span> nv' u<span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> ballI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="var">?nv</span> <span class="main">-</span> <span class="main">{</span><span class="var">?nv</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="var">?n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="var">?nv</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> dist<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> ij i j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">us</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> distinct_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">us</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> nvi<span class="main">(</span>3-4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> j this<span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∙</span> <span class="skolem">us</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> nvi<span class="main">(</span>9<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> subset_li_is_li<span class="main">[</span><span class="operator">OF</span> lin'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="free">ws</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ortho_lin_indpt<span class="main">[</span><span class="operator">OF</span> nv ws scalar_0 lin_nv this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="var">?nv</span> <span class="main">∪</span> set <span class="free">ws</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?nv</span> <span class="main">∪</span> set <span class="free">ws</span> <span class="main">=</span> set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="var">?nv</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="var">?nv</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pos_norm_vec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pos_norm_vec</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">c'</span> <span class="main">=</span> normal_vector <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">;</span>
     <span class="bound">c</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">c'</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">c'</span> <span class="keyword1">else</span> <span class="main">-</span><span class="bound">c'</span><span class="main">)</span> <span class="keyword1">in</span> <span class="bound">c</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Normal_Vector-pos_norm_vec"><span class="command">lemma</span></span> pos_norm_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="free">D</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> c_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> pos_norm_vec <span class="free">D</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"span <span class="free">D</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> span <span class="free">D</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="main">{</span>normal_vector <span class="free">D</span><span class="main">,</span> <span class="main">-</span>normal_vector <span class="free">D</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_vector <span class="free">D</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> normal_vector assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> cnorm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="main">{</span>normal_vector <span class="free">D</span><span class="main">,</span> <span class="main">-</span>normal_vector <span class="free">D</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def pos_norm_vec_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms normal_vector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="free">D</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∙</span> normal_vector <span class="free">D</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_vector_span<span class="main">[</span><span class="operator">OF</span> card D fin lin<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cnorm c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> span_char<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">D</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> span <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> c<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> span_char <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"normal_vector <span class="free">D</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cnorm n x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>normal_vector <span class="free">D</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">-</span>normal_vector <span class="free">D</span><span class="main">)</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> c_def pos_norm_vec_def Let_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Dim_Span">
<div class="head">
<h1>Theory Dim_Span</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Dimension of Spans›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the notion of dimension of a span of vectors and prove some natural results about them.
  The definition is made as a function, so that no interpretation of locales like subspace is required.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Dim_Span
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Missing_VS_Connect">Missing_VS_Connect</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> vec_space
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">dim_span</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">=</span> Max <span class="main">(</span>card <span class="main">`</span> <span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="bound">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="bound">V</span> <span class="main">⊆</span> span <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">∧</span> lin_indpt <span class="bound">V</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">V</span> <span class="free">W</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    card_le_dim_span<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">V</span> <span class="main">⊆</span> span <span class="free">W</span> <span class="main">⟹</span> lin_indpt <span class="free">V</span> <span class="main">⟹</span> card <span class="free">V</span> <span class="main">≤</span> dim_span <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    card_eq_dim_span_imp_same_span<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">V</span> <span class="main">⊆</span> span <span class="free">W</span> <span class="main">⟹</span> lin_indpt <span class="free">V</span> <span class="main">⟹</span> card <span class="free">V</span> <span class="main">=</span> dim_span <span class="free">W</span> <span class="main">⟹</span> span <span class="free">V</span> <span class="main">=</span> span <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    same_span_imp_card_eq_dim_span<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> span <span class="free">V</span> <span class="main">=</span> span <span class="free">W</span> <span class="main">⟹</span> lin_indpt <span class="free">V</span> <span class="main">⟹</span> card <span class="free">V</span> <span class="main">=</span> dim_span <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dim_span_cong<span class="main">:</span>
    <span class="quoted"><span class="quoted">"span <span class="free">V</span> <span class="main">=</span> span <span class="free">W</span> <span class="main">⟹</span> dim_span <span class="free">V</span> <span class="main">=</span> dim_span <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ex_basis_span<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="bound">W</span> <span class="main">∧</span> span <span class="free">V</span> <span class="main">=</span> span <span class="bound">W</span> <span class="main">∧</span> dim_span <span class="free">V</span> <span class="main">=</span> card <span class="bound">W</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">V</span> <span class="bound">W</span><span class="main">.</span> span <span class="bound">V</span> <span class="main">=</span> span <span class="bound">W</span> <span class="main">⟹</span> dim_span <span class="bound">V</span> <span class="main">=</span> dim_span <span class="bound">W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dim_span_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">W</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">V</span><span class="main">.</span> <span class="bound">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="bound">V</span> <span class="main">⊆</span> span <span class="skolem">W</span> <span class="main">∧</span> lin_indpt <span class="bound">V</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">`</span> <span class="var">?M</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> card <span class="main">`</span> <span class="var">?M</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="skolem">V</span> <span class="main">⊆</span> span <span class="skolem">W</span> <span class="main">∧</span> lin_indpt <span class="skolem">V</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> card <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> V <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">V</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dim_is_n li_le_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> k <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>card <span class="main">`</span> <span class="var">?M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> span_empty span_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> imageI<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted">card</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> card <span class="main">`</span> <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> Mempty<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">`</span> <span class="var">?M</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Max_ge<span class="main">[</span><span class="operator">OF</span> fin<span class="main">,</span> <span class="operator">folded</span> dim_span_def<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">V</span> <span class="main">::</span> <span class="tfree">'a</span> vec set<span class="main">.</span> <span class="bound">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="bound">V</span> <span class="main">⊆</span> span <span class="skolem">W</span> <span class="main">⟹</span> lin_indpt <span class="bound">V</span> <span class="main">⟹</span> card <span class="bound">V</span> <span class="main">≤</span> dim_span <span class="skolem">W</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> this fin Mempty
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> part1 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span>  W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> VsW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> span <span class="skolem">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> linV<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">V</span> <span class="main">=</span> dim_span <span class="skolem">W</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> W VsW <span class="keyword1"><span class="command">have</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> span_mem<span class="main">[</span><span class="operator">OF</span> W<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> part1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">folded</span> dim_span_def<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">W</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">WW</span></span> <span class="keyword2"><span class="keyword">where</span></span> WW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">WW</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">WW</span> <span class="main">⊆</span> span <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">WW</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_span <span class="skolem">W</span> <span class="main">=</span> card <span class="skolem">WW</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"span <span class="skolem">V</span> <span class="main">=</span> span <span class="skolem">W</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> VsW V W <span class="keyword1"><span class="command">have</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="skolem">V</span> <span class="main">⊆</span> span <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> span_subsetI <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"span <span class="skolem">V</span> <span class="main">≠</span> span <span class="skolem">W</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> sub <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> wW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> span <span class="skolem">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wsV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> span <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> wW W <span class="keyword1"><span class="command">have</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> linV V <span class="keyword1"><span class="command">have</span></span> finV<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_dim fin_dim_li_fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> wsV span_mem<span class="main">[</span><span class="operator">OF</span> V<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> wV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">w</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?X</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="skolem">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wV finV <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> gt<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="var">?X</span> <span class="main">&gt;</span> dim_span <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> card <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> linX<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lin_dep_iff_in_span<span class="main">[</span><span class="operator">OF</span> V linV w wV<span class="main">]</span> wsV <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> XW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">⊆</span> span <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wW VsW <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> part1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ XW linX<span class="main">]</span> w V <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?X</span> <span class="main">≤</span> dim_span <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> gt <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> card_dim_span <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> part1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">folded</span> dim_span_def<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">V</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> span <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">W</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> idW<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">W</span> <span class="main">=</span> dim_span <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="bound">W</span> <span class="main">∧</span> span <span class="skolem">V</span> <span class="main">=</span> span <span class="bound">W</span> <span class="main">∧</span> dim_span <span class="skolem">V</span> <span class="main">=</span> card <span class="bound">W</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">W</span></span></span></span><span class="main"><span class="main">]</span></span> conjI W idW<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> card_dim_span<span class="main">[</span><span class="operator">OF</span> V<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> W<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span> idW<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"span <span class="skolem">V</span> <span class="main">=</span> span <span class="skolem">W</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">W</span>
    <span class="keyword3"><span class="command">assume</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="skolem">V</span> <span class="main">=</span> span <span class="skolem">W</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> part1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">folded</span> dim_span_def<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">W</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">WW</span></span> <span class="keyword2"><span class="keyword">where</span></span> WW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">WW</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">WW</span> <span class="main">⊆</span> span <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">WW</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> idWW<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">WW</span> <span class="main">=</span> dim_span <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> card_dim_span<span class="main">[</span><span class="operator">OF</span> W WW<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span> idWW<span class="main">]</span> span
    <span class="keyword1"><span class="command">have</span></span> spanWW<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="skolem">WW</span> <span class="main">=</span> span <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> span <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> span <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> span_mem<span class="main">[</span><span class="operator">OF</span> V<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> part1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> V this lin<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> VW<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">V</span> <span class="main">≤</span> dim_span <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> finWW<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">WW</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> WW <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_dim_li_fin<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> finV<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lin V <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_dim_li_fin<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> replacement<span class="main">[</span><span class="operator">OF</span> finWW finV V WW<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> WW<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">folded</span> span<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">unfolded</span> idWW<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>card <span class="skolem">C</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>card <span class="skolem">V</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span>dim_span <span class="skolem">W</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> le <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>dim_span <span class="skolem">W</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span>card <span class="skolem">C</span><span class="main">)</span> <span class="main">≤</span> int <span class="main">(</span>card <span class="skolem">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dim_span <span class="skolem">W</span> <span class="main">+</span> card <span class="skolem">C</span> <span class="main">≤</span> card <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">with</span></span> VW <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">V</span> <span class="main">=</span> dim_span <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dim_Span-dim_span_le_n"><span class="command">lemma</span></span> dim_span_le_n<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_span <span class="free">W</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ex_basis_span<span class="main">[</span><span class="operator">OF</span> W<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_span <span class="free">W</span> <span class="main">=</span> card <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dim <span class="keyword1"><span class="command">using</span></span> lin V
    <span class="keyword1"><span class="command">using</span></span> dim_is_n li_le_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dim_Span-dim_span_insert"><span class="command">lemma</span></span> dim_span_insert<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> span <span class="free">W</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_span <span class="main">(</span>insert <span class="free">v</span> <span class="free">W</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>dim_span <span class="free">W</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ex_basis_span<span class="main">[</span><span class="operator">OF</span> W<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">W</span> <span class="main">=</span> span <span class="skolem">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_span <span class="free">W</span> <span class="main">=</span> card <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> V vs<span class="main">[</span><span class="operator">unfolded</span> span<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> vV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> span_mem<span class="main">[</span><span class="operator">OF</span> V<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> lin_dep_iff_in_span<span class="main">[</span><span class="operator">OF</span> V lin v vV<span class="main">]</span> vs span
  <span class="keyword1"><span class="command">have</span></span> lin'<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>insert <span class="free">v</span> <span class="skolem">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> finV<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lin V <span class="keyword1"><span class="command">using</span></span> fin_dim fin_dim_li_fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="free">v</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="skolem">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finV vV <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> cvV<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="free">v</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>dim_span <span class="free">W</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>insert <span class="free">v</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">=</span> span <span class="main">(</span>insert <span class="free">v</span> <span class="free">W</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> span V W v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_least insert_subset insert_union span_union_is_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> same_span_imp_card_eq_dim_span<span class="main">[</span><span class="operator">OF</span> _ _ this lin'<span class="main">]</span> cvV v V W
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Fundamental_Theorem_Linear_Inequalities">
<div class="head">
<h1>Theory Fundamental_Theorem_Linear_Inequalities</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Fundamental Theorem of Linear Inequalities›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The theorem states that for a given set of vectors A and vector b, either
  b is in the cone of a linear independent subset of A, or
  there is a hyperplane that contains span(A,b)-1 linearly independent vectors of A
  that separates A from b. We prove this theorem and derive some consequences, e.g.,
  Caratheodory's theorem that b is the cone of A iff b is in the cone of a linear
  independent subset of A.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Fundamental_Theorem_Linear_Inequalities
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#Cone">Cone</a>
    <a href="#Normal_Vector">Normal_Vector</a>
    <a href="#Dim_Span">Dim_Span</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> gram_schmidt
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The mentions equivances A-D are:
 <span class="antiquoted"><span class="antiquoted">▪</span></span> A: b is in the cone of vectors A,
 <span class="antiquoted"><span class="antiquoted">▪</span></span> B: b is in the cone of a subset of linear independent of vectors A,
 <span class="antiquoted"><span class="antiquoted">▪</span></span> C: there is no separating hyperplane of b and the vectors A,
      which contains dim many linear independent vectors of A
 <span class="antiquoted"><span class="antiquoted">▪</span></span> D: there is no separating hyperplane of b and the vectors A›</span></span>

<span class="keyword1" id="Fundamental_Theorem_Linear_Inequalities-fundamental_theorem_of_linear_inequalities_A_imp_D"><span class="command">lemma</span></span> fundamental_theorem_of_linear_inequalities_A_imp_D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> cone <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ai<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">ai</span><span class="main">.</span> <span class="bound">ai</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="bound">ai</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> b<span class="main">[</span><span class="operator">unfolded</span> cone_def nonneg_lincomb_def finite_cone_def<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">AA</span></span> <span class="keyword2"><span class="keyword">where</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> lincomb <span class="skolem">l</span> <span class="skolem">AA</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">`</span> <span class="skolem">AA</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> AA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">AA</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> cone_carrier<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> b <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">ai</span><span class="main">∈</span><span class="skolem">AA</span><span class="main">.</span> <span class="skolem">l</span> <span class="bound">ai</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∙</span> <span class="bound">ai</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_nonneg mult_nonneg_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> l ai AA<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">ai</span><span class="main">∈</span><span class="skolem">AA</span><span class="main">.</span> <span class="skolem">l</span> <span class="bound">ai</span> <span class="main">*</span> <span class="main">(</span><span class="bound">ai</span> <span class="main">∙</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> c A AA comm_scalar_prod<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">ai</span><span class="main">∈</span><span class="skolem">AA</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l</span> <span class="bound">ai</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">ai</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> smult_scalar_prod_distrib c A AA<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∙</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bc lincomb_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finsum_scalar_prod_sum<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> c A AA<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comm_scalar_prod b c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The difficult direction is that C implies B. To this end we follow the
  proof that at least one of B and the negation of C is satisfied.›</span></span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">m</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inj_a<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">a</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> full_span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">goal</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">I</span><span class="main">.</span> <span class="bound">I</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> finite_cone <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">c</span> <span class="bound">I</span><span class="main">.</span> <span class="bound">I</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> <span class="main">{</span>normal_vector <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> normal_vector <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>
      <span class="main">∧</span> lin_indpt <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="free">a</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Fundamental_Theorem_Linear_Inequalities-card_a_I"><span class="command">lemma</span></span> card_a_I<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span> <span class="main">⟹</span> card <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> card <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> inj_a card_image inj_on_image_eq_iff subset_image_inj subset_refl subset_trans<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Fundamental_Theorem_Linear_Inequalities-in_a_I"><span class="command">lemma</span></span> in_a_I<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">a</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inj_a
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atLeastLessThan_iff image_eqI inj_on_image_mem_iff zero_le<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">valid_I</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">I</span><span class="main">.</span> card <span class="bound">I</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">I</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">cond</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cond</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">I'</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span>
  <span class="free">b</span> <span class="main">=</span> lincomb <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span> <span class="main">∧</span>
  <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span><span class="free">a</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">h'</span><span class="main">.</span> <span class="bound">h'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⟶</span> <span class="bound">h'</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span><span class="free">a</span> <span class="bound">h'</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
  <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> span <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span>
  <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∙</span> <span class="free">a</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">k'</span><span class="main">.</span> <span class="bound">k'</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∙</span> <span class="free">a</span> <span class="bound">k'</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
  <span class="free"><span class="bound"><span class="entity">I'</span></span></span> <span class="main">=</span> insert <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">step_rel</span> <span class="main">=</span> Restr <span class="main">{</span> <span class="main">(</span><span class="bound">I''</span><span class="main">,</span> <span class="bound">I</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">l</span> <span class="bound">c</span> <span class="bound">h</span> <span class="bound">k</span><span class="main">.</span> cond <span class="bound">I</span> <span class="bound">I''</span> <span class="bound">l</span> <span class="bound">c</span> <span class="bound">h</span> <span class="bound">k</span> <span class="main">}</span> valid_I"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Fundamental_Theorem_Linear_Inequalities-finite_step_rel"><span class="command">lemma</span></span> finite_step_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"finite step_rel"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"step_rel <span class="main">⊆</span> <span class="main">(</span>Pow <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span> <span class="main">×</span> Pow <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> step_rel_def valid_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Fundamental_Theorem_Linear_Inequalities-acyclic_imp_goal"><span class="command">lemma</span></span> acyclic_imp_goal<span class="main">:</span> <span class="quoted"><span class="quoted">"acyclic step_rel <span class="main">⟹</span> goal"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> ngoal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> goal"</span></span> <span class="comment1">(* then the algorithm will not terminate *)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span>
    <span class="keyword3"><span class="command">assume</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">∈</span> valid_I"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> Im<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      cardI<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">I</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_I_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> finD<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?D</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Im infinite_super <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> carrD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a Im <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> cardD<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="var">?D</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cardI Im <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> spanD<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="var">?D</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> span_carrier_lin_indpt_card_n lin cardD carrD<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lamb</span></span> <span class="keyword2"><span class="keyword">where</span></span> b_is_lincomb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> lincomb <span class="skolem">lamb</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_in_span<span class="main">[</span><span class="operator">OF</span> fin carrD<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> spanD b carrD fin_dim lin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">∧</span> <span class="skolem">lamb</span> <span class="main">(</span><span class="free">a</span> <span class="bound">h</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">I'</span><span class="main">.</span> <span class="main">(</span><span class="bound">I'</span><span class="main">,</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">∈</span> step_rel"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span> <span class="skolem">I</span> <span class="main">.</span> <span class="skolem">lamb</span> <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> cond1_T<span class="main">:</span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">goal</span> <span class="keyword1"><span class="command">unfolding</span></span> goal_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disjI1 exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">I</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI lin cardI
            lincomb_in_finite_cone<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b_is_lincomb finD _ carrD<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> cardI Im cond1_T<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> ngoal <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> cond1_F<span class="main">:</span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">∧</span> <span class="skolem">lamb</span> <span class="main">(</span><span class="free">a</span> <span class="bound">h</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> LeastI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">folded</span> h_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lamb</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> not_less_Least<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">∧</span> <span class="skolem">lamb</span> <span class="main">(</span><span class="free">a</span> <span class="bound">h</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> h_def<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> h_least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="skolem">h</span> <span class="main">⟶</span> <span class="skolem">lamb</span> <span class="main">(</span><span class="free">a</span> <span class="bound">k</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I'</span></span> <span class="keyword2"><span class="keyword">where</span></span> I'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I'</span> <span class="main">=</span> <span class="skolem">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> pos_norm_vec <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="skolem">I'</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">`</span> <span class="skolem">I'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> I'm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Im I'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> carrD'<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="var">?D'</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a Im I'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> finD'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?D'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Im I'_def subset_eq_atLeast0_lessThan_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> D'subs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D'</span> <span class="main">⊆</span> <span class="var">?D</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> I'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> linD'<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span><span class="var">?D'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lin I'_def Im D'subs subset_li_is_li <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> D'strictsubs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="var">?D'</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span> <span class="skolem">h</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h I'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> h_nin_I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∉</span> <span class="skolem">I'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h I'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ah_nin_D'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">h</span> <span class="main">∉</span> <span class="var">?D'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h inj_a Im h_nin_I <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> in_a_I<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> cardD'<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="main">(</span><span class="var">?D'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> cardD ah_nin_D' D'strictsubs finD' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> ah_carr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">h</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h a Im <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> pnv <span class="main">=</span> pos_norm_vec<span class="main">[</span><span class="operator">OF</span> carrD' finD' linD' cardD' c_def<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> ah_nin_span<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">h</span> <span class="main">∉</span> span <span class="var">?D'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> D'strictsubs lin_dep_iff_in_span<span class="main">[</span><span class="operator">OF</span> carrD' linD' ah_carr ah_nin_D'<span class="main">]</span> lin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> cah_ge_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∙</span> <span class="free">a</span> <span class="skolem">h</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> cnorm<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="var">?D'</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∙</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ah_carr ah_nin_span pnv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ccarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="skolem">c</span> <span class="main">=</span> lincomb <span class="skolem">lamb</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_is_lincomb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span> <span class="var">?D</span><span class="main">.</span> <span class="skolem">lamb</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">∙</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lincomb_scalar_prod_left<span class="main">[</span><span class="operator">OF</span> carrD<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">lamb</span></span><span class="main">]</span> pos_norm_vec ccarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">lamb</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">h</span> <span class="main">∙</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span> <span class="var">?D'</span><span class="main">.</span> <span class="skolem">lamb</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">∙</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum.insert<span class="main">[</span><span class="operator">OF</span> finD' ah_nin_D'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">lamb</span></span><span class="main">]</span> D'strictsubs ah_nin_D' finD' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span> <span class="var">?D'</span><span class="main">.</span> <span class="skolem">lamb</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">∙</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> span_mem<span class="main">[</span><span class="operator">OF</span> carrD'<span class="main">,</span> <span class="operator">unfolded</span> cnorm<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lamb</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">h</span> <span class="main">∙</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cah_ge_zero h<span class="main">(</span>2<span class="main">)</span> comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> ah_carr ccarr<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_neg_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> cb_le_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> b ccarr<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">.</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="free">a</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> cond2_T<span class="main">:</span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted">goal</span>
          <span class="keyword1"><span class="command">unfolding</span></span> goal_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disjI2 exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">I'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI cb_le_zero linD' cond2_T cardD' I'm pnv<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ngoal <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> cond2_F<span class="main">:</span> False
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="free">a</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">k</span> <span class="skolem">I'</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> step_rel_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?I''</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mem_Collect_eq split<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> LeastI_ex<span class="main">[</span><span class="operator">OF</span> <span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="free">a</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cond2_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">from</span></span> LeastI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">folded</span> k_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∙</span> <span class="free">a</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cond <span class="skolem">I</span> <span class="var">?I''</span> <span class="skolem">lamb</span> <span class="skolem">c</span> <span class="skolem">h</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cond_def I'_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> cnorm
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> conjI cb_le_zero b_is_lincomb h ccarr h_least refl k<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∙</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> ccarr<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> not_less_Least<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="free">a</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> k_def<span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k'</span></span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">.</span> <span class="bound">k'</span> <span class="main">&gt;</span> <span class="free">m</span> <span class="main">∨</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="free">a</span> <span class="bound">k'</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k<span class="main">(</span>1<span class="main">)</span> less_trans not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k'</span></span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">.</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="free">a</span> <span class="bound">k'</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I''</span> <span class="main">∈</span> valid_I"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_I_def
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> k a <span class="keyword1"><span class="command">have</span></span> ak_carr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">k</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> ak_nin_span<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">k</span> <span class="main">∉</span> span <span class="var">?D'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k<span class="main">(</span>2<span class="main">)</span> cnorm comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> ak_carr ccarr<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> ak_nin_D'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">k</span> <span class="main">∉</span> <span class="var">?D'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> span_mem<span class="main">[</span><span class="operator">OF</span> carrD'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> lin_dep_iff_in_span<span class="main">[</span><span class="operator">OF</span> carrD' linD' ak_carr ak_nin_D'<span class="main">]</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="var">?I''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ak_nin_span <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I''</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> I'm k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">k</span> <span class="skolem">I'</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cardD' ak_nin_D' finD'
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹insert <span class="skolem">k</span> <span class="skolem">I'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>›</span></span> card_a_I card_insert_disjoint image_insert<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?I''</span><span class="main">,</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">∈</span> valid_I <span class="main">×</span> valid_I"</span></span>  <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> step <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span> <span class="comment1">(* create some valid initial set I *)</span>
    <span class="keyword1"><span class="command">from</span></span> exists_lin_indpt_subset<span class="main">[</span><span class="operator">OF</span> a<span class="main">,</span> <span class="operator">unfolded</span> full_span<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="skolem">A</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Am<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">a</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Am a <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> lin span A <span class="keyword1"><span class="command">have</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">A</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> basis_def dim_basis dim_is_n fin_dim_li_fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> A Am <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span>  A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="free">a</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subset_imageE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">∈</span> valid_I"</span></span> <span class="keyword1"><span class="command">using</span></span> I card lin <span class="keyword1"><span class="command">unfolding</span></span> valid_I_def A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">I</span><span class="main">.</span> <span class="bound">I</span> <span class="main">∈</span> valid_I"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> init <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> step_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">I'</span><span class="main">,</span><span class="skolem">I</span><span class="main">)</span> <span class="main">∈</span> step_rel <span class="main">⟹</span> <span class="skolem">I'</span> <span class="main">∈</span> valid_I"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">I</span> <span class="skolem">I'</span> <span class="keyword1"><span class="command">unfolding</span></span> step_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>wf step_rel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> init <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">∈</span> valid_I"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"wf step_rel"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> wf_eq_minimal<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> I<span class="main">]</span> step step_valid <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> wf_iff_acyclic_if_finite<span class="main">[</span><span class="operator">OF</span> finite_step_rel<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> acyclic step_rel"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"acyclic step_rel <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Fundamental_Theorem_Linear_Inequalities-acyclic_step_rel"><span class="command">lemma</span></span> acyclic_step_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"acyclic step_rel"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> acyclic <span class="main">(</span>step_rel<span class="main">¯</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* obtain cycle *)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">I</span><span class="main">,</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step_rel<span class="main">^-1</span><span class="main">)</span><span class="main">^+</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> acyclic_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> trancl_power<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">len</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">I</span><span class="main">,</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>step_rel<span class="main">^-1</span><span class="main">)</span> <span class="main">^^</span> <span class="skolem">len</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">len</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="comment1">(* obtain all intermediate I's *)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> relpow_fun_conv<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Is</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    stepsIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">len</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">Is</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">Is</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> step_rel"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> IsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">len</span> <span class="main">=</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">len</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">len</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> stepsIs<span class="main">[</span><span class="operator">unfolded</span> step_rel_def<span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">i</span> <span class="main">∈</span> valid_I"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> Is_valid <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> stepsIs<span class="main">[</span><span class="operator">unfolded</span> step_rel_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">l</span> <span class="bound">c</span> <span class="bound">h</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">len</span> <span class="main">⟶</span> cond <span class="main">(</span><span class="skolem">Is</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">c</span> <span class="bound">h</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">(* obtain all intermediate c's h's, l's, k's *)</span>
  <span class="keyword1"><span class="command">from</span></span> choice<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ls</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">c</span> <span class="bound">h</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">len</span> <span class="main">⟶</span> cond <span class="main">(</span><span class="skolem">Is</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ls</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">c</span> <span class="bound">h</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> choice<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">h</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">len</span> <span class="main">⟶</span> cond <span class="main">(</span><span class="skolem">Is</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ls</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cs</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">h</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> choice<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">len</span> <span class="main">⟶</span> cond <span class="main">(</span><span class="skolem">Is</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ls</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cs</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">hs</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> choice<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ks</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">len</span> <span class="main">⟹</span> cond <span class="main">(</span><span class="skolem">Is</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ls</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cs</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">hs</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ks</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">(* finally derive contradiction *)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">hs</span> <span class="bound">i</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">len</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> Max <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> cond<span class="main">[</span><span class="operator">OF</span> len0<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hs</span> <span class="main">0</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IsI <span class="keyword1"><span class="command">unfolding</span></span> cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> R0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hs</span> <span class="main">0</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> finR<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> finR<span class="main">]</span> R0
  <span class="keyword1"><span class="command">have</span></span> rR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">hs</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">len</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Max_ge<span class="main">[</span><span class="operator">OF</span> finR<span class="main">,</span> <span class="operator">folded</span> r_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> rLarge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">len</span> <span class="main">⟹</span> <span class="skolem">hs</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> exq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">ks</span> <span class="bound">q</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">&lt;</span> <span class="skolem">len</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">∈</span><span class="main">{</span>Suc <span class="skolem">p</span><span class="main">..</span><span class="skolem">len</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">j</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> j_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">p</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">&gt;</span> Suc <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> j_len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">len</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> pj_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">p</span> <span class="main">⟹</span> cond <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ls</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">hs</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ks</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cond p <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> r_neq_ksp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="skolem">ks</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">p</span> <span class="main">⟹</span> <span class="skolem">Is</span> <span class="skolem">j</span> <span class="main">=</span> insert <span class="main">(</span><span class="skolem">ks</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rp cond pj_cond cond_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">j</span>"</span></span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">p</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_neq_ksp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="skolem">p</span><span class="main">..</span><span class="skolem">len</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">have</span></span> r_neq_kspj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> Suc <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">len</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">≠</span> <span class="skolem">ks</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_len neg IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> jsucj_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> Suc <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">len</span> <span class="main">⟹</span> <span class="skolem">Is</span> <span class="skolem">j</span> <span class="main">=</span> insert <span class="main">(</span><span class="skolem">ks</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">hs</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cond_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">j</span>"</span></span><span class="main">]</span> cond
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_less_eq2 diff_Suc_1 le_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> Suc <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">len</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">∉</span> insert <span class="main">(</span><span class="skolem">ks</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IH r_neq_kspj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> Suc <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">len</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jsucj_cond <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> j_bounds j_len c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> neg IsI<span class="main">(</span>2<span class="main">)</span> True p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">p</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span><span class="main">(</span>less <span class="skolem">j</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> j_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> r_nin_Is0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IsI<span class="main">(</span>1<span class="main">)</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">p</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> j_neq_ksjpred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">≠</span> <span class="skolem">ks</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg j_bound p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> Is_jpredj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">Is</span> <span class="skolem">j</span> <span class="main">=</span> insert <span class="main">(</span><span class="skolem">ks</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">hs</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cond_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">j</span>"</span></span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">hs</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ks</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span> cond
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> One_nat_def Suc_pred diff_le_self j_bound le_less_trans p<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">∉</span> insert <span class="main">(</span><span class="skolem">ks</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> j_neq_ksjpred IH j_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Is_jpredj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> j_bound r_nin_Is0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rp cond cond_def p <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ks</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q_len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">len</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="skolem">i1</span> <span class="skolem">i2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">&lt;</span> <span class="skolem">len</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">&lt;</span> <span class="skolem">len</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">i1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∉</span> <span class="skolem">Is</span> <span class="skolem">i2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="skolem">len</span><span class="main">.</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">hs</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> hst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">len</span> <span class="main">⟹</span> <span class="skolem">hs</span> <span class="bound">j</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">len</span> <span class="main">⟹</span> <span class="skolem">t</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">len</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> cond<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">unfolded</span> cond_def<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="main">(</span>Suc <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span><span class="skolem">ks</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Is</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">hs</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span> hst<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> i <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i2</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">&lt;</span> <span class="skolem">len</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="skolem">i2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> IsI <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="skolem">len</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">len</span> <span class="main">-</span> <span class="skolem">i1</span>"</span></span> <span class="quoted"><span class="skolem">i1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">&lt;</span> <span class="skolem">len</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> <span class="skolem">Is</span> <span class="skolem">i1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">i1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> innotin <span class="main">=</span> this

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span>Suc <span class="skolem">r</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> i_in_Isp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> i_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="skolem">len</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">hs</span> <span class="bound">j</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> innotin<span class="main">[</span><span class="operator">OF</span> p q_len i_range i_in_Isp<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j_hs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">hs</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&gt;</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> j_hs p rLarge ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> bla <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> blin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> lincomb <span class="main">(</span><span class="skolem">ls</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cond_def p cond <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> carrDp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> Is_valid valid_I_def a p
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> image_subset_iff less_imp_le_nat mem_Collect_eq subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> carrcq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cond cond_def q_len <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> ineq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cond_def q_len cond <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Isp_lt_r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Isp_gt_r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">r</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Is_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Isp_lt_r</span> <span class="main">∩</span> <span class="var">?Isp_gt_r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Is_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Isp_lt_r</span> <span class="main">⊆</span> <span class="skolem">Is</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> Isp_lt_0m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Isp_lt_r</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_I_def Is_valid p less_imp_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Isp_gt_r</span> <span class="main">⊆</span> <span class="skolem">Is</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> Isp_gt_0m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Isp_gt_r</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_I_def Is_valid p less_imp_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Dp_lt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">`</span> <span class="var">?Isp_lt_r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Dp_ge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">`</span> <span class="var">?Isp_gt_r</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> Asub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">r</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> Bsub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">r</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ABinters<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rp p cond <span class="keyword1"><span class="command">unfolding</span></span> cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> r_lt_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p Is_valid<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> valid_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Asub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_lt_m Bsub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">`</span> <span class="skolem">A</span> <span class="main">∩</span> <span class="free">a</span> <span class="main">`</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inj_on_image_Int<span class="main">[</span><span class="operator">OF</span> inj_a 1 2<span class="main">]</span> ABinters <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> inja <span class="main">=</span> this

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">r</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">r</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">r</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inja<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">r</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">r</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rp p Is_valid<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> valid_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> gtr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">w</span> <span class="main">∈</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">r</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ls</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span><span class="main">{</span>Suc <span class="skolem">r</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> w_in_q<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bla<span class="main">[</span><span class="operator">OF</span> w2<span class="main">]</span> w1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hs</span> <span class="skolem">q</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rR rLarge <span class="keyword1"><span class="command">using</span></span> q_len <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="skolem">hs</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">q</span> <span class="main">-</span><span class="main">{</span><span class="skolem">hs</span> <span class="skolem">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w1 w_in_q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Is</span> <span class="skolem">q</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">hs</span> <span class="skolem">q</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> q_len Is_valid<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> valid_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">w</span> <span class="main">∈</span> span <span class="main">(</span> <span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">q</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">hs</span> <span class="skolem">q</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> span_mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> span <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">q</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">hs</span> <span class="skolem">q</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cond<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> q_len <span class="keyword1"><span class="command">unfolding</span></span> cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a w2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ls</span> <span class="skolem">p</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="free">a</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">note</span></span> pp <span class="main">=</span> cond<span class="main">[</span><span class="operator">OF</span> p<span class="main">,</span> <span class="operator">unfolded</span> cond_def rp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> qq <span class="main">=</span> cond<span class="main">[</span><span class="operator">OF</span> q_len<span class="main">,</span> <span class="operator">unfolded</span> cond_def q1<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∙</span> lincomb <span class="main">(</span><span class="skolem">ls</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> blin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span> <span class="main">∈</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ls</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_scalar_prod_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> carrDp carrcq<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span> <span class="main">∈</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">r</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
     <span class="main">(</span><span class="main">(</span><span class="skolem">ls</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> split<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span> <span class="main">∈</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ls</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>
       <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span> <span class="main">∈</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ls</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>
      <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span> <span class="main">∈</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span>Suc <span class="skolem">r</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ls</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ one<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inja<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span> <span class="main">∈</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ls</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>
       <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span> <span class="main">∈</span> <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ls</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum.neutral gtr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> add_le_less_mono sum_nonneg mult_nonneg_nonneg<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">ls</span> <span class="skolem">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pp x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qq x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">Is</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="skolem">ls</span> <span class="skolem">p</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ls</span> <span class="skolem">p</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="free">a</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">w</span><span class="main">∈</span><span class="free">a</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Is</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">r</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="skolem">ls</span> <span class="skolem">p</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mult_neg_neg<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ls</span> <span class="skolem">p</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="free">a</span> <span class="skolem">r</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="skolem">q</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Fundamental_Theorem_Linear_Inequalities-fundamental_theorem_neg_C_or_B_in_context"><span class="command">lemma</span></span> fundamental_theorem_neg_C_or_B_in_context<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">=</span> <span class="free">a</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">W</span> <span class="main">∧</span> card <span class="bound">U</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="bound">U</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> finite_cone <span class="bound">U</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">c</span> <span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">W</span> <span class="main">∧</span>
           <span class="bound">c</span> <span class="main">∈</span> <span class="main">{</span>normal_vector <span class="bound">U</span><span class="main">,</span> <span class="main">-</span> normal_vector <span class="bound">U</span><span class="main">}</span> <span class="main">∧</span>
           Suc <span class="main">(</span>card <span class="bound">U</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="bound">U</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> <span class="free">W</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">w</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> acyclic_imp_goal<span class="main">[</span><span class="operator">unfolded</span> goal_def<span class="main">,</span> <span class="operator">OF</span> acyclic_step_rel<span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">I</span><span class="main">.</span> <span class="bound">I</span><span class="main">⊆</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">∧</span> card <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> finite_cone <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> W <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span> <span class="bound">I</span><span class="main">.</span> <span class="bound">I</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">∧</span>
          <span class="bound">c</span> <span class="main">∈</span> <span class="main">{</span>normal_vector <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> normal_vector <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span>
          Suc <span class="main">(</span>card <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="bound">I</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">∙</span> <span class="free">a</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">∧</span>
          <span class="skolem">c</span> <span class="main">∈</span> <span class="main">{</span>normal_vector <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> normal_vector <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span>
          Suc <span class="main">(</span>card <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="main">(</span><span class="free">a</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="free">a</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> W
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disjI2 exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">a</span></span></span> <span class="main"><span class="main"><span class="main">`</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">I</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Fundamental_Theorem_Linear_Inequalities-fundamental_theorem_of_linear_inequalities_C_imp_B_full_dim"><span class="command">lemma</span></span> fundamental_theorem_of_linear_inequalities_C_imp_B_full_dim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">A</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span> <span class="comment1">(* this condition was a wlog in the proof *)</span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span> <span class="bound">c</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> <span class="main">{</span>normal_vector <span class="bound">B</span><span class="main">,</span> <span class="main">-</span> normal_vector <span class="bound">B</span><span class="main">}</span> <span class="main">∧</span> Suc <span class="main">(</span>card <span class="bound">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>
      <span class="main">∧</span> lin_indpt <span class="bound">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">B</span></span> <span class="main">⊆</span> <span class="free">A</span><span class="main">.</span> lin_indpt <span class="bound">B</span> <span class="main">∧</span> card <span class="bound">B</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> finite_cone <span class="bound">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> finite_distinct_list<span class="main">[</span><span class="operator">OF</span> fin<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> Aas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> set <span class="skolem">as</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> length <span class="skolem">as</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">as</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">a</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> m_def a_def Aas <span class="keyword1"><span class="command">using</span></span> inj_on_nth<span class="main">[</span><span class="operator">OF</span> dist<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fundamental_theorem_neg_C_or_B_in_context<span class="main">[</span><span class="operator">OF</span> _ inj b<span class="main">,</span> <span class="operator">folded</span> id<span class="main">,</span> <span class="operator">OF</span> A span refl<span class="main">]</span> C
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Fundamental_Theorem_Linear_Inequalities-fundamental_theorem_of_linear_inequalities_full_dim"><span class="command">lemma</span></span> fundamental_theorem_of_linear_inequalities_full_dim<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">HyperN</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∄</span> <span class="bound">B</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> <span class="main">{</span>normal_vector <span class="bound">B</span><span class="main">,</span> <span class="main">-</span> normal_vector <span class="bound">B</span><span class="main">}</span>
      <span class="main">∧</span> Suc <span class="main">(</span>card <span class="bound">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="bound">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">HyperA</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∄</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">lin_indpt_cone</span> <span class="main">≡</span> <span class="main">⋃</span> <span class="main">{</span> finite_cone <span class="bound">B</span> <span class="main">|</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">B</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="bound">B</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">A</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">lin_indpt_cone</span>"</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">HyperN</span>"</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">HyperA</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lin_indpt_cone</span> <span class="main">⊆</span> cone <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lin_indpt_cone_def cone_def <span class="keyword1"><span class="command">using</span></span> fin finite_cone_mono A
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">⊆</span> <span class="free">HyperA</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
    <span class="keyword3"><span class="command">assume</span></span> cA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> cone <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> fundamental_theorem_of_linear_inequalities_A_imp_D<span class="main">[</span><span class="operator">OF</span> A fin this<span class="main">]</span> cone_carrier<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> cA
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">HyperA</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> HyperA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">HyperA</span> <span class="main">⊆</span> <span class="free">HyperN</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">HyperA</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> False<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">v</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∙</span> <span class="skolem">c</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> False"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> HyperA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">HyperN</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> HyperN_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI c notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">W</span> <span class="skolem">nv</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> A fin <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> False<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">nv</span></span><span class="main">]</span> 1 normal_vector<span class="main">[</span><span class="operator">OF</span> fin _ _ W<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">HyperN</span> <span class="main">⊆</span> <span class="free">lin_indpt_cone</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">HyperN</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> HyperN_def<span class="main">]</span>
      fundamental_theorem_of_linear_inequalities_C_imp_B_full_dim<span class="main">[</span><span class="operator">OF</span> A fin span<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">lin_indpt_cone</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lin_indpt_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">lin_indpt_cone</span>"</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">HyperN</span>"</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">HyperA</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Fundamental_Theorem_Linear_Inequalities-fundamental_theorem_of_linear_inequalities_C_imp_B"><span class="command">lemma</span></span> fundamental_theorem_of_linear_inequalities_C_imp_B<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span> <span class="bound">c</span> <span class="bound">A'</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>
      <span class="main">∧</span> <span class="bound">A'</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> Suc <span class="main">(</span>card <span class="bound">A'</span><span class="main">)</span> <span class="main">=</span> dim_span <span class="main">(</span>insert <span class="free">b</span> <span class="free">A</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">A'</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
      <span class="main">∧</span> lin_indpt <span class="bound">A'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">B</span></span> <span class="main">⊆</span> <span class="free">A</span><span class="main">.</span> lin_indpt <span class="bound">B</span> <span class="main">∧</span> card <span class="bound">B</span> <span class="main">=</span> dim_span <span class="free">A</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> finite_cone <span class="bound">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> exists_lin_indpt_sublist<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="skolem">A'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span> <span class="main">=</span> span <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A'A<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> linA'<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lin_indpt_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> A'A A <span class="keyword1"><span class="command">have</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">A'</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> dim_spanA<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_span <span class="free">A</span> <span class="main">=</span> card <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> same_span_imp_card_eq_dim_span<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A' A span linA'<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> span <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> span <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> span <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> lin <span class="keyword1"><span class="command">have</span></span> linAb<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="main">(</span><span class="skolem">A'</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lin_indpt_list_def
      <span class="keyword1"><span class="command">using</span></span> lin_dep_iff_in_span<span class="main">[</span><span class="operator">OF</span> A' _ b<span class="main">]</span> span_mem<span class="main">[</span><span class="operator">OF</span> A'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">interpret</span></span> gso<span class="main">:</span> gram_schmidt_fs_lin_indpt <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> linAb<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> lin_indpt_list_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="skolem">A'</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">-</span> gso.gso <span class="var">?m</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gso.gso_carrier<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> gso.gso_times_self_is_norm<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> gso.gso <span class="var">?m</span> <span class="main">=</span> sq_norm <span class="main">(</span>gso.gso <span class="var">?m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> b c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gso.sq_norm_pos<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> cb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b c comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> b c<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> span <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> span <span class="keyword1"><span class="command">using</span></span> span_mem<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> finite_in_span<span class="main">[</span><span class="operator">OF</span> _ A' this<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> lincomb <span class="skolem">l</span> <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∙</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∙</span> lincomb <span class="skolem">l</span> <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lincomb_scalar_prod_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A' c<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> A'<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> set_conv_nth<span class="main"><span class="keyword3">,</span></span>
            <span class="operator">insert</span> gso.gso_scalar_zero<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?m</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span> c<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def nth_append <span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∙</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> cA <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span> <span class="bound">A'</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="bound">A'</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> Suc <span class="main">(</span>card <span class="bound">A'</span><span class="main">)</span> <span class="main">=</span> dim_span <span class="main">(</span>insert <span class="free">b</span> <span class="free">A</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">A'</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> lin_indpt <span class="bound">A'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"set <span class="skolem"><span class="skolem">A'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> conjI A'A linA' cb c<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="skolem">A'</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cA A'A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_span <span class="main">(</span>insert <span class="free">b</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>dim_span <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dim_span_insert<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A b False<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dim_spanA <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_span <span class="main">(</span>insert <span class="free">b</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> bspan<span class="main">:</span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> normal_vectors <span class="skolem">A'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> normal_vectors<span class="main">[</span><span class="operator">OF</span> lin<span class="main">,</span> <span class="operator">folded</span> N_def<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">N</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      orthA'N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span> <span class="bound">nv</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="skolem">A'</span> <span class="main">⟹</span> <span class="bound">nv</span> <span class="main">∈</span> set <span class="skolem">N</span> <span class="main">⟹</span> <span class="bound">nv</span> <span class="main">∙</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      linAN<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="main">(</span><span class="skolem">A'</span> <span class="main">@</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
      lenAN<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">A'</span> <span class="main">@</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      disj<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">A'</span> <span class="main">∩</span> set <span class="skolem">N</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> linAN lenAN <span class="keyword1"><span class="command">have</span></span> full_span'<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="main">(</span><span class="skolem">A'</span> <span class="main">@</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lin_indpt_list_length_eq_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> full_span''<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="skolem">A'</span> <span class="main">∪</span> set <span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> A N A' <span class="keyword1"><span class="command">have</span></span> AN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> set <span class="skolem">N</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A'N<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">A'</span> <span class="main">@</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> set <span class="skolem">N</span><span class="main">)</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> span_is_subset2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A'A span_is_monotone<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">A'</span> <span class="main">@</span> <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> set <span class="skolem">N</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> full_span'<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> full_span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> set <span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword1"><span class="command">have</span></span> finAN<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> set <span class="skolem">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> fundamental <span class="main">=</span> fundamental_theorem_of_linear_inequalities_full_dim<span class="main">[</span><span class="operator">OF</span> AN finAN full_span<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> cone <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> set <span class="skolem">N</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> fundamental<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> CAN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∪</span> set <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cardC<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">C</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> linC<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">C</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> bC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> finite_cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> finC<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> CAN<span class="main">]</span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> CAN A N <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> bC<span class="main">[</span><span class="operator">unfolded</span> finite_cone_def nonneg_lincomb_def<span class="main">]</span> finC <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> bC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="main">⟹</span> <span class="skolem">c</span> <span class="bound">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">-</span> set <span class="skolem">N</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?C</span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> subset_li_is_li<span class="main">[</span><span class="operator">OF</span> linC<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> CA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> CAN <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="main">(</span><span class="var">?C</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> set <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bC
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"lincomb <span class="main"><span class="main"><span class="main">_</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="main">(</span><span class="var">?C</span> <span class="main">-</span> <span class="skolem">C</span> <span class="main">∩</span> set <span class="skolem">N</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> orthogonal_cone<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> A N fin full_span'' orthA'N refl span
              A'A linAN lenAN _ CA _ bc<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>set <span class="skolem">N</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ortho_span'<span class="main">[</span><span class="operator">OF</span> A' N _ bspan<span class="main"><span class="main">[</span></span><span class="operator">folded</span> span<span class="main"><span class="main">]</span></span><span class="main">]</span> orthA'N <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">-</span> <span class="skolem">C</span> <span class="main">∩</span> set <span class="skolem">N</span> <span class="main">=</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> lincomb <span class="skolem">c</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> nonneg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonneg_lincomb <span class="skolem">c</span> <span class="var">?C</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> finite_cone <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> CA fin<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> Cid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∩</span> set <span class="skolem">N</span> <span class="main">∪</span> <span class="var">?C</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">A'</span> <span class="main">+</span> length <span class="skolem">N</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> set <span class="skolem">N</span> <span class="main">∪</span> <span class="var">?C</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> Cid cardC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> set <span class="skolem">N</span><span class="main">)</span> <span class="main">+</span> card <span class="var">?C</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Un_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> finC<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> length <span class="skolem">N</span> <span class="main">+</span> card <span class="var">?C</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_right_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> order.trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">N</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
              <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_length<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">A'</span> <span class="main">=</span> card <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lin<span class="main">[</span><span class="operator">unfolded</span> lin_indpt_list_def<span class="main">]</span>
            distinct_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_span <span class="free">A</span> <span class="main">≤</span> card <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dim_spanA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> CA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> span <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> CA C in_own_span<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> linC<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subset_li_is_li<span class="main">[</span><span class="operator">OF</span> linC<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?C</span> <span class="main">=</span> dim_span <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> card_le_dim_span<span class="main">[</span><span class="operator">OF</span> _ CA linC<span class="main">]</span> le C <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> False<span class="main">[</span><span class="operator">unfolded</span> fundamental<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> b
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        CAN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∪</span> set <span class="skolem">N</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
        cardC<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
        linC<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        contains<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">∈</span><span class="free">A</span> <span class="main">∪</span> set <span class="skolem">N</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        cb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        nv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">{</span>normal_vector <span class="skolem">C</span><span class="main">,</span> <span class="main">-</span> normal_vector <span class="skolem">C</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> CAN A N <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> cardC <span class="keyword1"><span class="command">have</span></span> cardCn<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">C</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> CAN<span class="main">]</span> fin <span class="keyword1"><span class="command">have</span></span> finC<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">-</span> set <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">note</span></span> nv' <span class="main">=</span> normal_vector<span class="main">(</span>1-4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> finC cardC linC C<span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> nv' nv <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span> <span class="bound">A'</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="bound">A'</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> Suc <span class="main">(</span>card <span class="bound">A'</span><span class="main">)</span> <span class="main">=</span> dim_span <span class="main">(</span>insert <span class="free">b</span> <span class="free">A</span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">A'</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> lin_indpt <span class="bound">A'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?C</span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI cb c<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> CA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> CAN <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> contains <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> lin'<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subset_li_is_li<span class="main">[</span><span class="operator">OF</span> linC<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> sC0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span> <span class="var">?C</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">∙</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nv' nv C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> Cid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∩</span> set <span class="skolem">N</span> <span class="main">∪</span> <span class="var">?C</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_span <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> same_span_imp_card_eq_dim_span<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A' A' refl linA'<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> length <span class="skolem">A'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> lin<span class="main">[</span><span class="operator">unfolded</span> lin_indpt_list_def<span class="main">]</span> distinct_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> dimA'<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_span <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> bspan <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>insert <span class="free">b</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> span <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b A <span class="keyword1"><span class="command">using</span></span> already_in_span <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> dim_span_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">folded</span> span<span class="main"><span class="main">]</span></span><span class="main">]</span> dimA'
        <span class="keyword1"><span class="command">have</span></span> dimbA<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_span <span class="main">(</span>insert <span class="free">b</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="var">?C</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">A'</span> <span class="main">≠</span> Suc <span class="main">(</span>card <span class="var">?C</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">A'</span> <span class="main">+</span> length <span class="skolem">N</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> set <span class="skolem">N</span> <span class="main">∪</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cid cardC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> set <span class="skolem">N</span><span class="main">)</span> <span class="main">+</span> card <span class="var">?C</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Un_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> finC<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">A'</span> <span class="main">+</span> length <span class="skolem">N</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> set <span class="skolem">N</span><span class="main">)</span> <span class="main">+</span> card <span class="var">?C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">have</span></span> le1<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> set <span class="skolem">N</span><span class="main">)</span> <span class="main">≤</span> length <span class="skolem">N</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_lower2 List.finite_set card_length card_mono inf.absorb_iff2 le_inf_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> CA C A <span class="keyword1"><span class="command">have</span></span> CsA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> span <span class="main">(</span>set <span class="skolem">A'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> span <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_own_span order.trans<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> card_le_dim_span<span class="main">[</span><span class="operator">OF</span> _ this lin'<span class="main">]</span> C
          <span class="keyword1"><span class="command">have</span></span> le2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="var">?C</span> <span class="main">≤</span> length <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dimA' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> id le1 le2 neq
          <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="var">?C</span> <span class="main">=</span> length <span class="skolem">A'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">from</span></span> card_eq_dim_span_imp_same_span<span class="main">[</span><span class="operator">OF</span> A' CsA lin' id2<span class="main"><span class="main">[</span></span><span class="operator">folded</span> dimA'<span class="main"><span class="main">]</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"span <span class="var">?C</span> <span class="main">=</span> span <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> span <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> bspan <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> span <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> orthocompl_span<span class="main">[</span><span class="operator">OF</span> _ _ c this<span class="main">]</span> C sC0
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> cb <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="var">?C</span><span class="main">)</span> <span class="main">=</span> dim_span <span class="main">(</span>insert <span class="free">b</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Fundamental_Theorem_Linear_Inequalities-fundamental_theorem_of_linear_inequalities"><span class="command">lemma</span></span> fundamental_theorem_of_linear_inequalities<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec set"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">HyperN</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∄</span> <span class="bound">c</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span>
      <span class="main">∧</span> Suc <span class="main">(</span>card <span class="bound">B</span><span class="main">)</span> <span class="main">=</span> dim_span <span class="main">(</span>insert <span class="bound">b</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> lin_indpt <span class="bound">B</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">HyperA</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∄</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">lin_indpt_cone</span> <span class="main">≡</span> <span class="main">⋃</span> <span class="main">{</span> finite_cone <span class="bound">B</span> <span class="main">|</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> card <span class="bound">B</span> <span class="main">=</span> dim_span <span class="free">A</span> <span class="main">∧</span> lin_indpt <span class="bound">B</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">lin_indpt_cone</span>"</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">HyperN</span>"</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">HyperA</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lin_indpt_cone</span> <span class="main">⊆</span> cone <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> lin_indpt_cone_def cone_def <span class="keyword1"><span class="command">using</span></span> fin finite_cone_mono A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">⊆</span> <span class="free">HyperA</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fundamental_theorem_of_linear_inequalities_A_imp_D<span class="main">[</span><span class="operator">OF</span> A fin<span class="main">]</span> cone_carrier<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> HyperA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">HyperA</span> <span class="main">⊆</span> <span class="free">HyperN</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> HyperA_def HyperN_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">HyperN</span> <span class="main">⊆</span> <span class="free">lin_indpt_cone</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">HyperN</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> HyperN_def<span class="main">]</span>
      fundamental_theorem_of_linear_inequalities_C_imp_B<span class="main">[</span><span class="operator">OF</span> A fin<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">lin_indpt_cone</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lin_indpt_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">lin_indpt_cone</span>"</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">HyperN</span>"</span></span>
    <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="free">HyperA</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Caratheodory_theorem<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">A</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span>finite_cone <span class="bound">B</span> <span class="main">|</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> lin_indpt <span class="bound">B</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span>finite_cone <span class="bound">B</span> <span class="main">|</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> lin_indpt <span class="bound">B</span><span class="main">}</span> <span class="main">⊆</span> cone <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cone_def
    <span class="keyword1"><span class="command">using</span></span> fin<span class="main">[</span><span class="operator">OF</span> fin_dim _ subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ A<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> cone_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      finB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> BA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> finite_cone <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> BA A <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> cone <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finB a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cone_iff_finite_cone<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> fundamental_theorem_of_linear_inequalities<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> B finB<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> CB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> finite_cone <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> BA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">{</span>finite_cone <span class="bound">B</span> <span class="main">|</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> lin_indpt <span class="bound">B</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span>finite_cone <span class="bound">B</span> <span class="main">|</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> lin_indpt <span class="bound">B</span><span class="main">}</span> <span class="main">⊇</span> cone <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Farkas_Lemma">
<div class="head">
<h1>Theory Farkas_Lemma</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Farkas' Lemma›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove two variants of Farkas' lemma. Note that type here is more general than in the versions
  of Farkas' Lemma which are in the AFP-entry Farkas-Lemma, which is restricted to rational matrices.
  However, there $\delta$-rationals are supported, which are not present here.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Farkas_Lemma
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Fundamental_Theorem_Linear_Inequalities">Fundamental_Theorem_Linear_Inequalities</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> gram_schmidt
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Farkas_Lemma-Farkas_Lemma"><span class="command">lemma</span></span> Farkas_Lemma<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">n</span> <span class="free">nr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟶</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>cols <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C'<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>set <span class="main">(</span>cols <span class="free">A</span><span class="main">)</span><span class="main">.</span> dim_vec <span class="bound">w</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">∈</span> cone <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cone_of_cols<span class="main">[</span><span class="operator">OF</span> A b<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∄</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">∈</span><span class="var">?C</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fundamental_theorem_of_linear_inequalities<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> C finite_set<span class="main">]</span> mem_Collect_eq
    <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">∈</span><span class="var">?C</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">⟶</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> all_cong imp_cong refl<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">∈</span> <span class="var">?C</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">∈</span> <span class="var">?C</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">∙</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ball_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> comm_scalar_prod<span class="main"><span class="main">[</span></span><span class="operator">OF</span> y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> C<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">≤</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">using</span></span> C A y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cols_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">∈</span>set <span class="main">(</span>cols <span class="free">A</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">≤</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Farkas_Lemma-Farkas_Lemma'"><span class="command">lemma</span></span> Farkas_Lemma'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span> carrier_vec <span class="free">nc</span> <span class="main">∧</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span>
         <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span><span class="free">A</span><span class="main">)</span>"</span></span>   
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">-</span><span class="free">b</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">nr</span> <span class="main">+</span> <span class="main">(</span><span class="free">nc</span> <span class="main">+</span> <span class="free">nc</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> id0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">nr</span> <span class="main">+</span> <span class="main">(</span><span class="free">nc</span> <span class="main">+</span> <span class="free">nc</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> idcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def n_def <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">x1</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x2</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x3</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span><span class="main">.</span> 
         <span class="bound">x1</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="bound">x2</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">∧</span> <span class="bound">x3</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="bound">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="bound">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>carrier_vec <span class="free">nc</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> Axb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> bmAx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A b xcarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="free">b</span> <span class="main">-</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bmAx <span class="keyword1"><span class="command">unfolding</span></span> x1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xcarr<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> vec <span class="main">(</span>dim_vec <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xcarr <span class="keyword1"><span class="command">unfolding</span></span> x2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span> <span class="main">=</span> vec <span class="main">(</span>dim_vec <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> x3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xcarr <span class="keyword1"><span class="command">unfolding</span></span> x3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> x2x3carr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">nc</span> <span class="main">+</span> <span class="free">nc</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x2 x3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> x2x3x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">-</span> <span class="skolem">x3</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x2_def x3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">-</span><span class="free">b</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec_le_iff_diff_le_0 b
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A Axb carrier_matD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dim_mult_mat_vec<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> x1lez<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1 <span class="keyword1"><span class="command">unfolding</span></span> x1_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> A Axb carrier_matD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> carrier_vecD diff_ge_0_iff_ge dim_mult_mat_vec 
          index_minus_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_zero_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_eq_vec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> x2lez<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x2 less_eq_vec_def <span class="keyword1"><span class="command">unfolding</span></span> x2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> x3lez<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x3 less_eq_vec_def <span class="keyword1"><span class="command">unfolding</span></span> x3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> B1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x1</span> <span class="main">=</span> <span class="free">b</span> <span class="main">-</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xcarr x1 <span class="keyword1"><span class="command">unfolding</span></span> x1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span> <span class="main">+</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="main">-</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x2 x3 A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x3</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A x2 x3
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_add_distrib_mat_vec uminus_carrier_vec<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x2x3x minus_add_uminus_vec x2 x3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> B2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x1</span> <span class="main">+</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?p1</span> <span class="main">+</span> <span class="var">?p2</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> x1 x2 x3 A mat_mult_append_cols <span class="keyword1"><span class="command">unfolding</span></span> B_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mat_mult_append_cols<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ x1 x2x3carr<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_mult_append_cols<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p1</span> <span class="main">=</span> <span class="free">b</span> <span class="main">-</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B1 <span class="keyword1"><span class="command">unfolding</span></span> x1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p2</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A xcarr b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>carrier_vec <span class="free">nc</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x1</span><span class="main">∈</span>carrier_vec <span class="free">nr</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x2</span><span class="main">∈</span>carrier_vec <span class="free">nc</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x3</span><span class="main">∈</span>carrier_vec <span class="free">nc</span><span class="main">.</span>
          <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">≤</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">≤</span> <span class="bound">x2</span> <span class="main">∧</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">≤</span> <span class="bound">x3</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="bound">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x3</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x1 x2 x3 x1lez x2lez x3lez res <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x1</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x2</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x3</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span><span class="main">.</span> 
            <span class="bound">x1</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="bound">x2</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">∧</span> <span class="bound">x3</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="bound">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="bound">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x1lez<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x2lez<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> x3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x3lez<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> clc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> x2x3carr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">nc</span> <span class="main">+</span> <span class="free">nc</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x2 x3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x2</span> <span class="main">-</span> <span class="skolem">x3</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> xcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x2 x3 <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span> <span class="main">+</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="main">-</span><span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x2 x3 A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x3</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A x2 x3
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_add_distrib_mat_vec uminus_carrier_vec<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> minus_add_uminus_vec x2 x3 <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> B2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> Axcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A xcarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> clc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x1</span> <span class="main">+</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x3</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?p1</span> <span class="main">+</span> <span class="var">?p2</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> x1 x2 x3 A mat_mult_append_cols <span class="keyword1"><span class="command">unfolding</span></span> B_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mat_mult_append_cols<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ x1 x2x3carr<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_mult_append_cols<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p2</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x1</span> <span class="main">+</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A xcarr b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">x1</span> <span class="main">+</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1 A b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1 A b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1lez <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Axcarr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">-</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="skolem">x1</span> <span class="main">+</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>›</span></span> carrier_vecD comm_add_vec index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          minus_add_minus_vec minus_cancel_vec vec_le_iff_diff_le_0 x1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x1</span><span class="main">∈</span>carrier_vec <span class="free">nr</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x2</span><span class="main">∈</span>carrier_vec <span class="free">nc</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x3</span><span class="main">∈</span>carrier_vec <span class="free">nc</span><span class="main">.</span>
          <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">≤</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">≤</span> <span class="bound">x2</span> <span class="main">∧</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">≤</span> <span class="bound">x3</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="bound">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x3</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">⟹</span>
          <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>carrier_vec <span class="free">nc</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xcarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x1</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x2</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x3</span> <span class="main">∈</span> carrier_vec <span class="free">nc</span><span class="main">.</span> 
         <span class="main">(</span><span class="bound">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="bound">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x3</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span>  <span class="main">∧</span> <span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="bound">x1</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="bound">x2</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_vec_le id0 n_def zero_carrier_vec<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="skolem">n</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span>  <span class="main">∧</span> <span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> n_def exists_vec_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">x</span></span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">.</span> <span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span> <span class="main">⟶</span> <span class="skolem">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gram_schmidt.Farkas_Lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> B b<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> all_cong imp_cong refl<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> idtcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> Atcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">∈</span> carrier_mat <span class="free">nc</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> mAtcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">∈</span> carrier_mat <span class="free">nc</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> AtAtcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="free">nc</span> <span class="main">+</span> <span class="free">nc</span><span class="main">)</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_cols_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> mat_mult_append<span class="main">[</span><span class="operator">OF</span> Atcarr mAtcarr y<span class="main">]</span> mat_mult_append y Atcarr idtcarr mAtcarr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AtAtcarr<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="main">-</span> <span class="free">A</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> id0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">A</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atcarr append_vec_le mult_mat_vec_carrier one_mult_mat_vec transpose_one y zero_carrier_vec<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">∧</span> <span class="main">-</span><span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A Atcarr carrier_matD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> carrier_vecD transpose_uminus uminus_mult_mat_vec y<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> A Atcarr carrier_matD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> carrier_vecD index_zero_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          mAtcarr mult_mat_vec_carrier transpose_uminus uminus_mult_mat_vec uminus_uminus_vec
          vec_le_iff_diff_le_0 y zero_minus_vec<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">≥</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nc</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Farkas_Minkowsky_Weyl">
<div class="head">
<h1>Theory Farkas_Minkowsky_Weyl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Theorem of Farkas, Minkowsky and Weyl›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove the theorem of Farkas, Minkowsky and Weyl that a cone is finitely generated
  iff it is polyhedral. Moreover, we provide quantative bounds.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Farkas_Minkowsky_Weyl
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Fundamental_Theorem_Linear_Inequalities">Fundamental_Theorem_Linear_Inequalities</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> gram_schmidt
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We first prove the one direction of the theorem
  for the case that the span of the vectors is the full n-dimensional space.›</span></span>

<span class="keyword1" id="Farkas_Minkowsky_Weyl-farkas_minkowsky_weyl_theorem_1_full_dim"><span class="command">lemma</span></span> farkas_minkowsky_weyl_theorem_1_full_dim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="free">X</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">nr</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> carrier_mat <span class="bound">nr</span> <span class="free">n</span> <span class="main">∧</span> cone <span class="free">X</span> <span class="main">=</span> polyhedral_cone <span class="bound">A</span>
  <span class="main">∧</span> <span class="main">(</span><span class="free">X</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cond</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cond</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">W</span><span class="main">.</span> Suc <span class="main">(</span>card <span class="bound">W</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="bound">W</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">W</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cond</span> <span class="skolem">W</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="skolem">W</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> WX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cond_def
      <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ fin<span class="main">]</span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> nv <span class="main">=</span> normal_vector<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"normal_vector <span class="skolem">W</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="skolem">W</span> <span class="main">⟹</span> normal_vector <span class="skolem">W</span> <span class="main">∙</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="quoted"><span class="quoted">"normal_vector <span class="skolem">W</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span> <span class="main">⟹</span> normal_vector <span class="skolem">W</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> WX <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> condD <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ns</span> <span class="main">=</span> <span class="main">{</span> normal_vector <span class="bound">W</span> <span class="main">|</span> <span class="bound">W</span><span class="main">.</span> <span class="skolem">cond</span> <span class="bound">W</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> normal_vector <span class="bound">W</span> <span class="main">∙</span> <span class="bound">w</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">}</span>
       <span class="main">∪</span> <span class="main">{</span> <span class="main">-</span> normal_vector <span class="bound">W</span> <span class="main">|</span> <span class="bound">W</span><span class="main">.</span> <span class="skolem">cond</span> <span class="bound">W</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> normal_vector <span class="bound">W</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">w</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ns</span> <span class="main">⊆</span> normal_vector <span class="main">`</span> <span class="main">{</span><span class="bound">W</span> <span class="main">.</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">W</span><span class="main">.</span> <span class="main">-</span> normal_vector <span class="bound">W</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ns_def cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finite_list<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ns</span> <span class="main">=</span> <span class="skolem">Ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ns</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ns_def <span class="keyword1"><span class="command">using</span></span> condD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> mat_of_rows <span class="free">n</span> <span class="skolem">ns</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nr</span> <span class="main">=</span> length <span class="skolem">ns</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">A</span> <span class="main">∈</span> carrier_mat <span class="skolem">nr</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def nr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> A<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> not_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ns</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">nv</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">nv</span> <span class="main">∈</span> <span class="main">{</span>normal_vector <span class="bound">W</span><span class="main">,</span> <span class="main">-</span> normal_vector <span class="bound">W</span><span class="main">}</span> <span class="main">∧</span>
             Suc <span class="main">(</span>card <span class="bound">W</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> lin_indpt <span class="bound">W</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">nv</span> <span class="main">∙</span> <span class="bound">a<span class="hidden">⇩</span><sub>i</sub></span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Ns_def cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polyhedral_cone <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">b</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">nr</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> polyhedral_cone_def
      <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="skolem">nr</span><span class="main">.</span> row <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span><span class="main">)</span> <span class="bound">i</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="skolem">nr</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">ns</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A Ns<span class="main">[</span><span class="operator">folded</span> ns<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Collect_cong conj_cong refl all_cong arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">∙</span></span></span> <span class="main"><span class="main"><span class="main">_</span></span></span> <span class="main"><span class="main"><span class="main">≤</span></span></span> <span class="main"><span class="main"><span class="main">_</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def mat_of_rows_def nr_def set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="skolem">Ns</span><span class="main">.</span> <span class="main">-</span> <span class="bound">n</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ns<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> nr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="skolem">Ns</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Collect_cong conj_cong refl ball_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Ns<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cone <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fundamental_theorem_of_linear_inequalities_full_dim<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> X fin span<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Collect_cong conj_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> not_le<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> not_ex not_conj not_not id<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">X</span> <span class="main">=</span> polyhedral_cone <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> XI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> set <span class="main">(</span>rows <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">v</span> <span class="main">∈</span> set <span class="main">(</span>rows <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">Ns</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">using</span></span> ns Ns <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> Ns_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> cW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cond</span> <span class="skolem">W</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">v</span> <span class="main">=</span> normal_vector <span class="skolem">W</span> <span class="main">∨</span> <span class="skolem">v</span> <span class="main">=</span> normal_vector <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> cW<span class="main">[</span><span class="operator">unfolded</span> cond_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> WX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> v <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> normal_vector <span class="skolem">W</span> <span class="main">∨</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">-</span> normal_vector <span class="skolem">W</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> uminus_uminus_vec<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> condD<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> cW XI<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_vector <span class="skolem">W</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rows <span class="main">(</span><span class="main">-</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We next generalize the theorem to the case where X does not span the full space.
  To this end, we extend X by unit-vectors until the full space is spanned, and then
  add the normal-vectors of these unit-vectors which are orthogonal to span X as additional
  constraints to the resulting matrix.›</span></span>
<span class="keyword1" id="Farkas_Minkowsky_Weyl-farkas_minkowsky_weyl_theorem_1"><span class="command">lemma</span></span> farkas_minkowsky_weyl_theorem_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> finX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">nr</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> carrier_mat <span class="bound">nr</span> <span class="free">n</span> <span class="main">∧</span> cone <span class="free">X</span> <span class="main">=</span> polyhedral_cone <span class="bound">A</span> <span class="main">∧</span>
    <span class="main">(</span><span class="free">X</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> exists_lin_indpt_sublist<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ls</span></span> <span class="keyword2"><span class="keyword">where</span></span> lin_Ls<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="skolem">Ls</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    spanL<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="skolem">Ls</span><span class="main">)</span> <span class="main">=</span> span <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> LX<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ls</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ns</span> <span class="main">=</span> normal_vectors <span class="skolem">Ls</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Bs</span> <span class="main">=</span> basis_extension <span class="skolem">Ls</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> basis_extension<span class="main">[</span><span class="operator">OF</span> lin_Ls<span class="main">,</span> <span class="operator">folded</span> Bs_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> BU<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Bs</span> <span class="main">⊆</span> set <span class="main">(</span>unit_vecs <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lin_Ls_Bs<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="main">(</span><span class="skolem">Ls</span> <span class="main">@</span> <span class="skolem">Bs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> len_Ls_Bs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">Ls</span> <span class="main">@</span> <span class="skolem">Bs</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> nv <span class="main">=</span> normal_vectors<span class="main">[</span><span class="operator">OF</span> lin_Ls<span class="main">,</span> <span class="operator">folded</span> Ns_def<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> nv<span class="main">(</span>1-6<span class="main">)</span> nv<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Bnd</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ns</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> LN'<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="main">(</span><span class="skolem">Ls</span> <span class="main">@</span> <span class="skolem">Ns</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">Ls</span> <span class="main">@</span> <span class="skolem">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ortho<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">l</span> <span class="main">∈</span> set <span class="skolem">Ls</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="skolem">Ns</span> <span class="main">⟹</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Ns_bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ls</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>
     <span class="main">⟹</span> set <span class="skolem">Ns</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> lin_indpt_list_length_eq_n<span class="main">[</span><span class="operator">OF</span> LN'<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> spanLN<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="main">(</span>set <span class="skolem">Ls</span> <span class="main">∪</span> set <span class="skolem">Ns</span><span class="main">)</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Bnd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Bndm</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Bounded_mat <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="free">X</span> <span class="main">∪</span> set <span class="skolem">Bs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> lin_Ls_Bs<span class="main">[</span><span class="operator">unfolded</span> lin_indpt_list_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    Ls<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ls</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Bs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Bs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    distLsBs<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">Ls</span> <span class="main">@</span> <span class="skolem">Bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    lin'<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="main">(</span>set <span class="main">(</span><span class="skolem">Ls</span> <span class="main">@</span> <span class="skolem">Bs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> LN<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ls</span> <span class="main">∩</span> set <span class="skolem">Ns</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">Ls</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">Ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ortho<span class="main">[</span><span class="operator">OF</span> xX xW<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sq_norm <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sq_norm_vec_as_cscalar_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> xX LX X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> vs_zero_lin_dep<span class="main">[</span><span class="operator">OF</span> _ lin'<span class="main">]</span> Ls Bs xX <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X Bs <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> CLB<span class="main">:</span> <span class="quoted"><span class="quoted">"carrier_vec <span class="free">n</span> <span class="main">=</span> span <span class="main">(</span>set <span class="main">(</span><span class="skolem">Ls</span> <span class="main">@</span> <span class="skolem">Bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lin_Ls_Bs len_Ls_Bs lin_indpt_list_length_eq_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> span <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> span_is_monotone<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> LX<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> span<span class="main">:</span> <span class="quoted"><span class="quoted">"span <span class="skolem">Y</span> <span class="main">=</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> finY<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finX <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> farkas_minkowsky_weyl_theorem_1_full_dim<span class="main">[</span><span class="operator">OF</span> Y finY span<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">nr</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> carrier_mat <span class="skolem">nr</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> YA<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="skolem">Y</span> <span class="main">=</span> polyhedral_cone <span class="skolem">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Y_Ints<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="var">?Bndm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span>row <span class="skolem">A</span> <span class="bound">i</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">nr</span><span class="main">}</span> <span class="main">∪</span> set <span class="skolem">Ns</span> <span class="main">∪</span> uminus <span class="main">`</span> set <span class="skolem">Ns</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finite_list<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs_def<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">=</span> <span class="main">{</span>row <span class="skolem">A</span> <span class="bound">i</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">nr</span><span class="main">}</span> <span class="main">∪</span> set <span class="skolem">Ns</span> <span class="main">∪</span> uminus <span class="main">`</span> set <span class="skolem">Ns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> A N <span class="keyword1"><span class="command">have</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="skolem">rs</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> mat_of_rows <span class="free">n</span> <span class="skolem">rs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> carrier_mat <span class="var">?m</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> B<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">∈</span><span class="main">{</span><span class="skolem">rs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?m</span><span class="main">}</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">r</span></span> <span class="main">&lt;</span> <span class="var">?m</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="skolem">rs</span> <span class="main">!</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polyhedral_cone <span class="skolem">B</span> <span class="main">=</span> <span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> polyhedral_cone_def
      <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="var">?m</span><span class="main">.</span> row <span class="skolem">B</span> <span class="bound">i</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="skolem">rs</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth id
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Collect_cong conj_cong refl all_cong arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">∙</span></span></span> <span class="main"><span class="main"><span class="main">_</span></span></span> <span class="main"><span class="main"><span class="main">≤</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="skolem">nr</span><span class="main">.</span> row <span class="skolem">A</span> <span class="bound">i</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span>
           <span class="main">∩</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="skolem">Ns</span> <span class="main">∪</span> uminus <span class="main">`</span> set <span class="skolem">Ns</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="skolem">nr</span><span class="main">.</span> row <span class="skolem">A</span> <span class="bound">i</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> polyhedral_cone <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> polyhedral_cone_def <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_vec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cone <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> YA <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="skolem">Ns</span> <span class="main">∪</span> uminus <span class="main">`</span> set <span class="skolem">Ns</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span>
      <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="skolem">Ns</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">⊆</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">w</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="skolem">Ns</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> N <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="skolem">w</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> two <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> scalar_prod_uminus_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> w x<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> one <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⊆</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polyhedral_cone <span class="skolem">B</span> <span class="main">=</span> cone <span class="skolem">Y</span> <span class="main">∩</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>set <span class="skolem">Ns</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cone <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> orthogonal_cone<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> X N finX spanLN ortho refl spanL LX lin_Ls_Bs len_Ls_Bs<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">X</span> <span class="main">=</span> polyhedral_cone <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">assume</span></span> X_I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> LX <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ls</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Ns_bnd<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> N_I_Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ns</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> <span class="var">?Bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> lin_Ls_Bs <span class="keyword1"><span class="command">have</span></span> linLs<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt_list <span class="skolem">Ls</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lin_indpt_list_def
      <span class="keyword1"><span class="command">using</span></span> subset_li_is_li<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ls</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> X_I LX <span class="keyword1"><span class="command">have</span></span> L_I<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Ls</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> Y_I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">using</span></span> X_I BU
        Bounded_vec_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Bnd</span></span> <span class="quoted"><span class="quoted">"max <span class="main">1</span> <span class="free">Bnd</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unit_vecs_def Ints_vec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Y_Ints<span class="main">[</span><span class="operator">OF</span> Y_I<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> A_I_Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rows <span class="skolem">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> <span class="var">?Bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rows <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>rows <span class="main">(</span>mat_of_rows <span class="free">n</span> <span class="skolem">rs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> set <span class="skolem">rs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> set <span class="main">(</span>rows <span class="skolem">A</span><span class="main">)</span> <span class="main">∪</span> set <span class="skolem">Ns</span> <span class="main">∪</span> uminus <span class="main">`</span> set <span class="skolem">Ns</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rs_def rows_def <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> <span class="var">?Bnd</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_I_Bnd N_I_Bnd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="var">?Bndm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now for the other direction.›</span></span>

<span class="keyword1" id="Farkas_Minkowsky_Weyl-farkas_minkowsky_weyl_theorem_2"><span class="command">lemma</span></span> farkas_minkowsky_weyl_theorem_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> finite <span class="bound">X</span> <span class="main">∧</span> polyhedral_cone <span class="free">A</span> <span class="main">=</span> cone <span class="bound">X</span>
    <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="free">Bnd</span> <span class="main">⟶</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rows_A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>row <span class="free">A</span> <span class="bound">i</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">nr</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Bnd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Bounded_vec <span class="main">(</span>det_bound <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> rows_A_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rows_A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> row_carrier_vec A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">mr</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∈</span> carrier_mat <span class="bound">mr</span> <span class="free">n</span> <span class="main">∧</span> cone <span class="var">?rows_A</span> <span class="main">=</span> polyhedral_cone <span class="bound">B</span>
    <span class="main">∧</span> <span class="main">(</span><span class="var">?rows_A</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span> <span class="main">⟶</span> set <span class="main">(</span>rows <span class="bound">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> <span class="var">?Bnd</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> farkas_minkowsky_weyl_theorem_1<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?rows_A</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mr</span></span> <span class="skolem"><span class="skolem">B</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> mr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> carrier_mat <span class="skolem">mr</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="var">?rows_A</span> <span class="main">=</span> polyhedral_cone <span class="skolem">B</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rows_A</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span> <span class="main">⟹</span> set <span class="main">(</span>rows <span class="skolem">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> <span class="var">?Bnd</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rows_B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>row <span class="skolem">B</span> <span class="bound">i</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">mr</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> rows_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rows_B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="var">?rows_B</span> <span class="main">=</span> polyhedral_cone <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rows_B</span> <span class="main">⊆</span> polyhedral_cone <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="var">?rows_B</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> row <span class="skolem">B</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">mr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mr row_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">r</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> index_zero_vec<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span> <span class="free">nr</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">r</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
          <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="var">?rows_A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∈</span> cone <span class="var">?rows_A</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> set_in_cone rows_A_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∈</span> polyhedral_cone <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Br<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">mr</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> polyhedral_cone_def <span class="keyword1"><span class="command">using</span></span> rows_A_n mr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">r</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A i index_mult_mat_vec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">∙</span> <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> _ rn<span class="main">]</span> row_carrier A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>row <span class="skolem">B</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>row <span class="free">A</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> index_mult_mat_vec mr j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Br j <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">r</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> polyhedral_cone <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> polyhedral_cone_def
        <span class="keyword1"><span class="command">using</span></span> A rn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cone <span class="var">?rows_B</span> <span class="main">⊆</span> polyhedral_cone <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cone_in_polyhedral_cone A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">next</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"polyhedral_cone <span class="free">A</span> <span class="main">⊆</span> cone <span class="var">?rows_B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> polyhedral_cone <span class="free">A</span> <span class="main">⊆</span> cone <span class="var">?rows_B</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> yA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> polyhedral_cone <span class="free">A</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> yB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> cone <span class="var">?rows_B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> yn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> polyhedral_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> finRB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?rows_B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> farkas_minkowsky_weyl_theorem_1<span class="main">[</span><span class="operator">OF</span> rows_B finRB<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nr'</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">∈</span> carrier_mat <span class="skolem">nr'</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cone<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="var">?rows_B</span> <span class="main">=</span> polyhedral_cone <span class="skolem">A'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> yB<span class="main">[</span><span class="operator">unfolded</span> cone polyhedral_cone_def<span class="main">]</span> yn A'
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">A'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">nr'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">nr'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"row <span class="skolem">A'</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">using</span></span> A' yn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> row <span class="skolem">A'</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i A' yn <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹row <span class="skolem">A'</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> w yn<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> wy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∙</span> <span class="skolem">w</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="var">?rows_B</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> cone <span class="var">?rows_B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_in_cone<span class="main">[</span><span class="operator">OF</span> rows_B<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> cone polyhedral_cone_def<span class="main">]</span> A'
        <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">b</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">nr'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> less_eq_vec_def<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command">using</span></span> i A' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∙</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> b w<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> wA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> cone <span class="var">?rows_A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B polyhedral_cone_def <span class="keyword1"><span class="command">using</span></span> mr w
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> wy <span class="keyword1"><span class="command">have</span></span> yw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">y</span> <span class="main">∙</span> <span class="skolem">w</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> scalar_prod_uminus_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> yn w<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rows_A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?rows_A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> fundamental_theorem_of_linear_inequalities_A_imp_D<span class="main">[</span><span class="operator">OF</span> this wA<span class="main">,</span> <span class="operator">unfolded</span> not_ex<span class="main">,</span>
          <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">y</span>"</span></span> <span class="main">]</span> yn yw
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">y</span> <span class="main">∙</span> row <span class="free">A</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∙</span> row <span class="free">A</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> scalar_prod_uminus_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i assms yn<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comm_scalar_prod<span class="main">[</span><span class="operator">OF</span> _ yn<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> i assms yn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> yA <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> polyhedral_cone_def less_eq_vec_def <span class="keyword1"><span class="command">using</span></span> i assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rows_B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> row_carrier_vec mr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?rows_B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> rA<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rows <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="var">?rows_A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">unfolding</span></span> rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> rB<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rows <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="var">?rows_B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mr <span class="keyword1"><span class="command">unfolding</span></span> rows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="free">Bnd</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rows <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Bnd<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> rA<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rows_B</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> <span class="var">?Bnd</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rA rB <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Farkas_Minkowsky_Weyl-farkas_minkowsky_weyl_theorem"><span class="command">lemma</span></span> farkas_minkowsky_weyl_theorem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> finite <span class="bound">X</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> cone <span class="bound">X</span><span class="main">)</span>
  <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">A</span> <span class="bound">nr</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> carrier_mat <span class="bound">nr</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> polyhedral_cone <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> farkas_minkowsky_weyl_theorem_1 farkas_minkowsky_weyl_theorem_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Decomposition_Theorem">
<div class="head">
<h1>Theory Decomposition_Theorem</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Decomposition Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory contains a proof of the fact, that every polyhedron can be decomposed
  into a convex hull of a finite set of points + a finitely generated cone, including bounds
  on the numbers that are required in the decomposition.
  We further prove the inverse direction of this theorem (without bounds) and
  as a corollary, we derive that a polyhedron is bounded iff it is the convex hull
  of finitely many points, i.e., a polytope.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Decomposition_Theorem
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#Farkas_Minkowsky_Weyl">Farkas_Minkowsky_Weyl</a>
    <a href="#Convex_Hull">Convex_Hull</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> gram_schmidt
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">polytope</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">V</span><span class="main">.</span> <span class="bound">V</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> finite <span class="bound">V</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> convex_hull <span class="bound">V</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">polyhedron</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Decomposition_Theorem-polyhedra_are_convex"><span class="command">lemma</span></span> polyhedra_are_convex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> polyhedron <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> convexI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> Pcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> polyhedron_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> xy<span class="main">[</span><span class="operator">unfolded</span> P polyhedron_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P polyhedron_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> ay<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ax ay <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> lesseq_vecI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ b<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> lesseq_vecD<span class="main">[</span><span class="operator">OF</span> b le<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> i<span class="main">]</span> lesseq_vecD<span class="main">[</span><span class="operator">OF</span> b le<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> i<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A x y i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scalar_prod_add_distrib<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> mult_left_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> le a<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">locale</span></span> gram_schmidt_m <span class="main">=</span> n<span class="main">:</span> gram_schmidt <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">f_ty</span></span> <span class="main">+</span> m<span class="main">:</span> gram_schmidt <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">f_ty</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">n</span> <span class="free">m</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f_ty</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Decomposition_Theorem-vec_first_lincomb_list"><span class="command">lemma</span></span> vec_first_lincomb_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">Xs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span>n.lincomb_list <span class="free">c</span> <span class="free">Xs</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span>
       m.lincomb_list <span class="free">c</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> vec_first <span class="bound">v</span> <span class="free">m</span><span class="main">)</span> <span class="free">Xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Xs
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nm<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">Xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Xs</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span>n.lincomb_list <span class="skolem">c</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">Xs</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span>
          vec_first <span class="main">(</span><span class="skolem">c</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> n.lincomb_list <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> vec_first <span class="main">(</span><span class="skolem">c</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="free">m</span> <span class="main">+</span> vec_first <span class="main">(</span>n.lincomb_list <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_first_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span><span class="main">]</span> x n.lincomb_list_carrier<span class="main">[</span><span class="operator">OF</span> Xs<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∘</span> Suc"</span></span><span class="main">]</span> nm
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span><span class="skolem">c</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> vec_first <span class="skolem">x</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_first_smult<span class="main">[</span><span class="operator">OF</span> nm<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span>"</span></span><span class="main">]</span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span>n.lincomb_list <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span>
               m.lincomb_list <span class="main">(</span><span class="skolem">c</span> <span class="main">∘</span> Suc<span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> vec_first <span class="bound">v</span> <span class="free">m</span><span class="main">)</span> <span class="skolem">Xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> vec_first <span class="skolem">x</span> <span class="free">m</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span>
               m.lincomb_list <span class="skolem">c</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> vec_first <span class="bound">v</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">Xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Decomposition_Theorem-convex_hull_next_dim"><span class="command">lemma</span></span> convex_hull_next_dim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Xm1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">$</span> <span class="free">m</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">$</span> <span class="free">m</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_first <span class="free">y</span> <span class="free">m</span> <span class="main">∈</span> m.convex_hull <span class="main">{</span>vec_first <span class="bound">y</span> <span class="free">m</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">∈</span> n.cone <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> Xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> set <span class="skolem">Xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>vec_first <span class="bound">y</span> <span class="free">m</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ys</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> vec_first <span class="bound">y</span> <span class="free">m</span><span class="main">)</span> <span class="skolem">Xs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">=</span> set <span class="var">?Ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Xs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vec_first <span class="free">y</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> vec_first <span class="free">y</span> <span class="free">m</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="free">y</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> vec_first_last_append y_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="free">y</span> <span class="main">1</span> <span class="main">=</span> vec_of_scal <span class="main">(</span>vec_last <span class="free">y</span> <span class="main">1</span> <span class="main">$</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_of_scal_dim_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vec_last <span class="free">y</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="free">y</span> <span class="main">1</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">y</span> <span class="main">$</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y_dim <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> vec_last_index<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> xy <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> n.cone <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"n.nonneg_lincomb <span class="skolem">c</span> <span class="free">X</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n.cone_iff_finite_cone<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n.finite_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="free">y</span> <span class="main">$</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> n.lincomb <span class="skolem">c</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> n.nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">$</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">$</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n.lincomb_index<span class="main">[</span><span class="operator">OF</span> _ X<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="skolem">c</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> n.R.finsum_restrict<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> restrict_ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Xm1<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> n.convex_hull <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n.convex_hull_def n.convex_lincomb_def
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"n.convex_hull <span class="free">X</span> <span class="main">⊆</span> n.cone <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> n.convex_hull_def n.convex_lincomb_def n.finite_cone_def n.cone_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"n.convex_hull <span class="free">X</span> <span class="main">=</span> n.convex_hull_list <span class="skolem">Xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> n.finite_convex_hull_iff_convex_hull_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> X Xs<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> n.convex_hull_list <span class="skolem">Xs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">Xs</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Xs</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n.convex_hull_list_def n.convex_lincomb_list_def
        n.nonneg_lincomb_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"m.lincomb_list <span class="skolem">c</span> <span class="var">?Ys</span> <span class="main">=</span> vec_first <span class="free">y</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c vec_first_lincomb_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Xs</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> X Xs <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> m.convex_hull_list <span class="var">?Ys</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> m.convex_hull_list_def m.convex_lincomb_list_def
        m.nonneg_lincomb_list_def
      <span class="keyword1"><span class="command">using</span></span> x_def c0 c1 x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> m.convex_hull_list <span class="var">?Ys</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"m.lincomb_list <span class="skolem">c</span> <span class="var">?Ys</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">Xs</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">c</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Xs</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> m.convex_hull_list_def m.convex_lincomb_list_def
        m.nonneg_lincomb_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span> <span class="main">$</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Xs</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">Xs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">$</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n.lincomb_list_index<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">Xs</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> Xs X <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="skolem">c</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">Xs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> n.R.finsum_restrict<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> restrict_ext<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Xm1 Xs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> c1<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="main">(</span>n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="main">1</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_of_scal_dim_1 vec_last_index<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span>"</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
        n.lincomb_list_carrier Xs X <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="main">(</span>n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> vec_of_scal <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_of_scal_dim_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span>n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_first_lincomb_list <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> Xs X x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span> <span class="main">=</span>
                   vec_first <span class="main">(</span>n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="free">m</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="main">(</span>n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_first_last_append Xs X n.lincomb_list_carrier <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> n.convex_hull_list <span class="skolem">Xs</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n.convex_hull_list_def n.convex_lincomb_list_def
        n.nonneg_lincomb_list_def <span class="keyword1"><span class="command">using</span></span> c0 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"m.convex_hull <span class="var">?Y</span> <span class="main">=</span> m.convex_hull_list <span class="var">?Ys</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> m.finite_convex_hull_iff_convex_hull_list<span class="main">[</span><span class="operator">OF</span> _ Ys<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Decomposition_Theorem-cone_next_dim"><span class="command">lemma</span></span> cone_next_dim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Xm0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">$</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">$</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_first <span class="free">y</span> <span class="free">m</span> <span class="main">∈</span> m.cone <span class="main">{</span>vec_first <span class="bound">y</span> <span class="free">m</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">∈</span> n.cone <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> Xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> set <span class="skolem">Xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>vec_first <span class="bound">y</span> <span class="free">m</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ys</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> vec_first <span class="bound">y</span> <span class="free">m</span><span class="main">)</span> <span class="skolem">Xs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">=</span> set <span class="var">?Ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Xs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vec_first <span class="free">y</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> vec_first <span class="free">y</span> <span class="free">m</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="free">y</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> vec_first_last_append y_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="free">y</span> <span class="main">1</span> <span class="main">=</span> vec_of_scal <span class="main">(</span>vec_last <span class="free">y</span> <span class="main">1</span> <span class="main">$</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_of_scal_dim_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vec_last <span class="free">y</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="free">y</span> <span class="main">1</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">y</span> <span class="main">$</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y_dim <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> vec_last_index<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> xy <span class="main">=</span> this

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"n.cone <span class="free">X</span> <span class="main">=</span> n.cone_list <span class="skolem">Xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n.cone_iff_finite_cone<span class="main">[</span><span class="operator">OF</span> X <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span><span class="main">]</span> n.finite_cone_iff_cone_list<span class="main">[</span><span class="operator">OF</span> X Xs<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> n.cone_list <span class="skolem">Xs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">Xs</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n.cone_list_def n.nonneg_lincomb_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"m.lincomb_list <span class="skolem">c</span> <span class="var">?Ys</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_def
      <span class="keyword1"><span class="command">using</span></span> vec_first_lincomb_list Xs X <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> m.cone_list <span class="var">?Ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c
      <span class="keyword1"><span class="command">unfolding</span></span> m.cone_list_def m.nonneg_lincomb_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> m.cone_list <span class="var">?Ys</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"m.lincomb_list <span class="skolem">c</span> <span class="var">?Ys</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">Xs</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> m.cone_list_def m.nonneg_lincomb_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="main">(</span>n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="main">1</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span> <span class="main">$</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> n.lincomb_list_carrier X Xs vec_last_index<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n.lincomb_list_index<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">Xs</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> Xs X <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> Xm0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> vec_last <span class="free">y</span> <span class="main">1</span> <span class="main">$</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y y_dim <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> vec_last_index<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="main">(</span>n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> vec_last <span class="free">y</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span>n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_first_lincomb_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Xs</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> x X Xs <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"n.lincomb_list <span class="skolem">c</span> <span class="skolem">Xs</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def
      <span class="keyword1"><span class="command">using</span></span> vec_first_last_append<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span>›</span></span> y_dim
        n.lincomb_list_carrier<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Xs</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> Xs X
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> n.cone_list <span class="skolem">Xs</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n.cone_list_def n.nonneg_lincomb_list_def <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"m.cone_list <span class="var">?Ys</span> <span class="main">=</span> m.cone <span class="var">?Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> m.finite_cone_iff_cone_list<span class="main">[</span><span class="operator">OF</span> _ Ys<span class="main">]</span> m.cone_iff_finite_cone<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span><span class="main">]</span>
      <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> gram_schmidt
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Decomposition_Theorem-decomposition_theorem_polyhedra_1"><span class="command">lemma</span></span> decomposition_theorem_polyhedra_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> polyhedron <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">Q</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> finite <span class="bound">X</span> <span class="main">∧</span>
    <span class="bound">Q</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> finite <span class="bound">Q</span> <span class="main">∧</span>
    <span class="free">P</span> <span class="main">=</span> convex_hull <span class="bound">Q</span> <span class="main">+</span> cone <span class="bound">X</span> <span class="main">∧</span>
    <span class="main">(</span><span class="free">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="free">Bnd</span> <span class="main">⟶</span> <span class="free">b</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span> <span class="main">⟶</span>
      <span class="bound">X</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="free">n</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="bound">Q</span> <span class="main">⊆</span> Bounded_vec <span class="main">(</span>det_bound <span class="free">n</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> next_dim<span class="main">:</span> gram_schmidt <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> gram_schmidt_m <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> P<span class="main">[</span><span class="operator">unfolded</span> polyhedron_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> mcb<span class="main">:</span> <span class="quoted"><span class="quoted">"mat_of_col <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> mat_of_col <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">1</span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> M_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> mat_of_col <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> carrier_append_cols<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A mcb<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> M_bottom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">1</span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> carrier_mat <span class="main">1</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> carrier_append_cols<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> M_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="free">nr</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> M_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> carrier_append_rows<span class="main"><span class="main">[</span></span><span class="operator">OF</span> M_top M_bottom<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="skolem">t</span> <span class="main">∈</span> next_dim.polyhedral_cone <span class="skolem">M</span> <span class="main">=</span>
          <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> next_dim.polyhedral_cone <span class="skolem">M</span> <span class="main">=</span>
            <span class="main">(</span><span class="skolem">M</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?y</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">nr</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> next_dim.polyhedral_cone_def <span class="keyword1"><span class="command">using</span></span> y M_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">nr</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?y</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">1</span> <span class="main">=</span>
                   <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> mat_of_col <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?y</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span>
                   <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">1</span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?y</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> M_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> append_rows_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> M_top M_bottom _ y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> mat_of_col<span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?y</span> <span class="main">=</span>
                 <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> mat_of_col<span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_mult_append_cols<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A _ x<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat_of_col<span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> mult_mat_of_row_vec_of_scal<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">1</span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span>
                 <span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">1</span> <span class="free">n</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> mat_mult_append_cols<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span> vec_of_scal <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">…</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?y</span> <span class="main">∈</span> next_dim.polyhedral_cone <span class="skolem">M</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> M_cone_car <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> next_dim.farkas_minkowsky_weyl_theorem_2<span class="main">[</span><span class="operator">OF</span> M_dim<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="main">1</span> <span class="free">Bnd</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"next_dim.polyhedral_cone <span class="skolem">M</span> <span class="main">=</span> next_dim.cone <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> carrier_vec <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span> <span class="main">⟹</span>
          <span class="skolem">X</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="free">n</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main">{</span><span class="var">?f</span> <span class="bound">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">using</span></span> fin_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Y_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> carrier_vec <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">using</span></span> X_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">`</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">`</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vec_first <span class="skolem">x</span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="skolem">x</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x X_carrier vec_first_last_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="skolem">x</span> <span class="main">1</span> <span class="main">=</span> vec_of_scal <span class="main">(</span>vec_last <span class="skolem">x</span> <span class="main">1</span> <span class="main">$</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="skolem">x</span> <span class="main">1</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x X_carrier <span class="keyword1"><span class="command">unfolding</span></span> vec_last_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vec_first <span class="skolem">x</span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> next_dim.polyhedral_cone <span class="skolem">M</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x X X_carrier next_dim.set_in_cone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M_cone_car vec_first_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"next_dim.cone <span class="skolem">Y</span> <span class="main">=</span> next_dim.polyhedral_cone <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def
    <span class="keyword1"><span class="command">using</span></span> next_dim.cone_smult_basis<span class="main">[</span><span class="operator">OF</span> X_carrier<span class="main">]</span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y0</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">.</span> <span class="bound">v</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y1</span> <span class="main">=</span> <span class="skolem">Y</span> <span class="main">-</span> <span class="skolem">Y0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Y0_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y0</span> <span class="main">⊆</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y1_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y1</span> <span class="main">⊆</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Y0_def Y1_def <span class="keyword1"><span class="command">using</span></span> Y_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Y0_def Y1_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> Y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y1</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x y Y1_def Y0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X_carrier <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Z0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>vec_first <span class="bound">y</span> <span class="free">n</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Z1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>vec_first <span class="bound">y</span> <span class="free">n</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y1</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Z0</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Z1</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?Z0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?Z1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> convex_hull <span class="var">?Z1</span> <span class="main">+</span> cone <span class="var">?Z0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> xn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">unfolding</span></span> polyhedron_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vec_le_iff_diff_le_0 A b carrier_vecD mult_mat_vec_carrier one_smult_vec
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.polyhedral_cone <span class="skolem">M</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> M_cone_car<span class="main">[</span><span class="operator">OF</span> xn<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.finite_cone <span class="skolem">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> next_dim.cone_iff_finite_cone<span class="main">[</span><span class="operator">OF</span> Y_carrier <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"next_dim.nonneg_lincomb <span class="skolem">c</span> <span class="skolem">Y</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> next_dim.finite_cone_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"next_dim.lincomb <span class="skolem">c</span> <span class="skolem">Y1</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"next_dim.lincomb <span class="skolem">c</span> <span class="skolem">Y0</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> y_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> next_dim.nonneg_lincomb_def
          <span class="keyword1"><span class="command">using</span></span> Y0_carrier Y1_carrier next_dim.lincomb_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">hence</span></span> yz_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">=</span> next_dim.lincomb <span class="skolem">c</span> <span class="skolem">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">unfolding</span></span> next_dim.nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="skolem">Y1</span> <span class="main">∪</span> <span class="skolem">Y0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y1_def <span class="keyword1"><span class="command">using</span></span> Y0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next_dim.lincomb <span class="skolem">c</span> <span class="main">(</span><span class="skolem">Y1</span> <span class="main">∪</span> <span class="skolem">Y0</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> next_dim.lincomb_union2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y1</span></span> <span class="quoted"><span class="skolem">Y0</span></span><span class="main">]</span>
            <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y0</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y</span>›</span></span> Y0_carrier Y_carrier
          <span class="keyword1"><span class="command">unfolding</span></span> Y1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span> <span class="main">=</span> vec_first <span class="main">(</span><span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="main">(</span><span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vec_first_last_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> add_carrier_vec yz_dim
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="main">(</span><span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> vec_of_scal <span class="main">(</span><span class="main">(</span><span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vec_of_scal_dim_1 vec_last_index<span class="main">[</span><span class="operator">OF</span> yz_dim<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">=</span>
                     vec_first <span class="main">(</span><span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">(</span><span class="main">(</span><span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vec_first <span class="main">(</span><span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          yz_last<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_of_scal <span class="main">1</span> <span class="main">=</span> vec_of_scal <span class="main">(</span><span class="main">(</span><span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> append_vec_eq yz_dim xn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vec_first <span class="var">?y</span> <span class="free">n</span> <span class="main">+</span> vec_first <span class="var">?z</span> <span class="free">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vec_first_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span><span class="main">]</span> y_dim z_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yz_last index_vec_of_scal
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="var">?y</span> <span class="main">$</span> <span class="free">n</span> <span class="main">+</span> <span class="var">?z</span> <span class="main">$</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_dim z_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> zn0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> next_dim.lincomb_index<span class="main">[</span><span class="operator">OF</span> _ Y0_carrier<span class="main">]</span> Y0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> yn1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="var">?y</span> <span class="main">$</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next_dim.nonneg_lincomb <span class="skolem">c</span> <span class="skolem">Y1</span> <span class="var">?y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> c Y1_def
          <span class="keyword1"><span class="command">unfolding</span></span> next_dim.nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Y1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> next_dim.cone_iff_finite_cone<span class="main">[</span><span class="operator">OF</span> Y1_carrier<span class="main">]</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y1</span>›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> next_dim.finite_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_first <span class="var">?y</span> <span class="free">n</span> <span class="main">∈</span> convex_hull <span class="var">?Z1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> convex_hull_next_dim<span class="main">[</span><span class="operator">OF</span> _ Y1_carrier <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y1</span>›</span></span> _ y_dim<span class="main">]</span> Y1 yn1
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next_dim.nonneg_lincomb <span class="skolem">c</span> <span class="skolem">Y0</span> <span class="var">?z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c Y0_def
          <span class="keyword1"><span class="command">unfolding</span></span> next_dim.nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Y0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y0</span>›</span></span> next_dim.cone_iff_finite_cone<span class="main">[</span><span class="operator">OF</span> Y0_carrier <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y0</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> next_dim.finite_cone_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_first <span class="var">?z</span> <span class="free">n</span> <span class="main">∈</span> cone <span class="var">?Z0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cone_next_dim<span class="main">[</span><span class="operator">OF</span> _ Y0_carrier <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y0</span>›</span></span> _ _ zn0<span class="main">]</span> Y0_def
            next_dim.lincomb_closed<span class="main">[</span><span class="operator">OF</span> Y0_carrier<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">from</span></span> xyz y z <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> convex_hull <span class="var">?Z1</span> <span class="main">+</span> cone <span class="var">?Z0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> convex_hull <span class="var">?Z1</span> <span class="main">+</span> cone <span class="var">?Z0</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> convex_hull <span class="var">?Z1</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> cone <span class="var">?Z0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> set_plus_elim<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> yn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> y convex_hull_carrier<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?Z1</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vec_of_scal_dim<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span><span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="free">n</span> <span class="main">∈</span> convex_hull <span class="var">?Z1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vec_first_append<span class="main">[</span><span class="operator">OF</span> yn<span class="main">]</span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Y1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> convex_hull_next_dim<span class="main">[</span><span class="operator">OF</span> _ Y1_carrier <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y1</span>›</span></span><span class="main">]</span> Y1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> y_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> next_dim.cone_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y1</span></span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> Y1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">have</span></span> zn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z cone_carrier<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Z0</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vec_of_scal_dim<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span><span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span><span class="main">)</span> <span class="free">n</span> <span class="main">∈</span> cone <span class="var">?Z0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vec_first_append<span class="main">[</span><span class="operator">OF</span> zn<span class="main">]</span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Y0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cone_next_dim<span class="main">[</span><span class="operator">OF</span> _ Y0_carrier <span class="quoted"><span class="quoted">‹finite <span class="skolem">Y0</span>›</span></span><span class="main">]</span> Y0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> z_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Y0_def next_dim.cone_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y0</span></span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">have</span></span> xn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>›</span></span> yn zn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>›</span></span> append_vec_add<span class="main">[</span><span class="operator">OF</span> yn zn<span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> vec_of_scal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> next_dim.cone_elem_sum<span class="main">[</span><span class="operator">OF</span> Y_carrier y_cone z_cone<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">b</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M_cone_car<span class="main">[</span><span class="operator">OF</span> xn<span class="main">]</span> Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec_le_iff_diff_le_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
            dim_mult_mat_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P xn <span class="keyword1"><span class="command">unfolding</span></span> polyhedron_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> convex_hull <span class="var">?Z1</span> <span class="main">+</span> cone <span class="var">?Z0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Bnd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"det_bound <span class="free">n</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="free">Bnd</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> Bounded_mat <span class="free">Bnd</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> Bounded_vec <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"elements_mat <span class="skolem">M</span> <span class="main">⊆</span> elements_mat <span class="free">A</span> <span class="main">∪</span> vec_set <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> M_def
      <span class="keyword1"><span class="command">unfolding</span></span> elements_mat_append_rows<span class="main">[</span><span class="operator">OF</span> M_top M_bottom<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> elements_mat_append_cols<span class="main">[</span><span class="operator">OF</span> A mcb<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> elements_mat_append_cols<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">ℤ</span> <span class="main">∩</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> abs <span class="bound">x</span> <span class="main">≤</span> <span class="free">Bnd</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">unfolded</span> Bounded_mat_elements_mat Ints_mat_elements_mat
          Bounded_vec_vec_set Ints_vec_vec_set<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">ℤ</span> <span class="main">∩</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> abs <span class="bound">x</span> <span class="main">≤</span> max <span class="main">1</span> <span class="free">Bnd</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> Bounded_mat <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Bounded_mat_elements_mat Ints_mat_elements_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> Bnd<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> XBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="var">?Bnd</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">⊆</span> carrier_vec <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> XBnd xX <span class="keyword1"><span class="command">have</span></span> xI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Bounded_vec <span class="var">?Bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="var">?Bnd</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xI xB <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> y0 <span class="main">=</span> this
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">$</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> x xI <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ints_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> x0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Ints_nonzero_abs_ge1<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> abs<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> abs <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> abs <span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> abs <span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> abs<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">≤</span> abs <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> abs <span class="main">=</span> this
        <span class="keyword1"><span class="command">from</span></span> x0 <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> vy<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_set <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> vec_set <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec_set_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Bounded_vec <span class="var">?Bnd</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xB abs
          <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_vec_set vy
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> imageE max.absorb2 max.bounded_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> yn0 <span class="main">=</span> this
      <span class="keyword1"><span class="command">note</span></span> y0 yn0
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> BndY <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">⊆</span> carrier_vec <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> setvY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟹</span> <span class="keyword1">set<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>vec_first <span class="skolem">y</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">set<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">unfolding</span></span> vec_first_def vec_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> BndY<span class="main">(</span>1<span class="main">)</span> setvY
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Z0</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="main">(</span>det_bound <span class="free">n</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bounded_vec_vec_set Ints_vec_vec_set Y0_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> BndY<span class="main">(</span>2<span class="main">)</span> setvY
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Z1</span> <span class="main">⊆</span> Bounded_vec <span class="main">(</span>det_bound <span class="free">n</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bounded_vec_vec_set Ints_vec_vec_set Y0_def Y1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Decomposition_Theorem-decomposition_theorem_polyhedra_2"><span class="command">lemma</span></span> decomposition_theorem_polyhedra_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> convex_hull <span class="free">Q</span> <span class="main">+</span> cone <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span> <span class="bound">b</span> <span class="bound">nr</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> carrier_mat <span class="bound">nr</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="bound">nr</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> polyhedron <span class="bound">A</span> <span class="bound">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> next_dim<span class="main">:</span> gram_schmidt <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> gram_schmidt_m <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> fin_Q <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> Qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> set <span class="skolem">Qs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fin_X <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> Xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> set <span class="skolem">Xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_list <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fin_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">using</span></span> fin_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> fin_Z<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Z_def <span class="keyword1"><span class="command">using</span></span> fin_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> Y_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">using</span></span> Q append_carrier_vec<span class="main">[</span><span class="operator">OF</span> _ vec_of_scal_dim<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> Z_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">⊆</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Z_def <span class="keyword1"><span class="command">using</span></span> X append_carrier_vec<span class="main">[</span><span class="operator">OF</span> _ vec_of_scal_dim<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> Y_car<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="main">{</span>vec_first <span class="bound">x</span> <span class="free">n</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>vec_first <span class="bound">x</span> <span class="free">n</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Q vec_first_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"vec_of_scal <span class="main">1</span>"</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>vec_first <span class="bound">x</span> <span class="free">n</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vec_first <span class="main">(</span><span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q vec_first_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> Z_car<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">{</span>vec_first <span class="bound">x</span> <span class="free">n</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span> <span class="main">∈</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>vec_first <span class="bound">x</span> <span class="free">n</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> X vec_first_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"vec_of_scal <span class="main">0</span>"</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>vec_first <span class="bound">x</span> <span class="free">n</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vec_first <span class="main">(</span><span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span><span class="main">)</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X vec_first_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> Y_last<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Z_last<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Z_def <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_Y fin_Z <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span> <span class="main">⊆</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Y_dim Z_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">nr</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"next_dim.cone <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">=</span> next_dim.polyhedral_cone <span class="skolem">B</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> B_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> carrier_mat <span class="skolem">nr</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> next_dim.farkas_minkowsky_weyl_theorem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"next_dim.cone <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> mat_col_first <span class="skolem">B</span> <span class="free">n</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> col <span class="skolem">B</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> B_blocks<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="skolem">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> mat_of_col <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> A_def b_def
    <span class="keyword1"><span class="command">using</span></span> mat_col_first_last_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> B_carrier
      mat_of_col_dim_col_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"mat_col_last <span class="skolem">B</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> A_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> carrier_mat <span class="skolem">nr</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">using</span></span> B_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> b_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier_vec <span class="skolem">nr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">using</span></span> B_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> convex_hull <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> cone <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> set_plus_elim<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> yn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y convex_hull_carrier<span class="main">[</span><span class="operator">OF</span> Q<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> zn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z cone_carrier<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> xn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> yn1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> append_carrier_vec<span class="main">[</span><span class="operator">OF</span> yn<span class="main">]</span> vec_of_scal_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">have</span></span> y_last<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yn <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span><span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_first_append<span class="main">[</span><span class="operator">OF</span> yn<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> convex_hull_next_dim<span class="main">[</span><span class="operator">OF</span> _ Y_dim fin_Y Y_last yn1 y_last<span class="main">]</span> Y_car y <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">hence</span></span> y_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.cone <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> next_dim.cone_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> zn1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> append_carrier_vec<span class="main">[</span><span class="operator">OF</span> zn<span class="main">]</span> vec_of_scal_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">have</span></span> z_last<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zn <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="main">(</span><span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_first_append<span class="main">[</span><span class="operator">OF</span> zn<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cone_next_dim<span class="main">[</span><span class="operator">OF</span> _ Z_dim fin_Z Z_last zn1 z_last<span class="main">]</span> Z_car z <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">hence</span></span> z_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span> <span class="main">∈</span> next_dim.cone <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> next_dim.cone_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Z</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">z</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> append_vec_add<span class="main">[</span><span class="operator">OF</span> yn zn<span class="main">]</span> vec_of_scal_dim_1
      <span class="keyword1"><span class="command">unfolding</span></span> vec_of_scal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.cone <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> next_dim.cone_elem_sum<span class="main">[</span><span class="operator">OF</span> _ y_cone z_cone<span class="main">]</span> Y_dim Z_dim xn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.cone <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"next_dim.lincomb <span class="skolem">c</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> next_dim.cone_iff_finite_cone Y_dim Z_dim fin_Y fin_Z
      <span class="keyword1"><span class="command">unfolding</span></span> next_dim.finite_cone_def next_dim.nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"next_dim.lincomb <span class="skolem">c</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"next_dim.lincomb <span class="skolem">c</span> <span class="skolem">Z</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">=</span> <span class="var">?y</span> <span class="main">+</span> <span class="var">?z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x next_dim.lincomb_union<span class="main">[</span><span class="operator">OF</span> Y_dim Z_dim _ fin_Y fin_Z<span class="main">]</span> Y_last Z_last
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">have</span></span> y_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> next_dim.lincomb_closed<span class="main">[</span><span class="operator">OF</span> Y_dim<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> z_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> next_dim.lincomb_closed<span class="main">[</span><span class="operator">OF</span> Z_dim<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xyz add_carrier_vec<span class="main">[</span><span class="operator">OF</span> y_dim z_dim<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">hence</span></span> x_dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> carrier_dim_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> carrier_dim_vec<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">have</span></span> z_last<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Z_last next_dim.lincomb_index<span class="main">[</span><span class="operator">OF</span> _ Z_dim<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">$</span> <span class="free">n</span> <span class="main">+</span> <span class="var">?z</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xyz index_add_vec<span class="main">(</span>1<span class="main">)</span> z_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> y_last<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">$</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z_last <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> next_dim.cone_iff_finite_cone<span class="main">[</span><span class="operator">OF</span> Y_dim<span class="main">]</span> fin_Y c
      <span class="keyword1"><span class="command">unfolding</span></span> next_dim.finite_cone_def next_dim.nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> y_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_first <span class="var">?y</span> <span class="free">n</span> <span class="main">∈</span> convex_hull <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> convex_hull_next_dim<span class="main">[</span><span class="operator">OF</span> _ Y_dim fin_Y Y_last y_dim y_last<span class="main">]</span> Y_car
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∈</span> next_dim.cone <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> next_dim.cone_iff_finite_cone<span class="main">[</span><span class="operator">OF</span> Z_dim<span class="main">]</span> fin_Z c
      <span class="keyword1"><span class="command">unfolding</span></span> next_dim.finite_cone_def next_dim.nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> z_cone<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_first <span class="var">?z</span> <span class="free">n</span> <span class="main">∈</span> cone <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cone_next_dim<span class="main">[</span><span class="operator">OF</span> _ Z_dim fin_Z Z_last z_dim z_last<span class="main">]</span> Z_car
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vec_first <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec_first_append<span class="main">[</span><span class="operator">OF</span> x_dim<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> vec_first <span class="var">?y</span> <span class="free">n</span> <span class="main">+</span> vec_first <span class="var">?z</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xyz vec_first_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span><span class="main">]</span> y_dim z_dim carrier_dim_vec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y_cone z_cone P <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.polyhedral_cone <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="skolem">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">nr</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> next_dim.polyhedral_cone_def <span class="keyword1"><span class="command">using</span></span> B_carrier
      <span class="keyword1"><span class="command">using</span></span> append_carrier_vec<span class="main">[</span><span class="operator">OF</span> _ vec_of_scal_dim<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> mat_of_col <span class="skolem">b</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">nr</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> B_blocks <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">A</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>c</sub></span> mat_of_col <span class="skolem">b</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
               <span class="skolem">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> mat_of_col <span class="skolem">b</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mat_mult_append_cols<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> A_carrier b_carrier xn<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat_of_col <span class="skolem">b</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_mat_of_row_vec_of_scal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">-</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_scal <span class="main">1</span> <span class="main">∈</span> next_dim.polyhedral_cone <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">-</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_le_iff_diff_le_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">b</span>"</span></span><span class="main">]</span> A_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> polyhedron <span class="skolem">A</span> <span class="main">(</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> polyhedron_def <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">b</span> <span class="main">∈</span> carrier_vec <span class="skolem">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Decomposition_Theorem-decomposition_theorem_polyhedra"><span class="command">lemma</span></span> decomposition_theorem_polyhedra<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">A</span> <span class="bound">b</span> <span class="bound">nr</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> carrier_mat <span class="bound">nr</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="bound">nr</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> polyhedron <span class="bound">A</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">∃</span> <span class="bound">Q</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">∪</span> <span class="bound">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> finite <span class="main">(</span><span class="bound">Q</span> <span class="main">∪</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> convex_hull <span class="bound">Q</span> <span class="main">+</span> cone <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">nr</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> carrier_mat <span class="skolem">nr</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier_vec <span class="skolem">nr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> polyhedron <span class="skolem">A</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> decomposition_theorem_polyhedra_1<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="skolem"><span class="skolem">X</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> convex_hull <span class="skolem">Q</span> <span class="main">+</span> cone <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">X</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> polytope_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> QX_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> QX_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">Q</span> <span class="main">∪</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> convex_hull <span class="skolem">Q</span> <span class="main">+</span> cone <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> QX_carrier <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> QX_fin <span class="keyword1"><span class="command">have</span></span> fin_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">using</span></span> decomposition_theorem_polyhedra_2<span class="main">[</span><span class="operator">OF</span> Q fin_Q X fin_X P<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Decomposition_Theorem-polytope_equiv_bounded_polyhedron"><span class="command">lemma</span></span> polytope_equiv_bounded_polyhedron<span class="main">:</span>
  <span class="quoted"><span class="quoted">"polytope <span class="free">P</span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">A</span> <span class="bound">b</span> <span class="bound">nr</span> <span class="bound">bnd</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> carrier_mat <span class="bound">nr</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="bound">nr</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> polyhedron <span class="bound">A</span> <span class="bound">b</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">⊆</span> Bounded_vec <span class="bound">bnd</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> polyP<span class="main">:</span> <span class="quoted"><span class="quoted">"polytope <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> Qcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> finQ<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> PconvhQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> convex_hull <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> polytope_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex_hull <span class="skolem">Q</span> <span class="main">+</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> convex_hull <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Qcarr add_0_right_vecset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"convex_hull <span class="skolem">Q</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> convex_hull_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> convex_hull <span class="skolem">Q</span> <span class="main">+</span> cone <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PconvhQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∪</span> <span class="var">?X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> finite <span class="main">(</span><span class="skolem">Q</span> <span class="main">∪</span> <span class="var">?X</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> convex_hull <span class="skolem">Q</span> <span class="main">+</span> cone <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Qcarr finQ PconvhQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">A</span> <span class="bound">b</span> <span class="bound">nr</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> carrier_mat <span class="bound">nr</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="bound">nr</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> polyhedron <span class="bound">A</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> decomposition_theorem_polyhedra <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> Ppolyh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span> <span class="bound">b</span> <span class="bound">nr</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> carrier_mat <span class="bound">nr</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="bound">nr</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> polyhedron <span class="bound">A</span> <span class="bound">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> finite_Bounded_vec_Max<span class="main">[</span><span class="operator">OF</span> Qcarr finQ<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bnd</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> Pbnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">bnd</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> convex_hull_bound PconvhQ Qcarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Ppolyh Pbnd <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span> <span class="bound">b</span> <span class="bound">nr</span> <span class="bound">bnd</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> carrier_mat <span class="bound">nr</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="bound">nr</span>
    <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> polyhedron <span class="bound">A</span> <span class="bound">b</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">⊆</span> Bounded_vec <span class="bound">bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span> <span class="bound">b</span> <span class="bound">nr</span> <span class="bound">bnd</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> carrier_mat <span class="bound">nr</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="bound">nr</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> polyhedron <span class="bound">A</span> <span class="bound">b</span>
    <span class="main">∧</span> <span class="free">P</span> <span class="main">⊆</span> Bounded_vec <span class="bound">bnd</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">nr</span></span> <span class="skolem"><span class="skolem">bnd</span></span> <span class="keyword2"><span class="keyword">where</span></span> Adim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> carrier_mat <span class="skolem">nr</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bdim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier_vec <span class="skolem">nr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Ppolyh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> polyhedron <span class="skolem">A</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Pbnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">A</span> <span class="bound">b</span> <span class="bound">nr</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> carrier_mat <span class="bound">nr</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> carrier_vec <span class="bound">nr</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> polyhedron <span class="bound">A</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Adim bdim Ppolyh <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">Q</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">∪</span> <span class="bound">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> finite <span class="main">(</span><span class="bound">Q</span> <span class="main">∪</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> convex_hull <span class="bound">Q</span> <span class="main">+</span> cone <span class="bound">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> decomposition_theorem_polyhedra <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> QXcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> finQX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">Q</span> <span class="main">∪</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Psum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> convex_hull <span class="skolem">Q</span> <span class="main">+</span> cone <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> QXcarr <span class="keyword1"><span class="command">have</span></span> Qcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"convex_hull <span class="skolem">Q</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> convex_hull_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> QXcarr <span class="keyword1"><span class="command">have</span></span> Xcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="skolem">X</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gram_schmidt.cone_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Pbnd <span class="keyword1"><span class="command">have</span></span> Pcarr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ppolyh <span class="keyword1"><span class="command">unfolding</span></span> polyhedron_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> convex_hull <span class="skolem">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> convex_hull <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Psum <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_plus_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> convnotempty<span class="main">:</span> <span class="quoted"><span class="quoted">"convex_hull <span class="skolem">Q</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> QXcarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> Pbndex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bnd</span><span class="main">.</span> <span class="free">P</span> <span class="main">⊆</span> Bounded_vec <span class="bound">bnd</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pbnd
      <span class="keyword1"><span class="command">using</span></span> QXcarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">bndc</span><span class="main">.</span> cone <span class="skolem">X</span> <span class="main">⊆</span> Bounded_vec <span class="bound">bndc</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bounded_vecset_sum<span class="main">[</span><span class="operator">OF</span> Qcarr Xcarr Psum Pbndex<span class="main">]</span> False convnotempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cone <span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounded_cone_is_zero QXcarr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Psum <span class="keyword1"><span class="command">using</span></span> Qcarr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_0_right_vecset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"polytope <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finQX QXcarr <span class="keyword1"><span class="command">unfolding</span></span> polytope_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Mixed_Integer_Solutions">
<div class="head">
<h1>Theory Mixed_Integer_Solutions</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Mixed Integer Solutions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove that if an integral system of linear inequalities
$Ax \leq b \wedge A'x &lt; b'$ has a (mixed)integer solution, there there is also
a small (mixed)integer solution, where the numbers are bounded by
$(n+1)! \cdot m^n$ where $n$ is the number of variables and $m$ is a bound on
the absolute values of numbers occurring in $A,A',b,b'$.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Mixed_Integer_Solutions
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Decomposition_Theorem">Decomposition_Theorem</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">less_vec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ord<span class="main">)</span> vec <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1"><span class="free">&lt;<span class="hidden">⇩</span><sub>v</sub></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="main">(</span>dim_vec <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> dim_vec <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> dim_vec <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Mixed_Integer_Solutions-less_vecD"><span class="command">lemma</span></span> less_vecD<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">$</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">w</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> less_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mixed_Integer_Solutions-less_vecI"><span class="command">lemma</span></span> less_vecI<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">w</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> less_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Mixed_Integer_Solutions-less_vec_lesseq_vec"><span class="command">lemma</span></span> less_vec_lesseq_vec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">w</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> preorder vec<span class="main">)</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_vec_def less_eq_vec_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_le_not_le<span class="main">)</span>

<span class="keyword1" id="Mixed_Integer_Solutions-floor_less"><span class="command">lemma</span></span> floor_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">ℤ</span> <span class="main">⟹</span> of_int <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Mixed_Integer_Solutions-floor_of_int_eq"><span class="command">lemma</span></span> floor_of_int_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟹</span> of_int <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ints_cases of_int_floor_cancel<span class="main">)</span>


<span class="keyword1"><span class="command">locale</span></span> gram_schmidt_floor <span class="main">=</span> gram_schmidt <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">f_ty</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f_ty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>floor_ceiling<span class="main">,</span>
    trivial_conjugatable_linordered_field<span class="main">}</span> itself"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Mixed_Integer_Solutions-small_mixed_integer_solution_main"><span class="command">lemma</span></span> small_mixed_integer_solution_main<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier_mat <span class="free">nr<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier_mat <span class="free">nr<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier_vec <span class="free">nr<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier_vec <span class="free">nr<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A1Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="free">Bnd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b1Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A2Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="free">Bnd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b2Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sol_nonstrict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sol_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span>
  <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span>
  <span class="bound">x</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span> <span class="main">∧</span>
  <span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span>
  <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span>
  <span class="bound">x</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>fact <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> det_bound <span class="free">n</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nr</span> <span class="main">=</span> <span class="free">nr<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">nr<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> B0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def det_bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> defs <span class="main">=</span> A_def b_def nr_def
  <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> carrier_mat <span class="skolem">nr</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> b1 b2 <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier_vec <span class="skolem">nr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> A1Bnd A2Bnd A1 A2 <span class="keyword1"><span class="command">have</span></span> ABnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> defs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ints_mat_elements_mat Bounded_mat_elements_mat elements_mat_append_rows<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> b1Bnd b2Bnd b1 b2 <span class="keyword1"><span class="command">have</span></span> bBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> defs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ints_vec_vec_set Bounded_vec_vec_set<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> decomposition_theorem_polyhedra_1<span class="main">[</span><span class="operator">OF</span> A b refl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">Bnd</span></span><span class="main">]</span> ABnd bBnd
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> finX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> finY<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> poly<span class="main">:</span> <span class="quoted"><span class="quoted">"polyhedron <span class="skolem">A</span> <span class="skolem">b</span> <span class="main">=</span> convex_hull <span class="skolem">Y</span> <span class="main">+</span> cone <span class="skolem">Z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ZBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="skolem">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> YBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span> <span class="main">∩</span> indexed_Ints_vec <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polyhedron <span class="skolem">A</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="skolem">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> polyhedron_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> defs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Collect_cong conj_cong refl append_rows_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A1 A2 b1<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> poly<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> convex_hull <span class="skolem">Y</span> <span class="main">+</span> cone <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x sol_nonstrict less_vec_lesseq_vec<span class="main">[</span><span class="operator">OF</span> sol_strict<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">note</span></span> sol <span class="main">=</span> this<span class="main">[</span><span class="operator">unfolded</span> poly<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> set_plus_elim<span class="main">[</span><span class="operator">OF</span> sol<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    yY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> convex_hull <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zZ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> cone <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> convex_hull_carrier<span class="main">[</span><span class="operator">OF</span> Y<span class="main">]</span> yY <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Caratheodory_theorem<span class="main">[</span><span class="operator">OF</span> Z<span class="main">]</span> zZ
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> zC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> finite_cone <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> CZ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> subset_trans<span class="main">[</span><span class="operator">OF</span> CZ Z<span class="main">]</span> lin <span class="keyword1"><span class="command">have</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">C</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dim_is_n li_le_dim<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> CZ finX<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> finC<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> zC<span class="main">[</span><span class="operator">unfolded</span> finite_cone_def nonneg_lincomb_def<span class="main">]</span> finC <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> za<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> lincomb <span class="skolem">a</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="bound">u</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> CZ Z <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">unfolding</span></span> za <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> yB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Bounded_vec <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yY convex_hull_bound<span class="main">[</span><span class="operator">OF</span> YBnd Y<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">D</span>
    <span class="keyword3"><span class="command">assume</span></span> DC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> this finC<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">+</span> lincomb <span class="bound">a</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="var">?L</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">c</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">D</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">c</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DC
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">D</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> empty
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> za xyz<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> sol_strict x xI nonneg <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="var">?P</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">c</span> <span class="skolem">D</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> lincomb <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">c</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">D</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">c</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> insert<span class="main">(</span>4<span class="main">)</span> C <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> sol a D<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="comment1">(* this is the core reasoning step where a<span class="hidden">⇩</span><sub>c</sub> is large *)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">d</span><span class="main">.</span> lincomb <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">-</span> <span class="bound">d</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">d</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">+</span> <span class="var">?z</span> <span class="bound">d</span>"</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
          <span class="keyword1"><span class="command">have</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">a</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="skolem">d</span> <span class="main">=</span> lincomb <span class="main">(</span><span class="main">λ</span> <span class="bound">e</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">e</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">a</span> <span class="skolem">c</span> <span class="main">-</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">a</span> <span class="bound">e</span><span class="main">)</span> <span class="skolem">C</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> lincomb_del2<span class="main">[</span><span class="operator">OF</span> finC C TrueI cC<span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lincomb_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> C c lin<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diff_smult_distrib_vec<span class="main">)</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="skolem">c</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="skolem">d</span> <span class="main">∈</span> finite_cone <span class="skolem">C</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">C</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">e</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="main">-</span> <span class="skolem">d</span> <span class="keyword1">else</span> <span class="skolem">a</span> <span class="bound">e</span><span class="main">)</span> <span class="bound">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le a finC <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> le a finC
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C lincomb_in_finite_cone<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="skolem">d</span> <span class="main">∈</span> cone <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> CZ
              <span class="keyword1"><span class="command">using</span></span> finC local.cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="skolem">d</span> <span class="main">∈</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_plus_intro<span class="main"><span class="main">[</span></span><span class="operator">OF</span> yY<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> sol <span class="main">=</span> this
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?x</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">w</span> <span class="main">∙</span> lincomb <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">-</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">∙</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> scalar_prod_add_distrib<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">insert</span> C c<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
                  <span class="operator">subst</span> scalar_prod_minus_distrib<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> w c C<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> scalar <span class="main">=</span> this
          <span class="keyword1"><span class="command">note</span></span> id sol scalar
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> generic <span class="main">=</span> this
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">(</span>floor <span class="main">(</span><span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="var">?fl</span>  <span class="main">=</span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="var">?fl</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> p_lt_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def
          <span class="keyword1"><span class="command">using</span></span> floor_less floor_of_int_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> p1_ge_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≥</span> <span class="skolem">a</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def
          <span class="keyword1"><span class="command">using</span></span> floor_correct le_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">e</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="main">-</span> <span class="skolem">p</span> <span class="keyword1">else</span> <span class="skolem">a</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> lin_id<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">a'</span> <span class="skolem">C</span> <span class="main">=</span> lincomb <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">-</span> <span class="skolem">p</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a'_def <span class="keyword1"><span class="command">using</span></span> id
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generic<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> lincomb <span class="skolem">a'</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier_vec <span class="free">n</span><span class="main">.</span> <span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> p_lt_ac generic<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> pInt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">using</span></span> sol <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> indexed_Ints_vec <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> CZ ZBnd
          <span class="keyword1"><span class="command">using</span></span> indexed_Ints_vec_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> pvindInts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">c</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> indexed_Ints_vec_def <span class="keyword1"><span class="command">using</span></span> pInt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="var">?x</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> carrier_vec <span class="free">nr<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="keyword1"><span class="command">using</span></span> A2 C c y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> lincomb <span class="skolem">a'</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lin_id
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> less_vecI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prod b2<span class="main"><span class="main">]</span></span> CollectI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
          <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">nr<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> sol <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="var">?x</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y C c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> less_vecD<span class="main">[</span><span class="operator">OF</span> this b2 i<span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">i</span> <span class="main">∙</span> <span class="var">?x</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A2 i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> generic<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">c</span>"</span></span><span class="main">]</span> i A2
          <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">i</span> <span class="main">∙</span> <span class="var">?x</span> <span class="main">(</span><span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> less_eq_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> A2 i <span class="keyword1"><span class="command">have</span></span> A2icarr<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">i</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">i</span> <span class="main">∙</span> <span class="var">?x</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lhs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lhs</span> <span class="main">=</span> row <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">y</span> <span class="main">+</span> row <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">i</span> <span class="main">∙</span> lincomb <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">-</span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mult</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mult</span> <span class="main">=</span> row <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">i</span> <span class="main">∙</span> <span class="skolem">c</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> le2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lhs</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">mult</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">unfolding</span></span> generic<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> A2icarr<span class="main">]</span> lhs_def mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> lt2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lhs</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">mult</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lt <span class="keyword1"><span class="command">unfolding</span></span> generic<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> A2icarr<span class="main">]</span> lhs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> le2 lt2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lhs</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">mult</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lt_ac p1 True
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> dual_order.strict_trans linorder_neqE_linordered_idom
                  mult_less_cancel_right not_less zero_less_one_class.zero_less_one<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> generic<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> A2icarr<span class="main">]</span> lhs_def mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?x</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i A2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> lincomb <span class="skolem">a'</span> <span class="skolem">C</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> lincomb <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">-</span> <span class="skolem">p</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lin_id<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> y C c<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_diff_eq_vec<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sol
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> diff_indexed_Ints_vec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ pvindInts<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span> <span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> c C<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> lincomb <span class="skolem">a'</span> <span class="skolem">C</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">∈</span><span class="skolem">C</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">a'</span> <span class="bound">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a'_def p_def <span class="keyword1"><span class="command">using</span></span> p_lt_ac a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">∈</span>insert <span class="skolem">c</span> <span class="skolem">D</span><span class="main">.</span> <span class="skolem">a'</span> <span class="bound">c</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a'_def <span class="keyword1"><span class="command">using</span></span> p1_ge_ac D p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI IntI 1 2 3 4 5<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">C</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> lincomb <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bnds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">c</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">c</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">y</span></span> <span class="main"><span class="main">+</span></span> lincomb <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">C</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> ZBnd CZ <span class="keyword1"><span class="command">have</span></span> BndC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> IntC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">*</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_card_bound<span class="main">[</span><span class="operator">OF</span> BndC C B0 _ card<span class="main">]</span> bnds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> sum_in_Bounded_vecI<span class="main">[</span><span class="operator">OF</span> yB this y<span class="main">]</span> C
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> lincomb <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span><span class="skolem">B</span> <span class="main">+</span> of_nat <span class="free">n</span> <span class="main">*</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">+</span> of_nat <span class="free">n</span> <span class="main">*</span> <span class="skolem">B</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fact <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def det_bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> lincomb <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>fact <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> max <span class="main">1</span> <span class="free">Bnd</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> sol<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We get rid of the max-1 operation, by showing that a smaller value of Bnd 
  can only occur in very special cases where the theorem is trivially satisfied.›</span></span>

<span class="keyword1" id="Mixed_Integer_Solutions-small_mixed_integer_solution"><span class="command">lemma</span></span> small_mixed_integer_solution<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier_mat <span class="free">nr<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier_mat <span class="free">nr<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> carrier_vec <span class="free">nr<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> carrier_vec <span class="free">nr<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A1Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="free">Bnd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b1Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A2Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="free">Bnd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b2Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sol_nonstrict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sol_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> non_degenerate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nr<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">nr<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">Bnd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span>
  <span class="bound">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span>
  <span class="bound">x</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span> <span class="main">∧</span>
  <span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span>
  <span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span>
  <span class="bound">x</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>fact <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">Bnd</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Bnd</span> <span class="main">≥</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"max <span class="main">1</span> <span class="free">Bnd</span> <span class="main">=</span> <span class="free">Bnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> small_mixed_integer_solution_main<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-12<span class="main"><span class="main">)</span></span><span class="main">]</span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> trivial<span class="main">:</span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>fact <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">Bnd</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bounded_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> xI x sol_nonstrict sol_strict <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> n<span class="main">:</span> False
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">nr</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> carrier_mat <span class="skolem">nr</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="free">Bnd</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">nr</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
        <span class="keyword1"><span class="command">with</span></span> Bnd A <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">Bnd</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> Bounded_mat_def Ints_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> trivial <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Bnd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ints_nonzero_abs_less1<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> this      
      <span class="keyword1"><span class="command">have</span></span> A0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">nr</span> <span class="free">n</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> main A<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nr</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">Bnd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">]</span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> A0 this
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> main<span class="main">[</span><span class="operator">OF</span> A1 A1Bnd<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nr1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nr<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">Bnd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> main<span class="main">[</span><span class="operator">OF</span> A2 A2Bnd<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">nr<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nr2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nr<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">Bnd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?x</span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?x</span> <span class="main">≤</span> <span class="free">b<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sol_nonstrict x <span class="keyword1"><span class="command">unfolding</span></span> A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?x</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sol_strict x <span class="keyword1"><span class="command">unfolding</span></span> A2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> indexed_Ints_vec <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> indexed_Ints_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> nr1 nr2 non_degenerate <span class="keyword1"><span class="command">have</span></span> Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Bnd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">Bnd</span> <span class="main">^</span> <span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>fact <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">Bnd</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bounded_vec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>      

<span class="keyword1"><span class="command">corollary</span></span> small_integer_solution_nonstrict<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ABnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> Bounded_mat <span class="free">Bnd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∩</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> non_degenerate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nr</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">Bnd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span>
  <span class="bound">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span>
  <span class="bound">y</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∧</span>
  <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span>
  <span class="bound">y</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>fact <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">Bnd</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">0</span> <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> mat"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> vec"</span></span>
  <span class="keyword1"><span class="command">from</span></span> non_degenerate <span class="keyword1"><span class="command">have</span></span> degen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nr</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">Bnd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∧</span> <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="var">?A2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span> <span class="keyword1">&lt;<span class="hidden">⇩</span><sub>v</sub></span> <span class="var">?b2</span>
  <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>fact <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">Bnd</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> small_mixed_integer_solution<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A _ b _ ABnd bBnd _ _ x _ sol<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?A2</span></span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?b2</span></span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">UNIV</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">folded</span> indexed_Ints_vec_UNIV<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> xI degen<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ints_vec_def Ints_mat_def Bounded_mat_def Bounded_vec_def less_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Integer_Hull">
<div class="head">
<h1>Theory Integer_Hull</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Integer Hull›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the integer hull of a polyhedron, i.e., the convex hull of all integer solutions.
  Moreover, we prove the result of Meyer that the integer hull of a polyhedron defined by an
  integer matrix is again a polyhedron, and give bounds for a corresponding decomposition theorem.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Integer_Hull
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#Decomposition_Theorem">Decomposition_Theorem</a>
    <a href="#Mixed_Integer_Solutions">Mixed_Integer_Solutions</a> <span class="comment1">(* for gram-schmidt-floor *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> gram_schmidt
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">integer_hull</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> convex_hull <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Integer_Hull-integer_hull_mono"><span class="command">lemma</span></span> integer_hull_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="free">Q</span> <span class="main">⟹</span> integer_hull <span class="free">P</span> <span class="main">⊆</span> integer_hull <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> integer_hull_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> convex_hull_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Integer_Hull-abs_neg_floor"><span class="command">lemma</span></span> abs_neg_floor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>of_int <span class="free">b</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">Bnd</span> <span class="main">⟹</span> <span class="main">-</span> <span class="main">(</span>floor <span class="free">Bnd</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abs_le_D2 floor_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Integer_Hull-abs_pos_floor"><span class="command">lemma</span></span> abs_pos_floor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>of_int <span class="free">b</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">Bnd</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≤</span> floor <span class="free">Bnd</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abs_le_D1 le_floor_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> gram_schmidt_floor
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Integer_Hull-integer_hull_integer_cone"><span class="command">lemma</span></span> integer_hull_integer_cone<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> CI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integer_hull <span class="main">(</span>cone <span class="free">C</span><span class="main">)</span> <span class="main">=</span> cone <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">C</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">⊆</span> cone <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"integer_hull <span class="main">(</span>cone <span class="free">C</span><span class="main">)</span> <span class="main">⊆</span> cone <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cone_cone<span class="main">[</span><span class="operator">OF</span> C<span class="main">]</span> convex_cone<span class="main">[</span><span class="operator">OF</span> C<span class="main">]</span> convex_hull_mono
    <span class="keyword1"><span class="command">unfolding</span></span> integer_hull_def convex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cone <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> finD<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> DC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> finite_cone <span class="skolem">D</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">from</span></span> DC C CI <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> DI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> D x finD <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> finite_cone <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_cone_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">D</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">l</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
                  <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finD <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> sum <span class="skolem">l</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L_sup</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L_sup</span> <span class="main">=</span> of_int <span class="main">(</span>floor <span class="skolem">L</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L_sup</span> <span class="main">≥</span> <span class="skolem">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> floor_correct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">L</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> L_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">using</span></span> sum_nonneg<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L_sup</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L_sup</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="keyword1">then</span> <span class="skolem">L_sup</span> <span class="main">-</span> <span class="skolem">L</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?f</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> already_in_span<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span><span class="main">]</span> lincomb_in_span local.span_empty
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?f</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> lincomb_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> D<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lincomb <span class="var">?f</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_vec_diff_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span><span class="main">]</span> D finD <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> lcomb_f<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">l</span> <span class="bound">y</span> <span class="main">+</span> <span class="var">?f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">]</span> finD D x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">L_sup</span> <span class="main">-</span> <span class="skolem">L</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.subset_diff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main"><span class="main">]</span></span> finD<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">l</span> <span class="bound">y</span> <span class="main">+</span> <span class="var">?f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">L_sup</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> l L_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">l</span> <span class="bound">y</span> <span class="main">+</span> <span class="var">?f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L</span> <span class="main">≤</span> <span class="skolem">L_sup</span>›</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">l'</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
                          <span class="keyword2"><span class="keyword">and</span></span> l'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span>
                          <span class="keyword2"><span class="keyword">and</span></span> sum_l'<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">l'</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">L_sup</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lcomb_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">L_sup</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> Did<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> <span class="skolem">L_sup</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l''</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">l'</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">L_sup</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lD</span></span> <span class="keyword2"><span class="keyword">where</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">lD</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> set <span class="skolem">lD</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_distinct_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span><span class="main">]</span> finD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lD'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="keyword1">(⋅<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="skolem">L_sup</span><span class="main">)</span> <span class="skolem">lD</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> dist'<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="var">?lD'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> distinct_smult_nonneg<span class="main">[</span><span class="operator">OF</span> _ dist<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">L_sup</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">have</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"lincomb <span class="skolem">l''</span> <span class="var">?D'</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> l''_def
      <span class="keyword1"><span class="command">unfolding</span></span> lincomb_def Did 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> finsum_reindex<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L_sup</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> smult_vec_nonneg_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">L_sup</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="keyword1">(⋅<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="skolem">L_sup</span><span class="main">)</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">l'</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">L_sup</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">(⋅<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="skolem">L_sup</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">→</span> carrier_vec <span class="free">n</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L_sup</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L_sup</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub>V</sub><span class="hidden">⇙</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">l'</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">L_sup</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">L_sup</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">L_sup</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">⨁</span><span class="hidden">⇘</span><sub>V</sub><span class="hidden">⇙</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">l'</span> <span class="bound">v</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finsum_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> D<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> smult_smult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span> <span class="main">⊆</span> cone <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_in_cone<span class="main">[</span><span class="operator">OF</span> C<span class="main">]</span> DC zero_in_cone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> D'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D'</span> <span class="main">⊆</span> cone <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cone_smult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">L_sup</span></span><span class="main">,</span> <span class="operator">OF</span> _ C<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">L_sup</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> zero_vec_def <span class="keyword1"><span class="command">using</span></span> DI Ints_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L_sup</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> D'I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D'</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ints_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> sum <span class="skolem">l'</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum_l' <span class="quoted"><span class="quoted">‹<span class="skolem">L_sup</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">l'</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="skolem">l'</span> <span class="skolem">lD</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.distinct_set_conv_list<span class="main">[</span><span class="operator">OF</span> dist<span class="main">]</span> lD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="skolem">l'</span> <span class="skolem">lD</span> <span class="main">=</span> map <span class="main">(</span><span class="skolem">l'</span> <span class="main">∘</span> <span class="main">(</span><span class="keyword1">(⋅<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="var">?lD'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> smult_smult_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span>"</span></span> <span class="quoted"><span class="skolem">L_sup</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">L_sup</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∘</span> <span class="main">(</span><span class="keyword1">(⋅<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="skolem">l'</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="main">…</span> <span class="var">?lD'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span><span class="main">)</span> <span class="main">=</span>
               sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">l'</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span><span class="main">)</span><span class="main">)</span> <span class="var">?lD'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_list_mult_const<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?lD'</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="skolem">l''</span> <span class="var">?lD'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> l''_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">L_sup</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="skolem">l''</span> <span class="main">(</span>set <span class="var">?lD'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum.distinct_set_conv_list<span class="main">[</span><span class="operator">OF</span> dist'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?lD'</span> <span class="main">=</span> <span class="var">?D'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> sum_l'<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">l''</span> <span class="var">?D'</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l''</span> <span class="main">`</span> <span class="var">?D'</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">l''</span> <span class="main">`</span> <span class="var">?D'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">l''</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?D'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">L_sup</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">l'</span> <span class="skolem">v</span> <span class="main">/</span> <span class="skolem">L_sup</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l' <span class="quoted"><span class="quoted">‹<span class="skolem">L_sup</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">l''</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x l''_def
        <span class="keyword1"><span class="command">using</span></span> smult_smult_assoc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="skolem">L_sup</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L_sup</span>"</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">L_sup</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?D'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finD <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> integer_hull <span class="main">(</span>cone <span class="free">C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> integer_hull_def convex_hull_def
      <span class="keyword1"><span class="command">using</span></span> x' D' D'I convex_lincomb_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l''</span></span> <span class="var"><span class="quoted"><span class="var">?D'</span></span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
                      nonneg_lincomb_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l''</span></span> <span class="var"><span class="quoted"><span class="var">?D'</span></span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cone <span class="free">C</span> <span class="main">⊆</span> integer_hull <span class="main">(</span>cone <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> decomposition_theorem_integer_hull_of_polyhedron<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> AI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> polyhedron <span class="free">A</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Bnd</span> <span class="main">=</span> Max <span class="main">(</span>abs <span class="main">`</span> <span class="main">(</span>elements_mat <span class="free">A</span> <span class="main">∪</span> vec_set <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">H</span> <span class="bound">C</span><span class="main">.</span> <span class="bound">H</span> <span class="main">∪</span> <span class="bound">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> 
  <span class="main">∧</span> <span class="bound">H</span> <span class="main">⊆</span> Bounded_vec <span class="main">(</span>fact <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>
  <span class="main">∧</span> <span class="bound">C</span> <span class="main">⊆</span> Bounded_vec <span class="main">(</span>fact <span class="free">n</span> <span class="main">*</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>
  <span class="main">∧</span> finite <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="bound">C</span><span class="main">)</span> 
  <span class="main">∧</span> integer_hull <span class="free">P</span> <span class="main">=</span> convex_hull <span class="bound">H</span> <span class="main">+</span> cone <span class="bound">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">DBnd</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DBnd</span> <span class="main">=</span> det_bound <span class="free">n</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nBnd</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nBnd</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">DBnd</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> DBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DBnd</span> <span class="main">=</span> fact <span class="free">n</span> <span class="main">*</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DBnd_def det_bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> nBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nBnd</span> <span class="main">=</span> fact <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nBnd_def DBnd
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> DBnd0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DBnd</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DBnd_def det_bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Pn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P polyhedron_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> Bounded_mat <span class="free">Bnd</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> Bounded_vec <span class="free">Bnd</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Bnd Bounded_mat_elements_mat Bounded_vec_vec_set
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ballI conjI Max_ge finite_imageI imageI finite_UnI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> decomposition_theorem_polyhedra_1<span class="main">[</span><span class="operator">OF</span> A b P<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">Bnd</span></span><span class="main">]</span> AI bI this
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">QQ</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> finC<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> QQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QQ</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> finQ<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">QQ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> BndQQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">QQ</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">DBnd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">+</span> cone <span class="skolem">C</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> convex_hull <span class="skolem">QQ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> CI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> BndC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">DBnd</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DBnd_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Bnd'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Bnd'</span> <span class="main">=</span> of_nat <span class="free">n</span> <span class="main">*</span> <span class="skolem">DBnd</span>"</span></span> 
  <span class="keyword1"><span class="command">note</span></span> coneC <span class="main">=</span> cone_iff_finite_cone<span class="main">[</span><span class="operator">OF</span> C finC<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_def <span class="keyword1"><span class="command">using</span></span> convex_hull_carrier<span class="main">[</span><span class="operator">OF</span> QQ<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">a</span> <span class="bound">D</span><span class="main">.</span> nonneg_lincomb <span class="bound">a</span> <span class="bound">D</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">⊆</span> <span class="skolem">C</span> <span class="main">∧</span> lin_indpt <span class="bound">D</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">d</span> <span class="main">∈</span> <span class="bound">D</span><span class="main">.</span> <span class="bound">a</span> <span class="bound">d</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> lincomb <span class="skolem">a</span> <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> DC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> <span class="skolem">C</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> linD<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bnd_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="main">∈</span> <span class="skolem">D</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="bound">d</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="bound">d</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def nonneg_lincomb_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> DC C <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> DC finC <span class="keyword1"><span class="command">have</span></span> finD<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> D linD finD <span class="keyword1"><span class="command">have</span></span> cardD<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">D</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dim_is_n li_le_dim<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> BndC DC <span class="keyword1"><span class="command">have</span></span> BndD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">DBnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> lincomb_card_bound<span class="main">[</span><span class="operator">OF</span> this D DBnd0 _ cardD<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">,</span> <span class="operator">folded</span> b<span class="main">]</span> bnd_a 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> Bounded_vec <span class="skolem">Bnd'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bnd'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> BndB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">Bnd'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> BndQQ <span class="keyword1"><span class="command">have</span></span> BndQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">DBnd</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_def <span class="keyword1"><span class="command">using</span></span> QQ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> convex_hull_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B_def nonneg_lincomb_def <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Q B <span class="keyword1"><span class="command">have</span></span> QB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_plus_elim<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sum_in_Bounded_vecI<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">DBnd</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">Bnd'</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> BndQ BndB B Q
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">⊆</span> Bounded_vec <span class="main">(</span><span class="skolem">DBnd</span> <span class="main">+</span> <span class="skolem">Bnd'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_plus_elim<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DBnd</span> <span class="main">+</span> <span class="skolem">Bnd'</span> <span class="main">=</span> <span class="skolem">nBnd</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nBnd_def Bnd'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> QB_Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">⊆</span> Bounded_vec <span class="skolem">nBnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> finQBZ<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subsetI<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ZBnd</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ZBnd</span> <span class="main">=</span> floor <span class="skolem">nBnd</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vecs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map vec_of_list <span class="main">(</span>concat_lists <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> map <span class="main">(</span>of_int <span class="main">::</span> <span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">[</span><span class="main">-</span><span class="skolem">ZBnd</span><span class="main">..</span><span class="skolem">ZBnd</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?vecs</span> <span class="main">=</span> vec_of_list <span class="main">`</span>
      <span class="main">{</span><span class="bound">as</span><span class="main">.</span> length <span class="bound">as</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> of_int <span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span> <span class="skolem">ZBnd</span><span class="main">..</span><span class="skolem">ZBnd</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_map <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?vecs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_set<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> xQB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> xQB QB_Bnd QB <span class="keyword1"><span class="command">have</span></span> xBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Bounded_vec <span class="skolem">nBnd</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> xid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> vec_of_list <span class="main">(</span>list_of_vec <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?vecs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> xid<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> imageI CollectI conjI allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>list_of_vec <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"list_of_vec <span class="skolem">x</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> xBnd<span class="main">[</span><span class="operator">unfolded</span> Bounded_vec_def<span class="main">]</span> i x <span class="keyword1"><span class="command">have</span></span> xiBnd<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">nBnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> xI<span class="main">[</span><span class="operator">unfolded</span> Ints_vec_def<span class="main">]</span> i x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> of_int <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ints_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> list_of_vec <span class="skolem">x</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> of_int <span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span> <span class="skolem">ZBnd</span><span class="main">..</span><span class="skolem">ZBnd</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id ZBnd_def
        <span class="keyword1"><span class="command">using</span></span> xiBnd <span class="keyword1"><span class="command">unfolding</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> abs_neg_floor abs_pos_floor<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> QBZ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> QB <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> decomposition_theorem_polyhedra_2<span class="main">[</span><span class="operator">OF</span> QBZ finQBZ<span class="main">,</span> <span class="operator">folded</span> integer_hull_def<span class="main">,</span> <span class="operator">OF</span> C finC refl<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">nr'</span></span> <span class="keyword2"><span class="keyword">where</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">∈</span> carrier_mat <span class="skolem">nr'</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> carrier_vec <span class="skolem">nr'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"integer_hull <span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> cone <span class="skolem">C</span> <span class="main">=</span> polyhedron <span class="skolem">A'</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> pI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">+</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> set_plus_elim<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      pqc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> qQ Q <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Caratheodory_theorem<span class="main">[</span><span class="operator">OF</span> C<span class="main">]</span> cC
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> cD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> finite_cone <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> DC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> linD<span class="main">:</span> <span class="quoted"><span class="quoted">"lin_indpt <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> DC C <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> DC finC <span class="keyword1"><span class="command">have</span></span> finD<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> cD finD
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"nonneg_lincomb <span class="skolem">a</span> <span class="skolem">D</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> caD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> lincomb <span class="skolem">a</span> <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∈</span> <span class="skolem">D</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="bound">d</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> nonneg_lincomb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">c</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">c</span> <span class="main">-</span> of_int <span class="main">(</span>floor <span class="main">(</span><span class="skolem">a</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">c</span><span class="main">.</span> of_int <span class="main">(</span>floor <span class="main">(</span><span class="skolem">a</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> lincomb <span class="skolem">a2</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> lincomb <span class="skolem">a1</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def b_def <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> bB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def b_def nonneg_lincomb_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a1</span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">D</span></span></span></span><span class="main"><span class="main">]</span></span> conjI ballI refl subsetI linD<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">a1</span> <span class="main">`</span> <span class="skolem">D</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> a0 <span class="keyword1"><span class="command">unfolding</span></span> a1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="keyword1"><span class="command">unfolding</span></span> a1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> DC<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cbd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def d_def caD lincomb_sum<span class="main">[</span><span class="operator">OF</span> finD D<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lincomb_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl D<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a1_def a2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nonneg_lincomb <span class="skolem">a2</span> <span class="skolem">D</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def nonneg_lincomb_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> allI conjI refl subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> a0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> dC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cone_def finite_cone_def <span class="keyword1"><span class="command">using</span></span> finC finD DC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pqc cbd <span class="keyword1"><span class="command">using</span></span> q b d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> dI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> CI DC C <span class="keyword1"><span class="command">unfolding</span></span> d_def indexed_Ints_vec_UNIV
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lincomb_indexed_Ints_vec<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> diff_indexed_Ints_vec<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted">UNIV</span><span class="main">,</span> <span class="operator">folded</span> indexed_Ints_vec_UNIV<span class="main">,</span> <span class="operator">OF</span> _ d pI dI<span class="main">,</span> <span class="operator">unfolded</span> p<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">-</span> <span class="skolem">d</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q b d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">-</span> <span class="skolem">d</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">+</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q b d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> qbI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> integer_hull <span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p integer_hull_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_plus_intro dC set_mp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set_in_convex_hull<span class="main"><span class="main">]</span></span> IntI qQ bB qbI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Q B<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_plus_elim<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">⊆</span> integer_hull <span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> one_dir<span class="main">:</span> <span class="quoted"><span class="quoted">"integer_hull <span class="free">P</span> <span class="main">⊆</span> integer_hull <span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> IH
    <span class="keyword1"><span class="command">unfolding</span></span> integer_hull_def <span class="keyword1"><span class="command">using</span></span> convex_convex_hull<span class="main">[</span><span class="operator">OF</span> polyhedra_are_convex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A' b' refl<span class="main"><span class="main">]</span></span><span class="main">]</span>
      convex_hull_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integer_hull <span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> cone <span class="skolem">C</span> <span class="main">⊆</span> integer_hull <span class="free">P</span> <span class="main">+</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_plus_mono2 subset_refl integer_hull_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def cone_def finite_cone_def <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ finC<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> integer_hull <span class="free">P</span> <span class="main">+</span> integer_hull <span class="main">(</span>cone <span class="skolem">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integer_hull_integer_cone<span class="main">[</span><span class="operator">OF</span> C CI<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> convex_hull <span class="main">(</span><span class="free">P</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">+</span> convex_hull <span class="main">(</span>cone <span class="skolem">C</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> integer_hull_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> convex_hull <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>cone <span class="skolem">C</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> convex_hull_sum<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Pn cone_carrier<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> convex_hull <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">+</span> cone <span class="skolem">C</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> convex_hull_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">+</span> cone <span class="skolem">C</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">⊆</span> <span class="main">(</span><span class="free">P</span> <span class="main">+</span> cone <span class="skolem">C</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_indexed_Ints_vec<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">n</span></span> <span class="main">_</span> <span class="quoted">UNIV</span><span class="main">,</span> <span class="operator">folded</span> indexed_Ints_vec_UNIV<span class="main">]</span> cone_carrier<span class="main">[</span><span class="operator">OF</span> C<span class="main">]</span> Pn
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_plus_elim<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> integer_hull <span class="main">(</span><span class="free">P</span> <span class="main">+</span> cone <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> integer_hull_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">+</span> cone <span class="skolem">C</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> CC<span class="main">:</span> <span class="quoted"><span class="quoted">"cone <span class="skolem">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_carrier<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">+</span> cone <span class="skolem">C</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">+</span> <span class="main">(</span>cone <span class="skolem">C</span> <span class="main">+</span> cone <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assoc_add_vecset<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> Q CC CC<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cone <span class="skolem">C</span> <span class="main">+</span> cone <span class="skolem">C</span> <span class="main">=</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cone_add_cone<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integer_hull <span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> cone <span class="skolem">C</span> <span class="main">⊆</span> integer_hull <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> one_dir <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"integer_hull <span class="free">P</span> <span class="main">=</span> integer_hull <span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">unfolding</span></span> integer_hull_def nBnd<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> DBnd<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">Q</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">B</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∩</span></span> <span class="keyword1"><span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span><span class="main"><span class="main">]</span></span> conjI refl BndC<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> QB_Bnd <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">⊆</span> Bounded_vec <span class="skolem">nBnd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∪</span> <span class="skolem">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> QB C CI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∪</span> <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finQBZ finC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> integer_hull_of_polyhedron<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> AI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> polyhedron <span class="free">A</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">A'</span> <span class="bound">b'</span> <span class="bound">nr'</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">∈</span> carrier_mat <span class="bound">nr'</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">b'</span> <span class="main">∈</span> carrier_vec <span class="bound">nr'</span> <span class="main">∧</span> integer_hull <span class="free">P</span> <span class="main">=</span> polyhedron <span class="bound">A'</span> <span class="bound">b'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> decomposition_theorem_integer_hull_of_polyhedron<span class="main">[</span><span class="operator">OF</span> A b AI bI P refl<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="skolem"><span class="skolem">C</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> HC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"integer_hull <span class="free">P</span> <span class="main">=</span> convex_hull <span class="skolem">H</span> <span class="main">+</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decomposition_theorem_polyhedra_2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ _ decomp<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> HC<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> small_integer_solution_nonstrict_via_decomp<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier_vec <span class="free">nr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> AI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>m</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Bnd</span> <span class="main">=</span> Max <span class="main">(</span>abs <span class="main">`</span> <span class="main">(</span>elements_mat <span class="free">A</span> <span class="main">∪</span> vec_set <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span>
  <span class="bound">y</span> <span class="main">∈</span> carrier_vec <span class="free">n</span> <span class="main">∧</span>
  <span class="bound">y</span> <span class="main">∈</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">∧</span>
  <span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span>
  <span class="bound">y</span> <span class="main">∈</span> Bounded_vec <span class="main">(</span>fact <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>max <span class="main">1</span> <span class="free">Bnd</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> x sol <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> polyhedron <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> polyhedron_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> xI x <span class="keyword1"><span class="command">have</span></span> xsol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> integer_hull <span class="main">(</span>polyhedron <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> integer_hull_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> IntI convex_hull_mono in_mono inf_sup_ord<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_sup_ord<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_in_convex_hull<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> decomposition_theorem_integer_hull_of_polyhedron<span class="main">[</span><span class="operator">OF</span> A b AI bI refl Bnd<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> HC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">C</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span> <span class="main">∩</span> <span class="keyword1">ℤ<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> Bounded_vec <span class="main">(</span>fact <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> max <span class="main">1</span> <span class="free">Bnd</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    id<span class="main">:</span> <span class="quoted"><span class="quoted">"integer_hull <span class="main">(</span>polyhedron <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> convex_hull <span class="skolem">H</span> <span class="main">+</span> cone <span class="skolem">C</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> xsol<span class="main">[</span><span class="operator">unfolded</span> id<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> hH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> set_in_convex_hull <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> convex_hull <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> HC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">∈</span> cone <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> zero_in_cone<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">+</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">∈</span> integer_hull <span class="main">(</span>polyhedron <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">+</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hH HC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integer_hull <span class="main">(</span>polyhedron <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊆</span> convex_hull <span class="main">(</span>polyhedron <span class="free">A</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> integer_hull_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> convex_hull_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convex_hull <span class="main">(</span>polyhedron <span class="free">A</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> polyhedron <span class="free">A</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A b
    <span class="keyword1"><span class="command">using</span></span> convex_convex_hull polyhedra_are_convex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">h</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> polyhedron_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">h</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI h<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> HC hH<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>