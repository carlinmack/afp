<div id="ZF_Library">
<div class="head">
<h1>Theory ZF_Library</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Library of basic $\ZF$ results\label{sec:zf-lib}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ZF_Library
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/ZF/ZF-Constructible/Normal.html">ZF-Constructible.Normal</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory gathers basic ``combinatorial'' results that can be proved
in $\ZF$ (that is, without using the Axiom of Choice $\AC$).
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We begin by setting up math-friendly notation.›</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> oadd <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">++</span>›</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> sum <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">‹<span class="keyword1">+</span>›</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> oadd <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">+</span>›</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> nat <span class="main">(</span><span class="quoted">‹<span class="keyword1">ω</span>›</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> csucc <span class="main">(</span><span class="quoted">‹_<span class="keyword1"><span class="hidden">⇧</span><sup>+</sup></span>›</span> <span class="main">[</span>90<span class="main">]</span><span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> Aleph <span class="main">(</span><span class="quoted">‹<span class="keyword1">ℵ</span>_›</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Aleph <span class="main">(</span><span class="quoted">‹<span class="keyword1">ℵ⇘</span>_<span class="keyword1">⇙</span>›</span><span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_ge"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span>i<span class="main">]</span> <span class="main">⇒</span> o"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">≥</span>›</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">y</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Some minimal arithmetic/ordinal stuff›</span></span>

<span class="keyword1" id="ZF_Library-Un_leD1"><span class="command">lemma</span></span> Un_leD1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∪</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">j</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Un_least_lt_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="ZF_Library-Un_leD2"><span class="command">lemma</span></span> Un_leD2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∪</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">j</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Un_least_lt_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="ZF_Library-Un_memD1"><span class="command">lemma</span></span> Un_memD1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∪</span> <span class="free">j</span> <span class="main">∈</span> <span class="free">k</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">j</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> ltI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Un_least_lt_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="ZF_Library-Un_memD2"><span class="command">lemma</span></span> Un_memD2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∪</span> <span class="free">j</span> <span class="main">∈</span> <span class="free">k</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">j</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> ltI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Un_least_lt_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This lemma allows to apply arithmetic simprocs to ordinal addition›</span></span>
<span class="keyword1" id="ZF_Library-nat_oadd_add"><span class="command">lemma</span></span> nat_oadd_add<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="keyword1">ω</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="keyword1">ω</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">m</span> <span class="main">=</span> <span class="free">n</span> <span class="main">#+</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">simp_all</span>

<span class="keyword1" id="ZF_Library-Ord_has_max_imp_succ"><span class="command">lemma</span></span> Ord_has_max_imp_succ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">α</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> <span class="bound">α</span> <span class="main">≤</span> <span class="free">β</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> succ<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Ord_trans<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">β</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> lt_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-Least_antitone"><span class="command">lemma</span></span> Least_antitone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">μ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Q</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms LeastI2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> Least_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ZF_Library-Least_set_antitone"><span class="command">lemma</span></span> Least_set_antitone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">j</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">j</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">B</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subset_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>Least_antitone<span class="main">)</span>

<span class="keyword1" id="ZF_Library-le_neq_imp_lt"><span class="command">lemma</span></span> le_neq_imp_lt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≤</span><span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">&lt;</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ltD ltI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> le_Ord2
  <span class="keyword1"><span class="command">unfolding</span></span> succ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Strict upper bound of a set of ordinals.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">str_bound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"i<span class="main">⇒</span>i"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">str_bound</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> succ<span class="main">(</span><span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ZF_Library-str_bound_type"><span class="command">lemma</span></span> str_bound_type <span class="main">[</span><span class="operator">TC</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> Ord<span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span>str_bound<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> str_bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-str_bound_lt"><span class="command">lemma</span></span> str_bound_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> Ord<span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> str_bound<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> str_bound_def <span class="keyword1"><span class="command">using</span></span> str_bound_type
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>ltI<span class="main">)</span>

<span class="keyword1" id="ZF_Library-naturals_lt_nat"><span class="command">lemma</span></span> naturals_lt_nat<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="keyword1">ω</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="keyword1">ω</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The next two lemmas are handy when one is constructing
some object recursively. The first handles injectivity (of recursively
constructed sequences of sets), while the second is helpful for
establishing a symmetry argument.›</span></span>
<span class="keyword1" id="ZF_Library-Int_eq_zero_imp_not_eq"><span class="command">lemma</span></span> Int_eq_zero_imp_not_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">D</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">A</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">D</span> <span class="main">⟹</span> <span class="free">A</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="free">A</span><span class="main">(</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="ZF_Library-lt_neq_symmetry"><span class="command">lemma</span></span> lt_neq_symmetry<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="bound">α</span> <span class="main">∈</span> <span class="free">γ</span> <span class="main">⟹</span> <span class="bound">β</span> <span class="main">∈</span> <span class="free">γ</span> <span class="main">⟹</span> <span class="bound">α</span> <span class="main">&lt;</span> <span class="bound">β</span> <span class="main">⟹</span> <span class="free">Q</span><span class="main">(</span><span class="bound">α</span><span class="main">,</span><span class="bound">β</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="free">Q</span><span class="main">(</span><span class="bound">α</span><span class="main">,</span><span class="bound">β</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span><span class="main">(</span><span class="bound">β</span><span class="main">,</span><span class="bound">α</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≠</span> <span class="free">β</span>"</span></span>
    <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="free">β</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">&lt;</span><span class="free">β</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">β</span><span class="main">&lt;</span><span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_linear_lt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="free">β</span></span> <span class="quoted"><span class="skolem">thesis</span></span><span class="main">]</span> Ord_in_Ord<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-cardinal_succ_not_0"><span class="command">lemma</span></span> cardinal_succ_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">A</span><span class="main">|</span> <span class="main">=</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-Ord_eq_Collect_lt"><span class="command">lemma</span></span> Ord_eq_Collect_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">α</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">j</span><span class="main">∈</span><span class="free">α</span><span class="main">.</span> <span class="bound">j</span><span class="main">&lt;</span><span class="free">i</span><span class="main">}</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="comment1">― ‹almost the same proof as <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> nat_eq_Collect_lt<span class="antiquote">}</span></span>›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ltD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_mem_iff_lt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Ord_trans ltI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ lt_Ord<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lt_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>ltD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Manipulation of function spaces›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Finite_to_one</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span>i<span class="main">]</span> <span class="main">⇒</span> i"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Finite_to_one</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">f</span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">.</span> Finite<span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">.</span> <span class="bound">f</span><span class="main">`</span><span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="ZF_Library-Finite_to_oneI"><span class="command">lemma</span></span> Finite_to_oneI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">X</span><span class="main">→</span><span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="free">Y</span> <span class="main">⟹</span> Finite<span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="free">f</span><span class="main">`</span><span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Finite_to_one<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Finite_to_one_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ZF_Library-Finite_to_oneD"><span class="command">lemma</span></span> Finite_to_oneD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Finite_to_one<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">:</span><span class="free">X</span><span class="main">→</span><span class="free">Y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Finite_to_one<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">y</span><span class="main">∈</span><span class="free">Y</span> <span class="main">⟹</span>  Finite<span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="free">f</span><span class="main">`</span><span class="bound">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Finite_to_one_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="ZF_Library-subset_Diff_Un"><span class="command">lemma</span></span> subset_Diff_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">X</span><span class="main">)</span> <span class="main">∪</span> <span class="free">X</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-Diff_bij"><span class="command">lemma</span></span> Diff_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="free">X</span> <span class="main">⊆</span> <span class="bound">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="bound">A</span><span class="main">-</span><span class="free">X</span><span class="main">)</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">F</span><span class="main">,</span> <span class="main">{</span><span class="bound">A</span><span class="main">-</span><span class="free">X</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span><span class="free">F</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> bij_def inj_def surj_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lam_type<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> subset_Diff_Un<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-function_space_nonempty"><span class="command">lemma</span></span> function_space_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lam_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="ZF_Library-vimage_lam"><span class="command">lemma</span></span> vimage_lam<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-``</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lam_funtype<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">,</span> <span class="operator">THEN</span> <span class="main"><span class="main">[</span></span>2<span class="main"><span class="main">]</span></span> domain_type<span class="main">]</span>
    lam_funtype<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">,</span> <span class="operator">THEN</span> <span class="main"><span class="main">[</span></span>2<span class="main"><span class="main">]</span></span> apply_equality<span class="main">]</span> lamI<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">blast</span>

<span class="keyword1" id="ZF_Library-range_fun_subset_codomain"><span class="command">lemma</span></span> range_fun_subset_codomain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span><span class="main">:</span><span class="free">B</span> <span class="main">→</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"range<span class="main">(</span><span class="free">h</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> range_def domain_def converse_def <span class="keyword1"><span class="command">using</span></span> range_type<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-Pi_rangeD"><span class="command">lemma</span></span> Pi_rangeD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">∈</span>Pi<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> range<span class="main">(</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span><span class="main">`</span><span class="bound">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms apply_equality<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
    domain_type<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-Pi_range_eq"><span class="command">lemma</span></span> Pi_range_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span> <span class="main">⟹</span> range<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">f</span> <span class="main">`</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Pi_rangeD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> apply_rangeI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ZF_Library-Pi_vimage_subset"><span class="command">lemma</span></span> Pi_vimage_subset <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">-``</span><span class="free">C</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Pi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-apply_in_range"><span class="command">lemma</span></span> apply_in_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span> <span class="free">A</span> <span class="main">→</span> <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="free">x</span><span class="main">∈</span><span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">∈</span><span class="free">A</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span>   domain_of_fun apply_rangeI  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">∉</span><span class="free">A</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> apply_0 Ord_0_lt ltD domain_of_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-range_eq_image"><span class="command">lemma</span></span> range_eq_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">A</span><span class="main">→</span><span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"range<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">``</span><span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">``</span> <span class="free">A</span> <span class="main">⊆</span> range<span class="main">(</span><span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">f</span><span class="main">``</span><span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> domain_of_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">B</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">``</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-Image_sub_codomain"><span class="command">lemma</span></span> Image_sub_codomain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">A</span><span class="main">→</span><span class="free">B</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">``</span><span class="free">C</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> image_subset fun_is_rel<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main">.</span> <span class="free">B</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="ZF_Library-inj_to_Image"><span class="command">lemma</span></span> inj_to_Image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">A</span><span class="main">→</span><span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">f</span><span class="main">``</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms inj_inj_range range_eq_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="ZF_Library-inj_imp_surj"><span class="command">lemma</span></span> inj_imp_surj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">b</span>
  <span class="keyword2"><span class="keyword">notes</span></span> inj_is_fun<span class="main">[</span><span class="operator">dest</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ifx</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free">x</span><span class="main">∈</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="keyword1">then</span> converse<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">`</span><span class="free">x</span> <span class="keyword1">else</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">B</span><span class="main">,</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">ifx</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> surj<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"converse<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">∈</span> surj<span class="main">(</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"range<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="quoted"><span class="quoted">"converse<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">:</span> range<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">→</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_converse_surj range_fun_subset_codomain surj_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∈</span><span class="free">B</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">ifx</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> surj<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> surj_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI lam_type ballI<span class="main"><span class="keyword3">;</span></span> <span class="operator">elim</span> CollectE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> converse<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">`</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹range<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">ifx</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-fun_Pi_disjoint_Un"><span class="command">lemma</span></span> fun_Pi_disjoint_Un<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">D</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∪</span> <span class="free">g</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">C</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∪</span> <span class="free">D</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pi_iff extension Un_rls<span class="main">)</span> <span class="main">(</span><span class="operator">unfold</span> function_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="ZF_Library-Un_restrict_decomposition"><span class="command">lemma</span></span> Un_restrict_decomposition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">C</span><span class="main">)</span> <span class="main">∪</span> restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">A</span> <span class="main">-</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fun_extension<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">A</span><span class="main">∩</span><span class="free">C</span><span class="main">)</span> <span class="main">∪</span> restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">A</span><span class="main">-</span><span class="free">C</span><span class="main">)</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">A</span><span class="main">∩</span><span class="free">C</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="free">C</span><span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">∪</span><span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> restrict_type2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> fun_Pi_disjoint_Un<span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">C</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">C</span><span class="main">)</span> <span class="main">∪</span> restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">A</span> <span class="main">-</span> <span class="free">C</span><span class="main">)</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">C</span><span class="main">)</span> <span class="main">∪</span> restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">A</span> <span class="main">-</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> restrict fun_disjoint_apply1<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>"</span></span><span class="main">]</span>
      fun_disjoint_apply2<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>"</span></span><span class="main">]</span>
      domain_restrict<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> apply_0 domain_of_fun
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">C</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-restrict_eq_imp_Un_into_Pi"><span class="command">lemma</span></span> restrict_eq_imp_Un_into_Pi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> restrict<span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∪</span> <span class="free">g</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">C</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∪</span> <span class="free">D</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> assms
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">g</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∉</span> restrict<span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> restrict_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">C</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">A</span> <span class="main">-</span> <span class="free">C</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> restrict<span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> Un_restrict_decomposition<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">C</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∪</span> <span class="free">g</span> <span class="main">=</span> restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">A</span> <span class="main">-</span> <span class="free">C</span><span class="main">)</span> <span class="main">∪</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> restrict_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">C</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Un_restrict_decomposition<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">C</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="free">C</span> <span class="main">∪</span> <span class="free">C</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> assms
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_Pi_disjoint_Un<span class="main">[</span><span class="operator">OF</span>
        restrict_type2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">-</span><span class="free">C</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">D</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-restrict_eq_imp_Un_into_Pi'"><span class="command">lemma</span></span> restrict_eq_imp_Un_into_Pi'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">D</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span> domain<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">∩</span> domain<span class="main">(</span><span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> restrict<span class="main">(</span><span class="free">g</span><span class="main">,</span> domain<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">∩</span> domain<span class="main">(</span><span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∪</span> <span class="free">g</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">C</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∪</span> <span class="free">D</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  assms domain_of_fun restrict_eq_imp_Un_into_Pi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ZF_Library-restrict_subset_Sigma"><span class="command">lemma</span></span> restrict_subset_Sigma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊆</span> Sigma<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">B</span><span class="main">)</span> <span class="main">⟹</span> restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> Sigma<span class="main">(</span><span class="free">A</span><span class="main">∩</span><span class="free">C</span><span class="main">,</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Finite sets›</span></span>

<span class="keyword1" id="ZF_Library-Replace_sing1"><span class="command">lemma</span></span> Replace_sing1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="bound">y'</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">y'</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">y</span><span class="main">=</span><span class="bound">y'</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">{</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">d</span><span class="main">}</span><span class="main">,</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">― ‹Not really necessary›</span>
<span class="keyword1" id="ZF_Library-Replace_sing2"><span class="command">lemma</span></span> Replace_sing2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">d</span><span class="main">}</span><span class="main">,</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-Replace_sing3"><span class="command">lemma</span></span> Replace_sing3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span> <span class="bound">e</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> <span class="bound">e</span> <span class="main">∧</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">d</span><span class="main">}</span><span class="main">,</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">d</span><span class="main">}</span><span class="main">,</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Replace_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-Replace_Un"><span class="command">lemma</span></span> Replace_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">,</span> <span class="free">Q</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">,</span> <span class="free">Q</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">B</span><span class="main">,</span> <span class="free">Q</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Replace_iff<span class="main">)</span>

<span class="keyword1" id="ZF_Library-Replace_subset_sing"><span class="command">lemma</span></span> Replace_subset_sing<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">{</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">d</span><span class="main">}</span><span class="main">,</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">z</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span>
    <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="bound">y'</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">y'</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">y</span><span class="main">=</span><span class="bound">y'</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span> <span class="bound">e</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> <span class="bound">e</span> <span class="main">∧</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">{</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">d</span><span class="main">}</span><span class="main">,</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">z</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Replace_sing1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">d</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Replace_sing3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">d</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-Finite_Replace"><span class="command">lemma</span></span> Finite_Replace<span class="main">:</span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> Finite<span class="main">(</span>Replace<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>Finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cons <span class="skolem">x</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> cons<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">B</span><span class="main">)</span><span class="main">,</span> <span class="free">Q</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">B</span><span class="main">,</span> <span class="free">Q</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">,</span> <span class="free">Q</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Replace_Un <span class="keyword1"><span class="command">unfolding</span></span> cons_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">,</span> <span class="free">Q</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Replace_subset_sing<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="main">{</span><span class="bound">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">,</span> <span class="free">Q</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_Finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> subset_Finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-Finite_domain"><span class="command">lemma</span></span> Finite_domain<span class="main">:</span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> Finite<span class="main">(</span>domain<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Finite_Replace <span class="keyword1"><span class="command">unfolding</span></span> domain_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-Finite_converse"><span class="command">lemma</span></span> Finite_converse<span class="main">:</span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> Finite<span class="main">(</span>converse<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Finite_Replace <span class="keyword1"><span class="command">unfolding</span></span> converse_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-Finite_range"><span class="command">lemma</span></span> Finite_range<span class="main">:</span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> Finite<span class="main">(</span>range<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Finite_domain Finite_converse <span class="keyword1"><span class="command">unfolding</span></span> range_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ZF_Library-Finite_Sigma"><span class="command">lemma</span></span> Finite_Sigma<span class="main">:</span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> Finite<span class="main">(</span><span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Finite<span class="main">(</span>Sigma<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Sigma_def <span class="keyword1"><span class="command">using</span></span> Finite_RepFun Finite_Union
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ZF_Library-Finite_Pi"><span class="command">lemma</span></span> Finite_Pi<span class="main">:</span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> Finite<span class="main">(</span><span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Finite<span class="main">(</span>Pi<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Finite_Sigma
    Finite_Pow subset_Finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Pi<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Pow<span class="main">(</span>Sigma<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> Pi_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic results on equipollence, cardinality and related concepts›</span></span>

<span class="keyword1" id="ZF_Library-lepollD"><span class="command">lemma</span></span> lepollD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≲</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lepoll_def <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="ZF_Library-lepollI"><span class="command">lemma</span></span> lepollI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≲</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lepoll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ZF_Library-eqpollD"><span class="command">lemma</span></span> eqpollD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eqpoll_def <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">declare</span></span> bij_imp_eqpoll<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

<span class="keyword1" id="ZF_Library-range_of_subset_eqpoll"><span class="command">lemma</span></span> range_of_subset_eqpoll<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≈</span> <span class="free">f</span> <span class="main">``</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms restrict_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹I thank Miguel Pagano for this proof.›</span></span>
<span class="keyword1" id="ZF_Library-function_space_eqpoll_cong"><span class="command">lemma</span></span> function_space_eqpoll_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≈</span> <span class="free">A'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≈</span> <span class="free">B'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">→</span> <span class="free">B</span> <span class="main">≈</span> <span class="free">A'</span> <span class="main">→</span> <span class="free">B'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> eqpoll_sym<span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">A'</span><span class="main">,</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">B</span><span class="main">,</span><span class="free">B'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">:</span> <span class="free">B'</span> <span class="main">→</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">:</span> <span class="free">A</span> <span class="main">→</span> <span class="free">A'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_converse_bij bij_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eqpoll_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI fg_imp_bijective<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> lam_type<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">:</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">A'</span><span class="main">,</span><span class="free">A</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">B</span><span class="main">,</span><span class="free">B'</span><span class="main">)</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">O</span> <span class="skolem">F</span> <span class="keyword1">O</span> <span class="skolem">f</span> <span class="main">:</span> <span class="free">A'</span> <span class="main">→</span> <span class="free">B'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bij_is_fun comp_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">:</span> <span class="free">A'</span> <span class="main">→</span> <span class="free">B'</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">:</span> <span class="free">B'</span> <span class="main">→</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">:</span> <span class="free">A</span> <span class="main">→</span> <span class="free">A'</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="keyword1">O</span> <span class="skolem">F</span> <span class="keyword1">O</span> converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">:</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">∈</span><span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span><span class="main">∈</span><span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">∈</span><span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span><span class="main">∈</span><span class="main">_</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A'</span> <span class="main">→</span> <span class="free">B'</span> <span class="main">⟹</span> converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bij_is_fun comp_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="free">B</span><span class="main">.</span> <span class="skolem">g</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A'</span> <span class="main">→</span> <span class="free">B'</span><span class="main">.</span> converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">)</span>
          <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A'</span> <span class="main">→</span> <span class="free">B'</span> <span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="keyword1">O</span> converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> <span class="main">(</span>converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span> <span class="keyword1">O</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lam_cong comp_assoc comp_lam<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A'</span> <span class="main">→</span> <span class="free">B'</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A'</span> <span class="main">→</span> <span class="free">B'</span> <span class="main">.</span> id<span class="main">(</span><span class="free">B'</span><span class="main">)</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> <span class="main">(</span>id<span class="main">(</span><span class="free">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> left_comp_inverse<span class="main">[</span><span class="operator">OF</span> bij_is_inj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">∈</span><span class="main">_</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        right_comp_inverse<span class="main">[</span><span class="operator">OF</span> bij_is_surj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span><span class="main">∈</span><span class="main">_</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A'</span> <span class="main">→</span> <span class="free">B'</span> <span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> left_comp_id<span class="main">[</span><span class="operator">OF</span> fun_is_rel<span class="main">]</span> right_comp_id<span class="main">[</span><span class="operator">OF</span> fun_is_rel<span class="main">]</span>  lam_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> id<span class="main">(</span><span class="free">A'</span><span class="main">→</span><span class="free">B'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">-&gt;</span> <span class="free">B</span><span class="main">.</span> <span class="skolem">g</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A'</span> <span class="main">-&gt;</span> <span class="free">B'</span><span class="main">.</span> converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> id<span class="main">(</span><span class="free">A'</span> <span class="main">-&gt;</span> <span class="free">B'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">∈</span><span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span><span class="main">∈</span><span class="main">_</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span> <span class="main">⟹</span> <span class="skolem">g</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> <span class="skolem">f</span> <span class="main">∈</span> <span class="free">A'</span> <span class="main">→</span> <span class="free">B'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bij_is_fun comp_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A'</span> <span class="main">-&gt;</span> <span class="free">B'</span><span class="main">.</span> converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">-&gt;</span> <span class="free">B</span><span class="main">.</span> <span class="skolem">g</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> <span class="skolem">f</span><span class="main">)</span>
          <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="free">B</span> <span class="main">.</span> <span class="main">(</span>converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="keyword1">O</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">O</span> converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_lam comp_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="free">B</span> <span class="main">.</span> id<span class="main">(</span><span class="free">B</span><span class="main">)</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> <span class="main">(</span>id<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>
        right_comp_inverse<span class="main">[</span><span class="operator">OF</span> bij_is_surj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">∈</span><span class="main">_</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        left_comp_inverse<span class="main">[</span><span class="operator">OF</span> bij_is_inj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span><span class="main">∈</span><span class="main">_</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> lam_cong
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="free">B</span> <span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> left_comp_id<span class="main">[</span><span class="operator">OF</span> fun_is_rel<span class="main">]</span> right_comp_id<span class="main">[</span><span class="operator">OF</span> fun_is_rel<span class="main">]</span> lam_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> id<span class="main">(</span><span class="free">A</span><span class="main">→</span><span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A'</span> <span class="main">→</span> <span class="free">B'</span><span class="main">.</span> converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">-&gt;</span> <span class="free">B</span><span class="main">.</span> <span class="skolem">g</span> <span class="keyword1">O</span> <span class="bound">x</span> <span class="keyword1">O</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> id<span class="main">(</span><span class="free">A</span> <span class="main">-&gt;</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-curry_eqpoll"><span class="command">lemma</span></span> curry_eqpoll<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="free">ν1</span> <span class="free">ν2</span>  <span class="free">κ</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ν1</span> <span class="main">→</span> <span class="free">ν2</span> <span class="main">→</span> <span class="free">κ</span> <span class="main">≈</span> <span class="free">ν1</span> <span class="main">×</span> <span class="free">ν2</span> <span class="main">→</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eqpoll_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> lam_bijective<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> lam_type<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> lam_type<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">:</span> <span class="free">ν1</span> <span class="main">→</span> <span class="free">ν2</span> <span class="main">→</span> <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">ν1</span> <span class="main">×</span> <span class="free">ν2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">`</span>fst<span class="main">(</span><span class="skolem">z</span><span class="main">)</span><span class="main">`</span>snd<span class="main">(</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">:</span> <span class="free">ν1</span> <span class="main">×</span> <span class="free">ν2</span> <span class="main">→</span> <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">ν1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">ν2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">`</span><span class="main">⟨</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">κ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> <span class="comment1">― ‹one composition is the identity:›</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">:</span> <span class="free">ν1</span> <span class="main">×</span> <span class="free">ν2</span> <span class="main">→</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">ν1</span> <span class="main">×</span> <span class="free">ν2</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">ν1</span><span class="main">.</span> <span class="main">λ</span><span class="bound">xa</span><span class="main">∈</span><span class="free">ν2</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span><span class="main">⟩</span><span class="main">)</span> <span class="main">`</span> fst<span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">`</span> snd<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>fun_extension<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span> <span class="comment1">― ‹the other composition follows automatically›</span>

<span class="keyword1" id="ZF_Library-Pow_eqpoll_function_space"><span class="command">lemma</span></span> Pow_eqpoll_function_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="free">X</span>
  <span class="keyword2"><span class="keyword">notes</span></span> bool_of_o_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> bool_of_o<span class="main">(</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="comment1">― ‹the witnessing map for the thesis:›</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Pow<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">≈</span> <span class="free">X</span> <span class="main">→</span> <span class="main">2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eqpoll_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> lam_bijective<span class="main">)</span>
  <span class="comment1">― ‹We give explicit mutual inverses›</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span>Pow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">(</span><span class="skolem">A</span><span class="main">)</span> <span class="main">:</span> <span class="free">X</span> <span class="main">→</span> <span class="main">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lam_type<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> bool_of_o<span class="main">(</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span><span class="main">∈</span>Pow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">d</span><span class="main">(</span><span class="skolem">A</span><span class="main">)</span><span class="main">`</span><span class="bound">y</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">:</span> <span class="free">X</span><span class="main">→</span><span class="main">2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">(</span><span class="main">{</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">.</span> <span class="skolem">f</span> <span class="main">`</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apply_type<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">:</span> <span class="free">X</span><span class="main">→</span><span class="main">2</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>fun_extension<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ZF_Library-cantor_inj"><span class="command">lemma</span></span> cantor_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∉</span> inj<span class="main">(</span>Pow<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inj_imp_surj<span class="main">[</span><span class="operator">OF</span> _ Pow_bottom<span class="main">]</span> cantor_surj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">cexp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span>i<span class="main">]</span> <span class="main">⇒</span> i"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">⇗↑</span>_<span class="keyword1">⇖</span>"</span> <span class="main">[</span>76<span class="main">,</span>1<span class="main">]</span> 75<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="hidden">⇗</span><sup>↑<span class="free"><span class="bound"><span class="entity">ν</span></span></span></sup><span class="hidden">⇖</span> <span class="main">≡</span> <span class="main">|</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">→</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">|</span>"</span></span>

<span class="keyword1" id="ZF_Library-Card_cexp"><span class="command">lemma</span></span> Card_cexp<span class="main">:</span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cexp_def Card_cardinal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ZF_Library-eq_csucc_ord"><span class="command">lemma</span></span> eq_csucc_ord<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">i</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">|</span><span class="free">i</span><span class="main">|</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Card_lt_iff Least_cong <span class="keyword1"><span class="command">unfolding</span></span> csucc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹I thank Miguel Pagano for this proof.›</span></span>
<span class="keyword1" id="ZF_Library-lesspoll_csucc"><span class="command">lemma</span></span> lesspoll_csucc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≺</span> <span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟷</span> <span class="free">d</span> <span class="main">≲</span> <span class="free">κ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≺</span> <span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> Card_is_Ord <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">&lt;</span> <span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_cardinal_eqpoll csucc_basic <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≺</span> <span class="main">|</span><span class="free">κ</span><span class="main">|</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="main">|</span><span class="free">κ</span><span class="main">|</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≈</span> <span class="main">|</span><span class="free">d</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_csucc_ord<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span> lesspoll_imp_eqpoll eqpoll_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">d</span><span class="main">|</span> <span class="main">&lt;</span> <span class="main">|</span><span class="free">κ</span><span class="main">|</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lesspoll_cardinal_lt csucc_basic <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">d</span><span class="main">|</span> <span class="main">≲</span> <span class="main">|</span><span class="free">κ</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_lt_csucc_iff le_imp_lepoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">d</span><span class="main">|</span> <span class="main">≲</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lepoll_eq_trans Ord_cardinal_eqpoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≲</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_lepoll_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">&lt;</span> <span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> csucc_basic <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≲</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≲</span> <span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_imp_lepoll leI lepoll_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">≲</span> <span class="free">κ</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≲</span> <span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≈</span> <span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqpoll_sym<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> eq_lepoll_trans<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">d</span><span class="main">≲</span><span class="free">κ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation <span class="quoted"><span class="quoted">‹Card<span class="main">(</span><span class="main">_</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">d</span> <span class="main">≈</span> <span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lesspoll_irrefl lesspoll_trans1 lt_Card_imp_lesspoll<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">κ</span> <span class="main">&lt;</span><span class="main">_</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≺</span> <span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lesspoll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">Infinite</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"i<span class="main">⇒</span>o"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Infinite</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">¬</span> Finite<span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ZF_Library-Infinite_not_empty"><span class="command">lemma</span></span> Infinite_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"Infinite<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> empty_lepollI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-Infinite_imp_nats_lepoll"><span class="command">lemma</span></span> Infinite_imp_nats_lepoll<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Infinite<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="keyword1">ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≲</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">∈</span> <span class="keyword1">ω</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> empty_lepollI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Infinite<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">ω</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≈</span> <span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eqpoll_sym <span class="keyword1"><span class="command">unfolding</span></span> Finite_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≲</span> <span class="free">X</span>›</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> surj<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bij_def eqpoll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">x</span><span class="main">.</span> <span class="skolem">f</span><span class="main">`</span><span class="bound">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inj_is_fun <span class="keyword1"><span class="command">unfolding</span></span> surj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">X</span><span class="main">-</span><span class="main">{</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inj_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>Pi_type<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cons<span class="main">(</span><span class="main">⟨</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">b</span><span class="main">⟩</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> inj<span class="main">(</span>succ<span class="main">(</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span> cons<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inj_extend<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">-</span><span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> succ_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>mem_irrefl<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">∈</span><span class="free">X</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cons<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">≲</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-zero_lesspoll"><span class="command">lemma</span></span> zero_lesspoll<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≺</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms eqpoll_0_iff<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span> eqpoll_sym
  <span class="keyword1"><span class="command">unfolding</span></span> lesspoll_def lepoll_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inj_def<span class="main">)</span>

<span class="keyword1" id="ZF_Library-lepoll_nat_imp_Infinite"><span class="command">lemma</span></span> lepoll_nat_imp_Infinite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span> <span class="main">≲</span> <span class="free">X</span> <span class="main">⟹</span> Infinite<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span> <span class="main">≲</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≈</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="keyword1">ω</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Finite_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span> <span class="main">≲</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lepoll_eq_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lepoll_nat_imp_Finite nat_not_Finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-InfCard_imp_Infinite"><span class="command">lemma</span></span> InfCard_imp_Infinite<span class="main">:</span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span> <span class="main">⟹</span> Infinite<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_imp_lepoll<span class="main">[</span><span class="operator">THEN</span> lepoll_nat_imp_Infinite<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> InfCard_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ZF_Library-lt_surj_empty_imp_Card"><span class="command">lemma</span></span> lt_surj_empty_imp_Card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">α</span><span class="main">.</span> <span class="bound">α</span> <span class="main">&lt;</span> <span class="free">κ</span> <span class="main">⟹</span> surj<span class="main">(</span><span class="bound">α</span><span class="main">,</span><span class="free">κ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">κ</span><span class="main">|</span> <span class="main">&lt;</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> LeastI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≈</span> <span class="free">κ</span>"</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">,</span> <span class="operator">OF</span> eqpoll_refl<span class="main">]</span>
        Least_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≈</span> <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">κ</span><span class="main">|</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> Ord_cardinal_eqpoll<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> Card_def cardinal_def eqpoll_def bij_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_cardinal_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span> not_lt_imp_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">κ</span><span class="main">|</span>"</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span> le_anti_sym
    <span class="keyword1"><span class="command">unfolding</span></span> Card_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Morphisms of binary relations›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The main case of interest is in the case of partial orders.›</span></span>

<span class="keyword1" id="ZF_Library-mono_map_mono"><span class="command">lemma</span></span> mono_map_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">B</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">C</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mono_map_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI ballI impI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="free">B</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_map_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">B</span><span class="main">⊆</span><span class="free">C</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span> <span class="free">A</span> <span class="main">→</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_weaken_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="skolem">y</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apply_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">x</span><span class="main">,</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">y</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mono_map_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-ordertype_zero_imp_zero"><span class="command">lemma</span></span> ordertype_zero_imp_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ordermap_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-mono_map_increasing"><span class="command">lemma</span></span> mono_map_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">∈</span>mono_map<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">B</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="free">c</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">c</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">j</span><span class="main">`</span><span class="free">a</span><span class="main">,</span><span class="free">j</span><span class="main">`</span><span class="free">c</span><span class="main">⟩</span><span class="main">∈</span><span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mono_map_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ZF_Library-linear_mono_map_reflects"><span class="command">lemma</span></span> linear_mono_map_reflects<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"linear<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">trans[</span><span class="free">β</span><span class="main">](</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"irrefl<span class="main">(</span><span class="free">β</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">∈</span>mono_map<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">β</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">f</span><span class="main">`</span><span class="free">x</span><span class="main">,</span><span class="free">f</span><span class="main">`</span><span class="free">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">∈</span>mono_map<span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> preserves<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">α</span> <span class="main">⟹</span> <span class="skolem">y</span><span class="main">∈</span><span class="free">α</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">f</span><span class="main">`</span><span class="skolem">x</span><span class="main">,</span><span class="free">f</span><span class="main">`</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">unfolding</span></span> mono_map_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main">∉</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">f</span><span class="main">`</span><span class="free">x</span><span class="main">,</span><span class="free">f</span><span class="main">`</span><span class="free">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">s</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹linear<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="main">⟨</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> linear_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> preserves <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="main">⟨</span><span class="free">f</span><span class="main">`</span><span class="free">y</span><span class="main">,</span> <span class="free">f</span><span class="main">`</span><span class="free">x</span><span class="main">⟩</span><span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">∈</span>mono_map<span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="free">β</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">∈</span><span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">∈</span><span class="free">α</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="free">x</span><span class="main">∈</span><span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="free">y</span><span class="main">∈</span><span class="free">β</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> apply_type<span class="main">[</span><span class="operator">OF</span> mono_map_is_fun<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="free">f</span><span class="main">`</span><span class="free">x</span><span class="main">,</span><span class="free">f</span><span class="main">`</span><span class="free">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">s</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="keyword1">trans[</span><span class="free">β</span><span class="main">](</span><span class="free">s</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹irrefl<span class="main">(</span><span class="free">β</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trans_onD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">β</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="free">x</span>"</span></span><span class="main">]</span> irreflE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-irrefl_Memrel"><span class="command">lemma</span></span> irrefl_Memrel<span class="main">:</span> <span class="quoted"><span class="quoted">"irrefl<span class="main">(</span><span class="free">x</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> irrefl_def <span class="keyword1"><span class="command">using</span></span> mem_irrefl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> Memrel_mono_map_reflects <span class="main">=</span> linear_mono_map_reflects
  <span class="main">[</span><span class="operator">OF</span> well_ord_is_linear<span class="main"><span class="main">[</span></span><span class="operator">OF</span> well_ord_Memrel<span class="main"><span class="main">]</span></span> well_ord_is_trans_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> well_ord_Memrel<span class="main"><span class="main">]</span></span>
    irrefl_Memrel<span class="main">]</span>

<span class="comment1">― ‹Same proof as Paulson's <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> mono_map_is_inj<span class="antiquote">}</span></span>›</span>
<span class="keyword1" id="ZF_Library-mono_map_is_inj'"><span class="command">lemma</span></span> mono_map_is_inj'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> linear<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span><span class="main">;</span>  irrefl<span class="main">(</span><span class="free">B</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">;</span>  <span class="free">f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">B</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> irrefl_def mono_map_def inj_def <span class="keyword1"><span class="command">using</span></span> linearE
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x w<span class="main">)</span>
    <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">w</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> linearE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> apply_type<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="ZF_Library-mono_map_imp_ord_iso_image"><span class="command">lemma</span></span> mono_map_imp_ord_iso_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"linear<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">trans[</span><span class="free">β</span><span class="main">](</span><span class="free">s</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"irrefl<span class="main">(</span><span class="free">β</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">∈</span>mono_map<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">β</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> ord_iso<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">f</span><span class="main">``</span><span class="free">α</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ord_iso_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI ballI iffI<span class="main">)</span>
  <span class="comment1">― ‹Enough to show it's bijective and preserves both ways›</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="free">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_map_is_inj' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> surj<span class="main">(</span><span class="free">α</span><span class="main">,</span> <span class="free">f</span><span class="main">``</span><span class="free">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mono_map_def <span class="keyword1"><span class="command">using</span></span> surj_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">α</span><span class="main">,</span> <span class="free">f</span><span class="main">``</span><span class="free">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_def <span class="keyword1"><span class="command">using</span></span> inj_is_fun inj_to_Image <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">∈</span>mono_map<span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">α</span> <span class="main">⟹</span> <span class="skolem">y</span><span class="main">∈</span><span class="free">α</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">f</span><span class="main">`</span><span class="skolem">x</span><span class="main">,</span><span class="free">f</span><span class="main">`</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">unfolding</span></span> mono_map_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">f</span><span class="main">`</span><span class="skolem">x</span><span class="main">,</span><span class="free">f</span><span class="main">`</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">s</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">α</span> <span class="main">⟹</span> <span class="skolem">y</span><span class="main">∈</span><span class="free">α</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> linear_mono_map_reflects
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We introduce the following notation for strictly increasing maps
between ordinals.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">mono_map_Memrel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span>i<span class="main">]</span> <span class="main">⇒</span> i"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">‹<span class="keyword1">→<span class="hidden">⇩</span><sub>&lt;</sub></span>›</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main"><span class="free">→<span class="hidden">⇩</span><sub>&lt;</sub></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">≡</span> mono_map<span class="main">(</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">,</span>Memrel<span class="main">(</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">,</span>Memrel<span class="main">(</span><span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ZF_Library-mono_map_imp_ord_iso_Memrel"><span class="command">lemma</span></span> mono_map_imp_ord_iso_Memrel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">α</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">β</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> ord_iso<span class="main">(</span><span class="free">α</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">,</span><span class="free">f</span><span class="main">``</span><span class="free">α</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms mono_map_imp_ord_iso_image<span class="main">[</span><span class="operator">OF</span> well_ord_is_linear<span class="main"><span class="main">[</span></span><span class="operator">OF</span> well_ord_Memrel<span class="main"><span class="main">]</span></span>
      well_ord_is_trans_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> well_ord_Memrel<span class="main"><span class="main">]</span></span> irrefl_Memrel<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ZF_Library-mono_map_ordertype_image'"><span class="command">lemma</span></span> mono_map_ordertype_image'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">,</span><span class="free">β</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="free">f</span><span class="main">``</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms mono_map_is_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">X</span></span> <span class="main">_</span> <span class="quoted"><span class="free">β</span></span><span class="main">]</span>  ordertype_eq
    mono_map_imp_ord_iso_image<span class="main">[</span><span class="operator">OF</span> well_ord_is_linear<span class="main"><span class="main">[</span></span><span class="operator">OF</span> well_ord_Memrel<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> linear_subset<span class="main"><span class="main">]</span></span>
      well_ord_is_trans_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> well_ord_Memrel<span class="main"><span class="main">]</span></span> irrefl_Memrel<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">β</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
    well_ord_subset<span class="main">[</span><span class="operator">OF</span> well_ord_Memrel<span class="main">]</span>  Image_sub_codomain<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">β</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-mono_map_ordertype_image"><span class="command">lemma</span></span> mono_map_ordertype_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">α</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">β</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="free">f</span><span class="main">``</span><span class="free">α</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms mono_map_is_fun ordertype_Memrel ordertype_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="quoted">"Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span><span class="main">]</span>
    mono_map_imp_ord_iso_Memrel well_ord_subset<span class="main">[</span><span class="operator">OF</span> well_ord_Memrel<span class="main">]</span> Image_sub_codomain<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">α</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-apply_in_image"><span class="command">lemma</span></span> apply_in_image<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">A</span><span class="main">→</span><span class="free">B</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">`</span><span class="free">a</span> <span class="main">∈</span> <span class="free">f</span><span class="main">``</span><span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> range_eq_image apply_rangeI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ZF_Library-Image_subset_Ord_imp_lt"><span class="command">lemma</span></span> Image_subset_Ord_imp_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span><span class="main">``</span><span class="free">A</span> <span class="main">⊆</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">h</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"function<span class="main">(</span><span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span><span class="main">`</span><span class="free">x</span> <span class="main">&lt;</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> domain_def <span class="keyword1"><span class="command">using</span></span> imageI ltI function_apply_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ZF_Library-ordermap_le_arg"><span class="command">lemma</span></span> ordermap_le_arg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">⟹</span> ordermap<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="free">x</span><span class="main">≤</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>Ord_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subsetD<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wf[</span><span class="free">X</span><span class="main">](</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wf_imp_wf_on<span class="main">[</span><span class="operator">OF</span> wf_Memrel<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">{</span>ordermap<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="bound">y</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="skolem">x</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">∈</span><span class="free">β</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordermap_unfold Ord_trans<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">β</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{</span>ordermap<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="bound">y</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="skolem">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_trans<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">β</span></span><span class="main">]</span> Ord_in_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword1"><span class="command">have</span></span> ordm<span class="main">:</span><span class="quoted"><span class="quoted">"ordermap<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">{</span>ordermap<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="bound">y</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="skolem">x</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">y</span><span class="main">∈</span><span class="free">X</span> <span class="main">⟹</span> ordermap<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">β</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">β</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">y</span><span class="main">∈</span><span class="free">X</span> <span class="main">⟹</span> ordermap<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> ltI<span class="main">[</span><span class="operator">OF</span> _ Ord_in_Ord<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">β</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> lt_trans1 ltD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> ordm
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>›</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_imp_le Ord_in_Ord<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">β</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> Ord_ordermap
      well_ord_subset<span class="main">[</span><span class="operator">OF</span> well_ord_Memrel<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">β</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-subset_imp_ordertype_le"><span class="command">lemma</span></span> subset_imp_ordertype_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">≤</span><span class="free">β</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ordermap_le_arg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordermap<span class="main">(</span><span class="free">X</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="skolem">x</span> <span class="main">∈</span> <span class="free">β</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> ltD<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="skolem">x</span><span class="main">)</span>"</span></span><span class="main">]</span> Ord_trans<span class="main">[</span><span class="operator">of</span>  <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">β</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="free">X</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordertype_unfold<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_imp_le Ord_ordertype<span class="main">[</span><span class="operator">OF</span> well_ord_subset<span class="main">,</span> <span class="operator">OF</span> well_ord_Memrel<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ZF_Library-mono_map_imp_le"><span class="command">lemma</span></span> mono_map_imp_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">∈</span>mono_map<span class="main">(</span><span class="free">α</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">,</span><span class="free">β</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">≤</span><span class="free">β</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">α</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">⟩</span> <span class="main">≅</span> <span class="main">⟨</span><span class="free">f</span><span class="main">``</span><span class="free">α</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_map_imp_ord_iso_Memrel <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"converse<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">f</span><span class="main">``</span><span class="free">α</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">⟩</span> <span class="main">≅</span> <span class="main">⟨</span><span class="free">α</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_iso_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="free">f</span><span class="main">``</span><span class="free">α</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordertype_eq well_ord_Memrel ordertype_Memrel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="free">f</span><span class="main">``</span><span class="free">α</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_imp_ordertype_le mono_map_is_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> Image_sub_codomain<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">― ‹<span class="antiquoted"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span><span class="quoted">‹Ord<span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">A</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="free">B</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">Aa</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">)</span>›</span></span>›</span> 
<span class="keyword1"><span class="command">lemmas</span></span> Memrel_mono_map_is_inj <span class="main">=</span> mono_map_is_inj
  <span class="main">[</span><span class="operator">OF</span> well_ord_is_linear<span class="main"><span class="main">[</span></span><span class="operator">OF</span> well_ord_Memrel<span class="main"><span class="main">]</span></span>
    wf_imp_wf_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_Memrel<span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1" id="ZF_Library-mono_mapI"><span class="command">lemma</span></span> mono_mapI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span> <span class="free">A</span><span class="main">→</span><span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="bound">y</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">f</span><span class="main">`</span><span class="bound">x</span><span class="main">,</span><span class="free">f</span><span class="main">`</span><span class="bound">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">B</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mono_map_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> mono_mapD <span class="main">=</span> mono_map_is_fun mono_map_increasing

<span class="keyword1"><span class="command">bundle</span></span> mono_map_rules <span class="main">=</span>  mono_mapI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span> mono_map_is_fun<span class="main">[</span><span class="operator">dest</span><span class="main">]</span> mono_mapD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span>

<span class="keyword1" id="ZF_Library-nats_le_InfCard"><span class="command">lemma</span></span> nats_le_InfCard<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="keyword1">ω</span>"</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Ord_is_Transset
    le_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="keyword1">ω</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">,</span> <span class="operator">OF</span> le_subset_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> InfCard_def Transset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ZF_Library-nat_into_InfCard"><span class="command">lemma</span></span> nat_into_InfCard<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="keyword1">ω</span>"</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms  le_imp_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="keyword1">ω</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> InfCard_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Alephs are infinite cardinals›</span></span>

<span class="keyword1" id="ZF_Library-Aleph_zero_eq_nat"><span class="command">lemma</span></span> Aleph_zero_eq_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="keyword1">ω</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Aleph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="ZF_Library-InfCard_Aleph"><span class="command">lemma</span></span> InfCard_Aleph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">notes</span></span> Aleph_zero_eq_nat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">α</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">α</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> <span class="keyword1">ω</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mem_irrefl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span> <span class="main">∈</span> ℵ<span class="hidden">⇘</span><sub><span class="free">α</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ord_0_lt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">α</span></span><span class="main">]</span> ltD  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Aleph_increasing<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> foundation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">|</span>ℵ<span class="hidden">⇘</span><sub><span class="free">α</span></sub><span class="hidden">⇙</span><span class="main">|</span> <span class="main">∈</span> <span class="keyword1">ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_cardinal_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Finite<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">α</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Inf_Card_is_InfCard <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Limit_Aleph <span class="main">=</span> InfCard_Aleph<span class="main">[</span><span class="operator">THEN</span> InfCard_is_Limit<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> Aleph_cont <span class="main">=</span> Normal_imp_cont<span class="main">[</span><span class="operator">OF</span> Normal_Aleph<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> Aleph_sup <span class="main">=</span> Normal_Union<span class="main">[</span><span class="operator">OF</span> _ _ Normal_Aleph<span class="main">]</span>

<span class="keyword1"><span class="command">bundle</span></span> Ord_dests <span class="main">=</span> Limit_is_Ord<span class="main">[</span><span class="operator">dest</span><span class="main">]</span> Card_is_Ord<span class="main">[</span><span class="operator">dest</span><span class="main">]</span>
<span class="keyword1"><span class="command">bundle</span></span> Aleph_dests <span class="main">=</span> Aleph_cont<span class="main">[</span><span class="operator">dest</span><span class="main">]</span> Aleph_sup<span class="main">[</span><span class="operator">dest</span><span class="main">]</span>
<span class="keyword1"><span class="command">bundle</span></span> Aleph_intros <span class="main">=</span> Aleph_increasing<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">bundle</span></span> Aleph_mem_dests <span class="main">=</span> Aleph_increasing<span class="main">[</span><span class="operator">OF</span> ltI<span class="main">,</span> <span class="operator">THEN</span> ltD<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Cofinality">
<div class="head">
<h1>Theory Cofinality</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Cofinality\label{sec:cofinality}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cofinality
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#ZF_Library">ZF_Library</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic results and definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A set <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">X</span></span>›</span></span></span></span> is <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹cofinal›</span></span> in <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">A</span></span>›</span></span></span></span> (with respect to the relation
    <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">r</span></span>›</span></span></span></span>) if every element of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">A</span></span>›</span></span></span></span> is “bounded
    above” by some element of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">X</span></span>›</span></span></span></span>. Note that <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">X</span></span>›</span></span></span></span> does not need 
    to be a subset of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">A</span></span>›</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">cofinal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span>i<span class="main">,</span>i<span class="main">]</span> <span class="main">⇒</span> o"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cofinal</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">⟨</span><span class="bound">a</span><span class="main">,</span><span class="bound">x</span><span class="main">⟩</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>

<span class="comment1">(*
(* Alternative definitions *)
definition
  cofinal_predic :: "[i,i,[i,i]⇒o] ⇒ o" where
  "cofinal_predic(X,A,r) ≡ ∀a∈A. ∃x∈X. r(a,x) ∨ a = x"

definition
  f_cofinal :: "[i⇒i,i,i,i] ⇒ o" where
  "f_cofinal(f,C,A,r) ≡ ∀a∈A. ∃x∈C. ⟨a,f(x)⟩∈r ∨ a = f(x)"

(* The next definition doesn't work if 0 is the top element of A.
   But it works for limit ordinals. *)
definition
  cofinal_fun' :: "[i,i,i] ⇒ o" where
  "cofinal_fun'(f,A,r) == f_cofinal(λx. f`x,domain(f),A, r)"
*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A function is cofinal if it range is.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">cofinal_fun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span>i<span class="main">,</span>i<span class="main">]</span> <span class="main">⇒</span> o"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cofinal_fun</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>domain<span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">a</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">`</span><span class="bound">x</span><span class="main">⟩</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">`</span><span class="bound">x</span>"</span></span>

<span class="keyword1" id="Cofinality-cofinal_funI"><span class="command">lemma</span></span> cofinal_funI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">a</span><span class="main">,</span><span class="free">f</span><span class="main">`</span><span class="bound">x</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f</span><span class="main">`</span><span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> cofinal_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cofinality-cofinal_funD"><span class="command">lemma</span></span> cofinal_funD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">f</span><span class="main">`</span><span class="bound">x</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">=</span> <span class="free">f</span><span class="main">`</span><span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> cofinal_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cofinality-cofinal_in_cofinal"><span class="command">lemma</span></span> cofinal_in_cofinal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"trans<span class="main">(</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="free">Y</span><span class="main">,</span><span class="free">X</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="free">Y</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cofinal<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">A</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">b</span><span class="main">,</span><span class="bound">x</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">∨</span> <span class="skolem">b</span><span class="main">=</span><span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">∨</span> <span class="skolem">a</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cofinal<span class="main">(</span><span class="free">Y</span><span class="main">,</span><span class="free">X</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">X</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">∨</span> <span class="skolem">c</span><span class="main">=</span><span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">∨</span> <span class="skolem">y</span><span class="main">=</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">∨</span> <span class="skolem">a</span><span class="main">=</span><span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹trans<span class="main">(</span><span class="free">r</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span><span class="bound">x</span><span class="main">⟩</span><span class="main">∈</span><span class="free">r</span> <span class="main">∨</span> <span class="skolem">a</span><span class="main">=</span><span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-codomain_is_cofinal"><span class="command">lemma</span></span> codomain_is_cofinal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">C</span> <span class="main">→</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span> <span class="free">f</span> <span class="main">`</span> <span class="bound">x</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span><span class="main">`</span><span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cofinal_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">b</span><span class="main">,</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">x</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span><span class="main">`</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span><span class="free">C</span> <span class="main">→</span> <span class="free">D</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">f</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="skolem">x</span><span class="main">∈</span><span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> domain_of_fun apply_rangeI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">b</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="main">=</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-cofinal_range_iff_cofinal_fun"><span class="command">lemma</span></span> cofinal_range_iff_cofinal_fun<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"function<span class="main">(</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">⟷</span> cofinal_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cofinal_fun_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">‹cofinal<span class="main">(</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> range_def domain_def converse_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹function<span class="main">(</span><span class="free">f</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">x</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> function_apply_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">∈</span><span class="free">f</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span> <span class="free">f</span> <span class="main">`</span> <span class="bound">x</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="bound">x</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">a</span><span class="main">,</span> <span class="free">f</span> <span class="main">`</span> <span class="bound">x</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> function_apply_Pair<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-cofinal_comp"><span class="command">lemma</span></span> cofinal_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">∈</span> mono_map<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">D</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">D</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span><span class="main">:</span><span class="free">B</span> <span class="main">→</span> <span class="free">C</span>"</span></span>  <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="free">h</span><span class="main">,</span><span class="free">C</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"trans<span class="main">(</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">h</span><span class="main">,</span><span class="free">D</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cofinal_fun_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">∈</span> mono_map<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">D</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">C</span> <span class="main">→</span> <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_map_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span><span class="main">:</span><span class="free">B</span> <span class="main">→</span> <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> domain_of_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹cofinal_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">D</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">C</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">c</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cofinal_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cofinal_fun<span class="main">(</span><span class="free">h</span><span class="main">,</span><span class="free">C</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹domain<span class="main">(</span><span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c</span><span class="main">,</span> <span class="free">h</span> <span class="main">`</span> <span class="skolem">b</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">∨</span> <span class="skolem">c</span> <span class="main">=</span> <span class="free">h</span> <span class="main">`</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cofinal_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span><span class="main">:</span><span class="free">B</span> <span class="main">→</span> <span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span><span class="main">`</span><span class="skolem">b</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">D</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">∈</span><span class="free">C</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">f</span><span class="main">`</span><span class="skolem">c</span><span class="main">,</span> <span class="free">f</span><span class="main">`</span> <span class="main">(</span><span class="free">h</span> <span class="main">`</span> <span class="skolem">b</span><span class="main">)</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="free">f</span><span class="main">`</span><span class="skolem">c</span> <span class="main">=</span> <span class="free">f</span><span class="main">`</span> <span class="main">(</span><span class="free">h</span> <span class="main">`</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mono_map_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">c</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">c</span>›</span></span> <span class="quoted"><span class="quoted">‹trans<span class="main">(</span><span class="free">r</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span><span class="main">:</span><span class="free">B</span> <span class="main">→</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">∈</span><span class="free">B</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">h</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">b</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">h</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> transD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">h</span><span class="main">:</span><span class="free">B</span> <span class="main">→</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹domain<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹domain<span class="main">(</span><span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> range_fun_subset_codomain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">∈</span><span class="free">B</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">h</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">h</span><span class="main">)</span> <span class="main">`</span> <span class="bound">x</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">h</span><span class="main">)</span> <span class="main">`</span> <span class="bound">x</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">cf_fun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span>i<span class="main">]</span> <span class="main">⇒</span> o"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cf_fun</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">≡</span> cofinal_fun<span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">,</span>Memrel<span class="main">(</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cofinality-cf_funI"><span class="command">lemma</span></span> cf_funI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">α</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cf_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cofinality-cf_funD"><span class="command">lemma</span></span> cf_funD<span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">α</span><span class="main">)</span> <span class="main">⟹</span> cofinal_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">α</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cf_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cofinality-cf_fun_comp"><span class="command">lemma</span></span> cf_fun_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">∈</span> mono_map<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">α</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">α</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">h</span><span class="main">:</span><span class="free">B</span> <span class="main">→</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="free">h</span><span class="main">,</span><span class="free">C</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">h</span><span class="main">,</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms cofinal_comp<span class="main">[</span><span class="operator">OF</span> _ _ _ _ trans_Memrel<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">cf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"i<span class="main">⇒</span>i"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cf</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">μ</span> <span class="bound">β</span><span class="main">.</span>  <span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">⊆</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">∧</span> cofinal<span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">,</span>Memrel<span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">β</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="bound">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cofinality-Ord_cf"><span class="command">lemma</span></span> Ord_cf <span class="main">[</span><span class="operator">TC</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span>cf<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cf_def <span class="keyword1"><span class="command">using</span></span> Ord_Least <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cofinality-gamma_cofinal_gamma"><span class="command">lemma</span></span> gamma_cofinal_gamma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="free">γ</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cofinality-cf_is_ordertype"><span class="command">lemma</span></span> cf_is_ordertype<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">⊆</span><span class="free">γ</span> <span class="main">∧</span> cofinal<span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="bound">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">(</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> gamma_cofinal_gamma LeastI<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span> ordertype_Memrel<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> cf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Cofinality-cf_fun_succ'"><span class="command">lemma</span></span> cf_fun_succ'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">α</span><span class="main">→</span>succ<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">.</span> <span class="free">f</span><span class="main">`</span><span class="bound">x</span><span class="main">=</span><span class="free">β</span><span class="main">)</span> <span class="main">⟷</span> cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span>succ<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">.</span> <span class="free">f</span><span class="main">`</span><span class="bound">x</span><span class="main">=</span><span class="free">β</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span>succ<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> domain_of_fun<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span><span class="free">α</span><span class="main">→</span>succ<span class="main">(</span><span class="free">β</span><span class="main">)</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cf_fun_def cofinal_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span>succ<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">β</span><span class="main">,</span><span class="free">f</span><span class="main">`</span><span class="skolem">x</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">β</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> domain_of_fun<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span><span class="free">α</span><span class="main">→</span>succ<span class="main">(</span><span class="free">β</span><span class="main">)</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cf_fun_def cofinal_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">β</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">β</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span> <span class="main">∉</span> Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> foundation <span class="keyword1"><span class="command">unfolding</span></span> Memrel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">.</span> <span class="free">f</span> <span class="main">`</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-cf_fun_succ"><span class="command">lemma</span></span> cf_fun_succ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">β</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">:</span><span class="main">1</span><span class="main">→</span>succ<span class="main">(</span><span class="free">β</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">`</span><span class="main">0</span><span class="main">=</span><span class="free">β</span> <span class="main">⟹</span> cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span>succ<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cf_fun_succ' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Cofinality-ordertype_0_not_cofinal_succ"><span class="command">lemma</span></span> ordertype_0_not_cofinal_succ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span>succ<span class="main">(</span><span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>cofinal<span class="main">(</span><span class="free">A</span><span class="main">,</span>succ<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">,</span>Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="main">0</span><span class="main">,</span>Memrel<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> ordertype_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">⊆</span>succ<span class="main">(</span><span class="free">i</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">i</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">A</span><span class="main">,</span> Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">⟩</span> <span class="main">≅</span> <span class="main">⟨</span><span class="main">0</span><span class="main">,</span> Memrel<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>   well_ord_Memrel well_ord_subset
      ordertype_eq_imp_ord_iso<span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> Ord_0  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  ord_iso_is_bij bij_imp_eqpoll eqpoll_0_is_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="free">A</span><span class="main">,</span> succ<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">,</span> Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">i</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_mem_empty <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹I thank Edwin Pacheco Rodríguez for the following lemma.›</span></span>
<span class="keyword1" id="Cofinality-cf_succ"><span class="command">lemma</span></span> cf_succ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">α</span><span class="main">⟩</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">:</span> <span class="main">1</span><span class="main">→</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">`</span><span class="main">0</span> <span class="main">=</span> <span class="free">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_extend3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">α</span></span><span class="main">]</span> singleton_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="skolem">f</span><span class="main">,</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_fun_succ <span class="keyword1"><span class="command">unfolding</span></span> cofinal_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">:</span><span class="main">1</span><span class="main">→</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">∈</span>domain<span class="main">(</span><span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">=</span><span class="main">{</span><span class="skolem">f</span><span class="main">`</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cf_fun<span class="main">(</span><span class="skolem">f</span><span class="main">,</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">∈</span>domain<span class="main">(</span><span class="skolem">f</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">`</span><span class="main">0</span><span class="main">=</span><span class="free">α</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">,</span>Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def cofinal_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">`</span><span class="main">0</span><span class="main">=</span><span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span><span class="main">=</span><span class="main">{</span><span class="skolem">f</span><span class="main">`</span><span class="main">0</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> succ<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> succ_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span><span class="main">⊆</span> succ<span class="main">(</span><span class="free">α</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_ord<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_succ well_ord_Memrel  well_ord_subset relation_Memrel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> succ<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">∧</span> cofinal<span class="main">(</span><span class="bound">A</span><span class="main">,</span> succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">,</span> Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="bound">A</span><span class="main">,</span> Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?P</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ordertype_0_not_cofinal_succ  <span class="keyword1"><span class="command">unfolding</span></span> cf_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span><span class="main">=</span><span class="main">{</span><span class="skolem">f</span><span class="main">`</span><span class="main">0</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">≈</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> singleton_eqpoll_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹well_ord<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nat_1I ordertype_eq_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ord_1  Least_equality<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-cf_zero"><span class="command">lemma</span></span> cf_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cf_def cofinal_def <span class="keyword1"><span class="command">using</span></span>
    ordertype_0 subset_empty_iff Least_le<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cofinality-surj_is_cofinal"><span class="command">lemma</span></span> surj_is_cofinal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> surj<span class="main">(</span><span class="free">δ</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">⟹</span> cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> surj_def cofinal_fun_def cf_fun_def
  <span class="keyword1"><span class="command">using</span></span> domain_of_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Cofinality-cf_zero_iff"><span class="command">lemma</span></span> cf_zero_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">⟹</span> cf<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">α</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cf_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">⊆</span><span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="free">α</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_is_ordertype <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">α</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordertype_zero_imp_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="quoted">"Memrel<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">― ‹TODO: define Succ (predicate for successor ordinals)›</span>
<span class="keyword1" id="Cofinality-cf_eq_one_iff"><span class="command">lemma</span></span> cf_eq_one_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">α</span><span class="main">.</span> Ord<span class="main">(</span><span class="bound">α</span><span class="main">)</span> <span class="main">∧</span> <span class="free">γ</span>  <span class="main">=</span> succ<span class="main">(</span><span class="bound">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">α</span><span class="main">.</span> Ord<span class="main">(</span><span class="bound">α</span><span class="main">)</span> <span class="main">∧</span> <span class="free">γ</span>  <span class="main">=</span> succ<span class="main">(</span><span class="bound">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cf_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_is_ordertype <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">≡</span>converse<span class="main">(</span>ordermap<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹ordertype<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">γ</span>›</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> surj<span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> well_ord_subset<span class="main">[</span><span class="operator">OF</span> well_ord_Memrel<span class="main">,</span> <span class="operator">THEN</span> ordermap_bij<span class="main">,</span>
        <span class="operator">THEN</span> bij_converse_bij<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">γ</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> bij_is_surj
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cofinal<span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">a</span><span class="main">,</span> <span class="skolem">f</span><span class="main">`</span><span class="main">0</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">`</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def surj_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> surj<span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">α</span><span class="main">.</span> Ord<span class="main">(</span><span class="bound">α</span><span class="main">)</span> <span class="main">∧</span> <span class="free">γ</span>  <span class="main">=</span> succ<span class="main">(</span><span class="bound">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_has_max_imp_succ<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">γ</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">`</span><span class="main">0</span>"</span></span><span class="main">]</span>
      surj_is_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> apply_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> lt_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>Ord_in_Ord<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-ordertype_in_cf_imp_not_cofinal"><span class="command">lemma</span></span> ordertype_in_cf_imp_not_cofinal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">¬</span> cofinal<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> <span class="free">γ</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">γ</span> <span class="main">∧</span> cofinal<span class="main">(</span><span class="bound">B</span><span class="main">,</span> <span class="free">γ</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="bound">B</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">(</span>ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="main">_</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_cf ltI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cf_def <span class="keyword1"><span class="command">using</span></span> less_LeastE<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>  <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-cofinal_mono_map_cf"><span class="command">lemma</span></span> cofinal_mono_map_cf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> mono_map<span class="main">(</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">,</span> Memrel<span class="main">(</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">γ</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span> cf_fun<span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> assms
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_is_ordertype <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≡</span> converse<span class="main">(</span>ordermap<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">:</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordertype_ord_iso<span class="main">[</span><span class="operator">THEN</span> ord_iso_sym<span class="main">,</span>
        <span class="operator">THEN</span> ord_iso_is_mono_map<span class="main">,</span> <span class="operator">THEN</span> mono_map_mono<span class="main">,</span>
        <span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="quoted">"Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span> well_ord_Memrel<span class="main">[</span><span class="operator">THEN</span> well_ord_subset<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> surj<span class="main">(</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> well_ord_Memrel<span class="main">[</span><span class="operator">THEN</span> well_ord_subset<span class="main">,</span> <span class="operator">THEN</span> ordertype_ord_iso<span class="main">,</span>
        <span class="operator">THEN</span> ord_iso_sym<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">γ</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">,</span> <span class="operator">THEN</span> ord_iso_is_bij<span class="main">,</span>
        <span class="operator">THEN</span> bij_is_surj<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cofinal<span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cofinal_range_iff_cofinal_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="free">γ</span></span> <span class="quoted"><span class="quoted">"Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span><span class="main">]</span>
      surj_range<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> surj_is_fun fun_is_function
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The factorization lemma›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In this subsection we prove a factorization lemma for cofinal functions
into ordinals, which shows that any cofinal function between ordinals can be
“decomposed” in such a way that a commutative triangle of strictly increasing
maps arises.

The factorization lemma has a kind of
fundamental character, in that the rest of the basic results on cofinality
(for, instance, idempotence) follow easily from it, in a more algebraic way.

This is a consequence that the proof encapsulates uses of transfinite
recursion in the basic theory of cofinality; indeed, only one use is needed.
In the setting of Isabelle/ZF, this is convenient since the machinery of
recursion is pretty clumsy. On the downside, this way of presenting things 
results in a longer proof of the factorization lemma. This approach was
taken by the author in the notes \cite{apunte_st} for an introductory course
in Set Theory.

To organize the use of the hypotheses of the factorization lemma,
we set up a locale containing all the relevant ingredients.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> cofinal_factor <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">j</span> <span class="free">δ</span> <span class="free">ξ</span> <span class="free">γ</span> <span class="free">f</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> j_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">:</span><span class="free">ξ</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">γ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     ords<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">ξ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   f_type<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span> <span class="free">δ</span> <span class="main">→</span> <span class="free">γ</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Here, <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span>›</span></span></span></span> is cofinal function from <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">δ</span></span>›</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">γ</span></span>›</span></span></span></span>, and the
ordinal <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">ξ</span></span>›</span></span></span></span> is meant to be the cofinality of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">γ</span></span>›</span></span></span></span>. Hence, there exists
an increasing map <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">j</span></span>›</span></span></span></span> from  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">ξ</span></span>›</span></span></span></span> to  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">γ</span></span>›</span></span></span></span> by the last lemma.

The main goal is to construct an increasing function <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">g</span></span><span class="main"><span class="main">:</span></span><span class="free"><span class="free">ξ</span></span><span class="main"><span class="main">→</span></span><span class="free"><span class="free">δ</span></span>›</span></span></span></span> such that
the composition <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="keyword1"><span class="keyword1">O</span></span> <span class="free"><span class="free">g</span></span>›</span></span></span></span> is still cofinal but also increasing.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">factor_body</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span>i<span class="main">,</span>i<span class="main">]</span> <span class="main">⇒</span> o"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">factor_body</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">∈</span><span class="free">δ</span> <span class="main">∧</span> <span class="free">j</span><span class="main">`</span><span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">≤</span> <span class="free">f</span><span class="main">`</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">α</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">.</span> <span class="free">f</span><span class="main">`</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">`</span><span class="bound">α</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">f</span><span class="main">`</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">=</span><span class="free">δ</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">factor_rec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span>i<span class="main">]</span> <span class="main">⇒</span> i"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">factor_rec</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">)</span> <span class="main">≡</span>  <span class="keyword1">μ</span> <span class="bound">x</span><span class="main">.</span> factor_body<span class="main">(</span><span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">h</span></span></span><span class="main">,</span><span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">txt</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹factor_rec›</span></span></span></span> is the inductive step for the definition by transfinite
recursion of the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹factor›</span></span> function (called <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">g</span></span>›</span></span></span></span> above), which in
turn is obtained by minimizing the predicate <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹factor_body›</span></span></span></span>. Next we show
that this predicate is monotonous.›</span></span>

<span class="keyword1" id="Cofinality-factor_body_mono"><span class="command">lemma</span></span> factor_body_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">β</span><span class="main">∈</span><span class="free">ξ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">&lt;</span><span class="free">β</span>"</span></span>
    <span class="quoted"><span class="quoted">"factor_body<span class="main">(</span><span class="free">β</span><span class="main">,</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">β</span><span class="main">.</span> <span class="free">G</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"factor_body<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">.</span> <span class="free">G</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span><span class="main">&lt;</span><span class="free">β</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">∈</span><span class="free">β</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ltD <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">β</span><span class="main">∈</span><span class="free">ξ</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">∈</span><span class="free">ξ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ords ltD Ord_cf Ord_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">`</span><span class="free">α</span> <span class="main">∈</span> <span class="free">j</span><span class="main">`</span><span class="free">β</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j_mono mono_map_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">β</span><span class="main">∈</span><span class="free">ξ</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">`</span><span class="free">β</span><span class="main">∈</span><span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_mono domain_of_fun apply_rangeI mono_map_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">j</span><span class="main">`</span><span class="free">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord ords Limit_is_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">`</span><span class="free">α</span> <span class="main">≤</span> <span class="free">j</span><span class="main">`</span><span class="free">β</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> lt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">`</span><span class="free">β</span> <span class="main">≤</span> <span class="free">f</span><span class="main">`</span><span class="skolem">θ</span> <span class="main">⟹</span> <span class="free">j</span><span class="main">`</span><span class="free">α</span> <span class="main">≤</span> <span class="free">f</span><span class="main">`</span><span class="skolem">θ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">θ</span> <span class="keyword1"><span class="command">using</span></span> le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">∈</span><span class="free">α</span><span class="main">.</span> <span class="free">G</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">f</span><span class="main">`</span><span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">β</span><span class="main">.</span> <span class="free">f</span><span class="main">`</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">∈</span><span class="free">β</span><span class="main">.</span> <span class="free">G</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">f</span><span class="main">`</span><span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&lt;</span><span class="free">α</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">&lt;</span><span class="free">α</span>›</span></span>
    <span class="keyword1"><span class="command">also</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span><span class="main">&lt;</span><span class="free">β</span>›</span></span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&lt;</span><span class="free">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">β</span><span class="main">.</span> <span class="free">f</span><span class="main">`</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">∈</span><span class="free">β</span><span class="main">.</span> <span class="free">G</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">f</span><span class="main">`</span><span class="skolem">z</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">∈</span><span class="free">β</span><span class="main">.</span> <span class="free">G</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">&lt;</span><span class="free">α</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">&lt;</span><span class="free">β</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">∈</span><span class="free">β</span><span class="main">.</span> <span class="free">G</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">∈</span><span class="free">α</span><span class="main">.</span> <span class="free">G</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> beta_if  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>ltD<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹factor_body<span class="main">(</span><span class="free">β</span><span class="main">,</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">β</span><span class="main">.</span> <span class="free">G</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="free">x</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> factor_body_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-factor_body_simp"><span class="command">lemma</span></span> factor_body_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"factor_body<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="free">g</span><span class="main">,</span><span class="free">δ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> factor_body_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cofinality-factor_rec_mono"><span class="command">lemma</span></span> factor_rec_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">β</span><span class="main">∈</span><span class="free">ξ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">&lt;</span><span class="free">β</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"factor_rec<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">.</span> <span class="free">G</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> factor_rec<span class="main">(</span><span class="free">β</span><span class="main">,</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">β</span><span class="main">.</span> <span class="free">G</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> factor_rec_def
  <span class="keyword1"><span class="command">using</span></span> assms ords factor_body_mono Least_antitone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We now define the factor as higher-order function.
Later it will be restricted to a set to obtain a bona fide function of
type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">i</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">factor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"i <span class="main">⇒</span> i"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">factor</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">≡</span> transrec<span class="main">(</span><span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">,</span>factor_rec<span class="main">)</span>"</span></span>

<span class="keyword1" id="Cofinality-factor_unfold"><span class="command">lemma</span></span> factor_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">=</span> factor_rec<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">.</span> factor<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> def_transrec<span class="main">[</span><span class="operator">OF</span> factor_def<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Cofinality-factor_mono"><span class="command">lemma</span></span> factor_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span><span class="main">∈</span><span class="free">ξ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">&lt;</span><span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">≠</span><span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">≠</span><span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">≤</span> factor<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">=</span> factor_rec<span class="main">(</span><span class="free">α</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">.</span> factor<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> factor_unfold <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> factor_rec_mono
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> factor_rec<span class="main">(</span><span class="free">β</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">β</span><span class="main">.</span> factor<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factor_rec<span class="main">(</span><span class="free">β</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">β</span><span class="main">.</span> factor<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> factor<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> def_transrec<span class="main">[</span><span class="operator">OF</span> factor_def<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The factor satisfies the predicate body of the minimization.›</span></span>

<span class="keyword1" id="Cofinality-factor_body_factor"><span class="command">lemma</span></span> factor_body_factor<span class="main">:</span>
  <span class="quoted"><span class="quoted">"factor_body<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">.</span> factor<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span>factor<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ords factor_unfold<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">α</span></span><span class="main">]</span>
    LeastI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"factor_body<span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">δ</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> factor_rec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cofinality-factor_type"><span class="command">lemma</span></span> factor_type <span class="main">[</span><span class="operator">TC</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span>factor<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ords factor_unfold<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">α</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> factor_rec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The value <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">δ</span></span>›</span></span></span></span> in <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹factor_body›</span></span></span></span> (and therefore, in
<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹factor›</span></span></span></span>) is meant to be a “default value”. Whenever it is not 
attained, the factor function behaves as expected: It is increasing
and its composition with <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span>›</span></span></span></span> also is.›</span></span>

<span class="keyword1" id="Cofinality-f_factor_increasing"><span class="command">lemma</span></span> f_factor_increasing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span><span class="main">∈</span><span class="free">ξ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">&lt;</span><span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">≠</span><span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span>factor<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">f</span><span class="main">`</span>factor<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">β</span><span class="main">.</span> factor<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">α</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">`</span> factor<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> factor_unfold<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">β</span></span><span class="main">]</span> ords LeastI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"factor_body<span class="main">(</span><span class="free">β</span><span class="main">,</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">β</span><span class="main">.</span> factor<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> factor_rec_def factor_body_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>beta_if<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">α</span><span class="main">&lt;</span><span class="free">β</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ltD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-factor_increasing"><span class="command">lemma</span></span> factor_increasing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span><span class="main">∈</span><span class="free">ξ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span><span class="main">&lt;</span><span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">≠</span><span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="free">β</span><span class="main">)</span><span class="main">≠</span><span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="free">α</span><span class="main">)</span><span class="main">&lt;</span>factor<span class="main">(</span><span class="free">β</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms f_factor_increasing factor_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>le_neq_imp_lt<span class="main">)</span>

<span class="keyword1" id="Cofinality-factor_in_delta"><span class="command">lemma</span></span> factor_in_delta<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="free">β</span><span class="main">)</span> <span class="main">≠</span> <span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="free">β</span><span class="main">)</span> <span class="main">∈</span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms factor_body_factor ords
  <span class="keyword1"><span class="command">unfolding</span></span> factor_body_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finally, we define the (set) factor function as the restriction of
factor to the ordinal  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">ξ</span></span>›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">fun_factor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"i"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fun_factor</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">β</span><span class="main">∈</span><span class="free">ξ</span><span class="main">.</span> factor<span class="main">(</span><span class="bound">β</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cofinality-fun_factor_is_mono_map"><span class="command">lemma</span></span> fun_factor_is_mono_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">β</span><span class="main">.</span> <span class="bound">β</span> <span class="main">∈</span> <span class="free">ξ</span> <span class="main">⟹</span> factor<span class="main">(</span><span class="bound">β</span><span class="main">)</span> <span class="main">≠</span> <span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fun_factor <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">ξ</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">ξ</span><span class="main">)</span><span class="main">,</span> <span class="free">δ</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">δ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mono_map_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI ballI impI<span class="main">)</span>
  <span class="comment1">(* Proof that <span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span>‹fun_factor› respects membership *)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">α</span> <span class="skolem">β</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">∈</span><span class="free">ξ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span><span class="main">∈</span><span class="free">ξ</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> assms
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="skolem">α</span><span class="main">)</span><span class="main">≠</span><span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="skolem">β</span><span class="main">)</span><span class="main">≠</span><span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="skolem">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> factor_in_delta Ord_in_Ord ords <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">α</span><span class="main">,</span> <span class="skolem">β</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">ξ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>fun_factor <span class="main">`</span> <span class="skolem">α</span><span class="main">,</span> fun_factor <span class="main">`</span> <span class="skolem">β</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fun_factor_def
    <span class="keyword1"><span class="command">using</span></span> ltI factor_increasing<span class="main">[</span><span class="operator">THEN</span> ltD<span class="main">]</span> factor_in_delta
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">(* Proof of type *)</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fun_factor <span class="main">:</span> <span class="free">ξ</span> <span class="main">→</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fun_factor_def
    <span class="keyword1"><span class="command">using</span></span> ltI lam_type factor_in_delta <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-f_fun_factor_is_mono_map"><span class="command">lemma</span></span> f_fun_factor_is_mono_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">β</span><span class="main">.</span> <span class="bound">β</span> <span class="main">∈</span> <span class="free">ξ</span> <span class="main">⟹</span> factor<span class="main">(</span><span class="bound">β</span><span class="main">)</span> <span class="main">≠</span> <span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">O</span> fun_factor <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">ξ</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">ξ</span><span class="main">)</span><span class="main">,</span> <span class="free">γ</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mono_map_def
  <span class="keyword1"><span class="command">using</span></span> f_type
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI ballI impI comp_fun<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">δ</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fun_factor <span class="main">:</span> <span class="free">ξ</span> <span class="main">→</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_factor_is_mono_map mono_map_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="comment1">(* Proof that f O ?g respects membership *)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">α</span> <span class="skolem">β</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">α</span><span class="main">,</span> <span class="skolem">β</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">ξ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">&lt;</span><span class="skolem">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">ξ</span>"</span></span><span class="main">]</span> ltI ords <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">∈</span><span class="free">ξ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span><span class="main">∈</span><span class="free">ξ</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="skolem">α</span><span class="main">)</span><span class="main">≠</span><span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="skolem">β</span><span class="main">)</span><span class="main">≠</span><span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ords Limit_is_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span><span class="main">&lt;</span><span class="skolem">β</span>›</span></span> <span class="quoted"><span class="quoted">‹fun_factor <span class="main">:</span> <span class="free">ξ</span> <span class="main">→</span> <span class="free">δ</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> fun_factor<span class="main">)</span> <span class="main">`</span> <span class="skolem">α</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> fun_factor<span class="main">)</span> <span class="main">`</span> <span class="skolem">β</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ltD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> factor<span class="main">(</span><span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> factor<span class="main">(</span><span class="skolem">β</span><span class="main">)</span>"</span></span><span class="main">]</span>
      f_factor_increasing apply_in_range f_type
    <span class="keyword1"><span class="command">unfolding</span></span> fun_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* cofinal_factor *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We state next the factorization lemma.›</span></span>

<span class="keyword1" id="Cofinality-cofinal_fun_factorization"><span class="command">lemma</span></span> cofinal_fun_factorization<span class="main">:</span>
  <span class="keyword2"><span class="keyword">notes</span></span> le_imp_subset <span class="main">[</span><span class="operator">dest</span><span class="main">]</span> lt_trans2 <span class="main">[</span><span class="operator">trans</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span> <span class="free">δ</span> <span class="main">→</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span> <span class="main">∈</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">δ</span><span class="main">.</span>  <span class="free">f</span> <span class="keyword1">O</span> <span class="bound">g</span> <span class="main">:</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">γ</span> <span class="main">∧</span>
           cofinal_fun<span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="bound">g</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Limit_is_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">:</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cofinal_mono_map_cf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> domain_of_fun mono_map_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> assms
  <span class="keyword1"><span class="command">interpret</span></span> cofinal_factor <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="free">δ</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The core of the argument is to show that the factor function
  indeed maps into <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">δ</span></span>›</span></span></span></span>, therefore its values satisfy the first
  disjunct of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹factor_body›</span></span></span></span>. This holds in turn because no
  restriction of the factor composed with <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span>›</span></span></span></span> to a proper initial
  segment of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹cf<span class="main"><span class="main">(</span></span><span class="free"><span class="free">γ</span></span><span class="main"><span class="main">)</span></span>›</span></span></span></span> can be cofinal in <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">γ</span></span>›</span></span></span></span> by definition of
  cofinality. Hence there must be a witness that satisfies the first
  disjunct.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> factor_not_delta<span class="main">:</span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="skolem">β</span><span class="main">)</span><span class="main">≠</span><span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">∈</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">β</span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For this, we induct on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">β</span></span>›</span></span></span></span> ranging over <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹cf<span class="main"><span class="main">(</span></span><span class="free"><span class="free">γ</span></span><span class="main"><span class="main">)</span></span>›</span></span></span></span>.›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">β</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>Ord_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Ord_cf<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">γ</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">β</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="skolem">β</span> <span class="main">⟹</span> factor<span class="main">(</span><span class="skolem">z</span><span class="main">)</span><span class="main">≠</span><span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">β</span><span class="main">.</span> <span class="free">f</span><span class="main">`</span>factor<span class="main">(</span><span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> IH
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="skolem">β</span> <span class="main">⟹</span> factor<span class="main">(</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
      <span class="keyword1"><span class="command">using</span></span> factor_in_delta <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span><span class="free">δ</span><span class="main">→</span><span class="free">γ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">:</span> <span class="skolem">β</span> <span class="main">→</span> <span class="free">γ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">using</span></span> apply_funtype lam_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">:</span> <span class="skolem">β</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mono_map_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI ballI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> IH
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="skolem">y</span><span class="main">)</span> <span class="main">≠</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">β</span> <span class="main">→</span> <span class="free">γ</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">`</span><span class="skolem">x</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">`</span><span class="skolem">y</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">β</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="skolem">β</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_trans Ord_cf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ord_cf Ord_in_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="skolem">β</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>ltI<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">h</span> <span class="main">`</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">h</span> <span class="main">`</span> <span class="skolem">y</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">using</span></span> f_factor_increasing ltD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">β</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="skolem">h</span><span class="main">``</span><span class="skolem">β</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">β</span>"</span></span> <span class="comment1">(* Maybe should use range(h) *)</span>
      <span class="keyword1"><span class="command">using</span></span> mono_map_ordertype_image<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">β</span></span><span class="main">]</span> Ord_cf Ord_in_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">β</span> <span class="main">∈</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="skolem">h</span><span class="main">``</span><span class="skolem">β</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">β</span> <span class="main">→</span> <span class="free">γ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">``</span><span class="skolem">β</span> <span class="main">⊆</span> <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mono_map_is_fun Image_sub_codomain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> cofinal<span class="main">(</span><span class="skolem">h</span><span class="main">``</span><span class="skolem">β</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ordertype_in_cf_imp_not_cofinal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α_0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α_0</span><span class="main">∈</span><span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">h</span> <span class="main">``</span> <span class="skolem">β</span><span class="main">.</span> <span class="main">¬</span> <span class="main">⟨</span><span class="skolem">α_0</span><span class="main">,</span> <span class="bound">x</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">α_0</span> <span class="main">≠</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span><span class="main">``</span><span class="skolem">β</span> <span class="main">⊆</span> <span class="free">γ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">h</span> <span class="main">``</span> <span class="skolem">β</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">α_0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> well_ord_Memrel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span> well_ord_is_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">γ</span></span> <span class="quoted"><span class="quoted">"Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> linear_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α_0</span> <span class="main">∈</span> <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">`</span><span class="skolem">β</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mono_map_is_fun apply_in_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α_0</span> <span class="main">∈</span> <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α_0</span> <span class="main">∪</span> <span class="skolem">j</span><span class="main">`</span><span class="skolem">β</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Un_least_mem_iff Ord_in_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span>›</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">α_0</span> <span class="main">∪</span> <span class="skolem">j</span><span class="main">`</span><span class="skolem">β</span><span class="main">,</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">θ</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">∨</span>  <span class="skolem">α_0</span> <span class="main">∪</span> <span class="skolem">j</span><span class="main">`</span><span class="skolem">β</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">θ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cofinal_fun_def<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span><span class="free">δ</span><span class="main">→</span><span class="free">γ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">∈</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span><span class="free">δ</span><span class="main">→</span><span class="free">γ</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">α_0</span> <span class="main">∈</span> <span class="free">γ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">f</span><span class="main">`</span><span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> apply_in_range Ord_in_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α_0</span> <span class="main">∈</span> <span class="free">γ</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">δ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span><span class="main">`</span><span class="skolem">β</span> <span class="main">∈</span> <span class="free">γ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="skolem">α_0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="skolem">j</span><span class="main">`</span><span class="skolem">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">h</span> <span class="main">``</span> <span class="skolem">β</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">α_0</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">α_0</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span><span class="main">:</span><span class="skolem">β</span><span class="main">→</span><span class="free">γ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">β</span> <span class="main">⟹</span> <span class="skolem">h</span><span class="main">`</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">α_0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> fun_is_function<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">β</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">γ</span>"</span></span><span class="main">]</span>
        Image_subset_Ord_imp_lt domain_of_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">β</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">γ</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">β</span> <span class="main">⟹</span> <span class="skolem">h</span><span class="main">`</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">f</span><span class="main">`</span><span class="skolem">θ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">h</span> <span class="main">``</span> <span class="skolem">β</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">α_0</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">α_0</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span><span class="main">:</span><span class="skolem">β</span><span class="main">→</span><span class="free">γ</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">`</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">α_0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fun_is_function<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">β</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">γ</span>"</span></span><span class="main">]</span>
          Image_subset_Ord_imp_lt domain_of_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">β</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">γ</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="skolem">α_0</span> <span class="main">∪</span> <span class="main">_</span><span class="main">,</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">θ</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">α_0</span> <span class="main">∪</span> <span class="main">_</span><span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">θ</span>›</span></span>
        <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">f</span><span class="main">`</span><span class="skolem">θ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">α_0</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">j</span><span class="main">`</span><span class="skolem">β</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α_0</span> <span class="main">≤</span> <span class="free">f</span><span class="main">`</span><span class="skolem">θ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Un_leD1<span class="main">[</span><span class="operator">OF</span> leI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ltI<span class="main"><span class="main">]</span></span><span class="main">]</span> Un_leD1<span class="main">[</span><span class="operator">OF</span> le_eqI<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">finally</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">`</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">f</span><span class="main">`</span><span class="skolem">θ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factor_body<span class="main">(</span><span class="skolem">β</span><span class="main">,</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">β</span><span class="main">.</span> factor<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> h_def factor_body_def <span class="keyword1"><span class="command">using</span></span> ltD
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Un_memD2 Un_leD2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le_eqI<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">θ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="skolem">β</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">θ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> factor_unfold<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">β</span></span><span class="main">]</span> Least_le <span class="keyword1"><span class="command">unfolding</span></span> factor_rec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span><span class="main">∈</span><span class="free">δ</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">δ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factor<span class="main">(</span><span class="skolem">β</span><span class="main">)</span> <span class="main">∈</span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> leI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">θ</span></span><span class="main">]</span> ltI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">θ</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>ltD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>mem_irrefl<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> fun_factor<span class="main">,</span> <span class="free">γ</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> cofinal_funI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cf_fun<span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹domain<span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">j</span><span class="main">`</span><span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">`</span><span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cofinal_fun_def<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> factor_not_delta
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> domain<span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> fun_factor<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_fun_factor_is_mono_map mono_map_is_fun domain_of_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> fun_factor<span class="main">)</span> <span class="main">`</span><span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> fun_factor<span class="main">)</span> <span class="main">`</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span> factor_not_delta
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">`</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">`</span> factor<span class="main">(</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mem_not_refl factor_body_factor factor_in_delta
        <span class="keyword1"><span class="command">unfolding</span></span> factor_body_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">j</span><span class="main">`</span><span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">`</span><span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> factor<span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> factor<span class="main">(</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ltD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lam_funtype<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted">factor</span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> fun_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">γ</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> factor_not_delta
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> fun_factor<span class="main">)</span> <span class="main">`</span><span class="skolem">x</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Limit_nonzero apply_in_range mono_map_is_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">O</span> fun_factor"</span></span><span class="main">]</span>
        f_fun_factor_is_mono_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> domain<span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> fun_factor<span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> fun_factor<span class="main">)</span> <span class="main">`</span> <span class="bound">x</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span>
                                       <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> fun_factor<span class="main">)</span> <span class="main">`</span><span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_factor_is_mono_map f_fun_factor_is_mono_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹As a final observation in this part, we note that if the original
cofinal map was increasing, then the factor function is also cofinal.›</span></span>
<span class="keyword1" id="Cofinality-factor_is_cofinal"><span class="command">lemma</span></span> factor_is_cofinal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">:</span><span class="free">δ</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">γ</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">O</span> <span class="free">g</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">α</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">g</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">:</span> <span class="free">α</span> <span class="main">→</span> <span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="free">g</span><span class="main">,</span><span class="free">δ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cf_fun_def cofinal_fun_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">δ</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="skolem">a</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_map_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cofinal_fun<span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">g</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">α</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">f</span><span class="main">`</span><span class="skolem">a</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">g</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">y</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">∨</span> <span class="free">f</span><span class="main">`</span><span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="free">g</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cofinal_fun_def <span class="keyword1"><span class="command">using</span></span> domain_of_fun<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span><span class="main">:</span><span class="free">α</span> <span class="main">→</span> <span class="free">δ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span><span class="main">:</span><span class="free">α</span> <span class="main">→</span> <span class="free">δ</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">f</span><span class="main">`</span><span class="skolem">a</span><span class="main">,</span> <span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="skolem">y</span><span class="main">)</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">∨</span> <span class="free">f</span><span class="main">`</span><span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">`</span><span class="skolem">y</span> <span class="main">∈</span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_fun_apply<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="free">δ</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span><span class="free">δ</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span> <span class="free">g</span> <span class="main">`</span> <span class="skolem">y</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">δ</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">g</span> <span class="main">`</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Memrel_mono_map_reflects Memrel_mono_map_is_inj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">δ</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">γ</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span>
      inj_apply_equality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">δ</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="free">α</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">g</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span> <span class="free">g</span> <span class="main">`</span> <span class="bound">x</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span><span class="free">δ</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">g</span> <span class="main">`</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> domain_of_fun<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span><span class="main">:</span><span class="free">α</span> <span class="main">→</span> <span class="free">δ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Classical results on cofinalities›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Now the rest of the results follow in a more algebraic way. The
next proof one invokes a case analysis on whether the argument is zero,
a successor ordinal or a limit one; the last case being the most
relevant one and is immediate from the factorization lemma.›</span></span>

<span class="keyword1" id="Cofinality-cf_le_domain_cofinal_fun"><span class="command">lemma</span></span> cf_le_domain_cofinal_fun<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">δ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span><span class="free">δ</span> <span class="main">→</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">≤</span><span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>Ord_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">δ</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Ord_0_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">γ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="skolem">x</span><span class="main">=</span><span class="skolem">γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cf_fun_succ' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">f</span><span class="main">`</span><span class="skolem">x</span><span class="main">⟩</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">`</span><span class="skolem">x</span><span class="main">=</span><span class="skolem">γ</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span><span class="main">:</span><span class="main">1</span><span class="main">→</span>succ<span class="main">(</span><span class="skolem">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> singleton_0 singleton_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">γ</span></span><span class="main">]</span> singleton_subsetI fun_weaken_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">γ</span><span class="main">)</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">`</span><span class="skolem">x</span><span class="main">=</span><span class="skolem">γ</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span>succ<span class="main">(</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cf_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span><span class="main">≠</span><span class="main">0</span>›</span></span> succ
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Ord_0_lt_iff succ_leI <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">δ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>limit<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">:</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">δ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cofinal_fun_factorization <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mono_map_imp_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-cf_ordertype_cofinal"><span class="command">lemma</span></span> cf_ordertype_cofinal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> cf<span class="main">(</span>ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> le_anti_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_is_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">⊆</span> <span class="free">γ</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_ord<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> well_ord_Memrel well_ord_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">:</span><span class="main">⟨</span><span class="skolem">α</span><span class="main">,</span> Memrel<span class="main">(</span><span class="skolem">α</span><span class="main">)</span><span class="main">⟩</span> <span class="main">≅</span> <span class="main">⟨</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordertype_ord_iso Ord_ordertype ord_iso_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">:</span> <span class="skolem">α</span> <span class="main">→</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_iso_is_mono_map mono_map_is_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"Memrel<span class="main">(</span><span class="skolem">α</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"function<span class="main">(</span><span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_is_function <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">:</span><span class="main">⟨</span><span class="skolem">α</span><span class="main">,</span> Memrel<span class="main">(</span><span class="skolem">α</span><span class="main">)</span><span class="main">⟩</span> <span class="main">≅</span> <span class="main">⟨</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">⟩</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range<span class="main">(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_iso_is_bij bij_is_surj surj_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹cofinal<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="skolem">f</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cofinal_range_iff_cofinal_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">α</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">:</span>cf<span class="main">(</span><span class="skolem">α</span><span class="main">)</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="skolem">h</span><span class="main">,</span><span class="skolem">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cofinal_mono_map_cf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trans<span class="main">(</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trans_Memrel <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">⊆</span><span class="free">γ</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="skolem">f</span> <span class="keyword1">O</span> <span class="skolem">h</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cofinal_comp ord_iso_is_mono_map<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">:</span><span class="main">⟨</span><span class="skolem">α</span><span class="main">,</span><span class="main">_</span><span class="main">⟩</span> <span class="main">≅</span> <span class="main">⟨</span><span class="free">A</span><span class="main">,</span><span class="main">_</span><span class="main">⟩</span>›</span></span><span class="main">]</span> mono_map_is_fun
      mono_map_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">:</span><span class="skolem">α</span><span class="main">→</span><span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">⊆</span><span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span><span class="main">∈</span>mono_map<span class="main">(</span>cf<span class="main">(</span><span class="skolem">α</span><span class="main">)</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="skolem">α</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">O</span> <span class="skolem">h</span> <span class="main">:</span> cf<span class="main">(</span><span class="skolem">α</span><span class="main">)</span> <span class="main">→</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Pi_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span> comp_fun  mono_map_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">α</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">≤</span> cf<span class="main">(</span>ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_le_domain_cofinal_fun<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">O</span> <span class="skolem">h</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cf_fun_def<span class="main">)</span>
      <span class="comment1">(********************************************************)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">:</span><span class="main">⟨</span><span class="skolem">α</span><span class="main">,</span> <span class="main">_</span><span class="main">⟩</span> <span class="main">≅</span> <span class="main">⟨</span><span class="free">A</span><span class="main">,</span><span class="main">_</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">⊆</span><span class="free">γ</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">:</span><span class="skolem">α</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_map_mono<span class="main">[</span><span class="operator">OF</span> ord_iso_is_mono_map<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">:</span> <span class="skolem">α</span> <span class="main">→</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_map_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cf_fun<span class="main">(</span><span class="skolem">f</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">α</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">:</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="skolem">α</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">O</span> <span class="skolem">g</span> <span class="main">:</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"cofinal_fun<span class="main">(</span><span class="skolem">f</span> <span class="keyword1">O</span> <span class="skolem">g</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cofinal_fun_factorization <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">:</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">→</span><span class="skolem">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_map_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">α</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">:</span><span class="skolem">α</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="skolem">g</span><span class="main">,</span><span class="skolem">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> factor_is_cofinal <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span>ordertype<span class="main">(</span><span class="free">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_le_domain_cofinal_fun<span class="main">[</span><span class="operator">OF</span> _ Ord_cf mono_map_is_fun<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-cf_idemp"><span class="command">lemma</span></span> cf_idemp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> cf<span class="main">(</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">⊆</span><span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_is_Ord cf_is_ordertype <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> cf<span class="main">(</span>ordertype<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cf_ordertype_cofinal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cf<span class="main">(</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> ordertype<span class="main">(</span><span class="skolem">A</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">=</span> cf<span class="main">(</span>cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-cf_le_cardinal"><span class="command">lemma</span></span> cf_le_cardinal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">γ</span><span class="main">|</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Limit_is_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> surj<span class="main">(</span><span class="main">|</span><span class="free">γ</span><span class="main">|</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_cardinal_eqpoll <span class="keyword1"><span class="command">unfolding</span></span> eqpoll_def bij_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_is_Ord<span class="main">[</span><span class="operator">OF</span> Card_cardinal<span class="main">]</span> surj_is_cofinal
      cf_le_domain_cofinal_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span> surj_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-regular_is_Card"><span class="command">lemma</span></span> regular_is_Card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">notes</span></span> le_imp_subset <span class="main">[</span><span class="operator">dest</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">γ</span><span class="main">|</span> <span class="main">⊆</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_is_Ord Ord_cardinal_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">γ</span> <span class="main">=</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">⊆</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">γ</span><span class="main">|</span> <span class="main">⊆</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Card_def <span class="keyword1"><span class="command">using</span></span> cf_le_cardinal <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-Limit_cf"><span class="command">lemma</span></span> Limit_cf<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span>cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ord_cf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">κ</span></span><span class="main">,</span> <span class="operator">THEN</span> Ord_cases<span class="main">]</span>
    <span class="comment1">― ‹<span class="antiquoted"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span><span class="quoted">‹cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span> being 0 or successor leads to contradiction›</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cf_zero_iff Limit_is_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">α</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_idemp cf_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> succ_LimitE cf_eq_one_iff Limit_is_Ord
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-InfCard_cf"><span class="command">lemma</span></span> InfCard_cf<span class="main">:</span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">κ</span><span class="main">)</span> <span class="main">⟹</span> InfCard<span class="main">(</span>cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> regular_is_Card cf_idemp Limit_cf nat_le_Limit Limit_cf
  <span class="keyword1"><span class="command">unfolding</span></span> InfCard_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cofinality-cf_le_cf_fun"><span class="command">lemma</span></span> cf_le_cf_fun<span class="main">:</span>
  <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main">]</span> <span class="main">=</span> Limit_is_Ord
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span> <span class="main">≤</span> <span class="free">ν</span>"</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span>  <span class="bound">f</span><span class="main">:</span><span class="free">ν</span> <span class="main">→</span> <span class="free">κ</span>  <span class="main">∧</span>  cf_fun<span class="main">(</span><span class="bound">f</span><span class="main">,</span> <span class="free">κ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> assms
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h_cofinal_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="skolem">h</span><span class="main">,</span><span class="free">κ</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">:</span>cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span> <span class="main">→<span class="hidden">⇩</span><sub>&lt;</sub></span> <span class="free">κ</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">:</span> cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span> <span class="main">→</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cofinal_mono_map_cf mono_map_is_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> inj<span class="main">(</span>cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span><span class="main">,</span> <span class="free">ν</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_imp_lepoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> calculation<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> surj<span class="main">(</span><span class="free">ν</span><span class="main">,</span> cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">:</span> <span class="free">ν</span> <span class="main">→</span> cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_imp_surj<span class="main">[</span><span class="operator">OF</span> _ Limit_has_0<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> ltD<span class="main"><span class="main">]</span></span><span class="main">]</span>
      surj_is_fun Limit_cf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="skolem">f</span><span class="main">,</span>cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> surj_is_cofinal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> h_cofinal_mono <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="skolem">h</span> <span class="keyword1">O</span> <span class="skolem">f</span><span class="main">,</span><span class="free">κ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_fun_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">O</span> <span class="skolem">f</span> <span class="main">∈</span> <span class="free">ν</span> <span class="main">-&gt;</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cofinality-Limit_cofinal_fun_lt"><span class="command">lemma</span></span> Limit_cofinal_fun_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main">]</span> <span class="main">=</span> Limit_is_Ord
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span> <span class="free">ν</span> <span class="main">→</span> <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">κ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">∈</span><span class="free">κ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">α</span><span class="main">∈</span><span class="free">ν</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">f</span><span class="main">`</span><span class="bound">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span><span class="main">∈</span><span class="free">κ</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_has_succ<span class="main">[</span><span class="operator">OF</span> _ ltI<span class="main">,</span> <span class="operator">THEN</span> ltD<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span> <span class="free">ν</span> <span class="main">→</span> <span class="main">_</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">ν</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> domain_of_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹cf_fun<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">κ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="free">ν</span>"</span></span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span><span class="main">`</span><span class="skolem">α</span> <span class="main">∨</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span><span class="skolem">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_funD<span class="main">[</span><span class="operator">THEN</span> cofinal_funD<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span><span class="main">`</span><span class="skolem">α</span>"</span></span> <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span><span class="skolem">α</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">f</span><span class="main">`</span><span class="skolem">α</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span> <span class="free">ν</span> <span class="main">→</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">∈</span> <span class="free">ν</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> apply_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">ν</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">κ</span>"</span></span><span class="main">,</span> <span class="operator">THEN</span> <span class="main"><span class="main">[</span></span>2<span class="main"><span class="main">]</span></span> Ord_in_Ord<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">α</span>"</span></span><span class="main">]</span> ltI  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">α</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span> <span class="free">ν</span> <span class="main">→</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span> <span class="main">∈</span> <span class="free">ν</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ltI
        apply_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">ν</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">κ</span>"</span></span><span class="main">,</span> <span class="operator">THEN</span> <span class="main"><span class="main">[</span></span>2<span class="main"><span class="main">]</span></span> Ord_in_Ord<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> Ord_dests Aleph_dests Aleph_intros Aleph_mem_dests mono_map_rules
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We end this section by calculating the cofinality of Alephs, for
the zero and limit case. The successor case depends on $\AC$.›</span></span>

<span class="keyword1" id="Cofinality-cf_nat"><span class="command">lemma</span></span> cf_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="keyword1">ω</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ω</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Limit_nat<span class="main">[</span><span class="operator">THEN</span> InfCard_cf<span class="main">]</span> cf_le_cardinal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="keyword1">ω</span></span><span class="main">]</span>
    Card_nat<span class="main">[</span><span class="operator">THEN</span> Card_cardinal_eq<span class="main">]</span> le_anti_sym
  <span class="keyword1"><span class="command">unfolding</span></span> InfCard_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cofinality-cf_Aleph_zero"><span class="command">lemma</span></span> cf_Aleph_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> ℵ<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> cf_nat <span class="keyword1"><span class="command">unfolding</span></span> Aleph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cofinality-cf_Aleph_Limit"><span class="command">lemma</span></span> cf_Aleph_Limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> ℵ<span class="hidden">⇘</span><sub><span class="bound">x</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">:</span> <span class="free">γ</span> <span class="main">→</span> ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">:</span> <span class="main">_</span> <span class="main">→</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> lam_funtype<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted">Aleph</span><span class="main">]</span> fun_weaken_type<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">y</span> <span class="main">⟹</span> ℵ<span class="hidden">⇘</span><sub><span class="skolem">x</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> ℵ<span class="hidden">⇘</span><sub><span class="skolem">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that Ord_in_Ord<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span> Ord_trans<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> mono_map<span class="main">(</span><span class="free">γ</span><span class="main">,</span>Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">,</span>ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span><span class="main">,</span> Memrel<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span>  <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">γ</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">⟩</span> <span class="main">≅</span> <span class="main">⟨</span><span class="var">?f</span><span class="main">``</span><span class="free">γ</span><span class="main">,</span> Memrel<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_map_imp_ord_iso_Memrel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">γ</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">]</span> 
      Card_Aleph <span class="comment1">(* Already an intro rule, but need it explicitly *)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"converse<span class="main">(</span><span class="var">?f</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span><span class="var">?f</span><span class="main">``</span><span class="free">γ</span><span class="main">,</span> Memrel<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">⟩</span> <span class="main">≅</span> <span class="main">⟨</span><span class="free">γ</span><span class="main">,</span> Memrel<span class="main">(</span><span class="free">γ</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_iso_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordertype<span class="main">(</span><span class="var">?f</span><span class="main">``</span><span class="free">γ</span><span class="main">,</span> Memrel<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordertype_eq<span class="main">[</span><span class="operator">OF</span> _ well_ord_Memrel<span class="main">]</span>
    ordertype_Memrel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cofinal<span class="main">(</span><span class="var">?f</span><span class="main">``</span><span class="free">γ</span><span class="main">,</span> ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span><span class="main">,</span> Memrel<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> cofinal_def 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span>ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">γ</span><span class="main">.</span> ℵ<span class="hidden">⇘</span><sub><span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span>ℵ<span class="hidden">⇘</span><sub><span class="skolem">i</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ltD Ord_in_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> calculation
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ltD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">i</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="skolem">i</span></sub><span class="hidden">⇙</span> <span class="main">&lt;</span> ℵ<span class="hidden">⇘</span><sub>succ<span class="main">(</span><span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span>ℵ<span class="hidden">⇘</span><sub><span class="skolem">i</span></sub><span class="hidden">⇙</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ltD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Aleph_increasing<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&lt;</span><span class="free">γ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="skolem">i</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> <span class="var">?f</span><span class="main">``</span><span class="free">γ</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ltD apply_in_image<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="main">:</span> <span class="main">_</span> <span class="main">→</span> <span class="main">_</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="var">?f</span> <span class="main">``</span> <span class="free">γ</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">⟩</span> <span class="main">∈</span> Memrel<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span><span class="main">:</span> <span class="free">γ</span> <span class="main">→</span> ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span>›</span></span> <span class="quoted"><span class="quoted">‹Limit<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="free">γ</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span>  cf<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_ordertype_cofinal<span class="main">[</span><span class="operator">OF</span> Limit_Aleph Image_sub_codomain<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">γ</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="quoted"><span class="free">γ</span></span> <span class="quoted"><span class="free">γ</span></span> <span class="main">]</span> 
      Limit_is_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* includes *)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Cardinal_Library">
<div class="head">
<h1>Theory Cardinal_Library</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Cardinal Arithmetic under Choice\label{sec:cardinal-lib}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cardinal_Library
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#ZF_Library">ZF_Library</a>
    <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/ZF/ZF/Cardinal_AC.html">ZF.Cardinal_AC</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory includes results on cardinalities that depend on $\AC$›</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Results on cardinal exponentiation›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Non trivial instances of cardinal exponentiation require that
     the relevant function spaces are well-ordered, hence this 
     implies a strong use of choice.›</span></span>

<span class="keyword1" id="Cardinal_Library-cexp_eqpoll_cong"><span class="command">lemma</span></span> cexp_eqpoll_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≈</span> <span class="free">A'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≈</span> <span class="free">B'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="hidden">⇗</span><sup>↑<span class="free">B</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">A'</span><span class="hidden">⇗</span><sup>↑<span class="free">B'</span></sup><span class="hidden">⇖</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cexp_def <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll_iff
    function_space_eqpoll_cong assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-cexp_cexp_cmult"><span class="command">lemma</span></span> cexp_cexp_cmult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="hidden">⇗</span><sup>↑<span class="free">ν2</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν2</span> <span class="main">⊗</span> <span class="free">ν1</span></sup><span class="hidden">⇖</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν1</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="hidden">⇗</span><sup>↑<span class="free">ν2</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν1</span> <span class="main">→</span> <span class="free">κ</span><span class="main">)</span><span class="hidden">⇗</span><sup>↑<span class="free">ν2</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cexp_eqpoll_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cexp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">…</span> <span class="main">=</span> <span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν2</span> <span class="main">×</span> <span class="free">ν1</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cexp_def <span class="keyword1"><span class="command">using</span></span> curry_eqpoll cardinal_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">…</span> <span class="main">=</span> <span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν2</span> <span class="main">⊗</span> <span class="free">ν1</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll<span class="main">[</span><span class="operator">THEN</span> eqpoll_sym<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cmult_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cexp_eqpoll_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cardinal_Library-cardinal_Pow"><span class="command">lemma</span></span> cardinal_Pow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span>Pow<span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">|</span> <span class="main">=</span> <span class="main">2</span><span class="hidden">⇗</span><sup>↑<span class="free">X</span></sup><span class="hidden">⇖</span>"</span></span> <span class="comment1">― ‹Perhaps it's better with |X|›</span>
  <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll_iff<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> Pow_eqpoll_function_space<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> cexp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-cantor_cexp"><span class="command">lemma</span></span> cantor_cexp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">ν</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="main">&lt;</span> <span class="main">2</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Card_is_Ord Card_cexp
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> not_le_iff_lt<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">2</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="free">ν</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>Pow<span class="main">(</span><span class="free">ν</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="free">ν</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cardinal_Pow <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pow<span class="main">(</span><span class="free">ν</span><span class="main">)</span> <span class="main">≲</span> <span class="free">ν</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll_iff Card_le_imp_lepoll Card_cardinal_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> inj<span class="main">(</span>Pow<span class="main">(</span><span class="free">ν</span><span class="main">)</span><span class="main">,</span> <span class="free">ν</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cantor_inj <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-cexp_left_mono"><span class="command">lemma</span></span> cexp_left_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ1</span> <span class="main">≤</span> <span class="free">κ2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ1</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="free">κ2</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span>"</span></span>
    <span class="comment1">(* ― ‹short, unreadable proof: ›
  unfolding cexp_def
  using subset_imp_lepoll[THEN lepoll_imp_cardinal_le]
    assms le_subset_iff[THEN iffD1, OF assms]
    Pi_weaken_type[of _ _ "λ_. κ1" "λ_. κ2"] by auto *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ1</span> <span class="main">⊆</span> <span class="free">κ2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_subset_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="main">→</span> <span class="free">κ1</span>  <span class="main">⊆</span> <span class="free">ν</span> <span class="main">→</span> <span class="free">κ2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Pi_weaken_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cexp_def
    <span class="keyword1"><span class="command">using</span></span> lepoll_imp_cardinal_le subset_imp_lepoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cardinal_Library-cantor_cexp'"><span class="command">lemma</span></span> cantor_cexp'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">2</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">ν</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="main">&lt;</span> <span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cexp_left_mono assms cantor_cexp lt_trans2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Cardinal_Library-InfCard_cexp"><span class="command">lemma</span></span> InfCard_cexp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">2</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">ν</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms cantor_cexp'<span class="main">[</span><span class="operator">THEN</span> leI<span class="main">]</span> le_trans Card_cexp
  <span class="keyword1"><span class="command">unfolding</span></span> InfCard_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> InfCard_cexp' <span class="main">=</span> InfCard_cexp<span class="main">[</span><span class="operator">OF</span> nats_le_InfCard<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span><span class="quoted">‹InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span> <span class="main">⟹</span> InfCard<span class="main">(</span><span class="free">ν</span><span class="main">)</span> <span class="main">⟹</span> InfCard<span class="main">(</span><span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span><span class="main">)</span>›</span></span>›</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Miscellaneous›</span></span>

<span class="keyword1" id="Cardinal_Library-cardinal_RepFun_le"><span class="command">lemma</span></span> cardinal_RepFun_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">{</span><span class="free">f</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">}</span><span class="main">|</span> <span class="main">≤</span> <span class="main">|</span><span class="free">A</span><span class="main">|</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> surj<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="main">{</span><span class="free">f</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> surj_def <span class="keyword1"><span class="command">using</span></span> lam_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span>  surj_implies_cardinal_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cardinal_Library-subset_imp_le_cardinal"><span class="command">lemma</span></span> subset_imp_le_cardinal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">A</span><span class="main">|</span> <span class="main">≤</span> <span class="main">|</span><span class="free">B</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subset_imp_lepoll<span class="main">[</span><span class="operator">THEN</span> lepoll_imp_cardinal_le<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Cardinal_Library-lt_cardinal_imp_not_subset"><span class="command">lemma</span></span> lt_cardinal_imp_not_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">A</span><span class="main">|</span> <span class="main">&lt;</span> <span class="main">|</span><span class="free">B</span><span class="main">|</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subset_imp_le_cardinal le_imp_not_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Cardinal_Library-cardinal_lt_csucc_iff"><span class="command">lemma</span></span> cardinal_lt_csucc_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">K</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">K'</span><span class="main">|</span> <span class="main">&lt;</span> <span class="free">K</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟷</span> <span class="main">|</span><span class="free">K'</span><span class="main">|</span> <span class="main">≤</span> <span class="free">K</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Card_lt_csucc_iff<span class="main">)</span>

<span class="keyword1" id="Cardinal_Library-cardinal_UN_le_nat"><span class="command">lemma</span></span> cardinal_UN_le_nat<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="keyword1">ω</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">X</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="keyword1">ω</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">|</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="keyword1">ω</span><span class="main">.</span> <span class="free">X</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="keyword1">ω</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cardinal_UN_le InfCard_nat<span class="main">)</span>

<span class="keyword1" id="Cardinal_Library-leqpoll_imp_cardinal_UN_le"><span class="command">lemma</span></span> leqpoll_imp_cardinal_UN_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main">]</span> <span class="main">=</span> InfCard_is_Card Card_is_Ord
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">K</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">≲</span> <span class="free">K</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">J</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">X</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="free">K</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="free">X</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="free">K</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">J</span> <span class="main">≲</span> <span class="free">K</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">J</span><span class="main">,</span><span class="free">K</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="skolem">k</span><span class="main">∈</span>range<span class="main">(</span><span class="skolem">f</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">X</span><span class="main">(</span>converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">`</span><span class="skolem">k</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="free">J</span> <span class="main">⟹</span> <span class="skolem">f</span><span class="main">`</span><span class="skolem">i</span> <span class="main">∈</span> <span class="free">K</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> inj_is_fun<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">J</span><span class="main">,</span><span class="free">K</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="free">X</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="skolem">Y</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> UN_E<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">J</span><span class="main">,</span><span class="free">K</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">∈</span><span class="free">J</span> <span class="main">⟹</span> <span class="skolem">f</span><span class="main">`</span><span class="skolem">i</span> <span class="main">∈</span> <span class="free">K</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">(</span><span class="skolem">f</span><span class="main">`</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">`</span><span class="skolem">i</span> <span class="main">∈</span> <span class="free">K</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Y_def
      <span class="keyword1"><span class="command">using</span></span> inj_is_fun<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">J</span><span class="main">,</span><span class="free">K</span><span class="main">)</span>›</span></span><span class="main">]</span>
        right_inverse apply_rangeI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="skolem">Y</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="free">X</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="main">|</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="skolem">Y</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">using</span></span> subset_imp_le_cardinal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">J</span> <span class="main">⟹</span> <span class="skolem">f</span><span class="main">`</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">K</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="free">X</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="free">K</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_converse_fun<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">J</span><span class="main">,</span><span class="free">K</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ cardinal_UN_le<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>Ord_0_le<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cardinal_Library-cardinal_lt_csucc_iff'"><span class="command">lemma</span></span> cardinal_lt_csucc_iff'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> Ord_dests
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">&lt;</span> <span class="main">|</span><span class="free">X</span><span class="main">|</span> <span class="main">⟷</span> <span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">|</span><span class="free">X</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms cardinal_lt_csucc_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">κ</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> Card_csucc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span>
    not_le_iff_lt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">κ</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">X</span><span class="main">|</span>"</span></span><span class="main">]</span> not_le_iff_lt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">X</span><span class="main">|</span>"</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Cardinal_Library-lepoll_imp_subset_bij"><span class="command">lemma</span></span> lepoll_imp_subset_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≲</span> <span class="free">Y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Z</span><span class="main">.</span> <span class="bound">Z</span> <span class="main">⊆</span> <span class="free">Y</span> <span class="main">∧</span> <span class="bound">Z</span> <span class="main">≈</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≲</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range<span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">X</span><span class="main">,</span>range<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_bij_range inj_is_fun range_fun_subset_codomain
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Z</span><span class="main">.</span> <span class="bound">Z</span> <span class="main">⊆</span> <span class="free">Y</span> <span class="main">∧</span> <span class="bound">Z</span> <span class="main">≈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqpoll_sym <span class="keyword1"><span class="command">unfolding</span></span> eqpoll_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Z</span><span class="main">.</span> <span class="bound">Z</span> <span class="main">⊆</span> <span class="free">Y</span> <span class="main">∧</span> <span class="bound">Z</span> <span class="main">≈</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> bij<span class="main">(</span><span class="skolem">Z</span><span class="main">,</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eqpoll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"converse<span class="main">(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> inj<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_is_inj inj_weaken_type bij_converse_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≲</span> <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following result proves to be very useful when combining
     <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹cardinal›</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹eqpoll›</span></span></span></span> in a calculation.›</span></span>

<span class="keyword1" id="Cardinal_Library-cardinal_Card_eqpoll_iff"><span class="command">lemma</span></span> cardinal_Card_eqpoll_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">κ</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">X</span><span class="main">|</span> <span class="main">=</span> <span class="free">κ</span> <span class="main">⟷</span> <span class="free">X</span> <span class="main">≈</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Card_cardinal_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span> cardinal_eqpoll_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="comment1">― ‹Compare <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> "le_Card_iff"<span class="antiquote">}</span></span>›</span>

<span class="keyword1" id="Cardinal_Library-lepoll_imp_lepoll_cardinal"><span class="command">lemma</span></span> lepoll_imp_lepoll_cardinal<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≲</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≲</span> <span class="main">|</span><span class="free">Y</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms cardinal_Card_eqpoll_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">Y</span><span class="main">|</span>"</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">]</span>
    lepoll_eq_trans<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">Y</span><span class="main">|</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-lepoll_Un"><span class="command">lemma</span></span> lepoll_Un<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≲</span> <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≲</span> <span class="free">κ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">≲</span> <span class="free">κ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">≲</span> sum<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Un_lepoll_sum <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> assms
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>sum<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="free">κ</span> <span class="main">⊕</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_lepoll_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">κ</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span> lepoll_imp_cardinal_le
    <span class="keyword1"><span class="command">unfolding</span></span> cadd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> InfCard_cdouble_eq Card_cardinal_eq
      InfCard_is_Card Card_le_imp_lepoll<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sum<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span>
      lepoll_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∪</span><span class="free">B</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cardinal_Library-cardinal_Un_le"><span class="command">lemma</span></span> cardinal_Un_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">A</span><span class="main">|</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">B</span><span class="main">|</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">|</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lepoll_Un le_Card_iff InfCard_is_Card <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is the unconditional version under choice of 
     <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Cardinal.Finite_cardinal_iff<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1" id="Cardinal_Library-Finite_cardinal_iff'"><span class="command">lemma</span></span> Finite_cardinal_iff'<span class="main">:</span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="main">|</span><span class="free">i</span><span class="main">|</span><span class="main">)</span> <span class="main">⟷</span> Finite<span class="main">(</span><span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll_iff eqpoll_imp_Finite_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Cardinal_Library-cardinal_subset_of_Card"><span class="command">lemma</span></span> cardinal_subset_of_Card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊆</span> <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">a</span><span class="main">|</span> <span class="main">&lt;</span> <span class="free">γ</span> <span class="main">∨</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span> <span class="main">=</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">a</span><span class="main">|</span> <span class="main">&lt;</span> <span class="main">|</span><span class="free">γ</span><span class="main">|</span> <span class="main">∨</span> <span class="main">|</span><span class="free">a</span><span class="main">|</span> <span class="main">=</span> <span class="main">|</span><span class="free">γ</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_imp_le_cardinal le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_cardinal_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cardinal_Library-cardinal_cases"><span class="command">lemma</span></span> cardinal_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> Ord_dests
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">γ</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">X</span><span class="main">|</span> <span class="main">&lt;</span> <span class="free">γ</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="main">|</span><span class="free">X</span><span class="main">|</span> <span class="main">≥</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> not_le_iff_lt
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Countable and uncountable sets›</span></span>

<span class="comment1">― ‹Kunen's Definition I.10.5›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">countable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"i<span class="main">⇒</span>o"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">countable</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≲</span> <span class="keyword1">ω</span>"</span></span>

<span class="keyword1" id="Cardinal_Library-countableI"><span class="command">lemma</span></span> countableI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≲</span> <span class="keyword1">ω</span> <span class="main">⟹</span> countable<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> countable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-countableD"><span class="command">lemma</span></span> countableD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">≲</span> <span class="keyword1">ω</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> countable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-countable_iff_cardinal_le_nat"><span class="command">lemma</span></span> countable_iff_cardinal_le_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">|</span><span class="free">X</span><span class="main">|</span> <span class="main">≤</span> <span class="keyword1">ω</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_Card_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="keyword1">ω</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> Card_nat
  <span class="keyword1"><span class="command">unfolding</span></span> countable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-lepoll_countable"><span class="command">lemma</span></span> lepoll_countable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≲</span> <span class="free">Y</span> <span class="main">⟹</span> countable<span class="main">(</span><span class="free">Y</span><span class="main">)</span> <span class="main">⟹</span> countable<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lepoll_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">― ‹Next lemma can be proved without using AC›</span>
<span class="keyword1" id="Cardinal_Library-surj_countable"><span class="command">lemma</span></span> surj_countable<span class="main">:</span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> surj<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span> <span class="main">⟹</span> countable<span class="main">(</span><span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> surj_implies_cardinal_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">,</span> <span class="operator">THEN</span> le_trans<span class="main">]</span>
    countable_iff_cardinal_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-Finite_imp_countable"><span class="command">lemma</span></span> Finite_imp_countable<span class="main">:</span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> countable<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Finite_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>InfCard_nat nats_le_InfCard<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="keyword1">ω</span></span><span class="main"><span class="main">,</span></span>
        <span class="operator">THEN</span> le_imp_lepoll<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>eq_lepoll_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="keyword1">ω</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Cardinal_Library-countable_imp_countable_UN"><span class="command">lemma</span></span> countable_imp_countable_UN<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="free">J</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">J</span> <span class="main">⟹</span> countable<span class="main">(</span><span class="free">X</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="free">X</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms leqpoll_imp_cardinal_UN_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="keyword1">ω</span></span> <span class="quoted"><span class="free">J</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> InfCard_nat
    countable_iff_cardinal_le_nat
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cardinal_Library-countable_union_countable"><span class="command">lemma</span></span> countable_union_countable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> countable<span class="main">(</span><span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="main">⋃</span><span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms countable_imp_countable_UN<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">uncountable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"i<span class="main">⇒</span>o"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uncountable</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">¬</span> countable<span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cardinal_Library-uncountable_iff_nat_lt_cardinal"><span class="command">lemma</span></span> uncountable_iff_nat_lt_cardinal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">⟷</span> <span class="keyword1">ω</span> <span class="main">&lt;</span> <span class="main">|</span><span class="free">X</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> countable_iff_cardinal_le_nat not_le_iff_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-uncountable_not_empty"><span class="command">lemma</span></span> uncountable_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> empty_lepollI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cardinal_Library-uncountable_imp_Infinite"><span class="command">lemma</span></span> uncountable_imp_Infinite<span class="main">:</span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> Infinite<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> uncountable_iff_nat_lt_cardinal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> lepoll_nat_imp_Infinite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span>
    cardinal_le_imp_lepoll<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="keyword1">ω</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> leI
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-uncountable_not_subset_countable"><span class="command">lemma</span></span> uncountable_not_subset_countable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">Y</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lepoll_trans subset_imp_lepoll<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Results on Alephs›</span></span>

<span class="keyword1" id="Cardinal_Library-nat_lt_Aleph1"><span class="command">lemma</span></span> nat_lt_Aleph1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span> <span class="main">&lt;</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aleph_def lt_csucc<span class="main">)</span>

<span class="keyword1" id="Cardinal_Library-zero_lt_Aleph1"><span class="command">lemma</span></span> zero_lt_Aleph1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">ω</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ltI nat_lt_Aleph1<span class="main">)</span>

<span class="keyword1" id="Cardinal_Library-le_aleph1_nat"><span class="command">lemma</span></span> le_aleph1_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">k</span><span class="main">&lt;</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">≤</span> <span class="keyword1">ω</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Aleph_def Card_lt_csucc_iff Card_nat<span class="main">)</span>

<span class="keyword1" id="Cardinal_Library-Aleph_succ"><span class="command">lemma</span></span> Aleph_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">=</span> ℵ<span class="hidden">⇘</span><sub><span class="free">α</span></sub><span class="hidden">⇙</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Aleph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-lesspoll_aleph_plus_one"><span class="command">lemma</span></span> lesspoll_aleph_plus_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≺</span> ℵ<span class="hidden">⇘</span><sub>succ<span class="main">(</span><span class="free">α</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">⟷</span> <span class="free">d</span> <span class="main">≲</span> ℵ<span class="hidden">⇘</span><sub><span class="free">α</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lesspoll_csucc Aleph_succ Card_is_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-cardinal_Aleph"><span class="command">lemma</span></span> cardinal_Aleph <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">|</span>ℵ<span class="hidden">⇘</span><sub><span class="free">α</span></sub><span class="hidden">⇙</span><span class="main">|</span> <span class="main">=</span> ℵ<span class="hidden">⇘</span><sub><span class="free">α</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Card_cardinal_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">― ‹Could be proved without using AC›</span>
<span class="keyword1" id="Cardinal_Library-Aleph_lesspoll_increasing"><span class="command">lemma</span></span> Aleph_lesspoll_increasing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> Aleph_intros
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟹</span> ℵ<span class="hidden">⇘</span><sub><span class="free">a</span></sub><span class="hidden">⇙</span> <span class="main">≺</span> ℵ<span class="hidden">⇘</span><sub><span class="free">b</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cardinal_lt_iff_lesspoll<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="free">a</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="free">b</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> Card_cardinal_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="free">b</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span>
    lt_Ord lt_Ord2 Card_Aleph<span class="main">[</span><span class="operator">THEN</span> Card_is_Ord<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cardinal_Library-uncountable_iff_subset_eqpoll_Aleph1"><span class="command">lemma</span></span> uncountable_iff_subset_eqpoll_Aleph1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> Ord_dests
  <span class="keyword2"><span class="keyword">notes</span></span> Aleph_zero_eq_nat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> Card_nat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> Aleph_succ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">S</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">≲</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> uncountable_iff_nat_lt_cardinal cardinal_lt_csucc_iff'
      cardinal_le_imp_lepoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lepoll_imp_subset_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">S</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cardinal_cong Card_csucc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="keyword1">ω</span></span><span class="main">]</span> Card_cardinal_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">S</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">≲</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_imp_lepoll<span class="main">[</span><span class="operator">THEN</span> <span class="main"><span class="main">[</span></span>2<span class="main"><span class="main">]</span></span> eq_lepoll_trans<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="free">X</span></span><span class="main">,</span>
        <span class="operator">OF</span> eqpoll_sym<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Aleph_lesspoll_increasing<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span> <span class="operator">THEN</span> <span class="main"><span class="main">[</span></span>2<span class="main"><span class="main">]</span></span> lesspoll_trans1<span class="main">,</span>
        <span class="operator">of</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> lepoll_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="keyword1">ω</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cardinal_Library-lt_Aleph_imp_cardinal_UN_le_nat"><span class="command">lemma</span></span> lt_Aleph_imp_cardinal_UN_le_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"function<span class="main">(</span><span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> domain<span class="main">(</span><span class="free">G</span><span class="main">)</span> <span class="main">≲</span> <span class="keyword1">ω</span> <span class="main">⟹</span>
   <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">|</span><span class="free">G</span><span class="main">`</span><span class="bound">n</span><span class="main">|</span><span class="main">&lt;</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="main">|</span><span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="free">G</span><span class="main">`</span><span class="bound">n</span><span class="main">|</span><span class="main">≤</span><span class="keyword1">ω</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"function<span class="main">(</span><span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span>domain<span class="main">(</span><span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="free">G</span><span class="main">`</span><span class="bound">n</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">≲</span> <span class="keyword1">ω</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> Eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span><span class="var">?N</span><span class="main">.</span> <span class="main">|</span><span class="free">G</span><span class="main">`</span><span class="bound">n</span><span class="main">|</span><span class="main">&lt;</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="var">?N</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Eq1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">G</span><span class="main">`</span><span class="skolem">n</span><span class="main">|</span> <span class="main">≤</span> <span class="keyword1">ω</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_aleph1_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="var">?N</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">G</span><span class="main">`</span><span class="skolem">n</span><span class="main">|</span> <span class="main">≤</span> <span class="keyword1">ω</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span> <span class="main">≲</span> <span class="keyword1">ω</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> InfCard_nat leqpoll_imp_cardinal_UN_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cardinal_Library-Aleph1_eq_cardinal_vimage"><span class="command">lemma</span></span> Aleph1_eq_cardinal_vimage<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">→</span><span class="keyword1">ω</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span><span class="main">∈</span><span class="keyword1">ω</span><span class="main">.</span> <span class="main">|</span><span class="free">f</span><span class="main">-``</span><span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">|</span> <span class="main">=</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">→</span><span class="keyword1">ω</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"function<span class="main">(</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">⊆</span><span class="keyword1">ω</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domain_of_fun fun_is_function range_fun_subset_codomain<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">∈</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span><span class="main">-``</span><span class="main">{</span><span class="bound">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">→</span><span class="keyword1">ω</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">ω</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> range_fun_subset_codomain<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="var">?G</span><span class="main">)</span> <span class="main">≲</span> <span class="keyword1">ω</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_imp_lepoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"function<span class="main">(</span><span class="var">?G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>function_lam<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">→</span><span class="keyword1">ω</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="keyword1">ω</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">-``</span><span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">⊆</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> Pi_vimage_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹range<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">ω</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span><span class="main">-``</span><span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">→</span><span class="keyword1">ω</span>›</span></span> <span class="quoted"><span class="quoted">‹function<span class="main">(</span><span class="free">f</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹domain<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span><span class="main">-``</span><span class="main">{</span><span class="free">f</span><span class="main">`</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span><span class="skolem">x</span> <span class="main">∈</span> range<span class="main">(</span><span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> function_apply_Pair vimage_iff apply_rangeI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span><span class="main">-``</span><span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="main">|</span><span class="free">f</span><span class="main">-``</span><span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">|</span> <span class="main">&lt;</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>domain<span class="main">(</span><span class="var">?G</span><span class="main">)</span><span class="main">.</span> <span class="main">|</span><span class="var">?G</span><span class="main">`</span><span class="bound">n</span><span class="main">|</span> <span class="main">&lt;</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> zero_lt_Aleph1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹function<span class="main">(</span><span class="var">?G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹domain<span class="main">(</span><span class="var">?G</span><span class="main">)</span> <span class="main">≲</span> <span class="keyword1">ω</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span>domain<span class="main">(</span><span class="var">?G</span><span class="main">)</span><span class="main">.</span> <span class="var">?G</span><span class="main">`</span><span class="bound">n</span><span class="main">|</span><span class="main">≤</span><span class="keyword1">ω</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lt_Aleph_imp_cardinal_UN_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span>range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span><span class="main">-``</span><span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">|</span><span class="main">≤</span><span class="keyword1">ω</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">_</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">|</span> <span class="main">≤</span> <span class="keyword1">ω</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="keyword1">ω</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Card_Aleph Card_cardinal_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nat_lt_Aleph1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>lt_trans2<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹range<span class="main">(</span><span class="free">f</span><span class="main">)</span><span class="main">⊆</span><span class="keyword1">ω</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="keyword1">ω</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">|</span><span class="free">f</span> <span class="main">-``</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">|</span> <span class="main">&lt;</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">≤</span> <span class="main">|</span><span class="free">f</span><span class="main">-``</span><span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_lt_iff_le Card_is_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">∈</span><span class="keyword1">ω</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">-``</span><span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">⊆</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_imp_le_cardinal<span class="main">[</span><span class="operator">THEN</span> le_anti_sym<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span>
      Card_Aleph Card_cardinal_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">― ‹There is some asymmetry between assumptions and conclusion
    (<span class="antiquoted"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span><span class="quoted">‹<span class="main">(≈)</span>›</span></span> versus <span class="antiquoted"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span><span class="quoted">‹cardinal›</span></span>)›</span>
<span class="keyword1" id="Cardinal_Library-eqpoll_Aleph1_cardinal_vimage"><span class="command">lemma</span></span> eqpoll_Aleph1_cardinal_vimage<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">:</span> <span class="free">X</span> <span class="main">→</span> <span class="keyword1">ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">∈</span><span class="keyword1">ω</span><span class="main">.</span> <span class="main">|</span><span class="free">f</span><span class="main">-``</span><span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">|</span> <span class="main">=</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">∈</span>bij<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">,</span><span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqpoll_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">:</span> <span class="free">X</span> <span class="main">→</span> <span class="keyword1">ω</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">O</span> <span class="skolem">g</span> <span class="main">:</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">→</span> <span class="keyword1">ω</span>"</span></span> <span class="quoted"><span class="quoted">"converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">X</span><span class="main">,</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_is_fun comp_fun bij_converse_bij <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="keyword1">ω</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span><span class="free">f</span> <span class="keyword1">O</span> <span class="skolem">g</span><span class="main">)</span><span class="main">-``</span><span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">|</span> <span class="main">=</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Aleph1_eq_cardinal_vimage <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">|</span>converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">``</span> <span class="main">(</span><span class="free">f</span> <span class="main">-``</span><span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_comp converse_comp
    <span class="keyword1"><span class="command">unfolding</span></span> vimage_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">X</span><span class="main">,</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">:</span> <span class="free">X</span><span class="main">→</span> <span class="keyword1">ω</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">|</span><span class="free">f</span> <span class="main">-``</span><span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> range_of_subset_eqpoll<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"converse<span class="main">(</span><span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">X</span></span>  <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">-``</span><span class="main">{</span><span class="skolem">n</span><span class="main">}</span>"</span></span><span class="main">]</span>
      bij_is_inj cardinal_cong bij_is_fun eqpoll_sym Pi_vimage_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">∈</span><span class="keyword1">ω</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Applications of transfinite recursive constructions›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">rec_constr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span>i<span class="main">]</span> <span class="main">⇒</span> i"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rec_constr</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">)</span> <span class="main">≡</span> transrec<span class="main">(</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">,</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">g</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">`</span><span class="main">(</span><span class="bound">g</span><span class="main">``</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The function <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹rec_constr›</span></span></span></span> allows to perform <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹recursive
     constructions›</span></span>: given a choice function on the powerset of some
     set, a transfinite sequence is created by successively choosing
     some new element.

     The next result explains its use.›</span></span>

<span class="keyword1" id="Cardinal_Library-rec_constr_unfold"><span class="command">lemma</span></span> rec_constr_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"rec_constr<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">α</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">`</span><span class="main">(</span><span class="main">{</span>rec_constr<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="bound">β</span><span class="main">)</span><span class="main">.</span> <span class="bound">β</span><span class="main">∈</span><span class="free">α</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> def_transrec<span class="main">[</span><span class="operator">OF</span> rec_constr_def<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">α</span></span><span class="main">]</span> image_lam <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-rec_constr_type"><span class="command">lemma</span></span> rec_constr_type<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span>Pow<span class="main">(</span><span class="free">G</span><span class="main">)</span><span class="main">→</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rec_constr<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">α</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>trans_induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">subst</span> rec_constr_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> apply_type<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Pow<span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">G</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="bound"><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">G</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The next lemma is an application of recursive constructions.
     It works under the assumption that whenever the already constructed
     subsequence is small enough, another element can be added.›</span></span>

<span class="keyword1" id="Cardinal_Library-bounded_cardinal_selection"><span class="command">lemma</span></span> bounded_cardinal_selection<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> Ord_dests
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="main">|</span><span class="bound">X</span><span class="main">|</span> <span class="main">&lt;</span> <span class="free">γ</span> <span class="main">⟹</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">Q</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">:</span> <span class="free">γ</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">α</span> <span class="main">∈</span> <span class="free">γ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">β</span> <span class="main">∈</span> <span class="free">γ</span><span class="main">.</span>  <span class="bound">α</span><span class="main">&lt;</span><span class="bound">β</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">(</span><span class="bound">S</span><span class="main">`</span><span class="bound">α</span><span class="main">,</span><span class="bound">S</span><span class="main">`</span><span class="bound">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cdltγ</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">∈</span>Pow<span class="main">(</span><span class="free">G</span><span class="main">)</span> <span class="main">.</span> <span class="main">|</span><span class="bound">X</span><span class="main">|</span><span class="main">&lt;</span><span class="free">γ</span><span class="main">}</span>"</span></span> <span class="comment1">― ‹“cardinal less than <span class="antiquoted"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span><span class="quoted">‹<span class="free">γ</span>›</span></span>”›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?inQ</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">Y</span><span class="main">.</span><span class="main">{</span><span class="bound">a</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span><span class="main">∈</span><span class="bound">Y</span><span class="main">.</span> <span class="free">Q</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">Y</span> <span class="main">∈</span> <span class="var">?cdltγ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="var">?inQ</span><span class="main">(</span><span class="bound">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="var">?cdltγ</span><span class="main">,</span><span class="var">?inQ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AC_ball_Pi<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?cdltγ</span></span></span> <span class="var"><span class="quoted"><span class="var">?inQ</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Pi<span class="main">(</span><span class="var">?cdltγ</span><span class="main">,</span><span class="var">?inQ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Cb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Cb</span> <span class="main">≡</span> <span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span>Pow<span class="main">(</span><span class="free">G</span><span class="main">)</span><span class="main">-</span><span class="var">?cdltγ</span><span class="main">.</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∈</span><span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Cb</span> <span class="main">∈</span> Pow<span class="main">(</span><span class="free">G</span><span class="main">)</span><span class="main">-</span><span class="var">?cdltγ</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Cb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Card<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∪</span> <span class="skolem">Cb</span> <span class="main">:</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span>Pow<span class="main">(</span><span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="var">?inQ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∪</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>
      fun_Pi_disjoint_Un<span class="main">[</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="var"><span class="quoted"><span class="var">?cdltγ</span></span></span>  <span class="var"><span class="quoted"><span class="var">?inQ</span></span></span> <span class="quoted"><span class="skolem">Cb</span></span> <span class="quoted"><span class="quoted">"Pow<span class="main">(</span><span class="free">G</span><span class="main">)</span><span class="main">-</span><span class="var">?cdltγ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span><span class="free">G</span>"</span></span><span class="main">]</span>
      Diff_partition<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">∈</span>Pow<span class="main">(</span><span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">|</span><span class="bound">X</span><span class="main">|</span><span class="main">&lt;</span><span class="free">γ</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"Pow<span class="main">(</span><span class="free">G</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> Collect_subset<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?inQ</span><span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∪</span> <span class="free">G</span> <span class="main">=</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∪</span> <span class="skolem">Cb</span> <span class="main">:</span> Pow<span class="main">(</span><span class="free">G</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">≡</span><span class="main">λ</span><span class="bound">α</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> rec_constr<span class="main">(</span><span class="skolem">f</span> <span class="main">∪</span> <span class="skolem">Cb</span><span class="main">,</span> <span class="bound">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∪</span> <span class="skolem">Cb</span><span class="main">:</span> Pow<span class="main">(</span><span class="free">G</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹Card<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">:</span> <span class="free">γ</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ord_in_Ord <span class="keyword1"><span class="command">unfolding</span></span> S_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> lam_type rec_constr_type<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">α</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">β</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> <span class="bound">α</span> <span class="main">&lt;</span> <span class="bound">β</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">(</span><span class="skolem">S</span> <span class="main">`</span> <span class="bound">α</span><span class="main">,</span> <span class="skolem">S</span> <span class="main">`</span> <span class="bound">β</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">α</span> <span class="skolem">β</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span><span class="main">∈</span><span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Card<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>rec_constr<span class="main">(</span><span class="skolem">f</span> <span class="main">∪</span> <span class="skolem">Cb</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">β</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">S</span><span class="main">`</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">β</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_trans<span class="main">[</span><span class="operator">OF</span> _ _ Card_is_Ord<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">β</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> S_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">β</span><span class="main">∈</span><span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">:</span> <span class="free">γ</span> <span class="main">→</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹Card<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">S</span><span class="main">`</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">β</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ord_trans<span class="main">[</span><span class="operator">OF</span> _ _ Card_is_Ord<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">β</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span>
        apply_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quoted"><span class="free">γ</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">G</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Card<span class="main">(</span><span class="free">γ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">β</span><span class="main">∈</span><span class="free">γ</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">{</span><span class="skolem">S</span><span class="main">`</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">β</span><span class="main">}</span><span class="main">|</span> <span class="main">&lt;</span> <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cardinal_RepFun_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">β</span></span><span class="main">]</span>  Ord_in_Ord
        lt_trans1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">{</span><span class="skolem">S</span><span class="main">`</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">β</span><span class="main">}</span><span class="main">|</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">β</span><span class="main">|</span>"</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span>
        Card_lt_iff<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">β</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">,</span> <span class="operator">OF</span> _ _ ltI<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">β</span><span class="main">.</span> <span class="free">Q</span><span class="main">(</span><span class="skolem">S</span><span class="main">`</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">S</span><span class="main">`</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">β</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> calculation <span class="keyword2"><span class="keyword">and</span></span> f_type
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">S</span><span class="main">`</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">β</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">β</span><span class="main">.</span> <span class="free">Q</span><span class="main">(</span><span class="skolem">S</span><span class="main">`</span><span class="bound">x</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> apply_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="var"><span class="quoted"><span class="var">?cdltγ</span></span></span> <span class="var"><span class="quoted"><span class="var">?inQ</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">S</span><span class="main">`</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">β</span><span class="main">}</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">∈</span><span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">&lt;</span> <span class="skolem">β</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">β</span><span class="main">∈</span><span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cb</span> <span class="main">∈</span> Pow<span class="main">(</span><span class="free">G</span><span class="main">)</span><span class="main">-</span><span class="var">?cdltγ</span> <span class="main">→</span> <span class="free">G</span>›</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">(</span><span class="skolem">S</span> <span class="main">`</span> <span class="skolem">α</span><span class="main">,</span> <span class="skolem">S</span> <span class="main">`</span> <span class="skolem">β</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fun_disjoint_apply1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">S</span><span class="main">`</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">β</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">Cb</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span>
        domain_of_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Cb</span></span><span class="main">]</span> ltD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">α</span></span> <span class="quoted"><span class="skolem">β</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> S_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">subst</span> rec_constr_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following basic result can, in turn, be proved by a
     bounded-cardinal selection.›</span></span>
<span class="keyword1" id="Cardinal_Library-Infinite_iff_lepoll_nat"><span class="command">lemma</span></span> Infinite_iff_lepoll_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"Infinite<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">⟷</span> <span class="keyword1">ω</span> <span class="main">≲</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Infinite<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Infinite_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">Y</span><span class="main">|</span> <span class="main">&lt;</span> <span class="keyword1">ω</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="skolem">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Finite_cardinal_iff' ltD nat_into_Finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Infinite<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">∈</span><span class="free">X</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">:</span> <span class="keyword1">ω</span> <span class="main">→</span> <span class="free">X</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">α</span><span class="main">∈</span><span class="keyword1">ω</span><span class="main">.</span> <span class="main">∀</span><span class="bound">β</span><span class="main">∈</span><span class="keyword1">ω</span><span class="main">.</span> <span class="bound">α</span> <span class="main">&lt;</span> <span class="bound">β</span> <span class="main">⟶</span> <span class="skolem">S</span><span class="main">`</span><span class="bound">α</span> <span class="main">≠</span> <span class="skolem">S</span><span class="main">`</span><span class="bound">β</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bounded_cardinal_selection<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="keyword1">ω</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span>"</span></span><span class="main">]</span>
      Card_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="keyword1">ω</span> <span class="main">⟹</span> <span class="skolem">β</span> <span class="main">∈</span> <span class="keyword1">ω</span> <span class="main">⟹</span> <span class="skolem">α</span><span class="main">≠</span><span class="skolem">β</span> <span class="main">⟹</span> <span class="skolem">S</span><span class="main">`</span><span class="skolem">α</span> <span class="main">≠</span> <span class="skolem">S</span><span class="main">`</span><span class="skolem">β</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span> <span class="skolem">β</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> lt_neq_symmetry<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">ω</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">α</span></span></span> <span class="bound"><span class="bound"><span class="bound">β</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">S</span></span></span><span class="main"><span class="main"><span class="main">`</span></span></span><span class="bound"><span class="bound"><span class="bound">α</span></span></span> <span class="main"><span class="main"><span class="main">≠</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">S</span></span></span><span class="main"><span class="main"><span class="main">`</span></span></span><span class="bound"><span class="bound"><span class="bound">β</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω</span> <span class="main">≲</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lepoll_def inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">intro</span> lepoll_nat_imp_Infinite<span class="main">)</span>

<span class="keyword1" id="Cardinal_Library-Infinite_InfCard_cardinal"><span class="command">lemma</span></span> Infinite_InfCard_cardinal<span class="main">:</span> <span class="quoted"><span class="quoted">"Infinite<span class="main">(</span><span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> InfCard<span class="main">(</span><span class="main">|</span><span class="free">X</span><span class="main">|</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lepoll_eq_trans eqpoll_sym lepoll_nat_imp_Infinite
    Infinite_iff_lepoll_nat Inf_Card_is_InfCard cardinal_eqpoll
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cardinal_Library-Finite_to_one_surj_imp_cardinal_eq"><span class="command">lemma</span></span> Finite_to_one_surj_imp_cardinal_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> Finite_to_one<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span> <span class="main">∩</span> surj<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Infinite<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">Y</span><span class="main">|</span> <span class="main">=</span> <span class="main">|</span><span class="free">X</span><span class="main">|</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> Finite_to_one<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span> <span class="main">∩</span> surj<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="free">F</span><span class="main">`</span><span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apply_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="free">Y</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="free">F</span><span class="main">`</span><span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> assms
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Finite_RepFun<span class="main">[</span><span class="operator">THEN</span> <span class="main"><span class="main">[</span></span>2<span class="main"><span class="main">]</span></span> Finite_Union<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="free">F</span><span class="main">`</span><span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">≲</span> <span class="main">|</span><span class="free">Y</span><span class="main">|</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll eqpoll_sym eqpoll_imp_lepoll <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> assms
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟹</span> <span class="main">|</span><span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="free">F</span><span class="main">`</span><span class="bound">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">}</span><span class="main">|</span> <span class="main">≤</span> <span class="main">|</span><span class="free">Y</span><span class="main">|</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> Infinite_imp_nats_lepoll<span class="main">[</span><span class="operator">THEN</span> lepoll_imp_cardinal_le<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">Y</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="free">F</span><span class="main">`</span><span class="bound">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">}</span><span class="main">|</span>"</span></span><span class="main">]</span> cardinal_idem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="free">F</span><span class="main">`</span><span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">|</span> <span class="main">≤</span> <span class="main">|</span><span class="free">Y</span><span class="main">|</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> leqpoll_imp_cardinal_UN_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">Y</span><span class="main">|</span>"</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">]</span>
        Infinite_InfCard_cardinal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">∈</span> Finite_to_one<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span> <span class="main">∩</span> surj<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">Y</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">Y</span><span class="main">|</span> <span class="main">≤</span> <span class="main">|</span><span class="free">X</span><span class="main">|</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> surj_implies_cardinal_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">.</span> <span class="free">F</span><span class="main">`</span><span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> le_anti_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cardinal_Library-cardinal_map_Un"><span class="command">lemma</span></span> cardinal_map_Un<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Infinite<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">{</span><span class="bound">a</span> <span class="main">∪</span> <span class="free">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span><span class="main">|</span> <span class="main">=</span> <span class="main">|</span><span class="free">X</span><span class="main">|</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∪</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> Finite_to_one<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span> <span class="main">∪</span> <span class="free">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∪</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span>  surj<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span> <span class="main">∪</span> <span class="free">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> surj_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="main">{</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∪</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="var">?Y</span><span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Finite<span class="main">(</span><span class="free">b</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">d</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∪</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">d</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">then</span> <span class="main">{</span><span class="skolem">d</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cons <span class="skolem">c</span> <span class="skolem">b</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∉</span> <span class="skolem">b</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span><span class="main">(</span>cons<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">c</span><span class="main">∈</span><span class="skolem">d</span> <span class="keyword1">then</span> <span class="var">?Y</span><span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?Y</span><span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">d</span><span class="main">-</span><span class="main">{</span><span class="skolem">c</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> cons
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> subset_Finite
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span> <span class="main">∪</span> <span class="free">b</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="main">{</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∪</span> <span class="free">b</span><span class="main">)</span> <span class="main">`</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lam_funtype<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Finite_to_one_surj_imp_cardinal_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Konig">
<div class="head">
<h1>Theory Konig</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Konig
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#Cofinality">Cofinality</a>
    <a href="#Cardinal_Library">Cardinal_Library</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Now, using the Axiom of choice, we can show that all successor
cardinals are regular.›</span></span>

<span class="keyword1" id="Konig-cf_csucc"><span class="command">lemma</span></span> cf_csucc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">≠</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹InfCard<span class="main">(</span><span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Limit<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> InfCard_csucc Card_is_Ord InfCard_is_Card InfCard_is_Limit
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_le_cardinal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span><span class="main">,</span> <span class="operator">THEN</span> le_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">]</span>
      Card_cardinal_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">:</span>cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">→</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">β</span><span class="main">∈</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">.</span> <span class="bound">β</span> <span class="main">&lt;</span> <span class="skolem">G</span><span class="main">`</span><span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_cofinal_fun_lt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span><span class="main">]</span> Ord_cf
      cf_le_cf_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span><span class="main">]</span> le_refl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Card<span class="main">(</span><span class="free">z</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Card<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">β</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">.</span> <span class="main">|</span><span class="skolem">G</span><span class="main">`</span><span class="bound">β</span><span class="main">|</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apply_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span><span class="main">,</span> <span class="operator">THEN</span> ltI<span class="main">]</span> Card_lt_iff<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">]</span>
      Ord_in_Ord<span class="main">[</span><span class="operator">OF</span> Card_is_Ord<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span><span class="main">]</span> cardinal_lt_csucc_iff<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹InfCard<span class="main">(</span><span class="free">z</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">≲</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cardinal_lt_csucc_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span><span class="main">]</span> Card_csucc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">z</span>"</span></span><span class="main">]</span>
      le_Card_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span><span class="main">]</span> InfCard_is_Card
      Card_lt_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span><span class="main">]</span> lt_Ord<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">β</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">.</span> <span class="main">|</span><span class="skolem">G</span><span class="main">`</span><span class="bound">β</span><span class="main">|</span> <span class="main">≤</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹InfCard<span class="main">(</span><span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">⋃</span><span class="bound">β</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">.</span> <span class="skolem">G</span><span class="main">`</span><span class="bound">β</span><span class="main">|</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> InfCard_csucc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
      subset_imp_lepoll<span class="main">[</span><span class="operator">THEN</span> lepoll_imp_cardinal_le<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="bound">β</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">.</span> <span class="skolem">G</span><span class="main">`</span><span class="bound">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> leqpoll_imp_cardinal_UN_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">β</span><span class="main">∈</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">.</span> <span class="bound">β</span> <span class="main">&lt;</span> <span class="skolem">G</span><span class="main">`</span><span class="bound">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">β</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">.</span> <span class="skolem">G</span><span class="main">`</span><span class="bound">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>ltD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subset_imp_le_cardinal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="bound">β</span><span class="main">∈</span>cf<span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span><span class="main">.</span> <span class="skolem">G</span><span class="main">`</span><span class="bound">β</span>"</span></span><span class="main">]</span> le_trans
      InfCard_is_Card Card_csucc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> Card_cardinal_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lt_csucc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> not_lt_iff_le<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span><span class="main">]</span>
      Card_csucc<span class="main">[</span><span class="operator">THEN</span> Card_is_Ord<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹And this finishes the calculation of cofinality of Alephs.›</span></span>

<span class="keyword1" id="Konig-cf_Aleph_succ"><span class="command">lemma</span></span> cf_Aleph_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">z</span><span class="main">)</span> <span class="main">⟹</span> cf<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub>succ<span class="main">(</span><span class="free">z</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> ℵ<span class="hidden">⇘</span><sub>succ<span class="main">(</span><span class="free">z</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Aleph_succ cf_csucc InfCard_Aleph <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹König's Theorem\label{sec:konig}›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We end this section by proving König's Theorem on the cofinality
of cardinal exponentiation. This is a strengthening of Cantor's theorem
and it is essentially the only basic way to prove strict cardinal
inequalities.

It is proved rather straightforwardly with the tools already developed.›</span></span>

<span class="keyword1" id="Konig-konigs_theorem"><span class="command">lemma</span></span> konigs_theorem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main">]</span> <span class="main">=</span> InfCard_is_Card Card_is_Ord
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">trans</span><span class="main">]</span> <span class="main">=</span> lt_trans1 lt_trans2
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">ν</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">κ</span><span class="main">)</span> <span class="main">≤</span> <span class="free">ν</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">κ</span> <span class="main">&lt;</span> <span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> Card_cexp
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> not_le_iff_lt<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="main">→</span> <span class="free">κ</span> <span class="main">≲</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Card_cardinal_eq<span class="main">[</span><span class="operator">OF</span> InfCard_is_Card<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
      Card_le_imp_lepoll
    <span class="keyword1"><span class="command">unfolding</span></span> cexp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈</span> surj<span class="main">(</span><span class="free">κ</span><span class="main">,</span> <span class="free">ν</span> <span class="main">→</span> <span class="free">κ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_imp_surj<span class="main">[</span><span class="operator">OF</span> _ function_space_nonempty<span class="main">,</span>
        <span class="operator">OF</span> _ nat_into_InfCard<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">:</span><span class="free">ν</span> <span class="main">→</span> <span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"cf_fun<span class="main">(</span><span class="skolem">f</span><span class="main">,</span><span class="free">κ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cf_le_cf_fun<span class="main">[</span><span class="operator">OF</span> _ InfCard_is_Limit<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span><span class="main">(</span><span class="skolem">α</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">μ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">κ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">&lt;</span><span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span><span class="main">.</span> <span class="skolem">G</span><span class="main">`</span><span class="bound">m</span><span class="main">`</span><span class="skolem">α</span> <span class="main">≠</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≡</span> <span class="keyword1">μ</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?P</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
  <span class="keyword1"><span class="command">have</span></span> H_satisfies<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="skolem">H</span><span class="main">(</span><span class="skolem">α</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="free">ν</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="skolem">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α</span><span class="main">∈</span><span class="free">ν</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">:</span><span class="free">ν</span> <span class="main">→</span> <span class="free">κ</span>›</span></span> <span class="quoted"><span class="quoted">‹InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span> <span class="main">&lt;</span> <span class="free">κ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> apply_type<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main">.</span> <span class="free">κ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>ltI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">{</span><span class="skolem">G</span><span class="main">`</span><span class="bound">m</span><span class="main">`</span><span class="skolem">α</span> <span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">κ</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span><span class="main">}</span><span class="main">}</span><span class="main">|</span> <span class="main">≤</span> <span class="main">|</span><span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">κ</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span><span class="main">}</span><span class="main">|</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cardinal_RepFun_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span> <span class="main">&lt;</span> <span class="free">κ</span>›</span></span> <span class="quoted"><span class="quoted">‹InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">κ</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span><span class="main">}</span><span class="main">|</span> <span class="main">&lt;</span> <span class="main">|</span><span class="free">κ</span><span class="main">|</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Card_lt_iff<span class="main">[</span><span class="operator">OF</span> lt_Ord<span class="main">,</span> <span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span>"</span></span> <span class="quoted"><span class="free">κ</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span>
          Ord_eq_Collect_lt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span>"</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span> Card_cardinal_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">finally</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">{</span><span class="skolem">G</span><span class="main">`</span><span class="bound">m</span><span class="main">`</span><span class="skolem">α</span> <span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="free">κ</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span><span class="main">}</span><span class="main">}</span><span class="main">|</span> <span class="main">&lt;</span> <span class="main">|</span><span class="free">κ</span><span class="main">|</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span> <span class="main">&lt;</span> <span class="free">κ</span>›</span></span> <span class="quoted"><span class="quoted">‹InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&lt;</span><span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span> <span class="main">⟹</span> <span class="skolem">m</span><span class="main">∈</span><span class="free">κ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
        <span class="keyword1"><span class="command">using</span></span> Ord_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span>"</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>ltD<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h</span><span class="main">.</span> <span class="var">?P</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">h</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lt_cardinal_imp_not_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> that
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="skolem">H</span><span class="main">(</span><span class="skolem">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> LeastI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">(</span><span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">h</span></span><span class="main">]</span> lt_Ord Ord_in_Ord
      <span class="keyword1"><span class="command">unfolding</span></span> H_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">∈</span><span class="free">ν</span><span class="main">.</span> <span class="skolem">H</span><span class="main">(</span><span class="bound">α</span><span class="main">)</span><span class="main">)</span><span class="main">:</span> <span class="free">ν</span> <span class="main">→</span> <span class="free">κ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lam_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">∈</span> surj<span class="main">(</span><span class="free">κ</span><span class="main">,</span> <span class="free">ν</span> <span class="main">→</span> <span class="free">κ</span><span class="main">)</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="free">κ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">`</span><span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">∈</span><span class="free">ν</span><span class="main">.</span> <span class="skolem">H</span><span class="main">(</span><span class="bound">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> surj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹InfCard<span class="main">(</span><span class="free">κ</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span><span class="main">:</span> <span class="free">ν</span> <span class="main">→</span> <span class="free">κ</span>›</span></span> <span class="quoted"><span class="quoted">‹cf_fun<span class="main">(</span><span class="skolem">f</span><span class="main">,</span><span class="main">_</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">∈</span><span class="free">ν</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit_cofinal_fun_lt<span class="main">[</span><span class="operator">OF</span> InfCard_is_Limit<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span><span class="main">`</span><span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">∈</span><span class="free">ν</span><span class="main">.</span> <span class="skolem">H</span><span class="main">(</span><span class="bound">α</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">`</span><span class="skolem">n</span><span class="main">`</span><span class="skolem">α</span> <span class="main">=</span> <span class="skolem">H</span><span class="main">(</span><span class="skolem">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ltD <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation <span class="keyword2"><span class="keyword">and</span></span> H_satisfies
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">&lt;</span><span class="skolem">f</span><span class="main">`</span><span class="skolem">α</span><span class="main">.</span> <span class="skolem">G</span><span class="main">`</span><span class="bound">m</span><span class="main">`</span><span class="skolem">α</span> <span class="main">≠</span> <span class="skolem">H</span><span class="main">(</span><span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Konig-cf_cexp"><span class="command">lemma</span></span> cf_cexp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"Card<span class="main">(</span><span class="free">κ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">ν</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">2</span> <span class="main">≤</span> <span class="free">κ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="main">&lt;</span> cf<span class="main">(</span><span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">ν</span> <span class="main">&lt;</span> cf<span class="main">(</span><span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹InfCard<span class="main">(</span><span class="free">ν</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf<span class="main">(</span><span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">≤</span> <span class="free">ν</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> not_lt_iff_le Ord_cf InfCard_is_Card Card_is_Ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> assms
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"InfCard<span class="main">(</span><span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InfCard_cexp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">κ</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="hidden">⇗</span><sup>↑<span class="free">ν</span></sup><span class="hidden">⇖</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> konigs_theorem <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> cexp_cexp_cmult InfCard_csquare_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finally, the next two corollaries illustrate the only possible
exceptions to the value of the cardinality of the continuum: The limit
cardinals of countable cofinality. That these are the only exceptions
is a consequence of Easton's Theorem~\cite[Thm 15.18]{Jech_Millennium}.›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> cf_continuum<span class="main">:</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span> <span class="main">&lt;</span> cf<span class="main">(</span><span class="main">2</span><span class="hidden">⇗</span><sup>↑ℵ<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cf_cexp InfCard_Aleph nat_into_Card <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> continuum_not_eq_Aleph_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">2</span><span class="hidden">⇗</span><sup>↑ℵ<span class="hidden">⇘</span><sub><span class="main">0</span></sub><span class="hidden">⇙</span></sup><span class="hidden">⇖</span> <span class="main">≠</span> ℵ<span class="hidden">⇘</span><sub><span class="keyword1">ω</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cf_continuum cf_Aleph_Limit<span class="main">[</span><span class="operator">OF</span> Limit_nat<span class="main">]</span> cf_nat
    Aleph_zero_eq_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Delta_System">
<div class="head">
<h1>Theory Delta_System</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The Delta System Lemma\label{sec:dsl}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Delta_System
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#Cardinal_Library">Cardinal_Library</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹delta system›</span></span> is family of sets with a common pairwise
intersection.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">delta_system</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"i <span class="main">⇒</span> o"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">delta_system</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="bound">r</span>"</span></span>

<span class="keyword1" id="Delta_System-delta_systemI"><span class="command">lemma</span></span> delta_systemI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"delta_system<span class="main">(</span><span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> delta_system_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Delta_System-delta_systemD"><span class="command">lemma</span></span> delta_systemD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"delta_system<span class="main">(</span><span class="free">D</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="bound">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delta_system_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Hence, pairwise intersections equal the intersection of the whole
family.›</span></span>

<span class="keyword1" id="Delta_System-delta_system_root_eq_Inter"><span class="command">lemma</span></span> delta_system_root_eq_Inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"delta_system<span class="main">(</span><span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="main">⋂</span><span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A'</span> <span class="skolem">B'</span> <span class="skolem">x</span> <span class="skolem">C</span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">A'</span><span class="main">∈</span><span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span><span class="main">∈</span> <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span><span class="main">≠</span><span class="skolem">B'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">A'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">B'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">∈</span><span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> delta<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">=</span><span class="skolem">A'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> hyp <span class="keyword2"><span class="keyword">and</span></span> assms
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> hyp
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation <span class="keyword2"><span class="keyword">and</span></span> delta
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">A'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">∩</span> <span class="skolem">B'</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹Delta System Lemma›</span></span> (DSL) states that any uncountable family of
finite sets includes an uncountable delta system. This is the simplest
non trivial version; others, for cardinals greater than <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹ℵ<span class="hidden">⇘</span><sub><span class="main"><span class="main">1</span></span></sub><span class="hidden">⇙</span>›</span></span></span></span>  assume
some weak versions of the generalized continuum hypothesis for the
cardinals involved.

The proof is essentially the one in \cite[III.2.6]{kunen2011set} for the
case  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹ℵ<span class="hidden">⇘</span><sub><span class="main"><span class="main">1</span></span></sub><span class="hidden">⇙</span>›</span></span></span></span>; another similar presentation can be found in
\cite[Chap.~16]{JW}.›</span></span>

<span class="keyword1" id="Delta_System-delta_system_Aleph1"><span class="command">lemma</span></span> delta_system_Aleph1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> Finite<span class="main">(</span><span class="bound">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> delta_system<span class="main">(</span><span class="bound">D</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Since all members are finite,›</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> Finite<span class="main">(</span><span class="bound">A</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="main">|</span><span class="bound">A</span><span class="main">|</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="main">→</span> <span class="keyword1">ω</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cards</span> <span class="main">:</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> lam_type<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?cards</span> <span class="main">-``</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">A</span><span class="main">∈</span><span class="free">F</span> <span class="main">.</span> <span class="main">|</span><span class="bound">A</span><span class="main">|</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> vimage_lam <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹there are uncountably many have the same cardinal:›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="keyword1">ω</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="var">?cards</span> <span class="main">-``</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">|</span> <span class="main">=</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqpoll_Aleph1_cardinal_vimage<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span> <span class="var"><span class="quoted"><span class="var">?cards</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">≡</span> <span class="var">?cards</span> <span class="main">-``</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Therefore, without loss of generality, we can assume that all
  elements of the family have cardinality <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">n</span></span><span class="main"><span class="main">∈</span></span><span class="keyword1"><span class="keyword1">ω</span></span>›</span></span></span></span>.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span><span class="skolem">G</span> <span class="main">⟹</span> <span class="main">|</span><span class="skolem">A</span><span class="main">|</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
    <span class="keyword1"><span class="command">using</span></span> cardinal_Card_eqpoll_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">∈</span><span class="keyword1">ω</span>›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹So we prove the result by induction on this <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">n</span></span>›</span></span></span></span> and
  generalizing <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">G</span></span>›</span></span></span></span>, since the argument requires changing the
  family in order to apply the inductive hypothesis.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">⊆</span> <span class="skolem">G</span> <span class="main">∧</span> delta_system<span class="main">(</span><span class="bound">D</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">G</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="comment1">― ‹This case is impossible›</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cardinal_0_iff_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> nat_lt_Aleph1 subset_imp_le_cardinal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main">]</span>
        lt_trans2 cardinal_Card_eqpoll_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> Finite<span class="main">(</span><span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Finite_cardinal_iff' nat_into_Finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">⊆</span> <span class="skolem">G</span> <span class="main">∧</span> delta_system<span class="main">(</span><span class="bound">D</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">G</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="comment1">― ‹the positive case, uncountably many sets with a
                    common element›</span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">G</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">.</span> <span class="bound">A</span><span class="main">∈</span><span class="main">{</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="skolem">p</span><span class="main">∈</span><span class="bound">X</span><span class="main">}</span><span class="main">}</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">≈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Diff_bij<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">G</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">p</span><span class="main">}</span>"</span></span><span class="main">]</span>
          comp_bij<span class="main">[</span><span class="operator">OF</span> bij_converse_bij<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> C<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Now using the hypothesis of the successor case,›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span><span class="skolem">G</span> <span class="main">⟹</span> <span class="main">|</span><span class="bound">A</span><span class="main">|</span><span class="main">=</span>succ<span class="main">(</span><span class="skolem">n</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> Finite<span class="main">(</span><span class="bound">a</span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> this
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">⟹</span> <span class="skolem">A</span><span class="main">∈</span><span class="skolem">G</span> <span class="main">⟹</span> <span class="main">|</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">|</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
        <span class="keyword1"><span class="command">using</span></span> Finite_imp_succ_cardinal_Diff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">∈</span><span class="keyword1">ω</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="var">?F</span><span class="main">.</span> Finite<span class="main">(</span><span class="bound">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Finite_cardinal_iff' nat_into_Finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹we may apply the inductive hypothesis to the new family <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="var"><span class="var">?F</span></span>›</span></span></span></span>:›</span></span>
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="var">?F</span> <span class="main">⟹</span> <span class="main">|</span><span class="bound">A</span><span class="main">|</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?F</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span>
             <span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">⊆</span> <span class="var">?F</span> <span class="main">∧</span> delta_system<span class="main">(</span><span class="bound">D</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>›</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span><span class="main">⊆</span><span class="main">{</span><span class="bound">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">.</span> <span class="bound">A</span><span class="main">∈</span><span class="main">{</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="skolem">p</span><span class="main">∈</span><span class="bound">X</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"delta_system<span class="main">(</span><span class="skolem">D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">D</span><span class="main">.</span> <span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="skolem">D</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">D</span><span class="main">.</span><span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="skolem">D</span><span class="main">.</span> <span class="bound">A</span><span class="main">∪</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">≠</span> <span class="bound">B</span><span class="main">∪</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">⟶</span><span class="main">(</span><span class="bound">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="bound">B</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">∪</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"delta_system<span class="main">(</span><span class="main">{</span><span class="bound">B</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">.</span> <span class="bound">B</span><span class="main">∈</span><span class="skolem">D</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"delta_system<span class="main">(</span><span class="var">?D</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">D</span><span class="main">|</span> <span class="main">=</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"Infinite<span class="main">(</span><span class="skolem">D</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cardinal_eqpoll_iff
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> uncountable_iff_subset_eqpoll_Aleph1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span>
            uncountable_imp_Infinite<span class="main">)</span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cardinal_map_Un<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">D</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">p</span><span class="main">}</span>"</span></span><span class="main">]</span> naturals_lt_nat
          cardinal_eqpoll_iff<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">.</span> <span class="bound">A</span><span class="main">∈</span><span class="main">{</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="skolem">p</span><span class="main">∈</span><span class="bound">X</span><span class="main">}</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">⊆</span> <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span><span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">-</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">.</span> <span class="bound">A</span><span class="main">∈</span><span class="main">{</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="skolem">p</span><span class="main">∈</span><span class="bound">X</span><span class="main">}</span><span class="main">}</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">⊆</span> <span class="skolem">G</span> <span class="main">∧</span> delta_system<span class="main">(</span><span class="bound">D</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="bound">A</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">)</span>›</span></span> <span class="comment1">― ‹the other case›</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">A</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">.</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span> <span class="main">≲</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span><span class="main">(</span><span class="skolem">p</span><span class="main">)</span> <span class="main">≲</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lepoll_eq_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subset_imp_lepoll<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span><span class="main">(</span><span class="skolem">p</span><span class="main">)</span> <span class="main">≺</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
        <span class="keyword1"><span class="command">unfolding</span></span> lesspoll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="comment1">(* may omit the previous step if unfolding here: *)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span><span class="main">(</span><span class="skolem">p</span><span class="main">)</span> <span class="main">≲</span> <span class="keyword1">ω</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
        <span class="keyword1"><span class="command">using</span></span> lesspoll_aleph_plus_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> Aleph_zero_eq_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">A</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">.</span> <span class="skolem">S</span> <span class="main">∩</span> <span class="bound">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="var">?G</span><span class="main">(</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="skolem">S</span><span class="main">)</span> <span class="main">⟹</span> countable<span class="main">(</span><span class="main">{</span><span class="bound">A</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">.</span> <span class="skolem">S</span> <span class="main">∩</span> <span class="bound">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span>
        <span class="keyword1"><span class="command">using</span></span> InfCard_nat Card_nat
         le_Card_iff<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">THEN</span> <span class="main"><span class="main">[</span></span>3<span class="main"><span class="main">]</span></span> leqpoll_imp_cardinal_UN_le<span class="main">,</span>
           <span class="operator">THEN</span> <span class="main"><span class="main">[</span></span>2<span class="main"><span class="main">]</span></span> le_Card_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="keyword1">ω</span></span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> countable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For every countable subfamily of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">G</span></span>›</span></span></span></span> there is another some
      element disjoint from all of them:›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">S</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∩</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">X</span><span class="main">|</span> <span class="main">&lt;</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">∈</span><span class="keyword1">ω</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span><span class="skolem">G</span> <span class="main">⟹</span> <span class="main">|</span><span class="bound">A</span><span class="main">|</span> <span class="main">=</span> succ<span class="main">(</span><span class="skolem">n</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span><span class="skolem">G</span> <span class="main">⟹</span> Finite<span class="main">(</span><span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
          <span class="keyword1"><span class="command">using</span></span> cardinal_Card_eqpoll_iff
          <span class="keyword1"><span class="command">unfolding</span></span> Finite_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span><span class="main">⊆</span><span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span><span class="skolem">X</span> <span class="main">⟹</span> countable<span class="main">(</span><span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span>
          <span class="keyword1"><span class="command">using</span></span> Finite_imp_countable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">|</span><span class="skolem">X</span><span class="main">|</span> <span class="main">&lt;</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="main">⋃</span><span class="skolem">X</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Card_nat<span class="main">[</span><span class="operator">THEN</span> cardinal_lt_csucc_iff<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span><span class="main">]</span>
            countable_union_countable countable_iff_cardinal_le_nat
          <span class="keyword1"><span class="command">unfolding</span></span> Aleph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹countable<span class="main">(</span><span class="main">_</span><span class="main">)</span> <span class="main">⟹</span> countable<span class="main">(</span><span class="main">{</span><span class="bound">A</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">.</span> <span class="main">_</span>  <span class="main">∩</span> <span class="bound">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="main">{</span><span class="bound">A</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">X</span><span class="main">)</span> <span class="main">∩</span> <span class="bound">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>›</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">∈</span><span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">A</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">X</span><span class="main">)</span> <span class="main">∩</span> <span class="bound">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> nat_lt_Aleph1 cardinal_Card_eqpoll_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">]</span>
            uncountable_not_subset_countable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">A</span> <span class="main">∈</span> <span class="skolem">G</span> <span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">X</span><span class="main">)</span> <span class="main">∩</span> <span class="bound">A</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">]</span>
            uncountable_iff_nat_lt_cardinal
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">S</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∩</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> uncountable_iff_subset_eqpoll_Aleph1
          uncountable_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Hence, the hypotheses to perform a bounded-cardinal selection
      are satisfied,›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">:</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">→</span><span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">∈</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="skolem">β</span><span class="main">∈</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="skolem">α</span><span class="main">&lt;</span><span class="skolem">β</span> <span class="main">⟹</span> <span class="skolem">S</span><span class="main">`</span><span class="skolem">α</span> <span class="main">∩</span> <span class="skolem">S</span><span class="main">`</span><span class="skolem">β</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span> <span class="skolem">β</span>
        <span class="keyword1"><span class="command">using</span></span> bounded_cardinal_selection<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">G</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∩</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="skolem">β</span> <span class="main">∈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">⟹</span> <span class="skolem">α</span><span class="main">≠</span><span class="skolem">β</span> <span class="main">⟹</span> <span class="skolem">S</span><span class="main">`</span><span class="skolem">α</span> <span class="main">∩</span> <span class="skolem">S</span><span class="main">`</span><span class="skolem">β</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span> <span class="skolem">β</span>
        <span class="keyword1"><span class="command">using</span></span> lt_neq_symmetry<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="skolem">S</span><span class="main">`</span><span class="bound">α</span> <span class="main">∩</span> <span class="skolem">S</span><span class="main">`</span><span class="bound">β</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">]</span> Card_is_Ord
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹and a symmetry argument shows that obtained <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">S</span></span>›</span></span></span></span> is
      an injective  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹ℵ<span class="hidden">⇘</span><sub><span class="main"><span class="main">1</span></span></sub><span class="hidden">⇙</span>›</span></span></span></span>-sequence of disjoint elements of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">G</span></span>›</span></span></span></span>.›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span><span class="skolem">G</span> <span class="main">⟹</span> <span class="main">|</span><span class="bound">A</span><span class="main">|</span> <span class="main">=</span> succ<span class="main">(</span><span class="skolem">n</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">:</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span> <span class="main">→</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> inj<span class="main">(</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span><span class="main">,</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cardinal_succ_not_0 Int_eq_zero_imp_not_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">S</span><span class="main">`</span><span class="bound">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range<span class="main">(</span><span class="skolem">S</span><span class="main">)</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inj_bij_range eqpoll_sym <span class="keyword1"><span class="command">unfolding</span></span> eqpoll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range<span class="main">(</span><span class="skolem">S</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inj_is_fun range_fun_subset_codomain <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">⊆</span> <span class="skolem">G</span> <span class="main">∧</span> delta_system<span class="main">(</span><span class="bound">D</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inj_is_fun range_eq_image<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">]</span>
          image_function<span class="main">[</span><span class="operator">OF</span> fun_is_function<span class="main">,</span> <span class="operator">OF</span> inj_is_fun<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">]</span>
          domain_of_fun<span class="main">[</span><span class="operator">OF</span> inj_is_fun<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quoted"><span class="quoted">"ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">``</span>ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This finishes the successor case and hence the proof.›</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Delta_System-delta_system_uncountable"><span class="command">lemma</span></span> delta_system_uncountable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> Finite<span class="main">(</span><span class="bound">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> delta_system<span class="main">(</span><span class="bound">D</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> uncountable_iff_subset_eqpoll_Aleph1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> Finite<span class="main">(</span><span class="bound">A</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> Finite<span class="main">(</span><span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> delta_system_Aleph1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Cohen_Posets">
<div class="head">
<h1>Theory Cohen_Posets</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Application to Cohen posets\label{sec:cohen}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cohen_Posets
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#Delta_System">Delta_System</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We end this session by applying DSL to the combinatorics of
finite function posets. We first define some basic concepts; we take
a different approach from \cite{2020arXiv200109715G}, in that the
order relation is presented as a predicate (of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">[</span></span>i<span class="main"><span class="main">,</span></span>i<span class="main"><span class="main">]</span></span> <span class="main"><span class="main">⇒</span></span> o›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>). 

Two elements of a poset are <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹compatible›</span></span> if they have a common lower
bound.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compat_in</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span><span class="main">[</span>i<span class="main">,</span>i<span class="main">]</span><span class="main">⇒</span>o<span class="main">,</span>i<span class="main">,</span>i<span class="main">]</span><span class="main">⇒</span>o"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">compat_in</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">d</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹antichain›</span></span> is a subset of pairwise incompatible members.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">antichain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span><span class="main">[</span>i<span class="main">,</span>i<span class="main">]</span><span class="main">⇒</span>o<span class="main">,</span>i<span class="main">]</span><span class="main">⇒</span>o"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">antichain</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">leq</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">⊆</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">q</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span>
                <span class="bound">p</span><span class="main">≠</span><span class="bound">q</span> <span class="main">⟶</span> <span class="main">¬</span>compat_in<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">leq</span></span></span><span class="main">,</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A poset has the  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹countable chain condition›</span></span> (ccc) if all of its
antichains are countable.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ccc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span><span class="main">[</span>i<span class="main">,</span>i<span class="main">]</span><span class="main">⇒</span>o<span class="main">]</span><span class="main">⇒</span>o"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ccc</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">leq</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">A</span><span class="main">.</span> antichain<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">leq</span></span></span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">⟶</span> countable<span class="main">(</span><span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finally, the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹Cohen poset›</span></span> is the set of finite partial functions
between two sets with the order of reverse inclusion.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Fn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>i<span class="main">,</span>i<span class="main">]</span> <span class="main">⇒</span> i"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Fn</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">J</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">⋃</span><span class="main">{</span><span class="main">(</span><span class="bound">d</span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">J</span></span></span><span class="main">)</span> <span class="main">.</span> <span class="bound">d</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span> <span class="main">∈</span> Pow<span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span><span class="main">.</span>  Finite<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">Supset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"i <span class="main">⇒</span> i <span class="main">⇒</span> o"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">⊇</span>›</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">⊇</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1" id="Cohen_Posets-FnI"><span class="command">lemma</span></span> FnI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">:</span> <span class="free">d</span> <span class="main">→</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span><span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Fn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cohen_Posets-FnD"><span class="command">lemma</span></span> FnD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span><span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d</span><span class="main">.</span> <span class="free">p</span> <span class="main">:</span> <span class="bound">d</span> <span class="main">→</span> <span class="free">J</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">⊆</span> <span class="free">I</span> <span class="main">∧</span> Finite<span class="main">(</span><span class="bound">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Fn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cohen_Posets-Fn_is_function"><span class="command">lemma</span></span> Fn_is_function<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span><span class="free">J</span><span class="main">)</span> <span class="main">⟹</span> function<span class="main">(</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Fn_def <span class="keyword1"><span class="command">using</span></span> fun_is_function <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cohen_Posets-restrict_eq_imp_compat"><span class="command">lemma</span></span> restrict_eq_imp_compat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">f</span><span class="main">,</span> domain<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">∩</span> domain<span class="main">(</span><span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> restrict<span class="main">(</span><span class="free">g</span><span class="main">,</span> domain<span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">∩</span> domain<span class="main">(</span><span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∪</span> <span class="free">g</span> <span class="main">∈</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="free">J</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="skolem"><span class="skolem">d2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">:</span> <span class="skolem">d1</span> <span class="main">→</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">∈</span> Pow<span class="main">(</span><span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="skolem">d1</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">:</span> <span class="skolem">d2</span> <span class="main">→</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span> <span class="main">∈</span> Pow<span class="main">(</span><span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="skolem">d2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> domain_of_fun
      restrict_eq_imp_Un_into_Pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">d1</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="skolem">d2</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">J</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We finally arrive to our application of DSL.›</span></span>

<span class="keyword1" id="Cohen_Posets-ccc_Fn_2"><span class="command">lemma</span></span> ccc_Fn_2<span class="main">:</span> <span class="quoted"><span class="quoted">"ccc<span class="main">(</span>Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span><span class="main">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(⊇)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> countable<span class="main">(</span><span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="main">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">d</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="skolem">d</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="main">2</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">.</span> domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">d</span> <span class="main">→</span> <span class="main">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> domain_of_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="skolem">d</span> <span class="main">→</span> <span class="main">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Finite_Pi lesspoll_nat_is_Finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subset_Finite<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">→</span><span class="main">2</span>"</span></span> <span class="main">]</span> Finite_imp_countable
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="main">2</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">.</span> domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> domain_of_fun<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> empty_lepollI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="main">{</span>domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="main">2</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">d</span><span class="main">∈</span><span class="main">{</span>domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="main">{</span>domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">d</span><span class="main">.</span> countable<span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d</span><span class="main">}</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>countable<span class="main">(</span><span class="skolem">A</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
        <span class="keyword1"><span class="command">using</span></span> countable_imp_countable_UN<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">p</span><span class="main">∈</span><span class="skolem">A</span><span class="main">}</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="main">{</span><span class="bound">p</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">}</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="main">2</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">⟹</span> Finite<span class="main">(</span>domain<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
      <span class="keyword1"><span class="command">using</span></span> lesspoll_nat_is_Finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main">]</span>
        domain_of_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"delta_system<span class="main">(</span><span class="skolem">D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">⊆</span> <span class="main">{</span>domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> delta_system_uncountable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> delta<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d1</span><span class="main">∈</span><span class="skolem">D</span><span class="main">.</span> <span class="main">∀</span><span class="bound">d2</span><span class="main">∈</span><span class="skolem">D</span><span class="main">.</span> <span class="bound">d1</span> <span class="main">≠</span> <span class="bound">d2</span> <span class="main">⟶</span> <span class="bound">d1</span> <span class="main">∩</span> <span class="bound">d2</span> <span class="main">=</span> <span class="main">⋂</span><span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> delta_system_root_eq_Inter
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">≈</span> ℵ<span class="hidden">⇘</span><sub><span class="main">1</span></sub><span class="hidden">⇙</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="skolem">D</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uncountable_iff_subset_eqpoll_Aleph1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">⊆</span> <span class="main">{</span>domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">}</span>›</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="skolem">p1</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uncountable_not_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">D</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p1</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">⟹</span> Finite<span class="main">(</span>domain<span class="main">(</span><span class="skolem">p1</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span>domain<span class="main">(</span><span class="skolem">p1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Finite_domain <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≡</span> <span class="main">⋂</span><span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Finite<span class="main">(</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subset_Finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="skolem">p1</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="main">{</span>restrict<span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">.</span> <span class="bound">p</span><span class="main">∈</span><span class="skolem">A</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="main">2</span><span class="main">)</span> <span class="main">⟹</span> restrict<span class="main">(</span><span class="skolem">f</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">∈</span> Pow<span class="main">(</span><span class="skolem">r</span> <span class="main">×</span> <span class="main">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
        <span class="keyword1"><span class="command">using</span></span> restrict_subset_Sigma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">2</span>"</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>FnD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pi_def<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="main">2</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>restrict<span class="main">(</span><span class="bound">f</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">}</span> <span class="main">⊆</span> Pow<span class="main">(</span><span class="skolem">r</span> <span class="main">×</span> <span class="main">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Finite<span class="main">(</span><span class="skolem">r</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Finite_Sigma<span class="main">[</span><span class="operator">THEN</span> Finite_Pow<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">2</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Finite_imp_countable<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>subset_Finite<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="var">?X</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">⊆</span> <span class="main">{</span>domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">∈</span><span class="var">?X</span><span class="main">.</span> domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> surj<span class="main">(</span><span class="var">?X</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lam_type <span class="keyword1"><span class="command">unfolding</span></span> surj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="var">?X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹uncountable<span class="main">(</span><span class="skolem">D</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> surj_countable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">f</span><span class="main">∈</span>Pow<span class="main">(</span><span class="skolem">r</span><span class="main">×</span><span class="main">2</span><span class="main">)</span> <span class="main">.</span> <span class="main">{</span>domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">.</span> <span class="bound">p</span><span class="main">∈</span><span class="main">{</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> restrict<span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">∧</span> domain<span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">D</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">⊆</span> <span class="main">_</span>›</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="main">2</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> this
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">:</span> <span class="skolem">z</span> <span class="main">→</span> <span class="main">2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> domain_of_fun <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>FnD<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">r</span> <span class="main">×</span> <span class="main">2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> function_restrictI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> fun_is_function<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">2</span>"</span></span><span class="main">]</span>
            restrict_subset_Sigma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">2</span>"</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Pi_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span>  restrict<span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">∈</span> Pow<span class="main">(</span><span class="skolem">r</span><span class="main">×</span><span class="main">2</span><span class="main">)</span> <span class="main">∧</span> domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI<span class="main">)</span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="main">{</span>domain<span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">.</span> <span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> restrict<span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">∧</span> domain<span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"uncountable<span class="main">(</span><span class="var">?Y</span><span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Finite<span class="main">(</span><span class="skolem">r</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span>Pow<span class="main">(</span><span class="skolem">r</span><span class="main">×</span><span class="main">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Finite_Sigma<span class="main">[</span><span class="operator">THEN</span> Finite_Pow<span class="main">,</span> <span class="operator">THEN</span> Finite_imp_countable<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"countable<span class="main">(</span><span class="var">?Y</span><span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">f</span><span class="main">∈</span>Pow<span class="main">(</span><span class="skolem">r</span><span class="main">×</span><span class="main">2</span><span class="main">)</span> <span class="main">.</span><span class="var">?Y</span><span class="main">(</span><span class="bound">f</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹uncountable<span class="main">(</span><span class="skolem">D</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> countable_imp_countable_UN<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Pow<span class="main">(</span><span class="skolem">r</span><span class="main">×</span><span class="main">2</span><span class="main">)</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">with</span></span> that
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> inj<span class="main">(</span>nat<span class="main">,</span> <span class="var">?Y</span><span class="main">(</span><span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uncountable_iff_nat_lt_cardinal<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">THEN</span> leI<span class="main">,</span>
          <span class="operator">THEN</span> cardinal_le_imp_lepoll<span class="main">,</span> <span class="operator">THEN</span> lepollD<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">`</span><span class="main">0</span> <span class="main">≠</span> <span class="skolem">j</span><span class="main">`</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">`</span><span class="main">0</span> <span class="main">∈</span> <span class="var">?Y</span><span class="main">(</span><span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">`</span><span class="main">1</span> <span class="main">∈</span> <span class="var">?Y</span><span class="main">(</span><span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inj_is_fun<span class="main">[</span><span class="operator">THEN</span> apply_type<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted">nat</span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span><span class="main">(</span><span class="skolem">f</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="skolem">p</span><span class="main">)</span> <span class="main">≠</span> domain<span class="main">(</span><span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span>"</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">D</span>"</span></span>
      <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> restrict<span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> delta
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"domain<span class="main">(</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∩</span> domain<span class="main">(</span><span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="main">2</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∪</span> <span class="skolem">q</span> <span class="main">∈</span> Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="main">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> restrict_eq_imp_compat<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="bound">q</span> <span class="main">∧</span> compat_in<span class="main">(</span>Fn<span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="main">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(⊇)</span><span class="main">,</span> <span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> compat_in_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ccc_def antichain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The fact that a poset $P$ has the ccc has useful consequences for the
theory of forcing, since it implies that cardinals from the original
model are exactly the cardinals in any generic extension by $P$
\cite[Chap.~IV]{kunen2011set}.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>